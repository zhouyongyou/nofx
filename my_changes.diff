diff --git a/.github/workflows/docker-build.yml b/.github/workflows/docker-build.yml
index 419e678c..8c5403d1 100644
--- a/.github/workflows/docker-build.yml
+++ b/.github/workflows/docker-build.yml
@@ -7,14 +7,18 @@ on:
       - dev
     tags:
       - 'v*'
+  pull_request:
+    branches:
+      - main
+      - dev
   workflow_dispatch:
 
 env:
   REGISTRY_GHCR: ghcr.io
 
 jobs:
-  # 预处理: 转换镜像名为小写
   prepare:
+    name: Prepare repository metadata
     runs-on: ubuntu-22.04
     outputs:
       image_base: ${{ steps.lowercase.outputs.image_base }}
@@ -26,21 +30,17 @@ jobs:
           echo "image_base=${REPO_LOWER}" >> $GITHUB_OUTPUT
           echo "Lowercase repository: ${REPO_LOWER}"
 
-  # 并行构建策略: 使用原生架构 runner 提升速度
-  # GitHub Actions 现在支持原生 ARM64 runner (ubuntu-22.04-arm)
   build-and-push:
+    name: Build ${{ matrix.name }} (${{ matrix.arch_tag }})
     needs: prepare
     runs-on: ${{ matrix.runner }}
     permissions:
       contents: read
       packages: write
-
     strategy:
-      # 并行运行所有构建任务
       fail-fast: false
       matrix:
         include:
-          # Backend builds
           - name: backend
             dockerfile: ./docker/Dockerfile.backend
             image_suffix: backend
@@ -52,8 +52,7 @@ jobs:
             image_suffix: backend
             platform: linux/arm64
             arch_tag: arm64
-            runner: ubuntu-22.04-arm  # 原生 ARM64 runner
-          # Frontend builds
+            runner: ubuntu-22.04-arm
           - name: frontend
             dockerfile: ./docker/Dockerfile.frontend
             image_suffix: frontend
@@ -65,32 +64,28 @@ jobs:
             image_suffix: frontend
             platform: linux/arm64
             arch_tag: arm64
-            runner: ubuntu-22.04-arm  # 原生 ARM64 runner
-    
+            runner: ubuntu-22.04-arm
     steps:
       - name: Checkout code
         uses: actions/checkout@v4
 
-      # 原生 ARM64 runner 不需要 QEMU 模拟
-      # 只在需要时设置 QEMU (理论上不需要,因为是原生构建)
-
       - name: Set up Docker Buildx
         uses: docker/setup-buildx-action@v3
-      
+
       - name: Log in to GitHub Container Registry
         uses: docker/login-action@v3
         with:
           registry: ${{ env.REGISTRY_GHCR }}
           username: ${{ github.actor }}
           password: ${{ secrets.GITHUB_TOKEN }}
-      
+
       - name: Log in to Docker Hub
         uses: docker/login-action@v3
         with:
           username: ${{ secrets.DOCKERHUB_USERNAME }}
           password: ${{ secrets.DOCKERHUB_TOKEN }}
         continue-on-error: true
-      
+
       - name: Extract metadata
         id: meta
         uses: docker/metadata-action@v5
@@ -102,6 +97,7 @@ jobs:
             type=ref,event=branch,suffix=-${{ matrix.arch_tag }}
             type=semver,pattern={{version}},suffix=-${{ matrix.arch_tag }}
             type=semver,pattern={{major}}.{{minor}},suffix=-${{ matrix.arch_tag }}
+            type=semver,pattern={{major}},suffix=-${{ matrix.arch_tag }}
             type=sha,prefix={{branch}}-,suffix=-${{ matrix.arch_tag }}
 
       - name: Build and push ${{ matrix.name }}-${{ matrix.arch_tag }} image
@@ -109,12 +105,10 @@ jobs:
         with:
           context: .
           file: ${{ matrix.dockerfile }}
-          # 单独构建每个架构,4 个任务并行运行
           platforms: ${{ matrix.platform }}
-          push: true
+          push: ${{ github.event_name != 'pull_request' }}
           tags: ${{ steps.meta.outputs.tags }}
           labels: ${{ steps.meta.outputs.labels }}
-          # 使用架构特定的缓存
           cache-from: type=gha,scope=${{ matrix.name }}-${{ matrix.arch_tag }}
           cache-to: type=gha,mode=max,scope=${{ matrix.name }}-${{ matrix.arch_tag }}
           build-args: |
@@ -128,18 +122,17 @@ jobs:
           echo "Platform: ${{ matrix.platform }}"
           echo "Tags: ${{ steps.meta.outputs.tags }}"
 
-  # 合并多架构镜像为统一 manifest
   create-manifest:
+    name: Create multi-arch manifests
+    if: github.event_name != 'pull_request'
     needs: [prepare, build-and-push]
     runs-on: ubuntu-22.04
     permissions:
       contents: read
       packages: write
-
     strategy:
       matrix:
         image_suffix: [backend, frontend]
-
     steps:
       - name: Log in to GitHub Container Registry
         uses: docker/login-action@v3
@@ -156,24 +149,20 @@ jobs:
         continue-on-error: true
 
       - name: Create and push multi-arch manifest
+        env:
+          IMAGE_BASE: ${{ needs.prepare.outputs.image_base }}
         run: |
-          # 提取分支/标签名
           REF_NAME="${{ github.ref_name }}"
+          GHCR_IMAGE="${{ env.REGISTRY_GHCR }}/${IMAGE_BASE}/nofx-${{ matrix.image_suffix }}"
 
-          # GHCR manifest (使用小写仓库名)
-          REPO_LOWER="${{ needs.prepare.outputs.image_base }}"
-          GHCR_IMAGE="${{ env.REGISTRY_GHCR }}/${REPO_LOWER}/nofx-${{ matrix.image_suffix }}"
-
-          echo "📦 Creating manifest for ${{ matrix.image_suffix }}..."
-          echo "Repository: ${REPO_LOWER}"
+          echo "📦 Creating manifest for ${{ matrix.image_suffix }}"
+          echo "Repository: ${IMAGE_BASE}"
           echo "Image: ${GHCR_IMAGE}"
 
-          # 创建并推送 manifest (合并 amd64 和 arm64)
           docker buildx imagetools create -t "${GHCR_IMAGE}:${REF_NAME}" \
             "${GHCR_IMAGE}:${REF_NAME}-amd64" \
             "${GHCR_IMAGE}:${REF_NAME}-arm64"
 
-          # 如果是主分支,也创建 latest 标签
           if [[ "${{ github.ref }}" == "refs/heads/main" ]] || [[ "${{ github.ref }}" == "refs/heads/dev" ]]; then
             docker buildx imagetools create -t "${GHCR_IMAGE}:latest" \
               "${GHCR_IMAGE}:${REF_NAME}-amd64" \
@@ -181,7 +170,6 @@ jobs:
             echo "✅ Created latest tag"
           fi
 
-          # Docker Hub manifest (如果配置了)
           if [[ -n "${{ secrets.DOCKERHUB_USERNAME }}" ]]; then
             DOCKERHUB_IMAGE="${{ secrets.DOCKERHUB_USERNAME }}/nofx-${{ matrix.image_suffix }}"
             docker buildx imagetools create -t "${DOCKERHUB_IMAGE}:${REF_NAME}" \
diff --git a/.github/workflows/pr-docker-compose-healthcheck.yml b/.github/workflows/pr-docker-compose-healthcheck.yml
new file mode 100644
index 00000000..139477e5
--- /dev/null
+++ b/.github/workflows/pr-docker-compose-healthcheck.yml
@@ -0,0 +1,152 @@
+name: PR Docker Compose Healthcheck
+
+# 驗證 docker-compose.yml 的 healthcheck 配置在 Alpine 容器中正常工作
+on:
+  pull_request:
+    branches:
+      - main
+      - dev
+    paths:
+      - 'docker-compose.yml'
+      - 'docker/Dockerfile.backend'
+      - 'docker/Dockerfile.frontend'
+      - '.github/workflows/pr-docker-compose-healthcheck.yml'
+
+jobs:
+  healthcheck-test:
+    name: Test Docker Compose Healthcheck
+    runs-on: ubuntu-22.04
+    timeout-minutes: 10
+    permissions:
+      contents: read
+
+    steps:
+      - name: Checkout code
+        uses: actions/checkout@v4
+
+      - name: Create minimal .env for testing
+        run: |
+          cat > .env <<EOF
+          # Minimal config for healthcheck testing
+          NOFX_BACKEND_PORT=8080
+          NOFX_FRONTEND_PORT=3000
+          NOFX_TIMEZONE=UTC
+          DATA_ENCRYPTION_KEY=test-key-32-chars-minimum-length
+          JWT_SECRET=test-jwt-secret-minimum-32-chars
+          EOF
+
+      - name: Create minimal config.json
+        run: |
+          cat > config.json <<EOF
+          {
+            "ai_models": [],
+            "exchanges": [],
+            "traders": []
+          }
+          EOF
+
+      - name: Start services with docker compose
+        run: |
+          docker compose up -d
+          echo "✅ Services started, waiting for healthcheck..."
+
+      - name: Wait for healthcheck start_period
+        run: |
+          echo "⏳ Waiting 70 seconds for healthcheck start_period to complete..."
+          sleep 70
+
+      - name: Verify backend healthcheck
+        run: |
+          echo "🔍 Checking backend container health..."
+
+          BACKEND_HEALTH=$(docker inspect nofx-trading --format='{{.State.Health.Status}}')
+          echo "Backend health status: $BACKEND_HEALTH"
+
+          if [ "$BACKEND_HEALTH" != "healthy" ]; then
+            echo "❌ Backend container is not healthy!"
+            echo "Health status: $BACKEND_HEALTH"
+            echo ""
+            echo "Health logs:"
+            docker inspect nofx-trading --format='{{json .State.Health}}' | jq
+            echo ""
+            echo "Container logs:"
+            docker logs nofx-trading
+            exit 1
+          fi
+
+          echo "✅ Backend container is healthy"
+
+      - name: Verify frontend healthcheck
+        run: |
+          echo "🔍 Checking frontend container health..."
+
+          FRONTEND_HEALTH=$(docker inspect nofx-frontend --format='{{.State.Health.Status}}')
+          echo "Frontend health status: $FRONTEND_HEALTH"
+
+          if [ "$FRONTEND_HEALTH" != "healthy" ]; then
+            echo "❌ Frontend container is not healthy!"
+            echo "Health status: $FRONTEND_HEALTH"
+            echo ""
+            echo "Health logs:"
+            docker inspect nofx-frontend --format='{{json .State.Health}}' | jq
+            echo ""
+            echo "Container logs:"
+            docker logs nofx-frontend
+            exit 1
+          fi
+
+          echo "✅ Frontend container is healthy"
+
+      - name: Verify healthcheck commands are Alpine-compatible
+        run: |
+          echo "🔍 Verifying healthcheck commands use Alpine-compatible tools..."
+
+          # Check that docker-compose.yml uses wget (not curl)
+          if grep -q 'test:.*curl' docker-compose.yml; then
+            echo "❌ ERROR: docker-compose.yml uses 'curl' which doesn't exist in Alpine!"
+            echo ""
+            echo "Alpine Linux (used by our containers) includes 'wget' but not 'curl'."
+            echo "Please use 'wget --no-verbose --tries=1 --spider' instead."
+            exit 1
+          fi
+
+          if ! grep -q 'test:.*wget' docker-compose.yml; then
+            echo "⚠️  WARNING: No wget healthcheck found in docker-compose.yml"
+          else
+            echo "✅ Healthcheck uses Alpine-compatible 'wget' command"
+          fi
+
+      - name: Test healthcheck commands inside containers
+        run: |
+          echo "🧪 Testing healthcheck commands directly..."
+
+          # Test backend healthcheck command
+          echo "Testing backend healthcheck..."
+          docker exec nofx-trading wget --no-verbose --tries=1 --spider http://localhost:8080/api/health
+          echo "✅ Backend healthcheck command works"
+
+          # Test frontend healthcheck command
+          echo "Testing frontend healthcheck..."
+          docker exec nofx-frontend wget --no-verbose --tries=1 --spider http://127.0.0.1/health
+          echo "✅ Frontend healthcheck command works"
+
+      - name: Show container status
+        if: always()
+        run: |
+          echo "📊 Final container status:"
+          docker ps --format "table {{.Names}}\t{{.Status}}"
+
+      - name: Show logs on failure
+        if: failure()
+        run: |
+          echo "📋 Backend logs:"
+          docker logs nofx-trading
+          echo ""
+          echo "📋 Frontend logs:"
+          docker logs nofx-frontend
+
+      - name: Cleanup
+        if: always()
+        run: |
+          docker compose down -v
+          rm -f .env config.json
diff --git a/.github/workflows/pr-template-suggester.yml b/.github/workflows/pr-template-suggester.yml
index 9e74a9e4..0798ca00 100644
--- a/.github/workflows/pr-template-suggester.yml
+++ b/.github/workflows/pr-template-suggester.yml
@@ -6,6 +6,7 @@ on:
 
 permissions:
   pull-requests: write
+  issues: write
   contents: read
 
 jobs:
diff --git a/.github/workflows/test.yml b/.github/workflows/test.yml
new file mode 100644
index 00000000..31b11c12
--- /dev/null
+++ b/.github/workflows/test.yml
@@ -0,0 +1,54 @@
+name: Test
+
+on:
+  push:
+    branches: [main, dev]
+  pull_request:
+    branches: [main, dev]
+
+jobs:
+  backend-tests:
+    name: Backend Tests
+    runs-on: ubuntu-latest
+    continue-on-error: true  # Don't block PRs
+
+    steps:
+      - name: Checkout code
+        uses: actions/checkout@v4
+
+      - name: Set up Go
+        uses: actions/setup-go@v5
+        with:
+          go-version: '1.23'
+
+      - name: Download dependencies
+        run: go mod download
+
+      - name: Run tests
+        run: go test -v ./...
+
+      - name: Generate coverage
+        run: go test -coverprofile=coverage.out ./...
+        continue-on-error: true
+
+  frontend-tests:
+    name: Frontend Tests
+    runs-on: ubuntu-latest
+    continue-on-error: true  # Don't block PRs
+
+    steps:
+      - name: Checkout code
+        uses: actions/checkout@v4
+
+      - name: Set up Node.js
+        uses: actions/setup-node@v4
+        with:
+          node-version: '20'
+          cache: 'npm'
+          cache-dependency-path: web/package-lock.json
+
+      - name: Install dependencies
+        run: cd web && npm ci
+
+      - name: Run tests
+        run: cd web && npm run test
diff --git a/.gitignore b/.gitignore
index ac5d3a0f..05dd17f4 100644
--- a/.gitignore
+++ b/.gitignore
@@ -122,3 +122,4 @@ dmypy.json
 
 # Pyre type checker
 .pyre/
+PR_DESCRIPTION.md
diff --git a/CHANGELOG.md b/CHANGELOG.md
index f520303d..063b7b4b 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -13,7 +13,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0
 
 ### Added
 - Documentation system with multi-language support (EN/CN/RU/UK)
-- Complete getting-started guides (Docker, PM2, Custom API)
+- Complete getting-started guides (Docker, Custom API)
 - Architecture documentation with system design details
 - User guides with FAQ and troubleshooting
 - Community documentation with bounty programs
diff --git a/CHANGELOG.zh-CN.md b/CHANGELOG.zh-CN.md
index 0bfdab3d..92c7840c 100644
--- a/CHANGELOG.zh-CN.md
+++ b/CHANGELOG.zh-CN.md
@@ -13,7 +13,7 @@ NOFX 项目的所有重要更改都将记录在此文件中。
 
 ### 新增
 - 多语言文档系统（英文/中文/俄语/乌克兰语）
-- 完整的快速开始指南（Docker、PM2、自定义 API）
+- 完整的快速开始指南（Docker、自定义 API）
 - 架构文档，包含系统设计细节
 - 用户指南，包含 FAQ 和故障排除
 - 社区文档，包含悬赏计划
diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md
index 31fc7c02..553a0399 100644
--- a/CONTRIBUTING.md
+++ b/CONTRIBUTING.md
@@ -469,7 +469,6 @@ Reviewers will check:
 
 - [Project Roadmap](docs/roadmap/README.md)
 - [Architecture Documentation](docs/architecture/README.md)
-- [API Documentation](docs/api/README.md)
 - [Deployment Guide](docs/getting-started/docker-deploy.en.md)
 
 ---
diff --git a/Makefile b/Makefile
new file mode 100644
index 00000000..4225c0f4
--- /dev/null
+++ b/Makefile
@@ -0,0 +1,153 @@
+# NOFX Makefile for testing and development
+
+.PHONY: help test test-backend test-frontend test-coverage clean
+
+# Default target
+help:
+	@echo "NOFX Testing & Development Commands"
+	@echo ""
+	@echo "Testing:"
+	@echo "  make test                 - Run all tests (backend + frontend)"
+	@echo "  make test-backend         - Run backend tests only"
+	@echo "  make test-frontend        - Run frontend tests only"
+	@echo "  make test-coverage        - Generate backend coverage report"
+	@echo ""
+	@echo "Build:"
+	@echo "  make build                - Build backend binary"
+	@echo "  make build-frontend       - Build frontend"
+	@echo ""
+	@echo "Clean:"
+	@echo "  make clean                - Clean build artifacts and test cache"
+
+# =============================================================================
+# Testing
+# =============================================================================
+
+# Run all tests
+test:
+	@echo "🧪 Running backend tests..."
+	go test -v ./...
+	@echo ""
+	@echo "🧪 Running frontend tests..."
+	cd web && npm run test
+	@echo "✅ All tests completed"
+
+# Backend tests only
+test-backend:
+	@echo "🧪 Running backend tests..."
+	go test -v ./...
+
+# Frontend tests only
+test-frontend:
+	@echo "🧪 Running frontend tests..."
+	cd web && npm run test
+
+# Coverage report
+test-coverage:
+	@echo "📊 Generating coverage..."
+	go test -coverprofile=coverage.out ./...
+	go tool cover -html=coverage.out -o coverage.html
+	@echo "✅ Backend coverage: coverage.html"
+
+# =============================================================================
+# Build
+# =============================================================================
+
+# Build backend binary
+build:
+	@echo "🔨 Building backend..."
+	go build -o nofx
+	@echo "✅ Backend built: ./nofx"
+
+# Build frontend
+build-frontend:
+	@echo "🔨 Building frontend..."
+	cd web && npm run build
+	@echo "✅ Frontend built: ./web/dist"
+
+# =============================================================================
+# Development
+# =============================================================================
+
+# Run backend in development mode
+run:
+	@echo "🚀 Starting backend..."
+	go run main.go
+
+# Run frontend in development mode
+run-frontend:
+	@echo "🚀 Starting frontend dev server..."
+	cd web && npm run dev
+
+# Format Go code
+fmt:
+	@echo "🎨 Formatting Go code..."
+	go fmt ./...
+	@echo "✅ Code formatted"
+
+# Lint Go code (requires golangci-lint)
+lint:
+	@echo "🔍 Linting Go code..."
+	golangci-lint run
+	@echo "✅ Linting completed"
+
+# =============================================================================
+# Clean
+# =============================================================================
+
+clean:
+	@echo "🧹 Cleaning..."
+	rm -f nofx
+	rm -f coverage.out coverage.html
+	rm -rf web/dist
+	go clean -testcache
+	@echo "✅ Cleaned"
+
+# =============================================================================
+# Docker
+# =============================================================================
+
+# Build Docker images
+docker-build:
+	@echo "🐳 Building Docker images..."
+	docker compose build
+	@echo "✅ Docker images built"
+
+# Run Docker containers
+docker-up:
+	@echo "🐳 Starting Docker containers..."
+	docker compose up -d
+	@echo "✅ Docker containers started"
+
+# Stop Docker containers
+docker-down:
+	@echo "🐳 Stopping Docker containers..."
+	docker compose down
+	@echo "✅ Docker containers stopped"
+
+# View Docker logs
+docker-logs:
+	docker compose logs -f
+
+# =============================================================================
+# Dependencies
+# =============================================================================
+
+# Download Go dependencies
+deps:
+	@echo "📦 Downloading Go dependencies..."
+	go mod download
+	@echo "✅ Dependencies downloaded"
+
+# Update Go dependencies
+deps-update:
+	@echo "📦 Updating Go dependencies..."
+	go get -u ./...
+	go mod tidy
+	@echo "✅ Dependencies updated"
+
+# Install frontend dependencies
+deps-frontend:
+	@echo "📦 Installing frontend dependencies..."
+	cd web && npm install
+	@echo "✅ Frontend dependencies installed"
diff --git a/README.ja.md b/README.ja.md
new file mode 100644
index 00000000..db4e81a0
--- /dev/null
+++ b/README.ja.md
@@ -0,0 +1,1343 @@
+# 🤖 NOFX - Agentic Trading OS
+
+[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org/)
+[![React](https://img.shields.io/badge/React-18+-61DAFB?style=flat&logo=react)](https://reactjs.org/)
+[![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-3178C6?style=flat&logo=typescript)](https://www.typescriptlang.org/)
+[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
+[![Backed by Amber.ac](https://img.shields.io/badge/Backed%20by-Amber.ac-orange.svg)](https://amber.ac)
+
+**言語:** [English](README.md) | [中文](README.zh-CN.md) | [Українська](README.uk.md) | [Русский](README.ru.md) | [日本語](README.ja.md)
+
+**公式Twitter:** [@nofx_ai](https://x.com/nofx_ai)
+
+---
+
+## 🚀 ユニバーサルAIトレーディングOS
+
+**NOFX**は、統合アーキテクチャに基づいて構築された**ユニバーサルAgenticトレーディングOS**です。暗号通貨市場において **「マルチエージェント判断 → 統一リスク管理 → 低レイテンシ実行 → ライブ/ペーパーアカウントバックテスト」** のループを成功裏に完成させ、現在この技術スタックを **株式、先物、オプション、外国為替、およびすべての金融市場** に拡大しています。
+
+### 🎯 コア機能
+
+- **ユニバーサルデータ＆バックテストレイヤー**: クロスマーケット、クロスタイムフレーム、クロス取引所の統一表現とファクターライブラリにより、転移可能な「戦略メモリ」を蓄積
+- **マルチエージェント自己対戦＆自己進化**: 戦略が自動的に競争し、最適なものを選択、アカウントレベルのPnLとリスク制約に基づいて継続的に反復
+- **統合実行＆リスク管理**: 低レイテンシルーティング、スリッページ/リスク管理サンドボックス、アカウントレベルの制限、ワンクリック市場切り替え
+
+### 🏢 [Amber.ac](https://amber.ac)の支援
+
+### 👥 コアチーム
+
+- **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
+- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
+
+### 💼 シードラウンド募集中
+
+現在、**シードラウンド**の資金調達を行っています。
+
+**投資に関するお問い合わせ**は、TwitterでTinkleまたはZackにDMをお送りください。
+
+**パートナーシップおよび協業**については、公式Twitter [@nofx_ai](https://x.com/nofx_ai)にDMをお送りください。
+
+---
+
+> ⚠️ **リスク警告**: このシステムは実験的なものです。AI自動取引には大きなリスクが伴います。学習/研究目的、または少額でのテストのみを強く推奨します！
+
+## 👥 開発者コミュニティ
+
+Telegram開発者コミュニティに参加して、議論、アイデアの共有、サポートを受けましょう：
+
+**💬 [NOFX開発者コミュニティ](https://t.me/nofx_dev_community)**
+
+---
+
+## 🆕 最新情報（最新アップデート）
+
+### 🚀 マルチ取引所対応！
+
+NOFXは現在、**3つの主要取引所**をサポートしています：Binance、Hyperliquid、Aster DEX！
+
+#### **Hyperliquid取引所**
+
+高性能な分散型無期限先物取引所！
+
+**主な機能:**
+- ✅ フル取引サポート（ロング/ショート、レバレッジ、ストップロス/テイクプロフィット）
+- ✅ 自動精度処理（注文サイズ＆価格）
+- ✅ 統一トレーダーインターフェース（シームレスな取引所切り替え）
+- ✅ メインネットとテストネットの両方をサポート
+- ✅ APIキー不要 - Ethereum秘密鍵のみ
+
+**なぜHyperliquid？**
+- 🔥 中央集権型取引所より低い手数料
+- 🔒 非カストディアル - 資金を自分で管理
+- ⚡ オンチェーン決済による高速実行
+- 🌍 KYC不要
+
+**クイックスタート:**
+1. MetaMaskの秘密鍵を取得（`0x`プレフィックスを削除）
+2. config.jsonで`"exchange": "hyperliquid"`を設定
+3. `"hyperliquid_private_key": "your_key"`を追加
+4. 取引開始！
+
+詳細は[設定ガイド](#-代替hyperliquid取引所の使用)をご覧ください。
+
+#### **Aster DEX取引所**（NEW! v2.0.2）
+
+Binance互換の分散型無期限先物取引所！
+
+**主な機能:**
+- ✅ BinanceスタイルAPI（Binanceからの移行が簡単）
+- ✅ Web3ウォレット認証（安全で分散型）
+- ✅ 自動精度処理によるフル取引サポート
+- ✅ CEXより低い取引手数料
+- ✅ EVM互換（Ethereum、BSC、Polygonなど）
+
+**なぜAster？**
+- 🎯 **Binance互換API** - 最小限のコード変更で済む
+- 🔐 **APIウォレットシステム** - セキュリティのための独立した取引ウォレット
+- 💰 **競争力のある手数料** - ほとんどの中央集権型取引所より低い
+- 🌐 **マルチチェーンサポート** - お好みのEVMチェーンで取引
+
+**クイックスタート:**
+1. [Aster APIウォレット](https://www.asterdex.com/en/api-wallet)にアクセス
+2. メインウォレットを接続してAPIウォレットを作成
+3. API Signerアドレスと秘密鍵をコピー
+4. config.jsonで`"exchange": "aster"`を設定
+5. `"aster_user"`、`"aster_signer"`、`"aster_private_key"`を追加
+
+---
+
+## 📸 スクリーンショット
+
+### 🏆 競争モード - リアルタイムAIバトル
+![競争ページ](screenshots/competition-page.png)
+*QwenとDeepSeekのライブトレーディングバトルを示すリアルタイムパフォーマンス比較チャート付きマルチAIリーダーボード*
+
+### 📊 トレーダー詳細 - 完全なトレーディングダッシュボード
+![詳細ページ](screenshots/details-page.png)
+*エクイティカーブ、ライブポジション、展開可能な入力プロンプトと思考連鎖推論を持つAI判断ログを備えたプロフェッショナルな取引インターフェース*
+
+---
+
+## ✨ 現在の実装 - 暗号通貨市場
+
+NOFXは現在、以下の実証済み機能で**暗号通貨市場において完全に稼働**しています：
+
+### 🏆 マルチエージェント競争フレームワーク
+- **ライブエージェントバトル**: QwenとDeepSeekモデルがリアルタイム取引で競争
+- **独立したアカウント管理**: 各エージェントは独自の判断ログとパフォーマンスメトリクスを維持
+- **リアルタイムパフォーマンス比較**: ライブROI追跡、勝率統計、一対一分析
+- **自己進化ループ**: エージェントは過去のパフォーマンスから学習し、継続的に改善
+
+### 🧠 AI自己学習＆最適化
+- **過去フィードバックシステム**: 各判断前に過去20取引サイクルを分析
+- **スマートパフォーマンス分析**:
+  - 最高/最悪パフォーマンス資産の特定
+  - 実際のUSDT建てで勝率、損益比、平均利益を計算
+  - 繰り返しミスを回避（連続損失パターン）
+  - 成功戦略を強化（高勝率パターン）
+- **動的戦略調整**: AIはバックテスト結果に基づいて取引スタイルを自律的に適応
+
+### 📊 ユニバーサルマーケットデータレイヤー（暗号実装）
+- **マルチタイムフレーム分析**: 3分リアルタイム + 4時間トレンドデータ
+- **テクニカル指標**: EMA20/50、MACD、RSI(7/14)、ATR
+- **建玉追跡**: マーケットセンチメント、資金フロー分析
+- **流動性フィルタリング**: 低流動性資産（<1500万USD）の自動フィルタリング
+- **クロス取引所サポート**: 統一データインターフェースでBinance、Hyperliquid、Aster DEX
+
+### 🎯 統一リスク管理システム
+- **ポジション制限**: 資産ごとの制限（アルトコイン≤1.5x エクイティ、BTC/ETH≤10x エクイティ）
+- **設定可能なレバレッジ**: 資産クラスとアカウントタイプに基づいて1xから50xまでの動的レバレッジ
+- **証拠金管理**: 総使用量≤90%、AI制御配分
+- **リスクリワード強制**: 必須≥1:2 ストップロス対テイクプロフィット比率
+- **重複防止**: 同じ資産/方向での重複ポジションを防止
+
+### ⚡ 低レイテンシ実行エンジン
+- **マルチ取引所API統合**: Binance Futures、Hyperliquid DEX、Aster DEX
+- **自動精度処理**: 取引所ごとのスマートな注文サイズと価格フォーマット
+- **優先実行**: 既存ポジションを先にクローズし、その後新規を開く
+- **スリッページ管理**: 実行前検証、リアルタイム精度チェック
+
+### 🎨 プロフェッショナルモニタリングインターフェース
+- **Binanceスタイルダッシュボード**: リアルタイム更新付きプロフェッショナルダークテーマ
+- **エクイティカーブ**: 過去のアカウント価値追跡（USD/パーセンテージ切り替え）
+- **パフォーマンスチャート**: ライブ更新付きマルチエージェントROI比較
+- **完全な判断ログ**: すべての取引の完全な思考連鎖（CoT）推論
+- **5秒データ更新**: リアルタイムアカウント、ポジション、損益更新
+
+---
+
+## 🔮 ロードマップ - ユニバーサルマーケット拡大
+
+実証済みの暗号インフラストラクチャを以下に拡張中：
+
+- **📈 株式市場**: 米国株式、A株、香港株
+- **📊 先物市場**: 商品先物、指数先物
+- **🎯 オプション取引**: 株式オプション、暗号オプション
+- **💱 外国為替市場**: 主要通貨ペア、クロスレート
+
+**同じアーキテクチャ。同じエージェントフレームワーク。すべての市場。**
+
+---
+
+## 🏗️ 技術アーキテクチャ
+
+```
+nofx/
+├── main.go                          # プログラムエントリ（マルチトレーダーマネージャー）
+├── config.json                      # 設定ファイル（APIキー、マルチトレーダー設定）
+│
+├── api/                            # HTTP APIサービス
+│   └── server.go                   # Ginフレームワーク、RESTful API
+│
+├── trader/                         # トレーディングコア
+│   ├── auto_trader.go              # 自動取引メインコントローラー（単一トレーダー）
+│   └── binance_futures.go          # Binance先物APIラッパー
+│
+├── manager/                        # マルチトレーダー管理
+│   └── trader_manager.go           # 複数のトレーダーインスタンスを管理
+│
+├── mcp/                            # Model Context Protocol - AI通信
+│   └── client.go                   # AIクライアント（DeepSeek/Qwen統合）
+│
+├── decision/                       # AI判断エンジン
+│   └── engine.go                   # 過去フィードバック付き判断ロジック
+│
+├── market/                         # マーケットデータ取得
+│   └── data.go                     # マーケットデータ＆テクニカル指標（K線、RSI、MACD）
+│
+├── pool/                           # コインプール管理
+│   └── coin_pool.go                # AI500 + OI Topマージプール
+│
+├── logger/                         # ロギングシステム
+│   └── decision_logger.go          # 判断記録 + パフォーマンス分析
+│
+├── decision_logs/                  # 判断ログストレージ
+│   ├── qwen_trader/                # Qwenトレーダーログ
+│   └── deepseek_trader/            # DeepSeekトレーダーログ
+│
+└── web/                            # Reactフロントエンド
+    ├── src/
+    │   ├── components/             # Reactコンポーネント
+    │   │   ├── EquityChart.tsx     # エクイティカーブチャート
+    │   │   ├── ComparisonChart.tsx # マルチAI比較チャート
+    │   │   └── CompetitionPage.tsx # 競争リーダーボード
+    │   ├── lib/api.ts              # API呼び出しラッパー
+    │   ├── types/index.ts          # TypeScript型
+    │   ├── index.css               # BinanceスタイルCSS
+    │   └── App.tsx                 # メインアプリ
+    └── package.json
+```
+
+### コア依存関係
+
+**バックエンド（Go）**
+- `github.com/adshao/go-binance/v2` - Binance APIクライアント
+- `github.com/markcheno/go-talib` - テクニカル指標計算（TA-Lib）
+- `github.com/gin-gonic/gin` - HTTP APIフレームワーク
+
+**フロントエンド（React + TypeScript）**
+- `react` + `react-dom` - UIフレームワーク
+- `recharts` - チャートライブラリ（エクイティカーブ、比較チャート）
+- `swr` - データフェッチングとキャッシング
+- `tailwindcss` - CSSフレームワーク
+
+---
+
+## 💰 Binanceアカウント登録（手数料節約！）
+
+このシステムを使用する前に、Binance先物アカウントが必要です。**紹介リンクを使用して取引手数料を節約しましょう：**
+
+**🎁 [Binance登録 - 手数料割引を取得](https://www.binance.com/join?ref=TINKLEVIP)**
+
+### 登録手順：
+
+1. **上記のリンクをクリック**してBinance登録ページにアクセス
+2. メール/電話番号で**登録を完了**
+3. **KYC認証を完了**（先物取引に必要）
+4. **先物アカウントを有効化**：
+   - Binanceホームページ → デリバティブ → USDT無期限先物
+   - 「今すぐ開設」をクリックして先物取引を有効化
+5. **APIキーを作成**：
+   - アカウント → API管理
+   - 新しいAPIキーを作成、**「先物」権限を有効化**
+   - APIキーとシークレットキーを保存（config.jsonに必要）
+   - **重要**: セキュリティのためIPアドレスをホワイトリストに追加
+
+### 手数料割引の利点：
+
+- ✅ **現物取引**: 最大30%の手数料割引
+- ✅ **先物取引**: 最大30%の手数料割引
+- ✅ **生涯有効**: すべての取引で永久割引
+
+---
+
+## 🚀 クイックスタート
+
+### 🐳 オプションA：Dockerワンクリックデプロイ（最も簡単 - 初心者推奨！）
+
+**⚡ Dockerで3つの簡単なステップで取引開始 - インストール不要！**
+
+Dockerはすべての依存関係（Go、Node.js、TA-Lib）と環境設定を自動的に処理します。初心者に最適！
+
+#### ステップ1：設定を準備
+
+```bash
+# 設定テンプレートをコピー
+cp config.json.example config.json
+
+# 編集してAPIキーを入力
+nano config.json  # または任意のエディタを使用
+```
+
+#### ステップ2：ワンクリック起動
+
+```bash
+# オプション1：便利スクリプトを使用（推奨）
+chmod +x scripts/start.sh
+./scripts/start.sh start --build
+
+> #### Docker Composeバージョンに関する注意
+>
+> **このプロジェクトはDocker Compose V2構文（スペース付き）を使用**
+>
+> 古いスタンドアロン`docker-compose`がインストールされている場合は、Docker DesktopまたはDocker 20.10+にアップグレードしてください
+
+# オプション2：docker composeを直接使用
+docker compose up -d --build
+```
+
+#### ステップ3：ダッシュボードにアクセス
+
+ブラウザを開いて次にアクセス：**http://localhost:3000**
+
+**これで完了！🎉** AIトレーディングシステムが稼働中です！
+
+#### システム管理
+
+```bash
+./scripts/start.sh logs      # ログを表示
+./scripts/start.sh status    # ステータスを確認
+./scripts/start.sh stop      # サービスを停止
+./scripts/start.sh restart   # サービスを再起動
+```
+
+**📖 詳細なDockerデプロイガイド、トラブルシューティング、高度な設定について：**
+- **English**: See [DOCKER_DEPLOY.en.md](DOCKER_DEPLOY.en.md)
+- **中文**: 查看 [DOCKER_DEPLOY.md](DOCKER_DEPLOY.md)
+- **日本語**: [DOCKER_DEPLOY.ja.md](DOCKER_DEPLOY.ja.md)を参照
+
+---
+
+### 📦 オプションB：手動インストール（開発者向け）
+
+**注意**: 上記のDockerデプロイを使用した場合は、このセクションをスキップしてください。手動インストールは、コードを変更したい場合、またはDockerなしで実行したい場合にのみ必要です。
+
+### 1. 環境要件
+
+- **Go 1.21+**
+- **Node.js 18+**
+- **TA-Lib**ライブラリ（テクニカル指標計算）
+
+#### TA-Libのインストール
+
+**macOS:**
+```bash
+brew install ta-lib
+```
+
+**Ubuntu/Debian:**
+```bash
+sudo apt-get install libta-lib0-dev
+```
+
+**その他のシステム**: [TA-Lib公式ドキュメント](https://github.com/markcheno/go-talib)を参照
+
+### 2. プロジェクトをクローン
+
+```bash
+git clone https://github.com/tinkle-community/nofx.git
+cd nofx
+```
+
+### 3. 依存関係をインストール
+
+**バックエンド:**
+```bash
+go mod download
+```
+
+**フロントエンド:**
+```bash
+cd web
+npm install
+cd ..
+```
+
+### 4. AI APIキーを取得
+
+システムを設定する前に、AI APIキーを取得する必要があります。以下のAIプロバイダーのいずれかを選択してください：
+
+#### オプション1：DeepSeek（初心者推奨）
+
+**なぜDeepSeek？**
+- 💰 GPT-4より安価（約1/10のコスト）
+- 🚀 高速レスポンス時間
+- 🎯 優れた取引判断品質
+- 🌍 VPNなしで世界中で動作
+
+**DeepSeek APIキーの取得方法：**
+
+1. **アクセス**: [https://platform.deepseek.com](https://platform.deepseek.com)
+2. **登録**: メール/電話番号でサインアップ
+3. **認証**: メール/電話認証を完了
+4. **チャージ**: アカウントにクレジットを追加
+   - 最低: 約$5 USD
+   - 推奨: テスト用に$20-50 USD
+5. **APIキーを作成**：
+   - APIキーセクションに移動
+   - 「新しいキーを作成」をクリック
+   - キーをコピーして保存（`sk-`で始まる）
+   - ⚠️ **重要**: すぐに保存してください - 再度見ることはできません！
+
+**価格**: 約100万トークンあたり$0.14（非常に安い！）
+
+#### オプション2：Qwen（Alibaba Cloud）
+
+**Qwen APIキーの取得方法：**
+
+1. **アクセス**: [https://dashscope.aliyuncs.com](https://dashscope.aliyuncs.com)
+2. **登録**: Alibaba Cloudアカウントでサインアップ
+3. **サービスを有効化**: DashScopeサービスを有効化
+4. **APIキーを作成**：
+   - APIキー管理に移動
+   - 新しいキーを作成
+   - コピーして保存（`sk-`で始まる）
+
+**注意**: 登録には中国の電話番号が必要な場合があります
+
+---
+
+### 5. システム設定
+
+**2つの設定モードが利用可能：**
+- **🌟 初心者モード**: シングルトレーダー + デフォルトコイン（推奨！）
+- **⚔️ エキスパートモード**: 複数トレーダー競争
+
+#### 🌟 初心者モード設定（推奨）
+
+**ステップ1**: 設定例ファイルをコピーしてリネーム
+
+```bash
+cp config.json.example config.json
+```
+
+**ステップ2**: APIキーで`config.json`を編集
+
+```json
+{
+  "traders": [
+    {
+      "id": "my_trader",
+      "name": "My AI Trader",
+      "ai_model": "deepseek",
+      "binance_api_key": "YOUR_BINANCE_API_KEY",
+      "binance_secret_key": "YOUR_BINANCE_SECRET_KEY",
+      "use_qwen": false,
+      "deepseek_key": "sk-xxxxxxxxxxxxx",
+      "qwen_key": "",
+      "initial_balance": 1000.0,
+      "scan_interval_minutes": 3
+    }
+  ],
+  "leverage": {
+    "btc_eth_leverage": 5,
+    "altcoin_leverage": 5
+  },
+  "use_default_coins": true,
+  "coin_pool_api_url": "",
+  "oi_top_api_url": "",
+  "api_server_port": 8080
+}
+```
+
+**ステップ3**: プレースホルダーを実際のキーに置き換え
+
+| プレースホルダー | 置き換え先 | 取得場所 |
+|------------|--------------|--------------|
+| `YOUR_BINANCE_API_KEY` | BinanceのAPIキー | Binance → アカウント → API管理 |
+| `YOUR_BINANCE_SECRET_KEY` | Binanceのシークレットキー | 上記と同じ |
+| `sk-xxxxxxxxxxxxx` | DeepSeek APIキー | [platform.deepseek.com](https://platform.deepseek.com) |
+
+**ステップ4**: 初期残高を調整（オプション）
+
+- `initial_balance`: 実際のBinance先物アカウント残高に設定
+- 損益パーセンテージの計算に使用
+- 例：500 USDTがある場合、`"initial_balance": 500.0`に設定
+
+**✅ 設定チェックリスト：**
+
+- [ ] Binance APIキーを入力（引用符の問題なし）
+- [ ] Binanceシークレットキーを入力（引用符の問題なし）
+- [ ] DeepSeek APIキーを入力（`sk-`で始まる）
+- [ ] `use_default_coins`を`true`に設定（初心者向け）
+- [ ] `initial_balance`をアカウント残高と一致させる
+- [ ] ファイルを`config.json`として保存（`.example`ではない）
+
+---
+
+#### 🔷 代替：Hyperliquid取引所の使用
+
+**NOFXはHyperliquidもサポート** - 分散型無期限先物取引所。Binanceの代わりにHyperliquidを使用するには：
+
+**ステップ1**: Ethereum秘密鍵を取得（Hyperliquid認証用）
+
+1. **MetaMask**（または任意のEthereumウォレット）を開く
+2. 秘密鍵をエクスポート
+3. キーから**`0x`プレフィックスを削除**
+4. [Hyperliquid](https://hyperliquid.xyz)でウォレットに資金を入金
+
+**ステップ2**: Hyperliquid用に`config.json`を設定
+
+```json
+{
+  "traders": [
+    {
+      "id": "hyperliquid_trader",
+      "name": "My Hyperliquid Trader",
+      "enabled": true,
+      "ai_model": "deepseek",
+      "exchange": "hyperliquid",
+      "hyperliquid_private_key": "your_private_key_without_0x",
+      "hyperliquid_wallet_addr": "your_ethereum_address",
+      "hyperliquid_testnet": false,
+      "deepseek_key": "sk-xxxxxxxxxxxxx",
+      "initial_balance": 1000.0,
+      "scan_interval_minutes": 3
+    }
+  ],
+  "use_default_coins": true,
+  "api_server_port": 8080
+}
+```
+
+**Binance設定との主な違い:**
+- `binance_api_key` + `binance_secret_key`を`hyperliquid_private_key`に置き換え
+- `"exchange": "hyperliquid"`フィールドを追加
+- メインネットには`hyperliquid_testnet: false`、テストネットには`true`を設定
+
+**⚠️ セキュリティ警告**: 秘密鍵は絶対に共有しないでください！メインウォレットではなく、取引専用のウォレットを使用してください。
+
+---
+
+#### 🔶 代替：Aster DEX取引所の使用
+
+**NOFXはAster DEXもサポート** - Binance互換の分散型無期限先物取引所！
+
+**なぜAsterを選ぶ？**
+- 🎯 Binance互換API（簡単な移行）
+- 🔐 APIウォレットセキュリティシステム
+- 💰 低い取引手数料
+- 🌐 マルチチェーンサポート（ETH、BSC、Polygon）
+- 🌍 KYC不要
+
+**ステップ1**: Aster APIウォレットを作成
+
+1. [Aster APIウォレット](https://www.asterdex.com/en/api-wallet)にアクセス
+2. メインウォレットを接続（MetaMask、WalletConnectなど）
+3. 「APIウォレットを作成」をクリック
+4. **これらの3つの項目をすぐに保存：**
+   - メインウォレットアドレス（User）
+   - APIウォレットアドレス（Signer）
+   - APIウォレット秘密鍵（⚠️ 一度だけ表示！）
+
+**ステップ2**: Aster用に`config.json`を設定
+
+```json
+{
+  "traders": [
+    {
+      "id": "aster_deepseek",
+      "name": "Aster DeepSeek Trader",
+      "enabled": true,
+      "ai_model": "deepseek",
+      "exchange": "aster",
+
+      "aster_user": "0x63DD5aCC6b1aa0f563956C0e534DD30B6dcF7C4e",
+      "aster_signer": "0x21cF8Ae13Bb72632562c6Fff438652Ba1a151bb0",
+      "aster_private_key": "4fd0a42218f3eae43a6ce26d22544e986139a01e5b34a62db53757ffca81bae1",
+
+      "deepseek_key": "sk-xxxxxxxxxxxxx",
+      "initial_balance": 1000.0,
+      "scan_interval_minutes": 3
+    }
+  ],
+  "use_default_coins": true,
+  "api_server_port": 8080,
+  "leverage": {
+    "btc_eth_leverage": 5,
+    "altcoin_leverage": 5
+  }
+}
+```
+
+**主要設定フィールド:**
+- `"exchange": "aster"` - 取引所をAsterに設定
+- `aster_user` - メインウォレットアドレス
+- `aster_signer` - APIウォレットアドレス（ステップ1から）
+- `aster_private_key` - APIウォレット秘密鍵（`0x`プレフィックスなし）
+
+**📖 詳細なセットアップ手順については**: [Aster統合ガイド](ASTER_INTEGRATION.md)を参照
+
+**⚠️ セキュリティ注意事項**:
+- APIウォレットはメインウォレットとは別（追加のセキュリティレイヤー）
+- API秘密鍵は絶対に共有しない
+- [asterdex.com](https://www.asterdex.com/en/api-wallet)でいつでもAPIウォレットアクセスを取り消し可能
+
+---
+
+#### ⚔️ エキスパートモード：マルチトレーダー競争
+
+複数のAIトレーダーが互いに競争する場合：
+
+```json
+{
+  "traders": [
+    {
+      "id": "qwen_trader",
+      "name": "Qwen AI Trader",
+      "ai_model": "qwen",
+      "binance_api_key": "YOUR_BINANCE_API_KEY_1",
+      "binance_secret_key": "YOUR_BINANCE_SECRET_KEY_1",
+      "use_qwen": true,
+      "qwen_key": "sk-xxxxx",
+      "deepseek_key": "",
+      "initial_balance": 1000.0,
+      "scan_interval_minutes": 3
+    },
+    {
+      "id": "deepseek_trader",
+      "name": "DeepSeek AI Trader",
+      "ai_model": "deepseek",
+      "binance_api_key": "YOUR_BINANCE_API_KEY_2",
+      "binance_secret_key": "YOUR_BINANCE_SECRET_KEY_2",
+      "use_qwen": false,
+      "qwen_key": "",
+      "deepseek_key": "sk-xxxxx",
+      "initial_balance": 1000.0,
+      "scan_interval_minutes": 3
+    }
+  ],
+  "use_default_coins": true,
+  "coin_pool_api_url": "",
+  "oi_top_api_url": "",
+  "api_server_port": 8080
+}
+```
+
+**競争モードの要件:**
+- 2つの別々のBinance先物アカウント（異なるAPIキー）
+- 両方のAI APIキー（Qwen + DeepSeek）
+- テスト用により多くの資本（推奨：アカウントあたり500+ USDT）
+
+---
+
+#### 📚 設定フィールド説明
+
+| フィールド | 説明 | 例の値 | 必須？ |
+|-------|-------------|---------------|-----------|
+| `id` | このトレーダーの一意の識別子 | `"my_trader"` | ✅ はい |
+| `name` | 表示名 | `"My AI Trader"` | ✅ はい |
+| `enabled` | このトレーダーが有効かどうか<br>起動をスキップする場合は`false`に設定 | `true`または`false` | ✅ はい |
+| `ai_model` | 使用するAIプロバイダー | `"deepseek"`または`"qwen"`または`"custom"` | ✅ はい |
+| `exchange` | 使用する取引所 | `"binance"`または`"hyperliquid"`または`"aster"` | ✅ はい |
+| `binance_api_key` | Binance APIキー | `"abc123..."` | Binance使用時に必須 |
+| `binance_secret_key` | Binanceシークレットキー | `"xyz789..."` | Binance使用時に必須 |
+| `hyperliquid_private_key` | Hyperliquid秘密鍵<br>⚠️ `0x`プレフィックスを削除 | `"your_key..."` | Hyperliquid使用時に必須 |
+| `hyperliquid_wallet_addr` | Hyperliquidウォレットアドレス | `"0xabc..."` | Hyperliquid使用時に必須 |
+| `hyperliquid_testnet` | テストネットを使用 | `true`または`false` | ❌ いいえ（デフォルトはfalse） |
+| `use_qwen` | Qwenを使用するかどうか | `true`または`false` | ✅ はい |
+| `deepseek_key` | DeepSeek APIキー | `"sk-xxx"` | DeepSeek使用時 |
+| `qwen_key` | Qwen APIキー | `"sk-xxx"` | Qwen使用時 |
+| `initial_balance` | 損益計算の開始残高 | `1000.0` | ✅ はい |
+| `scan_interval_minutes` | 判断を行う頻度 | `3`（3-5推奨） | ✅ はい |
+| **`leverage`** | **レバレッジ設定（v2.0.3+）** | 下記参照 | ✅ はい |
+| `btc_eth_leverage` | BTC/ETHの最大レバレッジ<br>⚠️ サブアカウント：≤5x | `5`（デフォルト、安全）<br>`50`（メインアカウント最大） | ✅ はい |
+| `altcoin_leverage` | アルトコインの最大レバレッジ<br>⚠️ サブアカウント：≤5x | `5`（デフォルト、安全）<br>`20`（メインアカウント最大） | ✅ はい |
+| `use_default_coins` | 組み込みコインリストを使用<br>**✨ スマートデフォルト：`true`**（v2.0.2+）<br>API URLが提供されていない場合自動有効化 | `true`または省略 | ❌ いいえ<br>（オプション、自動デフォルト） |
+| `coin_pool_api_url` | カスタムコインプールAPI<br>*`use_default_coins: false`の場合のみ必要* | `""`（空） | ❌ いいえ |
+| `oi_top_api_url` | 建玉API<br>*オプション補足データ* | `""`（空） | ❌ いいえ |
+| `api_server_port` | Webダッシュボードポート | `8080` | ✅ はい |
+
+**デフォルト取引コイン**（`use_default_coins: true`の場合）：
+- BTC、ETH、SOL、BNB、XRP、DOGE、ADA、HYPE
+
+---
+
+#### ⚙️ レバレッジ設定（v2.0.3+）
+
+**レバレッジ設定とは？**
+
+レバレッジ設定は、AIが各取引で使用できる最大レバレッジを制御します。これは、特にレバレッジ制限があるBinanceサブアカウントでリスク管理に重要です。
+
+**設定形式：**
+
+```json
+"leverage": {
+  "btc_eth_leverage": 5,    // BTCとETHの最大レバレッジ
+  "altcoin_leverage": 5      // その他すべてのコインの最大レバレッジ
+}
+```
+
+**⚠️ 重要：Binanceサブアカウント制限**
+
+- **サブアカウント**: Binanceにより**≤5xレバレッジ**に制限
+- **メインアカウント**: 最大20x（アルトコイン）または50x（BTC/ETH）を使用可能
+- サブアカウントを使用していてレバレッジを>5xに設定すると、取引は**失敗**し、エラーが表示されます：`Subaccounts are restricted from using leverage greater than 5x`
+
+**推奨設定：**
+
+| アカウントタイプ | BTC/ETHレバレッジ | アルトコインレバレッジ | リスクレベル |
+|-------------|------------------|------------------|------------|
+| **サブアカウント** | `5` | `5` | ✅ 安全（デフォルト） |
+| **メイン（保守的）** | `10` | `10` | 🟡 中程度 |
+| **メイン（積極的）** | `20` | `15` | 🔴 高 |
+| **メイン（最大）** | `50` | `20` | 🔴🔴 非常に高 |
+
+**例：**
+
+**安全な設定（サブアカウントまたは保守的）：**
+```json
+"leverage": {
+  "btc_eth_leverage": 5,
+  "altcoin_leverage": 5
+}
+```
+
+**積極的な設定（メインアカウントのみ）：**
+```json
+"leverage": {
+  "btc_eth_leverage": 20,
+  "altcoin_leverage": 15
+}
+```
+
+**AIのレバレッジ使用方法：**
+
+- AIは設定された最大値まで**1xから任意のレバレッジを選択**できます
+- たとえば、`altcoin_leverage: 20`の場合、AIは市場条件に基づいて5x、10x、または20xを使用することを決定する可能性があります
+- 設定は固定値ではなく**上限**を設定します
+- AIはレバレッジを選択する際にボラティリティ、リスクリワード比率、アカウント残高を考慮します
+
+---
+
+#### ⚠️ 重要：`use_default_coins`フィールド
+
+**スマートデフォルト動作（v2.0.2+）：**
+
+次の場合、システムは自動的に`use_default_coins: true`をデフォルトにします：
+- config.jsonにこのフィールドを含めていない、または
+- `false`に設定したが`coin_pool_api_url`を提供していない
+
+これにより初心者に優しくなります！このフィールドを完全に省略することもできます。
+
+**設定例：**
+
+✅ **オプション1：明示的に設定（明確性のため推奨）**
+```json
+"use_default_coins": true,
+"coin_pool_api_url": "",
+"oi_top_api_url": ""
+```
+
+✅ **オプション2：フィールドを省略（デフォルトコインを自動使用）**
+```json
+// "use_default_coins"を含めないだけ
+"coin_pool_api_url": "",
+"oi_top_api_url": ""
+```
+
+⚙️ **高度：外部APIを使用**
+```json
+"use_default_coins": false,
+"coin_pool_api_url": "http://your-api.com/coins",
+"oi_top_api_url": "http://your-api.com/oi"
+```
+
+---
+
+### 6. システムを実行
+
+#### 🚀 システムの起動（2ステップ）
+
+システムには別々に実行される**2つの部分**があります：
+1. **バックエンド**（AIトレーディングブレイン + API）
+2. **フロントエンド**（監視用Webダッシュボード）
+
+---
+
+#### **ステップ1：バックエンドを起動**
+
+ターミナルを開いて実行：
+
+```bash
+# プログラムをビルド（初回のみ、またはコード変更後）
+go build -o nofx
+
+# バックエンドを起動
+./nofx
+```
+
+**表示されるべきもの：**
+
+```
+🚀 启动自动交易系统...
+✓ Trader [my_trader] 已初始化
+✓ API服务器启动在端口 8080
+📊 开始交易监控...
+```
+
+**⚠️ エラーが表示される場合：**
+
+| エラーメッセージ | 解決策 |
+|--------------|----------|
+| `invalid API key` | config.jsonのBinance APIキーを確認 |
+| `TA-Lib not found` | `brew install ta-lib`を実行（macOS） |
+| `port 8080 already in use` | config.jsonの`api_server_port`を変更 |
+| `DeepSeek API error` | DeepSeek APIキーと残高を確認 |
+
+**✅ バックエンドが正しく実行されているとき：**
+- エラーメッセージなし
+- "开始交易监控..."が表示される
+- システムがアカウント残高を表示
+- このターミナルウィンドウを開いたままにしてください！
+
+---
+
+#### **ステップ2：フロントエンドを起動**
+
+**新しいターミナルウィンドウ**を開き（最初のものは実行したまま）、次を実行：
+
+```bash
+cd web
+npm run dev
+```
+
+**表示されるべきもの：**
+
+```
+VITE v5.x.x  ready in xxx ms
+
+➜  Local:   http://localhost:3000/
+➜  Network: use --host to expose
+```
+
+**✅ フロントエンドが実行されているとき：**
+- "Local: http://localhost:3000/"メッセージ
+- エラーメッセージなし
+- このターミナルウィンドウも開いたままにしてください！
+
+---
+
+#### **ステップ3：ダッシュボードにアクセス**
+
+Webブラウザを開いて次にアクセス：
+
+**🌐 http://localhost:3000**
+
+**表示されるもの：**
+- 📊 リアルタイムアカウント残高
+- 📈 オープンポジション（ある場合）
+- 🤖 AI判断ログ
+- 📉 エクイティカーブチャート
+
+**初回のヒント：**
+- 最初のAI判断まで3-5分かかることがあります
+- 初期判断は「観望」（待機）と言う場合があります - これは正常です
+- AIは最初に市場状況を分析する必要があります
+
+---
+
+### 7. システムを監視
+
+**監視すべきもの：**
+
+✅ **健全なシステムの兆候：**
+- バックエンドターミナルが3-5分ごとに判断サイクルを表示
+- 継続的なエラーメッセージなし
+- アカウント残高の更新
+- Webダッシュボードの自動更新
+
+⚠️ **警告の兆候：**
+- 繰り返されるAPIエラー
+- 10分以上判断なし
+- 残高の急速な減少
+
+**システムステータスの確認：**
+
+```bash
+# 新しいターミナルウィンドウで
+curl http://localhost:8080/health
+```
+
+戻り値：`{"status":"ok"}`
+
+---
+
+### 8. システムを停止
+
+**グレースフルシャットダウン（推奨）：**
+
+1. **バックエンドターミナル**（最初のもの）に移動
+2. `Ctrl+C`を押す
+3. "系统已停止"メッセージを待つ
+4. **フロントエンドターミナル**（2番目のもの）に移動
+5. `Ctrl+C`を押す
+
+**⚠️ 重要：**
+- 常にバックエンドを最初に停止
+- ターミナルを閉じる前に確認を待つ
+- 強制終了しない（ターミナルを直接閉じない）
+
+---
+
+## 📖 AI判断フロー
+
+各判断サイクル（デフォルト3分）で、システムは以下のインテリジェントプロセスを実行します：
+
+```
+┌──────────────────────────────────────────────────────────┐
+│ 1. 📊 過去パフォーマンスを分析（過去20サイクル）           │
+├──────────────────────────────────────────────────────────┤
+│  ✓ 総合勝率、平均利益、損益比を計算                       │
+│  ✓ コインごとの統計（勝率、平均損益（USDT））             │
+│  ✓ 最高/最悪パフォーマンスコインを特定                    │
+│  ✓ 正確なPnLを含む最後の5取引の詳細をリスト              │
+│  ✓ リスク調整パフォーマンスのシャープレシオを計算          │
+│  📌 NEW（v2.0.2）：レバレッジを含む正確なUSDT PnL         │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 2. 💰 アカウントステータスを取得                           │
+├──────────────────────────────────────────────────────────┤
+│  • 総エクイティと利用可能残高                             │
+│  • オープンポジション数と未実現損益                       │
+│  • 証拠金使用率（AIは最大90%を管理）                      │
+│  • 日次損益追跡とドローダウン監視                         │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 3. 🔍 既存ポジションを分析（ある場合）                     │
+├──────────────────────────────────────────────────────────┤
+│  • 各ポジションについて、最新の市場データを取得           │
+│  • リアルタイムのテクニカル指標を計算：                   │
+│    - 3分K線：RSI(7)、MACD、EMA20                         │
+│    - 4時間K線：RSI(14)、EMA20/50、ATR                    │
+│  • ポジション保有期間を追跡（例：「2時間15分」）          │
+│    📌 NEW（v2.0.2）：各ポジションの保有期間を表示         │
+│  • 表示：エントリー価格、現在価格、損益%、期間            │
+│  • AIが評価：保持するかクローズするか？                   │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 4. 🎯 新しい機会を評価（候補コイン）                       │
+├──────────────────────────────────────────────────────────┤
+│  • コインプールを取得（2モード）：                        │
+│    🌟 デフォルトモード：BTC、ETH、SOL、BNB、XRPなど       │
+│    ⚙️  高度モード：AI500（上位20）+ OI Top（上位20）     │
+│  • 候補コインをマージして重複削除                         │
+│  • フィルター：低流動性を削除（<1500万USD OI値）          │
+│  • 市場データ + テクニカル指標をバッチ取得                │
+│  • ボラティリティ、トレンド強度、出来高急増を計算        │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 5. 🧠 AI総合判断（DeepSeek/Qwen）                         │
+├──────────────────────────────────────────────────────────┤
+│  • 過去フィードバックをレビュー：                         │
+│    - 最近の勝率と利益率                                   │
+│    - 最高/最悪コインパフォーマンス                        │
+│    - 繰り返しミスを回避                                   │
+│  • すべての生シーケンスデータを分析：                     │
+│    - 3分価格シーケンス、4時間K線シーケンス                │
+│    - 完全な指標シーケンス（最新のみではない）             │
+│    📌 NEW（v2.0.2）：AIは分析の完全な自由を持つ          │
+│  • 思考連鎖（CoT）推論プロセス                            │
+│  • 構造化された判断を出力：                               │
+│    - アクション：close_long/close_short/open_long/open_short│
+│    - コインシンボル、数量、レバレッジ                     │
+│    - ストップロスとテイクプロフィットレベル（≥1:2比率）   │
+│  • 判断：待機/保持/クローズ/オープン                      │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 6. ⚡ 取引を実行                                           │
+├──────────────────────────────────────────────────────────┤
+│  • 優先順位：既存をクローズ → その後新規をオープン       │
+│  • 実行前のリスクチェック：                               │
+│    - ポジションサイズ制限（アルトコイン1.5x、BTC 10x）    │
+│    - 重複ポジションなし（同じコイン + 方向）              │
+│    - 証拠金使用量が90%制限内                              │
+│  • Binance LOT_SIZE精度を自動取得して適用                 │
+│  • Binance Futures APIで注文を実行                        │
+│  • クローズ後：すべての保留注文を自動キャンセル           │
+│  • 実際の実行価格と注文IDを記録                           │
+│  📌 期間計算のためにポジションオープン時間を追跡          │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+┌──────────────────────────────────────────────────────────┐
+│ 7. 📝 完全なログを記録してパフォーマンスを更新             │
+├──────────────────────────────────────────────────────────┤
+│  • decision_logs/{trader_id}/に判断ログを保存             │
+│  • ログには以下が含まれます：                             │
+│    - 完全な思考連鎖（CoT）                                │
+│    - すべての市場データを含む入力プロンプト               │
+│    - 構造化された判断JSON                                 │
+│    - アカウントスナップショット（残高、ポジション、証拠金）│
+│    - 実行結果（成功/失敗、価格）                          │
+│  • パフォーマンスデータベースを更新：                     │
+│    - symbol_sideキーでオープン/クローズペアをマッチ       │
+│      📌 NEW：ロング/ショート競合を防止                    │
+│    - 正確なUSDT PnLを計算：                               │
+│      PnL = ポジション価値 × 価格変化% × レバレッジ        │
+│      📌 NEW：数量 + レバレッジを考慮                      │
+│    - 保存：数量、レバレッジ、オープン時間、クローズ時間   │
+│    - 更新：勝率、利益率、シャープレシオ                   │
+│  • パフォーマンスデータは次のサイクルにフィードバック     │
+└──────────────────────────────────────────────────────────┘
+                           ↓
+                    （3-5分ごとに繰り返し）
+```
+
+### v2.0.2の主な改善点
+
+**📌 ポジション期間追跡：**
+- システムが各ポジションの保有期間を追跡
+- ユーザープロンプトに表示：「持仓时长2小时15分钟」
+- AIが出口タイミングについてより良い判断を下すのに役立つ
+
+**📌 正確なPnL計算：**
+- 以前：パーセンテージのみ（100U@5% = 1000U@5% = 両方とも「5.0」と表示）
+- 現在：実際のUSDT利益 = ポジション価値 × 価格変化 × レバレッジ
+- 例：1000 USDT × 5% × 20x = 1000 USDT実際の利益
+
+**📌 AI自由度の向上：**
+- AIはすべての生シーケンスデータを自由に分析可能
+- 事前定義された指標の組み合わせに制限されない
+- 独自のトレンド分析、サポート/レジスタンス計算を実行可能
+
+**📌 改善されたポジション追跡：**
+- `symbol_side`キーを使用（例：「BTCUSDT_long」）
+- ロングとショートの両方を保有する際の競合を防止
+- 完全なデータを保存：数量、レバレッジ、オープン/クローズ時間
+
+---
+
+## 🧠 AI自己学習の例
+
+### 過去フィードバック（プロンプトに自動追加）
+
+```markdown
+## 📊 過去パフォーマンスフィードバック
+
+### 総合パフォーマンス
+- **総取引数**: 15（利益：8 | 損失：7）
+- **勝率**: 53.3%
+- **平均利益**: +3.2% | 平均損失：-2.1%
+- **損益比**: 1.52:1
+
+### 最近の取引
+1. BTCUSDT LONG: 95000.0000 → 97500.0000 = +2.63% ✓
+2. ETHUSDT SHORT: 3500.0000 → 3450.0000 = +1.43% ✓
+3. SOLUSDT LONG: 185.0000 → 180.0000 = -2.70% ✗
+4. BNBUSDT LONG: 610.0000 → 625.0000 = +2.46% ✓
+5. ADAUSDT LONG: 0.8500 → 0.8300 = -2.35% ✗
+
+### コインパフォーマンス
+- **最高**: BTCUSDT（勝率75%、平均+2.5%）
+- **最悪**: SOLUSDT（勝率25%、平均-1.8%）
+```
+
+### AIのフィードバック使用方法
+
+1. **連続損失を回避**: SOLUSDTが3回連続でストップロスになっているのを見て、AIは回避するかより慎重になる
+2. **成功戦略を強化**: BTCブレイクアウトロングが75%の勝率で、AIはこのパターンを継続
+3. **動的スタイル調整**: 勝率<40% → 保守的；損益比>2 → 積極的を維持
+4. **市場状況の特定**: 連続損失は荒れた市場を示す可能性があり、取引頻度を減らす
+
+---
+
+## 📊 Webインターフェース機能
+
+### 1. 競争ページ
+
+- **🏆 リーダーボード**: リアルタイムROIランキング、ゴールドボーダーでリーダーをハイライト
+- **📈 パフォーマンス比較**: デュアルAI ROIカーブ比較（紫対青）
+- **⚔️ 一対一**: リードマージンを示す直接比較
+- **リアルタイムデータ**: 総エクイティ、損益%、ポジション数、証拠金使用量
+
+### 2. 詳細ページ
+
+- **エクイティカーブ**: 過去トレンドチャート（USD/パーセンテージ切り替え）
+- **統計**: 総サイクル、成功/失敗、オープン/クローズ統計
+- **ポジションテーブル**: すべてのポジション詳細（エントリー価格、現在価格、損益%、清算価格）
+- **AI判断ログ**: 最近の判断記録（展開可能なCoT）
+
+### 3. リアルタイム更新
+
+- システムステータス、アカウント情報、ポジションリスト：**5秒更新**
+- 判断ログ、統計：**10秒更新**
+- エクイティチャート：**10秒更新**
+
+---
+
+## 🎛️ APIエンドポイント
+
+### 競争関連
+
+```bash
+GET /api/competition          # 競争リーダーボード（全トレーダー）
+GET /api/traders              # トレーダーリスト
+```
+
+### 単一トレーダー関連
+
+```bash
+GET /api/status?trader_id=xxx            # システムステータス
+GET /api/account?trader_id=xxx           # アカウント情報
+GET /api/positions?trader_id=xxx         # ポジションリスト
+GET /api/equity-history?trader_id=xxx    # エクイティ履歴（チャートデータ）
+GET /api/decisions/latest?trader_id=xxx  # 最新5判断
+GET /api/statistics?trader_id=xxx        # 統計
+```
+
+### システムエンドポイント
+
+```bash
+GET /health                   # ヘルスチェック
+GET /api/config               # システム設定
+```
+
+---
+
+## ⚠️ 重要なリスク警告
+
+### 取引リスク
+
+1. **暗号通貨市場は非常にボラティルが高い**、AI判断は利益を保証しません
+2. **先物取引はレバレッジを使用**、損失が元本を超える可能性があります
+3. **極端な市場状況**は清算リスクにつながる可能性があります
+4. **ファンディングレート**は保有コストに影響する可能性があります
+5. **流動性リスク**: 一部のコインでスリッページが発生する可能性があります
+
+### 技術リスク
+
+1. **ネットワークレイテンシ**は価格スリッページを引き起こす可能性があります
+2. **APIレート制限**は取引実行に影響する可能性があります
+3. **AI APIタイムアウト**は判断失敗を引き起こす可能性があります
+4. **システムバグ**は予期しない動作を引き起こす可能性があります
+
+### 使用推奨事項
+
+✅ **推奨**
+- テストには失っても構わない資金のみを使用
+- 少額から始める（推奨100-500 USDT）
+- システムの動作状態を定期的に確認
+- アカウント残高の変化を監視
+- AI判断ログを分析して戦略を理解
+
+❌ **非推奨**
+- すべての資金または借りたお金を投資
+- 長期間監視なしで実行
+- AI判断を盲目的に信頼
+- システムを理解せずに使用
+- 極端な市場ボラティリティ中に実行
+
+---
+
+## 🛠️ よくある問題
+
+### 1. コンパイルエラー：TA-Libが見つからない
+
+**解決策**: TA-Libライブラリをインストール
+```bash
+# macOS
+brew install ta-lib
+
+# Ubuntu
+sudo apt-get install libta-lib0-dev
+```
+
+### 2. 精度エラー：Precision is over the maximum
+
+**解決策**: システムがBinance LOT_SIZEから精度を自動処理します。エラーが続く場合は、ネットワーク接続を確認してください。
+
+### 3. AI APIタイムアウト
+
+**解決策**:
+- APIキーが正しいか確認
+- ネットワーク接続を確認（プロキシが必要な場合があります）
+- システムタイムアウトは120秒に設定されています
+
+### 4. フロントエンドがバックエンドに接続できない
+
+**解決策**:
+- バックエンドが実行中であることを確認（http://localhost:8080）
+- ポート8080が占有されていないか確認
+- ブラウザコンソールでエラーを確認
+
+### 5. コインプールAPI失敗
+
+**解決策**:
+- コインプールAPIはオプションです
+- APIが失敗した場合、システムはデフォルトのメインストリームコイン（BTC、ETHなど）を使用
+- config.jsonのAPI URLと認証パラメータを確認
+
+---
+
+## 📈 パフォーマンス最適化のヒント
+
+1. **合理的な判断サイクルを設定**: 3-5分を推奨、過剰取引を避ける
+2. **候補コイン数を制御**: システムはデフォルトでAI500上位20 + OI Top上位20
+3. **ログを定期的にクリーン**: 過度なディスク使用を避ける
+4. **API呼び出し数を監視**: Binanceレート制限のトリガーを避ける
+5. **少額資本でテスト**: まず100-500 USDTで戦略検証をテスト
+
+---
+
+## 🔄 変更履歴
+
+### v2.0.2（2025-10-29）
+
+**重大なバグ修正 - 取引履歴とパフォーマンス分析：**
+
+このバージョンは、収益性統計に大きく影響した過去取引記録とパフォーマンス分析システムの**重大な計算エラー**を修正します。
+
+**1. PnL計算 - 主要エラー修正**（logger/decision_logger.go）
+- **問題**: 以前はパーセンテージのみで計算され、ポジションサイズとレバレッジを完全に無視
+  - 例：100 USDTポジションが5%獲得と1000 USDTポジションが5%獲得の両方が利益として`5.0`と表示
+  - これによりパフォーマンス分析が完全に不正確に
+- **解決策**: 実際のUSDT利益額を計算
+  ```
+  PnL（USDT）= ポジション価値 × 価格変化% × レバレッジ
+  例：1000 USDT × 5% × 20x = 1000 USDT実際の利益
+  ```
+- **影響**: 勝率、利益率、シャープレシオが正確なUSDT額に基づくようになりました
+
+**2. ポジション追跡 - 重要データの欠落**
+- **問題**: オープンポジション記録が価格と時間のみを保存、数量とレバレッジが欠落
+- **解決策**: 完全な取引データを保存：
+  - `quantity`: ポジションサイズ（コイン単位）
+  - `leverage`: レバレッジ倍率（例：20x）
+  - これらは正確なPnL計算に不可欠
+
+**3. ポジションキーロジック - ロング/ショート競合**
+- **問題**: `symbol`をポジションキーとして使用し、ロングとショートの両方を保有する際にデータ競合を引き起こす
+  - 例：BTCUSDTロングとBTCUSDTショートが互いに上書き
+- **解決策**: `symbol_side`形式に変更（例：`BTCUSDT_long`、`BTCUSDT_short`）
+  - ロングとショートポジションを適切に区別
+
+**4. シャープレシオ計算 - コード最適化**
+- **問題**: 平方根計算にカスタムニュートン法を使用
+- **解決策**: 標準ライブラリ`math.Sqrt`に置き換え
+  - より信頼性が高く、保守可能で効率的
+
+**このアップデートが重要な理由：**
+- ✅ 過去取引統計が無意味なパーセンテージではなく**実際のUSDT損益**を表示
+- ✅ 異なるレバレッジ取引間のパフォーマンス比較が正確に
+- ✅ AI自己学習メカニズムが正しい過去フィードバックを受信
+- ✅ 利益率とシャープレシオの計算が意味を持つように
+- ✅ マルチポジション追跡（ロング + ショート同時）が正しく機能
+
+**推奨**: このアップデート前にシステムを実行していた場合、過去統計は不正確でした。v2.0.2にアップデート後、新しい取引は正しく計算されます。
+
+### v2.0.2（2025-10-29）
+
+**バグ修正：**
+- ✅ Aster取引所精度エラーを修正（コード-1111：「Precision is over the maximum defined for this asset」）
+- ✅ 取引所の精度要件に合わせて価格と数量のフォーマットを改善
+- ✅ デバッグ用の詳細な精度処理ログを追加
+- ✅ 適切な精度処理ですべての注文関数（OpenLong、OpenShort、CloseLong、CloseShort、SetStopLoss、SetTakeProfit）を強化
+
+**技術詳細：**
+- float64を正しい精度で文字列に変換する`formatFloatWithPrecision`関数を追加
+- 価格と数量パラメータが取引所の`pricePrecision`と`quantityPrecision`仕様に従ってフォーマットされるようになりました
+- API リクエストを最適化するために、フォーマットされた値から末尾のゼロを削除
+
+### v2.0.1（2025-10-29）
+
+**バグ修正：**
+- ✅ ComparisonChartデータ処理ロジックを修正 - cycle_numberからタイムスタンプグループ化に切り替え
+- ✅ バックエンド再起動時にcycle_numberがリセットされるとチャートがフリーズする問題を解決
+- ✅ チャートデータ表示を改善 - すべての過去データポイントを時系列で表示
+- ✅ トラブルシューティングを改善するためのデバッグログを強化
+
+### v2.0.0（2025-10-28）
+
+**主要アップデート：**
+- ✅ AI自己学習メカニズム（過去フィードバック、パフォーマンス分析）
+- ✅ マルチトレーダー競争モード（Qwen対DeepSeek）
+- ✅ BinanceスタイルUI（完全なBinanceインターフェース模倣）
+- ✅ パフォーマンス比較チャート（リアルタイムROI比較）
+- ✅ リスク管理最適化（コインごとのポジション制限調整）
+
+**バグ修正：**
+- 初期残高のハードコーディング問題を修正
+- マルチトレーダーデータ同期問題を修正
+- チャートデータの整列を最適化（cycle_numberを使用）
+
+### v1.0.0（2025-10-27）
+- 初回リリース
+- 基本的なAI取引機能
+- 判断ログシステム
+- シンプルなWebインターフェース
+
+---
+
+## 📄 ライセンス
+
+MITライセンス - 詳細は[LICENSE](LICENSE)ファイルを参照してください
+
+---
+
+## 🤝 貢献
+
+IssueとPull Requestを歓迎します！
+
+### 開発ガイド
+
+1. プロジェクトをフォーク
+2. 機能ブランチを作成（`git checkout -b feature/AmazingFeature`）
+3. 変更をコミット（`git commit -m 'Add some AmazingFeature'`）
+4. ブランチにプッシュ（`git push origin feature/AmazingFeature`）
+5. Pull Requestを開く
+
+---
+
+## 📬 お問い合わせ
+
+
+### 🐛 技術サポート
+- **GitHub Issues**: [Issueを提出](https://github.com/tinkle-community/nofx/issues)
+- **開発者コミュニティ**: [Telegramグループ](https://t.me/nofx_dev_community)
+
+---
+
+## 🙏 謝辞
+
+- [Binance API](https://binance-docs.github.io/apidocs/futures/en/) - Binance先物API
+- [DeepSeek](https://platform.deepseek.com/) - DeepSeek AI API
+- [Qwen](https://dashscope.aliyuncs.com/) - Alibaba Cloud Qwen
+- [TA-Lib](https://ta-lib.org/) - テクニカル指標ライブラリ
+- [Recharts](https://recharts.org/) - Reactチャートライブラリ
+
+---
+
+**最終更新**: 2025-10-29（v2.0.3）
+
+**⚡ AIの力で量的取引の可能性を探求しましょう！**
+
+---
+
+## ⭐ Star履歴
+
+[![Star履歴チャート](https://api.star-history.com/svg?repos=tinkle-community/nofx&type=Date)](https://star-history.com/#tinkle-community/nofx&Date)
diff --git a/README.md b/README.md
index 1420d2e5..a444dcc7 100644
--- a/README.md
+++ b/README.md
@@ -8,8 +8,6 @@
 
 **Languages:** [English](README.md) | [中文](docs/i18n/zh-CN/README.md) | [Українська](docs/i18n/uk/README.md) | [Русский](docs/i18n/ru/README.md) | [日本語](docs/i18n/ja/README.md)
 
-**Official Twitter:** [@nofx_ai](https://x.com/nofx_ai)
-
 **📚 Documentation:** [Docs Home](docs/README.md) | [Getting Started](docs/getting-started/README.md) | [Prompt Writing Guide](docs/prompt-guide.md) ([中文](docs/prompt-guide.zh-CN.md)) | [Changelog](CHANGELOG.md) | [Contributing](CONTRIBUTING.md) | [Security](SECURITY.md)
 
 ---
@@ -31,7 +29,6 @@
 - [🧠 AI Self-Learning](#-ai-self-learning-example)
 - [📊 Web Interface Features](#-web-interface-features)
 - [🎛️ API Endpoints](#️-api-endpoints)
-- [🔐 Admin Mode (Single-User)](#-admin-mode-single-user) 
 - [⚠️ Important Risk Warnings](#️-important-risk-warnings)
 - [🛠️ Common Issues](#️-common-issues)
 - [📈 Performance Tips](#-performance-optimization-tips)
@@ -56,15 +53,12 @@
 ### 👥 Core Team
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
 
 ### 💼 Seed Funding Round Open
 
-We are currently raising our **seed round**. 
-
-**For investment inquiries**, please DM **Tinkle** or **Zack** via Twitter.
+We are currently raising our **seed round**.
 
-**For partnerships and collaborations**, please DM our official Twitter [@nofx_ai](https://x.com/nofx_ai).
+**For investment inquiries**, please DM **Tinkle** via Twitter.
 
 ---
 
@@ -245,48 +239,6 @@ NOFX is built with a modern, modular architecture:
 
 ---
 
-## 🔐 Admin Mode (Single-User)
-
-For self-hosted or single-tenant setups, NOFX supports a strict admin-only mode that disables public features and requires an admin password for all access.
-
-### How it works
-- All API endpoints require a valid JWT when `admin_mode=true`, except:
-  - `GET /api/health`
-  - `GET /api/config`
-  - `POST /api/admin-login`
-- Logout invalidates the current token via an in-memory blacklist (sufficient for single instance; use Redis for multi-instance – see Notes).
-
-### Quick setup
-1) Set flags in `config.json`:
-```jsonc
-{
-  // ... other config
-  "admin_mode": true,
-  "jwt_secret": "YOUR_JWT_SCR" 
-}
-```
-
-2) Provide required environment variables:
-- `NOFX_ADMIN_PASSWORD` — plaintext admin password (only used at startup to derive a bcrypt hash)
-
-Docker Compose example (already wired):
-```yaml
-services:
-  nofx:
-    environment:
-      - NOFX_ADMIN_PASSWORD=${NOFX_ADMIN_PASSWORD}
-```
-
-1) Login flow (admin mode):
-- Open the web UI → you’ll be redirected to the login page
-- Enter admin password → the server returns a JWT
-- The UI stores the token and authenticates subsequent API calls
-
-### Notes
-- Token lifetime: 24h. On logout, tokens are blacklisted in-memory until expiry. For multi-instance deployments, use a shared store (e.g., Redis) to sync the blacklist.
-
----
-
 ## 💰 Register Binance Account (Save on Fees!)
 
 Before using this system, you need a Binance Futures account. **Use our referral link to save on trading fees:**
@@ -337,8 +289,8 @@ nano config.json  # or use any editor
 #### Step 2: One-Click Start
 ```bash
 # Option 1: Use convenience script (Recommended)
-chmod +x start.sh
-./start.sh start --build
+chmod +x scripts/start.sh
+./scripts/start.sh start --build
 
 > #### Docker Compose Version Notes
 >
@@ -363,10 +315,10 @@ Open your browser and visit: **http://localhost:3000**
 
 #### Manage Your System
 ```bash
-./start.sh logs      # View logs
-./start.sh status    # Check status
-./start.sh stop      # Stop services
-./start.sh restart   # Restart services
+./scripts/start.sh logs      # View logs
+./scripts/start.sh status    # Check status
+./scripts/start.sh stop      # Stop services
+./scripts/start.sh restart   # Restart services
 ```
 
 **📖 For detailed Docker deployment guide, troubleshooting, and advanced configuration:**
diff --git a/api/server.go b/api/server.go
index b3f67f11..daf3665e 100644
--- a/api/server.go
+++ b/api/server.go
@@ -5,6 +5,7 @@ import (
 	"encoding/json"
 	"fmt"
 	"log"
+	"math"
 	"net"
 	"net/http"
 	"nofx/auth"
@@ -132,7 +133,6 @@ func (s *Server) setupRoutes() {
 			protected.POST("/traders/:id/start", s.handleStartTrader)
 			protected.POST("/traders/:id/stop", s.handleStopTrader)
 			protected.PUT("/traders/:id/prompt", s.handleUpdateTraderPrompt)
-			protected.POST("/traders/:id/sync-balance", s.handleSyncBalance)
 
 			// AI模型配置
 			protected.GET("/models", s.handleGetModelConfigs)
@@ -197,11 +197,18 @@ func (s *Server) handleGetSystemConfig(c *gin.Context) {
 	betaModeStr, _ := s.database.GetSystemConfig("beta_mode")
 	betaMode := betaModeStr == "true"
 
+	regEnabledStr, err := s.database.GetSystemConfig("registration_enabled")
+	registrationEnabled := true
+	if err == nil {
+		registrationEnabled = strings.ToLower(regEnabledStr) != "false"
+	}
+
 	c.JSON(http.StatusOK, gin.H{
-		"beta_mode":        betaMode,
-		"default_coins":    defaultCoins,
-		"btc_eth_leverage": btcEthLeverage,
-		"altcoin_leverage": altcoinLeverage,
+		"beta_mode":            betaMode,
+		"default_coins":        defaultCoins,
+		"btc_eth_leverage":     btcEthLeverage,
+		"altcoin_leverage":     altcoinLeverage,
+		"registration_enabled": registrationEnabled,
 	})
 }
 
@@ -485,8 +492,9 @@ func (s *Server) handleCreateTrader(c *gin.Context) {
 		}
 	}
 
-	// 生成交易员ID
-	traderID := fmt.Sprintf("%s_%s_%d", req.ExchangeID, req.AIModelID, time.Now().Unix())
+	// 生成交易员ID (使用 UUID 确保唯一性，解决 Issue #893)
+	// 保留前缀以便调试和日志追踪
+	traderID := fmt.Sprintf("%s_%s_%s", req.ExchangeID, req.AIModelID, uuid.New().String())
 
 	// 设置默认值
 	isCrossMargin := true // 默认为全仓模式
@@ -582,16 +590,36 @@ func (s *Server) handleCreateTrader(c *gin.Context) {
 			if balanceErr != nil {
 				log.Printf("⚠️ 查询交易所余额失败，使用用户输入的初始资金: %v", balanceErr)
 			} else {
-				// 提取可用余额
-				if availableBalance, ok := balanceInfo["available_balance"].(float64); ok && availableBalance > 0 {
-					actualBalance = availableBalance
-					log.Printf("✓ 查询到交易所实际余额: %.2f USDT (用户输入: %.2f USDT)", actualBalance, req.InitialBalance)
-				} else if totalBalance, ok := balanceInfo["balance"].(float64); ok && totalBalance > 0 {
-					// 有些交易所可能只返回 balance 字段
-					actualBalance = totalBalance
-					log.Printf("✓ 查询到交易所实际余额: %.2f USDT (用户输入: %.2f USDT)", actualBalance, req.InitialBalance)
+				// 🔧 计算Total Equity = Wallet Balance + Unrealized Profit
+				// 这是账户的真实净值，用作Initial Balance的基准
+				var totalWalletBalance float64
+				var totalUnrealizedProfit float64
+
+				// 提取钱包余额
+				if wb, ok := balanceInfo["totalWalletBalance"].(float64); ok {
+					totalWalletBalance = wb
+				} else if wb, ok := balanceInfo["wallet_balance"].(float64); ok {
+					totalWalletBalance = wb
+				} else if wb, ok := balanceInfo["balance"].(float64); ok {
+					totalWalletBalance = wb
+				}
+
+				// 提取未实现盈亏
+				if up, ok := balanceInfo["totalUnrealizedProfit"].(float64); ok {
+					totalUnrealizedProfit = up
+				} else if up, ok := balanceInfo["unrealized_profit"].(float64); ok {
+					totalUnrealizedProfit = up
+				}
+
+				// 计算总净值
+				totalEquity := totalWalletBalance + totalUnrealizedProfit
+
+				if totalEquity > 0 {
+					actualBalance = totalEquity
+					log.Printf("✅ 查询到交易所实际净值: %.2f USDT (钱包: %.2f + 未实现: %.2f, 用户输入: %.2f)",
+						actualBalance, totalWalletBalance, totalUnrealizedProfit, req.InitialBalance)
 				} else {
-					log.Printf("⚠️ 无法从余额信息中提取可用余额，使用用户输入的初始资金")
+					log.Printf("⚠️ 无法从余额信息中计算净值，使用用户输入的初始资金")
 				}
 			}
 		}
@@ -745,6 +773,21 @@ func (s *Server) handleUpdateTrader(c *gin.Context) {
 		return
 	}
 
+	// 如果请求中包含initial_balance且与现有值不同，单独更新它
+	// UpdateTrader不会更新initial_balance，需要使用专门的方法
+	if req.InitialBalance > 0 && math.Abs(req.InitialBalance-existingTrader.InitialBalance) > 0.1 {
+		err = s.database.UpdateTraderInitialBalance(userID, traderID, req.InitialBalance)
+		if err != nil {
+			log.Printf("⚠️ 更新初始余额失败: %v", err)
+			// 不返回错误，因为主要配置已更新成功
+		} else {
+			log.Printf("✓ 初始余额已更新: %.2f -> %.2f", existingTrader.InitialBalance, req.InitialBalance)
+		}
+	}
+
+	// 🔄 从内存中移除旧的trader实例，以便重新加载最新配置
+	s.traderManager.RemoveTrader(traderID)
+
 	// 重新加载交易员到内存
 	err = s.traderManager.LoadTraderByID(s.database, userID, traderID)
 	if err != nil {
@@ -906,113 +949,6 @@ func (s *Server) handleUpdateTraderPrompt(c *gin.Context) {
 	c.JSON(http.StatusOK, gin.H{"message": "自定义prompt已更新"})
 }
 
-// handleSyncBalance 同步交易所余额到initial_balance（选项B：手动同步 + 选项C：智能检测）
-func (s *Server) handleSyncBalance(c *gin.Context) {
-	userID := c.GetString("user_id")
-	traderID := c.Param("id")
-
-	log.Printf("🔄 用户 %s 请求同步交易员 %s 的余额", userID, traderID)
-
-	// 从数据库获取交易员配置（包含交易所信息）
-	traderConfig, _, exchangeCfg, err := s.database.GetTraderConfig(userID, traderID)
-	if err != nil {
-		c.JSON(http.StatusNotFound, gin.H{"error": "交易员不存在"})
-		return
-	}
-
-	if exchangeCfg == nil || !exchangeCfg.Enabled {
-		c.JSON(http.StatusBadRequest, gin.H{"error": "交易所未配置或未启用"})
-		return
-	}
-
-	// 创建临时 trader 查询余额
-	var tempTrader trader.Trader
-	var createErr error
-
-	switch traderConfig.ExchangeID {
-	case "binance":
-		tempTrader = trader.NewFuturesTrader(exchangeCfg.APIKey, exchangeCfg.SecretKey, userID)
-	case "hyperliquid":
-		tempTrader, createErr = trader.NewHyperliquidTrader(
-			exchangeCfg.APIKey,
-			exchangeCfg.HyperliquidWalletAddr,
-			exchangeCfg.Testnet,
-		)
-	case "aster":
-		tempTrader, createErr = trader.NewAsterTrader(
-			exchangeCfg.AsterUser,
-			exchangeCfg.AsterSigner,
-			exchangeCfg.AsterPrivateKey,
-		)
-	default:
-		c.JSON(http.StatusBadRequest, gin.H{"error": "不支持的交易所类型"})
-		return
-	}
-
-	if createErr != nil {
-		log.Printf("⚠️ 创建临时 trader 失败: %v", createErr)
-		c.JSON(http.StatusInternalServerError, gin.H{"error": fmt.Sprintf("连接交易所失败: %v", createErr)})
-		return
-	}
-
-	// 查询实际余额
-	balanceInfo, balanceErr := tempTrader.GetBalance()
-	if balanceErr != nil {
-		log.Printf("⚠️ 查询交易所余额失败: %v", balanceErr)
-		c.JSON(http.StatusInternalServerError, gin.H{"error": fmt.Sprintf("查询余额失败: %v", balanceErr)})
-		return
-	}
-
-	// 提取可用余额
-	var actualBalance float64
-	if availableBalance, ok := balanceInfo["available_balance"].(float64); ok && availableBalance > 0 {
-		actualBalance = availableBalance
-	} else if availableBalance, ok := balanceInfo["availableBalance"].(float64); ok && availableBalance > 0 {
-		actualBalance = availableBalance
-	} else if totalBalance, ok := balanceInfo["balance"].(float64); ok && totalBalance > 0 {
-		actualBalance = totalBalance
-	} else {
-		c.JSON(http.StatusInternalServerError, gin.H{"error": "无法获取可用余额"})
-		return
-	}
-
-	oldBalance := traderConfig.InitialBalance
-
-	// ✅ 选项C：智能检测余额变化
-	changePercent := ((actualBalance - oldBalance) / oldBalance) * 100
-	changeType := "增加"
-	if changePercent < 0 {
-		changeType = "减少"
-	}
-
-	log.Printf("✓ 查询到交易所实际余额: %.2f USDT (当前配置: %.2f USDT, 变化: %.2f%%)",
-		actualBalance, oldBalance, changePercent)
-
-	// 更新数据库中的 initial_balance
-	err = s.database.UpdateTraderInitialBalance(userID, traderID, actualBalance)
-	if err != nil {
-		log.Printf("❌ 更新initial_balance失败: %v", err)
-		c.JSON(http.StatusInternalServerError, gin.H{"error": "更新余额失败"})
-		return
-	}
-
-	// 重新加载交易员到内存
-	err = s.traderManager.LoadTraderByID(s.database, userID, traderID)
-	if err != nil {
-		log.Printf("⚠️ 重新加载交易员到内存失败: %v", err)
-	}
-
-	log.Printf("✅ 已同步余额: %.2f → %.2f USDT (%s %.2f%%)", oldBalance, actualBalance, changeType, changePercent)
-
-	c.JSON(http.StatusOK, gin.H{
-		"message":        "余额同步成功",
-		"old_balance":    oldBalance,
-		"new_balance":    actualBalance,
-		"change_percent": changePercent,
-		"change_type":    changeType,
-	})
-}
-
 // handleGetModelConfigs 获取AI模型配置
 func (s *Server) handleGetModelConfigs(c *gin.Context) {
 	userID := c.GetString("user_id")
@@ -1270,12 +1206,13 @@ func (s *Server) handleTraderList(c *gin.Context) {
 		// 返回完整的 AIModelID（如 "admin_deepseek"），不要截断
 		// 前端需要完整 ID 来验证模型是否存在（与 handleGetTraderConfig 保持一致）
 		result = append(result, map[string]interface{}{
-			"trader_id":       trader.ID,
-			"trader_name":     trader.Name,
-			"ai_model":        trader.AIModelID, // 使用完整 ID
-			"exchange_id":     trader.ExchangeID,
-			"is_running":      isRunning,
-			"initial_balance": trader.InitialBalance,
+			"trader_id":              trader.ID,
+			"trader_name":            trader.Name,
+			"ai_model":               trader.AIModelID, // 使用完整 ID
+			"exchange_id":            trader.ExchangeID,
+			"is_running":             isRunning,
+			"initial_balance":        trader.InitialBalance,
+			"system_prompt_template": trader.SystemPromptTemplate,
 		})
 	}
 
@@ -1555,22 +1492,16 @@ func (s *Server) handleEquityHistory(c *gin.Context) {
 		CycleNumber      int     `json:"cycle_number"`
 	}
 
-	// 从AutoTrader获取初始余额（用于计算盈亏百分比）
-	initialBalance := 0.0
+	// 从AutoTrader获取当前初始余额（用作旧数据的fallback）
+	base := 0.0
 	if status := trader.GetStatus(); status != nil {
 		if ib, ok := status["initial_balance"].(float64); ok && ib > 0 {
-			initialBalance = ib
+			base = ib
 		}
 	}
 
-	// 如果无法从status获取，且有历史记录，则从第一条记录获取
-	if initialBalance == 0 && len(records) > 0 {
-		// 第一条记录的equity作为初始余额
-		initialBalance = records[0].AccountState.TotalBalance
-	}
-
 	// 如果还是无法获取，返回错误
-	if initialBalance == 0 {
+	if base == 0 {
 		c.JSON(http.StatusInternalServerError, gin.H{
 			"error": "无法获取初始余额",
 		})
@@ -1580,14 +1511,24 @@ func (s *Server) handleEquityHistory(c *gin.Context) {
 	var history []EquityPoint
 	for _, record := range records {
 		// TotalBalance字段实际存储的是TotalEquity
-		totalEquity := record.AccountState.TotalBalance
+		// totalEquity := record.AccountState.TotalBalance
 		// TotalUnrealizedProfit字段实际存储的是TotalPnL（相对初始余额）
-		totalPnL := record.AccountState.TotalUnrealizedProfit
+		// totalPnL := record.AccountState.TotalUnrealizedProfit
+		walletBalance := record.AccountState.TotalBalance
+		unrealizedPnL := record.AccountState.TotalUnrealizedProfit
+		totalEquity := walletBalance + unrealizedPnL
+
+		// 🔄 使用历史记录中保存的initial_balance（如果有）
+		// 这样可以保持历史PNL%的准确性，即使用户后来更新了initial_balance
+		if record.AccountState.InitialBalance > 0 {
+			base = record.AccountState.InitialBalance
+		}
 
+		totalPnL := totalEquity - base
 		// 计算盈亏百分比
 		totalPnLPct := 0.0
-		if initialBalance > 0 {
-			totalPnLPct = (totalPnL / initialBalance) * 100
+		if base > 0 {
+			totalPnLPct = (totalPnL / base) * 100
 		}
 
 		history = append(history, EquityPoint{
@@ -1704,6 +1645,14 @@ func (s *Server) handleLogout(c *gin.Context) {
 
 // handleRegister 处理用户注册请求
 func (s *Server) handleRegister(c *gin.Context) {
+	regEnabled := true
+	if regStr, err := s.database.GetSystemConfig("registration_enabled"); err == nil {
+		regEnabled = strings.ToLower(regStr) != "false"
+	}
+	if !regEnabled {
+		c.JSON(http.StatusForbidden, gin.H{"error": "注册已关闭"})
+		return
+	}
 
 	var req struct {
 		Email    string `json:"email" binding:"required,email"`
@@ -2155,16 +2104,17 @@ func (s *Server) handlePublicTraderList(c *gin.Context) {
 	result := make([]map[string]interface{}, 0, len(traders))
 	for _, trader := range traders {
 		result = append(result, map[string]interface{}{
-			"trader_id":       trader["trader_id"],
-			"trader_name":     trader["trader_name"],
-			"ai_model":        trader["ai_model"],
-			"exchange":        trader["exchange"],
-			"is_running":      trader["is_running"],
-			"total_equity":    trader["total_equity"],
-			"total_pnl":       trader["total_pnl"],
-			"total_pnl_pct":   trader["total_pnl_pct"],
-			"position_count":  trader["position_count"],
-			"margin_used_pct": trader["margin_used_pct"],
+			"trader_id":              trader["trader_id"],
+			"trader_name":            trader["trader_name"],
+			"ai_model":               trader["ai_model"],
+			"exchange":               trader["exchange"],
+			"is_running":             trader["is_running"],
+			"total_equity":           trader["total_equity"],
+			"total_pnl":              trader["total_pnl"],
+			"total_pnl_pct":          trader["total_pnl_pct"],
+			"position_count":         trader["position_count"],
+			"margin_used_pct":        trader["margin_used_pct"],
+			"system_prompt_template": trader["system_prompt_template"],
 		})
 	}
 
diff --git a/api/server_test.go b/api/server_test.go
index 6b6b83c1..f59817bd 100644
--- a/api/server_test.go
+++ b/api/server_test.go
@@ -225,3 +225,81 @@ func TestUpdateTraderRequest_CompleteFields(t *testing.T) {
 		t.Errorf("SystemPromptTemplate mismatch: expected %q, got %q", "nof1", req.SystemPromptTemplate)
 	}
 }
+
+// TestTraderListResponse_SystemPromptTemplate 测试 handleTraderList API 返回的 trader 对象是否包含 system_prompt_template 字段
+func TestTraderListResponse_SystemPromptTemplate(t *testing.T) {
+	// 模拟 handleTraderList 中的 trader 对象构造
+	trader := &config.TraderRecord{
+		ID:                   "trader-001",
+		UserID:               "user-1",
+		Name:                 "My Trader",
+		AIModelID:            "gpt-4",
+		ExchangeID:           "binance",
+		InitialBalance:       5000,
+		SystemPromptTemplate: "nof1",
+		IsRunning:            true,
+	}
+
+	// 构造 API 响应对象（与 api/server.go 中的逻辑一致）
+	response := map[string]interface{}{
+		"trader_id":              trader.ID,
+		"trader_name":            trader.Name,
+		"ai_model":               trader.AIModelID,
+		"exchange_id":            trader.ExchangeID,
+		"is_running":             trader.IsRunning,
+		"initial_balance":        trader.InitialBalance,
+		"system_prompt_template": trader.SystemPromptTemplate,
+	}
+
+	// ✅ 验证 system_prompt_template 字段存在
+	if _, exists := response["system_prompt_template"]; !exists {
+		t.Errorf("Trader list response is missing 'system_prompt_template' field")
+	}
+
+	// ✅ 验证 system_prompt_template 值正确
+	if response["system_prompt_template"] != "nof1" {
+		t.Errorf("Expected system_prompt_template='nof1', got %v", response["system_prompt_template"])
+	}
+}
+
+// TestPublicTraderListResponse_SystemPromptTemplate 测试 handlePublicTraderList API 返回的 trader 对象是否包含 system_prompt_template 字段
+func TestPublicTraderListResponse_SystemPromptTemplate(t *testing.T) {
+	// 模拟 getConcurrentTraderData 返回的 trader 数据
+	traderData := map[string]interface{}{
+		"trader_id":              "trader-002",
+		"trader_name":            "Public Trader",
+		"ai_model":               "claude",
+		"exchange":               "binance",
+		"total_equity":           10000.0,
+		"total_pnl":              500.0,
+		"total_pnl_pct":          5.0,
+		"position_count":         3,
+		"margin_used_pct":        25.0,
+		"is_running":             true,
+		"system_prompt_template": "default",
+	}
+
+	// 构造 API 响应对象（与 api/server.go handlePublicTraderList 中的逻辑一致）
+	response := map[string]interface{}{
+		"trader_id":              traderData["trader_id"],
+		"trader_name":            traderData["trader_name"],
+		"ai_model":               traderData["ai_model"],
+		"exchange":               traderData["exchange"],
+		"total_equity":           traderData["total_equity"],
+		"total_pnl":              traderData["total_pnl"],
+		"total_pnl_pct":          traderData["total_pnl_pct"],
+		"position_count":         traderData["position_count"],
+		"margin_used_pct":        traderData["margin_used_pct"],
+		"system_prompt_template": traderData["system_prompt_template"],
+	}
+
+	// ✅ 验证 system_prompt_template 字段存在
+	if _, exists := response["system_prompt_template"]; !exists {
+		t.Errorf("Public trader list response is missing 'system_prompt_template' field")
+	}
+
+	// ✅ 验证 system_prompt_template 值正确
+	if response["system_prompt_template"] != "default" {
+		t.Errorf("Expected system_prompt_template='default', got %v", response["system_prompt_template"])
+	}
+}
diff --git a/api/traderid_test.go b/api/traderid_test.go
new file mode 100644
index 00000000..52b581c8
--- /dev/null
+++ b/api/traderid_test.go
@@ -0,0 +1,123 @@
+package api
+
+import (
+	"fmt"
+	"strings"
+	"testing"
+
+	"github.com/google/uuid"
+)
+
+// TestTraderIDUniqueness 测试 traderID 的唯一性（修复 Issue #893）
+// 验证即使在相同的 exchange 和 AI model 下，也能生成唯一的 traderID
+func TestTraderIDUniqueness(t *testing.T) {
+	exchangeID := "binance"
+	aiModelID := "gpt-4"
+
+	// 模拟同时创建 100 个 trader（相同参数）
+	traderIDs := make(map[string]bool)
+	const numTraders = 100
+
+	for i := 0; i < numTraders; i++ {
+		// 模拟 api/server.go:497 的 traderID 生成逻辑
+		traderID := generateTraderID(exchangeID, aiModelID)
+
+		// ✅ 检查是否重复
+		if traderIDs[traderID] {
+			t.Errorf("Duplicate traderID detected: %s", traderID)
+		}
+		traderIDs[traderID] = true
+
+		// ✅ 验证格式：应该是 "exchange_model_uuid"
+		if !isValidTraderIDFormat(traderID, exchangeID, aiModelID) {
+			t.Errorf("Invalid traderID format: %s", traderID)
+		}
+	}
+
+	// ✅ 验证生成了预期数量的唯一 ID
+	if len(traderIDs) != numTraders {
+		t.Errorf("Expected %d unique traderIDs, got %d", numTraders, len(traderIDs))
+	}
+}
+
+// generateTraderID 辅助函数，模拟 api/server.go 中的 traderID 生成逻辑
+func generateTraderID(exchangeID, aiModelID string) string {
+	return fmt.Sprintf("%s_%s_%s", exchangeID, aiModelID, uuid.New().String())
+}
+
+// isValidTraderIDFormat 验证 traderID 格式是否符合预期
+func isValidTraderIDFormat(traderID, expectedExchange, expectedModel string) bool {
+	// 格式：exchange_model_uuid
+	// 例如：binance_gpt-4_a1b2c3d4-e5f6-7890-abcd-ef1234567890
+	parts := strings.Split(traderID, "_")
+	if len(parts) < 3 {
+		return false
+	}
+
+	// 验证前缀
+	if parts[0] != expectedExchange {
+		return false
+	}
+
+	// AI model 可能包含连字符（如 gpt-4），所以需要重组
+	// 最后一部分应该是 UUID
+	uuidPart := parts[len(parts)-1]
+
+	// 验证 UUID 格式（36 个字符，包含 4 个连字符）
+	_, err := uuid.Parse(uuidPart)
+	return err == nil
+}
+
+// TestTraderIDFormat 测试 traderID 格式的正确性
+func TestTraderIDFormat(t *testing.T) {
+	tests := []struct {
+		name       string
+		exchangeID string
+		aiModelID  string
+	}{
+		{"Binance + GPT-4", "binance", "gpt-4"},
+		{"Hyperliquid + Claude", "hyperliquid", "claude-3"},
+		{"OKX + Qwen", "okx", "qwen-2.5"},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			traderID := generateTraderID(tt.exchangeID, tt.aiModelID)
+
+			// ✅ 验证包含正确的前缀
+			if !strings.HasPrefix(traderID, tt.exchangeID+"_"+tt.aiModelID+"_") {
+				t.Errorf("traderID does not have correct prefix. Got: %s", traderID)
+			}
+
+			// ✅ 验证格式有效
+			if !isValidTraderIDFormat(traderID, tt.exchangeID, tt.aiModelID) {
+				t.Errorf("Invalid traderID format: %s", traderID)
+			}
+
+			// ✅ 验证长度合理（至少应该有 exchange + model + "_" + UUID(36) 的长度）
+			minLength := len(tt.exchangeID) + len(tt.aiModelID) + 2 + 36 // 2个下划线 + 36字符UUID
+			if len(traderID) < minLength {
+				t.Errorf("traderID too short: expected at least %d chars, got %d", minLength, len(traderID))
+			}
+		})
+	}
+}
+
+// TestTraderIDNoCollision 测试在高并发场景下不会产生碰撞
+func TestTraderIDNoCollision(t *testing.T) {
+	const iterations = 1000
+	uniqueIDs := make(map[string]bool, iterations)
+
+	// 模拟高并发场景
+	for i := 0; i < iterations; i++ {
+		id := generateTraderID("binance", "gpt-4")
+		if uniqueIDs[id] {
+			t.Fatalf("Collision detected after %d iterations: %s", i+1, id)
+		}
+		uniqueIDs[id] = true
+	}
+
+	if len(uniqueIDs) != iterations {
+		t.Errorf("Expected %d unique IDs, got %d", iterations, len(uniqueIDs))
+	}
+}
diff --git a/config.json.example b/config.json.example
index 1c7406d0..331fbc54 100644
--- a/config.json.example
+++ b/config.json.example
@@ -1,5 +1,6 @@
 {
   "beta_mode": false,
+  "registration_enabled": true,
   "leverage": {
     "btc_eth_leverage": 5,
     "altcoin_leverage": 5
diff --git a/config/database.go b/config/database.go
index 5977ae3c..b275720c 100644
--- a/config/database.go
+++ b/config/database.go
@@ -324,6 +324,7 @@ func (d *Database) initDefaultData() error {
 		"btc_eth_leverage":     "5",                                                                                   // BTC/ETH杠杆倍数
 		"altcoin_leverage":     "5",                                                                                   // 山寨币杠杆倍数
 		"jwt_secret":           "",                                                                                    // JWT密钥，默认为空，由config.json或系统生成
+		"registration_enabled": "true",                                                                                // 默认允许注册
 	}
 
 	for key, value := range systemConfigs {
@@ -954,12 +955,12 @@ func (d *Database) UpdateTraderStatus(userID, id string, isRunning bool) error {
 func (d *Database) UpdateTrader(trader *TraderRecord) error {
 	_, err := d.db.Exec(`
 		UPDATE traders SET
-			name = ?, ai_model_id = ?, exchange_id = ?, initial_balance = ?,
+			name = ?, ai_model_id = ?, exchange_id = ?,
 			scan_interval_minutes = ?, btc_eth_leverage = ?, altcoin_leverage = ?,
 			trading_symbols = ?, custom_prompt = ?, override_base_prompt = ?,
 			system_prompt_template = ?, is_cross_margin = ?, updated_at = CURRENT_TIMESTAMP
 		WHERE id = ? AND user_id = ?
-	`, trader.Name, trader.AIModelID, trader.ExchangeID, trader.InitialBalance,
+	`, trader.Name, trader.AIModelID, trader.ExchangeID,
 		trader.ScanIntervalMinutes, trader.BTCETHLeverage, trader.AltcoinLeverage,
 		trader.TradingSymbols, trader.CustomPrompt, trader.OverrideBasePrompt,
 		trader.SystemPromptTemplate, trader.IsCrossMargin, trader.ID, trader.UserID)
@@ -972,7 +973,8 @@ func (d *Database) UpdateTraderCustomPrompt(userID, id string, customPrompt stri
 	return err
 }
 
-// UpdateTraderInitialBalance 更新交易员初始余额（用于自动同步交易所实际余额）
+// UpdateTraderInitialBalance 更新交易员初始余额（仅支持手动更新）
+// ⚠️ 注意：系统不会自动调用此方法，仅供用户在充值/提现后手动同步使用
 func (d *Database) UpdateTraderInitialBalance(userID, id string, newBalance float64) error {
 	_, err := d.db.Exec(`UPDATE traders SET initial_balance = ? WHERE id = ? AND user_id = ?`, newBalance, id, userID)
 	return err
diff --git a/decision/engine.go b/decision/engine.go
index bef863df..ea0f4fbc 100644
--- a/decision/engine.go
+++ b/decision/engine.go
@@ -48,6 +48,7 @@ type PositionInfo struct {
 type AccountInfo struct {
 	TotalEquity      float64 `json:"total_equity"`      // 账户净值
 	AvailableBalance float64 `json:"available_balance"` // 可用余额
+	UnrealizedPnL    float64 `json:"unrealized_pnl"`    // 未实现盈亏
 	TotalPnL         float64 `json:"total_pnl"`         // 总盈亏
 	TotalPnLPct      float64 `json:"total_pnl_pct"`     // 总盈亏百分比
 	MarginUsed       float64 `json:"margin_used"`       // 已用保证金
@@ -120,12 +121,12 @@ type FullDecision struct {
 }
 
 // GetFullDecision 获取AI的完整交易决策（批量分析所有币种和持仓）
-func GetFullDecision(ctx *Context, mcpClient *mcp.Client) (*FullDecision, error) {
+func GetFullDecision(ctx *Context, mcpClient mcp.AIClient) (*FullDecision, error) {
 	return GetFullDecisionWithCustomPrompt(ctx, mcpClient, "", false, "")
 }
 
 // GetFullDecisionWithCustomPrompt 获取AI的完整交易决策（支持自定义prompt和模板选择）
-func GetFullDecisionWithCustomPrompt(ctx *Context, mcpClient *mcp.Client, customPrompt string, overrideBase bool, templateName string) (*FullDecision, error) {
+func GetFullDecisionWithCustomPrompt(ctx *Context, mcpClient mcp.AIClient, customPrompt string, overrideBase bool, templateName string) (*FullDecision, error) {
 	// 1. 为所有币种获取市场数据
 	if err := fetchMarketDataForContext(ctx); err != nil {
 		return nil, fmt.Errorf("获取市场数据失败: %w", err)
@@ -345,13 +346,17 @@ func buildSystemPrompt(accountEquity float64, btcEthLeverage, altcoinLeverage in
 	sb.WriteString("<decision>\n")
 	sb.WriteString("```json\n[\n")
 	sb.WriteString(fmt.Sprintf("  {\"symbol\": \"BTCUSDT\", \"action\": \"open_short\", \"leverage\": %d, \"position_size_usd\": %.0f, \"stop_loss\": 97000, \"take_profit\": 91000, \"confidence\": 85, \"risk_usd\": 300, \"reasoning\": \"下跌趋势+MACD死叉\"},\n", btcEthLeverage, accountEquity*5))
+	sb.WriteString("  {\"symbol\": \"SOLUSDT\", \"action\": \"update_stop_loss\", \"new_stop_loss\": 155, \"reasoning\": \"移动止损至保本位\"},\n")
 	sb.WriteString("  {\"symbol\": \"ETHUSDT\", \"action\": \"close_long\", \"reasoning\": \"止盈离场\"}\n")
 	sb.WriteString("]\n```\n")
 	sb.WriteString("</decision>\n\n")
 	sb.WriteString("## 字段说明\n\n")
-	sb.WriteString("- `action`: open_long | open_short | close_long | close_short | hold | wait\n")
+	sb.WriteString("- `action`: open_long | open_short | close_long | close_short | update_stop_loss | update_take_profit | partial_close | hold | wait\n")
 	sb.WriteString("- `confidence`: 0-100（开仓建议≥75）\n")
-	sb.WriteString("- 开仓时必填: leverage, position_size_usd, stop_loss, take_profit, confidence, risk_usd, reasoning\n\n")
+	sb.WriteString("- 开仓时必填: leverage, position_size_usd, stop_loss, take_profit, confidence, risk_usd, reasoning\n")
+	sb.WriteString("- update_stop_loss 时必填: new_stop_loss (注意是 new_stop_loss，不是 stop_loss)\n")
+	sb.WriteString("- update_take_profit 时必填: new_take_profit (注意是 new_take_profit，不是 take_profit)\n")
+	sb.WriteString("- partial_close 时必填: close_percentage (0-100)\n\n")
 
 	return sb.String()
 }
diff --git a/decision/prompt_test.go b/decision/prompt_test.go
new file mode 100644
index 00000000..f8fc1b3b
--- /dev/null
+++ b/decision/prompt_test.go
@@ -0,0 +1,50 @@
+package decision
+
+import (
+	"strings"
+	"testing"
+)
+
+// TestBuildSystemPrompt_ContainsAllValidActions 测试 prompt 是否包含所有有效的 action
+func TestBuildSystemPrompt_ContainsAllValidActions(t *testing.T) {
+	// 这是系统中定义的所有有效 action（来自 validateDecision）
+	validActions := []string{
+		"open_long",
+		"open_short",
+		"close_long",
+		"close_short",
+		"update_stop_loss",
+		"update_take_profit",
+		"partial_close",
+		"hold",
+		"wait",
+	}
+
+	// 构建 prompt
+	prompt := buildSystemPrompt(1000.0, 10, 5, "default")
+
+	// 验证每个有效 action 都在 prompt 中出现
+	for _, action := range validActions {
+		if !strings.Contains(prompt, action) {
+			t.Errorf("Prompt 缺少有效的 action: %s", action)
+		}
+	}
+}
+
+// TestBuildSystemPrompt_ActionListCompleteness 测试 action 列表的完整性
+func TestBuildSystemPrompt_ActionListCompleteness(t *testing.T) {
+	prompt := buildSystemPrompt(1000.0, 10, 5, "default")
+
+	// 检查是否包含关键的缺失 action
+	missingActions := []string{
+		"update_stop_loss",
+		"update_take_profit",
+		"partial_close",
+	}
+
+	for _, action := range missingActions {
+		if !strings.Contains(prompt, action) {
+			t.Errorf("Prompt 缺少关键 action: %s（这会导致 AI 返回无效决策）", action)
+		}
+	}
+}
diff --git a/decision/validate_test.go b/decision/validate_test.go
index faac4fe5..d7e89229 100644
--- a/decision/validate_test.go
+++ b/decision/validate_test.go
@@ -98,3 +98,198 @@ func TestLeverageFallback(t *testing.T) {
 		})
 	}
 }
+
+// TestUpdateStopLossValidation 测试 update_stop_loss 动作的字段验证
+func TestUpdateStopLossValidation(t *testing.T) {
+	tests := []struct {
+		name      string
+		decision  Decision
+		wantError bool
+		errorMsg  string
+	}{
+		{
+			name: "正确使用new_stop_loss字段",
+			decision: Decision{
+				Symbol:      "SOLUSDT",
+				Action:      "update_stop_loss",
+				NewStopLoss: 155.5,
+				Reasoning:   "移动止损至保本位",
+			},
+			wantError: false,
+		},
+		{
+			name: "new_stop_loss为0应该报错",
+			decision: Decision{
+				Symbol:      "SOLUSDT",
+				Action:      "update_stop_loss",
+				NewStopLoss: 0,
+				Reasoning:   "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "新止损价格必须大于0",
+		},
+		{
+			name: "new_stop_loss为负数应该报错",
+			decision: Decision{
+				Symbol:      "SOLUSDT",
+				Action:      "update_stop_loss",
+				NewStopLoss: -100,
+				Reasoning:   "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "新止损价格必须大于0",
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			err := validateDecision(&tt.decision, 1000.0, 10, 5)
+
+			if (err != nil) != tt.wantError {
+				t.Errorf("validateDecision() error = %v, wantError %v", err, tt.wantError)
+				return
+			}
+
+			if tt.wantError && err != nil {
+				if tt.errorMsg != "" && !contains(err.Error(), tt.errorMsg) {
+					t.Errorf("错误信息不匹配: got %q, want to contain %q", err.Error(), tt.errorMsg)
+				}
+			}
+		})
+	}
+}
+
+// TestUpdateTakeProfitValidation 测试 update_take_profit 动作的字段验证
+func TestUpdateTakeProfitValidation(t *testing.T) {
+	tests := []struct {
+		name      string
+		decision  Decision
+		wantError bool
+		errorMsg  string
+	}{
+		{
+			name: "正确使用new_take_profit字段",
+			decision: Decision{
+				Symbol:        "BTCUSDT",
+				Action:        "update_take_profit",
+				NewTakeProfit: 98000,
+				Reasoning:     "调整止盈至关键阻力位",
+			},
+			wantError: false,
+		},
+		{
+			name: "new_take_profit为0应该报错",
+			decision: Decision{
+				Symbol:        "BTCUSDT",
+				Action:        "update_take_profit",
+				NewTakeProfit: 0,
+				Reasoning:     "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "新止盈价格必须大于0",
+		},
+		{
+			name: "new_take_profit为负数应该报错",
+			decision: Decision{
+				Symbol:        "BTCUSDT",
+				Action:        "update_take_profit",
+				NewTakeProfit: -1000,
+				Reasoning:     "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "新止盈价格必须大于0",
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			err := validateDecision(&tt.decision, 1000.0, 10, 5)
+
+			if (err != nil) != tt.wantError {
+				t.Errorf("validateDecision() error = %v, wantError %v", err, tt.wantError)
+				return
+			}
+
+			if tt.wantError && err != nil {
+				if tt.errorMsg != "" && !contains(err.Error(), tt.errorMsg) {
+					t.Errorf("错误信息不匹配: got %q, want to contain %q", err.Error(), tt.errorMsg)
+				}
+			}
+		})
+	}
+}
+
+// TestPartialCloseValidation 测试 partial_close 动作的字段验证
+func TestPartialCloseValidation(t *testing.T) {
+	tests := []struct {
+		name      string
+		decision  Decision
+		wantError bool
+		errorMsg  string
+	}{
+		{
+			name: "正确使用close_percentage字段",
+			decision: Decision{
+				Symbol:          "ETHUSDT",
+				Action:          "partial_close",
+				ClosePercentage: 50.0,
+				Reasoning:       "锁定一半利润",
+			},
+			wantError: false,
+		},
+		{
+			name: "close_percentage为0应该报错",
+			decision: Decision{
+				Symbol:          "ETHUSDT",
+				Action:          "partial_close",
+				ClosePercentage: 0,
+				Reasoning:       "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "平仓百分比必须在0-100之间",
+		},
+		{
+			name: "close_percentage超过100应该报错",
+			decision: Decision{
+				Symbol:          "ETHUSDT",
+				Action:          "partial_close",
+				ClosePercentage: 150,
+				Reasoning:       "测试错误情况",
+			},
+			wantError: true,
+			errorMsg:  "平仓百分比必须在0-100之间",
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			err := validateDecision(&tt.decision, 1000.0, 10, 5)
+
+			if (err != nil) != tt.wantError {
+				t.Errorf("validateDecision() error = %v, wantError %v", err, tt.wantError)
+				return
+			}
+
+			if tt.wantError && err != nil {
+				if tt.errorMsg != "" && !contains(err.Error(), tt.errorMsg) {
+					t.Errorf("错误信息不匹配: got %q, want to contain %q", err.Error(), tt.errorMsg)
+				}
+			}
+		})
+	}
+}
+
+// contains 检查字符串是否包含子串（辅助函数）
+func contains(s, substr string) bool {
+	return len(s) >= len(substr) && (s == substr || len(substr) == 0 ||
+		(len(s) > 0 && len(substr) > 0 && stringContains(s, substr)))
+}
+
+func stringContains(s, substr string) bool {
+	for i := 0; i <= len(s)-len(substr); i++ {
+		if s[i:i+len(substr)] == substr {
+			return true
+		}
+	}
+	return false
+}
diff --git a/docker-compose.yml b/docker-compose.yml
index 38278f12..0fe50998 100644
--- a/docker-compose.yml
+++ b/docker-compose.yml
@@ -25,7 +25,7 @@ services:
     networks:
       - nofx-network
     healthcheck:
-      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
+      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/api/health"]
       interval: 30s
       timeout: 10s
       retries: 3
@@ -45,7 +45,7 @@ services:
     depends_on:
       - nofx
     healthcheck:
-      test: ["CMD", "curl", "-f", "http://127.0.0.1/health"]
+      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1/health"]
       interval: 30s
       timeout: 10s
       retries: 3
diff --git "a/docs/Git\345\267\245\344\275\234\346\265\201\350\247\204\350\214\203.md" "b/docs/Git\345\267\245\344\275\234\346\265\201\350\247\204\350\214\203.md"
new file mode 100644
index 00000000..583f2bfa
--- /dev/null
+++ "b/docs/Git\345\267\245\344\275\234\346\265\201\350\247\204\350\214\203.md"
@@ -0,0 +1,368 @@
+# Git 工作流规范
+
+## 1. 总体目标
+
+建立清晰、统一的 Git 工作流规范，解决团队协作中的冲突和代码丢失问题，同时有效管理开源和闭源两个版本的代码。
+
+## 2. 分支管理策略
+
+### 2.1 开源版本（GitHub Flow）
+
+目前高频更新时期，针对开源版本的 GitHub Flow 工作流：
+
+```
+dev 分支
+  ↓ Developer 新建功能分支
+feat/hotfix 分支
+  ↓ 开发、测试
+  ↓ Pull Request
+  ↓ Review
+dev (合并回dev分支)
+  ↓ 不定期完整测试
+main (合并回main分支)  
+  ↓ 自动发布
+Release Tag
+```
+
+**分支规范：**
+- `main`：唯一稳定分支
+- `dev`：高频更新分支
+- 功能开发分支：开发者自建分支，`feat/功能描述` 格式（从 `dev` 检出）
+- 热修复分支：开发者自建分支，`hotfix/问题描述` 格式（从 `dev` 检出）
+
+**操作流程：**
+1. 从 `dev` 分支创建功能/修复分支
+2. 在功能分支上进行开发
+3. 开发完成后提交 Pull Request
+4. 代码审查通过后合并到 `dev`
+5. 不定期完整测试`dev`稳定后
+6. 合并到`main`，自动触发 CI/CD 流程，发布 Release 并打 Tag
+
+**完整测试频率建议：**
+- 至少每周一次
+- 重要功能发布后
+- 紧急修复后
+
+### 2.2 闭源版本（简化版 Git Flow）
+
+针对闭源版本的 Git Flow 工作流：
+
+```
+test 分支(测试环境)
+  ↓ Developer 新建功能分支
+feat/hotfix 分支
+  ↓ 开发、测试
+  ↓ Pull Request
+  ↓ Review
+  ↓ 测试：测试人员拉取当前开发者的feature/hotfix分支，对feature/hotfix进行测试  
+test-cp (合并进test-cp分支测试)
+  ↓ 完整测试  --> 失败回滚
+test (合并进test分支)
+  ↓ 合并test分支  
+  ↓ 更新test环境    
+main (合并回main分支)  
+  ↓ 自动发布
+Release Tag
+```
+
+
+**分支规范：**
+- `main`：生产环境稳定分支
+- `test`：测试环境分支（从 `main` 检出）- 
+- `test-cp`：测试者的临时测试环境分支（从 `test` 检出）
+- 功能开发分支：开发者自建 `feat/功能描述` 格式（从 `test` 检出）
+- 热修复分支：开发者自建 `hotfix/问题描述` 格式（从 `test` 检出）
+
+**操作流程：**
+
+**开发场景：**
+```
+1. test → 创建 feat/f-support-sql-driver
+2. feat/f-support-sql-driver → 开发完成后PR
+3. 测试人员拉取当前开发者的feature/hotfix分支合并到 test-cp，对test-cp进行测试
+4. PR合并到 test
+5. test测试验证通过 → 提交 PR 合并到 main
+6. main → 完成自动触发 release 打 tag
+```
+
+## 3. 开源与闭源版本管理
+
+### 3.1 仓库分离策略
+
+```
+上游 (开源版本)           下游 (闭源版本)
+[公有仓库]              [私有仓库]
+    |                       |
+    |                       |
+ 开源核心代码 ←←←←←←←←←←←  商业版本完整代码
+    |                       |
+    |                       |
+   社区贡献                 闭源功能
+```
+
+**仓库结构：**
+- 公有仓库：存放开源版本代码，所有人可访问
+- 私有仓库：存放商业版本完整代码（开源核心 + 闭源功能）
+
+### 3.2 代码流向规范
+
+**单向流动原则：**
+- 开源核心的所有改进（新功能、Bug修复）定期从公有仓库合并到私有仓库
+- 私有仓库中的闭源代码不流入公有仓库
+
+### 3.3 实现方式
+
+开源main分支发布后， 团队讨论后决定是否合并到闭源
+
+## 4. 操作步骤详解
+
+### 4.1 开源版本操作步骤
+
+**新建功能开发：**
+```bash
+# 1. 切换到 dev 分支并更新
+git checkout dev
+git pull origin dev
+
+# 2. 创建功能分支
+git checkout -b feat/功能描述
+
+# 3. 开发并提交代码
+git add .
+git commit -m "功能描述"
+
+# 4. 推送分支到远程仓库
+git push origin feat/功能描述
+
+# 5. 在 GitHub 上创建 Pull Request
+# 6. 代码审查通过后合并到dev
+# 7. dev不定期完整测试后，并到main
+```
+
+### 4.2 闭源版本操作步骤
+
+**新建功能开发：**
+```bash
+# 1. 切换到 test 分支并更新
+git checkout test
+git pull origin test
+
+# 2. 创建功能分支
+git checkout -b feat/功能描述
+
+# 3. 开发并提交代码
+git add .
+git commit -m "功能描述"
+
+# 4. 推送分支到远程仓库
+git push origin feat/功能描述
+
+# 5. 在 GitHub 上创建 Pull Request
+# 6. 测试人员拉取当前开发者的feature/hotfix分支并到 test-cp，对test-cp进行测试
+# 7. 测试人员test-cp分支完整测试验证通过
+# 8. 测试通过后PR合并到 test分支，更新测试环境
+# 9. 提交 PR 合并到 main
+# 10. main → 完成自动触发 release 打 tag
+```
+
+## 5. 定期同步开源版本到闭源版本
+
+为了确保闭源版本能够及时获得开源版本的改进，团队需要定期讨论是否将公有仓库的更新同步到私有仓库
+
+**同步频率建议：**
+- 每周一次定期同步
+- 重要功能发布后立即同步
+- 紧急修复后立即同步
+
+## 6. GitHub里程碑自动Release案例
+
+可以使用 GitHub Actions 来实现基于里程碑的自动发布，创建 `.github/workflows/auto-release.yml` 文件：
+
+```yaml
+name: Auto Release on Milestone Completion
+
+on:
+  milestone:
+    types: [closed]
+  workflow_dispatch:
+    inputs:
+      milestone_title:
+        description: 'Milestone title to release'
+        required: true
+
+jobs:
+  release:
+    runs-on: ubuntu-latest
+    steps:
+      - name: Checkout code
+        uses: actions/checkout@v3
+        
+      - name: Get milestone info
+        id: milestone
+        run: |
+          if [ "${{ github.event_name }}" = "milestone" ]; then
+            MILESTONE_TITLE="${{ github.event.milestone.title }}"
+            MILESTONE_DESC="${{ github.event.milestone.description }}"
+          else
+            MILESTONE_TITLE="${{ github.event.inputs.milestone_title }}"
+            MILESTONE_DESC=""
+          fi
+          
+          echo "milestone_title=$MILESTONE_TITLE" >> $GITHUB_OUTPUT
+          echo "milestone_description=$MILESTONE_DESC" >> $GITHUB_OUTPUT
+          
+      - name: Create release tag
+        run: |
+          git config --global user.name 'github-actions[bot]'
+          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
+          git tag -a "v${{ steps.milestone.outputs.milestone_title }}" -m "${{ steps.milestone.outputs.milestone_description }}"
+          git push origin "v${{ steps.milestone.outputs.milestone_title }}"
+          
+      - name: Create GitHub Release
+        uses: actions/create-release@v1
+        env:
+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
+        with:
+          tag_name: "v${{ steps.milestone.outputs.milestone_title }}"
+          release_name: "Release ${{ steps.milestone.outputs.milestone_title }}"
+          body: |
+            ## Release Notes
+            ${{ steps.milestone.outputs.milestone_description }}
+            
+            ### Features
+            - Feature 1
+            - Feature 2
+            
+            ### Bug Fixes
+            - Bug fix 1
+            - Bug fix 2
+            
+          draft: false
+          prerelease: false
+```
+
+**使用说明：**
+1. 当里程碑完成并关闭时，自动触发发布流程
+2. 根据里程碑标题创建版本标签（如 v1.0.0）
+3. 自动生成 GitHub Release 页面
+4. 支持手动触发特定里程碑的发布
+
+## 7. 冲突解决策略?
+
+在将功能分支合并到 「test」/ 「dev」 分支时，可能会遇到代码冲突。为了解决这个问题并保持功能分支的独立性，推荐使用临时分支处理方式：
+
+```bash
+# 1. 创建临时分支用于解决冲突
+git checkout -b test-tmp origin/test
+
+# 2. 将功能分支合并到临时分支
+git merge feat/功能分支名称
+
+# 3. 解决冲突并提交
+#    在编辑器中解决冲突文件
+git add .
+git commit -m "解决合并冲突"
+
+# 4. 推送临时分支到远程仓库
+git push origin test-tmp
+
+# 5. 创建从 test-tmp 到 test 的 Pull Request
+# 6. 代码审查通过后合并到 test 分支
+
+# 7. 清理临时分支
+git checkout test
+git pull origin test
+git branch -d test-tmp
+git push origin --delete test-tmp
+```
+
+这种方式的优点：
+- 保持功能分支的独立性，不会被 「test」 分支污染 「test」 分支可能包含其他正在测试的功能特性，避免相互影响
+- 冲突解决过程在临时分支中进行，更加安全
+
+## 8. 当前策略可能存在的问题
+* 需要建立完整测试流程与feature/hotfix测试流程
+* 需要专业测试人员，或者培训现有开发做测试
+* 开源版本：dev完整测试的频率是否合适
+* 同步开源版本到闭源版本的频率是否合适
+
+## 9. 分支模型合并流转图
+
+角色说明
+- [开] 开发者（Developer）
+- [评] 评审者（Reviewer）
+- [维] 维护者（Maintainer）: 暂由Tester兼任
+- [测] 测试人员或测试责任（可由 Maintainer/CI/QA 共同承担）
+- [CI] CI/CD 系统（自动化构建/测试/发布）
+
+### 9.1 开源版本分支模型
+```text
+Feature/Hotfix 分支 ───● 从Dev检出创建分支[开]──────────● 开发&自测[开]──────────● 提交PR→dev[开]                               
+                                                                   
+                                                                                             
+Dev 分支                 ● 接收PR/Review[评]───● 合并到 dev[评]───● dev 不定期完整测试[测/CI][通过?]───● 发起 PR：dev→main[维]
+                                                                  
+                                                                   
+Main 分支            ───● Review[评]───────────● 合并到 main[维]───────────● Release + Tag[CI]────────▶
+```
+
+### 9.2 闭源版本分支模型
+```
+Feature/Hotfix 分支 ───● 从Test检出创建分支[开]───────────● 开发&自测[开]──────────● 提交PR→test[开]      ● 修复并更新PR[开]────▶
+                                                                                                   ╱
+                                                                                                  ╱  测试失败回路：test 未通过 → 返回修复并更新 PR）
+Test 分支         ● 接收PR/Review[评]───● 合并到test-cp[维]───● 构建环境[CI]───● 回归测试[测][通过?]───● 合并进test，发起PR：test→main[维]
+                                                                                       
+                                                                                     
+Main 分支         ● Review[评]──────────● 合并到 main[维]──────────● Release + Tag[CI]────────▶
+
+```
+说明
+- 失败回路：若 test-cp 分支的完整测试未通过，返回到 Feature/Hotfix 的“修复并更新PR”，开发者继续提交修复，PR 自动更新，再次进入 Review→合并→测试流程。
+
+
+### 9.3 跨仓库代码流转图
+
+```
+┌─────────────────────────────────────────────────────────────┐
+│                    跨仓库代码流转模型                        │
+└─────────────────────────────────────────────────────────────┘
+
+[公有仓库 - 开源版本]               [私有仓库 - 闭源版本]
+       │                                 │
+       ▼                                 ▼
+    新功能开发                        商业功能开发
+       │                                 │
+       ▼                                 ▼
+    代码审查                         闭源功能集成
+       │                                 │
+       ▼                                 │
+    合并到main                            │
+       │                                 │
+       ▼                                 ▼
+    发布Release                   定期同步开源更新
+       │                                 │
+       └─────────────────────────────────┘
+                   │
+                   ▼
+              版本兼容性测试
+
+```
+
+## 10. 最佳实践
+
+1. **提交信息规范：**
+   - 使用清晰、简洁的提交信息
+   - 遵循约定式提交格式：`<type>(<scope>): <subject>`
+
+2. **分支命名规范：**
+   - 功能分支：`feat/功能简述`
+   - 热修复分支：`hotfix/问题简述`
+   - 使用英文小写字母，单词间用连字符分隔
+
+3. **代码审查：**
+   - 所有合并到主分支的代码必须经过代码审查
+   - 审查人员应关注代码质量、功能正确性和安全性
+
+4. **定期同步：**
+   - 定期将开源版本的改进同步到闭源版本
\ No newline at end of file
diff --git a/docs/MIGRATION_GUIDE.md b/docs/MIGRATION_GUIDE.md
index 1f4dad42..46bf6b48 100644
--- a/docs/MIGRATION_GUIDE.md
+++ b/docs/MIGRATION_GUIDE.md
@@ -9,7 +9,6 @@ NOFX documentation has been reorganized into a structured `docs/` directory for
 ### Deployment Guides
 - `DOCKER_DEPLOY.en.md` → `docs/getting-started/docker-deploy.en.md`
 - `DOCKER_DEPLOY.md` → `docs/getting-started/docker-deploy.zh-CN.md`
-- `PM2_DEPLOYMENT.md` → `docs/getting-started/pm2-deploy.md`
 - `CUSTOM_API.md` → `docs/getting-started/custom-api.md`
 
 ### Community Docs
@@ -42,7 +41,6 @@ nofx/
 ├── README.uk.md
 ├── DOCKER_DEPLOY.md
 ├── DOCKER_DEPLOY.en.md
-├── PM2_DEPLOYMENT.md
 ├── CUSTOM_API.md
 ├── HOW_TO_POST_BOUNTY.md
 ├── INTEGRATION_BOUNTY_HYPERLIQUID.md
@@ -101,7 +99,6 @@ Files GitHub needs to see:
 
 1. **`getting-started/`** - Deployment and setup
    - Docker deployment (EN/中文)
-   - PM2 deployment
    - Custom API configuration
 
 2. **`guides/`** - Usage guides and tutorials
diff --git a/docs/README.md b/docs/README.md
index 72ea76b2..10fbe917 100644
--- a/docs/README.md
+++ b/docs/README.md
@@ -17,15 +17,12 @@ Welcome to the NOFX documentation! This page helps you find the right documentat
 | [Getting Started Index (中文)](getting-started/README.zh-CN.md) | 所有部署选项 | All deployment options |
 | [Docker Deployment (EN)](getting-started/docker-deploy.en.md) | Deploy with Docker (recommended) | Docker 部署（推荐） |
 | [Docker Deployment (中文)](getting-started/docker-deploy.zh-CN.md) | Docker 部署指南（中文） | Docker deployment guide |
-| [PM2 Deployment (EN)](getting-started/pm2-deploy.en.md) | Deploy with PM2 process manager | PM2 进程管理器部署 |
-| [PM2 Deployment (中文)](getting-started/pm2-deploy.md) | PM2 部署指南（中文） | PM2 deployment guide |
 | [Custom API (EN)](getting-started/custom-api.en.md) | Connect custom AI API providers | 连接自定义 AI API |
 | [Custom API (中文)](getting-started/custom-api.md) | 连接自定义 AI API 提供商 | Custom AI provider guide |
 
 **Quick Links:**
 - 📖 See all options → [Getting Started](getting-started/README.md) / [快速开始](getting-started/README.zh-CN.md)
 - 🐳 Want easiest setup? → [Docker (EN)](getting-started/docker-deploy.en.md) / [Docker (中文)](getting-started/docker-deploy.zh-CN.md)
-- 🔧 Advanced user? → [PM2 (EN)](getting-started/pm2-deploy.en.md) / [PM2 (中文)](getting-started/pm2-deploy.md)
 - 🤖 Custom AI model? → [Custom API (EN)](getting-started/custom-api.en.md) / [自定义 API](getting-started/custom-api.md)
 
 ---
diff --git a/docs/architecture/README.md b/docs/architecture/README.md
index fb233a31..e5147770 100644
--- a/docs/architecture/README.md
+++ b/docs/architecture/README.md
@@ -93,7 +93,7 @@ nofx/
 | `github.com/gin-gonic/gin` | HTTP API framework | v1.9+ |
 | `github.com/adshao/go-binance/v2` | Binance API client | v2.4+ |
 | `github.com/markcheno/go-talib` | Technical indicators (TA-Lib) | Latest |
-| `github.com/mattn/go-sqlite3` | SQLite database driver | v1.14+ |
+| `github.com/lib/pq` | PostgreSQL database driver | v1.10+ |
 | `github.com/golang-jwt/jwt/v5` | JWT authentication | v5.0+ |
 | `github.com/pquerna/otp` | 2FA/TOTP support | v1.4+ |
 | `golang.org/x/crypto` | Password hashing (bcrypt) | Latest |
diff --git a/docs/architecture/README.zh-CN.md b/docs/architecture/README.zh-CN.md
index 4acc0f90..0ce428fc 100644
--- a/docs/architecture/README.zh-CN.md
+++ b/docs/architecture/README.zh-CN.md
@@ -93,7 +93,7 @@ nofx/
 | `github.com/gin-gonic/gin` | HTTP API 框架 | v1.9+ |
 | `github.com/adshao/go-binance/v2` | Binance API 客户端 | v2.4+ |
 | `github.com/markcheno/go-talib` | 技术指标（TA-Lib） | 最新 |
-| `github.com/mattn/go-sqlite3` | SQLite 数据库驱动 | v1.14+ |
+| `github.com/lib/pq` | PostgreSQL 数据库驱动 | v1.10+ |
 | `github.com/golang-jwt/jwt/v5` | JWT 认证 | v5.0+ |
 | `github.com/pquerna/otp` | 2FA/TOTP 支持 | v1.4+ |
 | `golang.org/x/crypto` | 密码哈希（bcrypt） | 最新 |
@@ -282,7 +282,6 @@ GET  /api/decisions/latest  # 最近决策
 - 基于 JWT token 的认证
 - 使用 TOTP 的 2FA（Google Authenticator）
 - Bcrypt 密码哈希
-- 管理员模式（简化的单用户模式）
 
 ---
 
diff --git a/docs/community/README.md b/docs/community/README.md
index 8241c721..43de34af 100644
--- a/docs/community/README.md
+++ b/docs/community/README.md
@@ -145,7 +145,7 @@ NOFX offers bounties for valuable contributions:
 ### Core Team
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
+- **Tintin** - [@Tintinx2021](https://x.com/Tintinx2021)
 
 **Contact:**
 - Technical questions → Telegram or GitHub Issues
diff --git a/docs/getting-started/README.md b/docs/getting-started/README.md
index 41339cd7..70156f2d 100644
--- a/docs/getting-started/README.md
+++ b/docs/getting-started/README.md
@@ -24,32 +24,11 @@ Choose the method that best fits your needs:
 **Quick Start:**
 ```bash
 cp config.json.example config.json
-./start.sh start --build
+./scripts/start.sh start --build
 ```
 
 ---
 
-### 🔧 PM2 Deployment
-
-**Best for:** Advanced users, development, custom setups
-
-- **English:** [pm2-deploy.en.md](pm2-deploy.en.md)
-- **中文:** [pm2-deploy.md](pm2-deploy.md)
-
-**Pros:**
-- ✅ Direct process control
-- ✅ Better for development
-- ✅ Lower resource usage
-- ✅ More flexible
-
-**Quick Start:**
-```bash
-go build -o nofx
-cd web && npm install && npm run build
-pm2 start ecosystem.config.js
-```
-
----
 
 ## 🤖 AI Configuration
 
@@ -77,7 +56,6 @@ Before starting, ensure you have:
 - ✅ Go 1.21+
 - ✅ Node.js 18+
 - ✅ TA-Lib library
-- ✅ PM2 (optional)
 
 ---
 
diff --git a/docs/getting-started/README.zh-CN.md b/docs/getting-started/README.zh-CN.md
index 836619f6..2e333e5c 100644
--- a/docs/getting-started/README.zh-CN.md
+++ b/docs/getting-started/README.zh-CN.md
@@ -22,32 +22,11 @@
 **快速开始：**
 ```bash
 cp config.json.example config.json
-./start.sh start --build
+./scripts/start.sh start --build
 ```
 
 ---
 
-### 🔧 PM2 部署
-
-**适合：** 进阶用户、开发环境、自定义设置
-
-- **中文文档：** [pm2-deploy.md](pm2-deploy.md)
-- **English:** [pm2-deploy.en.md](pm2-deploy.en.md)
-
-**优势：**
-- ✅ 直接进程控制
-- ✅ 更适合开发
-- ✅ 资源占用更低
-- ✅ 更灵活
-
-**快速开始：**
-```bash
-go build -o nofx
-cd web && npm install && npm run build
-pm2 start ecosystem.config.js
-```
-
----
 
 ## 🤖 AI 配置
 
@@ -75,7 +54,6 @@ pm2 start ecosystem.config.js
 - ✅ Go 1.21+
 - ✅ Node.js 18+
 - ✅ TA-Lib 库
-- ✅ PM2（可选）
 
 ---
 
diff --git a/docs/getting-started/pm2-deploy.en.md b/docs/getting-started/pm2-deploy.en.md
deleted file mode 100644
index 428bef88..00000000
--- a/docs/getting-started/pm2-deploy.en.md
+++ /dev/null
@@ -1,303 +0,0 @@
-# NoFX Trading Bot - PM2 Deployment Guide
-
-Complete guide for local development and production deployment using PM2.
-
-## 🚀 Quick Start
-
-### 1. Install PM2
-
-```bash
-npm install -g pm2
-```
-
-### 2. One-Command Launch
-
-```bash
-./pm2.sh start
-```
-
-That's it! Frontend and backend will start automatically.
-
----
-
-## 📋 All Commands
-
-### Service Management
-
-```bash
-# Start services
-./pm2.sh start
-
-# Stop services
-./pm2.sh stop
-
-# Restart services
-./pm2.sh restart
-
-# View status
-./pm2.sh status
-
-# Delete services
-./pm2.sh delete
-```
-
-### Log Viewing
-
-```bash
-# View all logs (live)
-./pm2.sh logs
-
-# Backend logs only
-./pm2.sh logs backend
-
-# Frontend logs only
-./pm2.sh logs frontend
-```
-
-### Build & Compile
-
-```bash
-# Compile backend
-./pm2.sh build
-
-# Recompile backend and restart
-./pm2.sh rebuild
-```
-
-### Monitoring
-
-```bash
-# Open PM2 monitoring dashboard (real-time CPU/Memory)
-./pm2.sh monitor
-```
-
----
-
-## 📊 Access URLs
-
-After successful startup:
-
-- **Frontend Web Interface**: http://localhost:3000
-- **Backend API**: http://localhost:8080
-- **Health Check**: http://localhost:8080/api/health
-
----
-
-## 🔧 Configuration Files
-
-### pm2.config.js
-
-PM2 configuration file, defines frontend and backend startup parameters:
-
-```javascript
-const path = require('path');
-
-module.exports = {
-  apps: [
-    {
-      name: 'nofx-backend',
-      script: './nofx',           // Go binary
-      cwd: __dirname,             // Dynamically get current directory
-      autorestart: true,
-      max_memory_restart: '500M'
-    },
-    {
-      name: 'nofx-frontend',
-      script: 'npm',
-      args: 'run dev',            // Vite dev server
-      cwd: path.join(__dirname, 'web'), // Dynamically join path
-      autorestart: true,
-      max_memory_restart: '300M'
-    }
-  ]
-};
-```
-
-**After modifying configuration, restart is required:**
-```bash
-./pm2.sh restart
-```
-
----
-
-## 📝 Log File Locations
-
-- **Backend Logs**: `./logs/backend-error.log` and `./logs/backend-out.log`
-- **Frontend Logs**: `./web/logs/frontend-error.log` and `./web/logs/frontend-out.log`
-
----
-
-## 🔄 Startup on Boot
-
-Set PM2 to start on boot:
-
-```bash
-# 1. Start services
-./pm2.sh start
-
-# 2. Save current process list
-pm2 save
-
-# 3. Generate startup script
-pm2 startup
-
-# 4. Follow the instructions to execute command (requires sudo)
-```
-
-**Disable startup on boot:**
-```bash
-pm2 unstartup
-```
-
----
-
-## 🛠️ Common Operations
-
-### Restart After Code Changes
-
-**Backend changes:**
-```bash
-./pm2.sh rebuild  # Auto compile and restart
-```
-
-**Frontend changes:**
-```bash
-./pm2.sh restart  # Vite will auto hot-reload, no restart needed
-```
-
-### View Real-time Resource Usage
-
-```bash
-./pm2.sh monitor
-```
-
-### View Detailed Information
-
-```bash
-pm2 info nofx-backend   # Backend details
-pm2 info nofx-frontend  # Frontend details
-```
-
-### Clear Logs
-
-```bash
-pm2 flush
-```
-
----
-
-## 🐛 Troubleshooting
-
-### Service Startup Failed
-
-```bash
-# 1. View detailed errors
-./pm2.sh logs
-
-# 2. Check port usage
-lsof -i :8080  # Backend port
-lsof -i :3000  # Frontend port
-
-# 3. Manual compile test
-go build -o nofx
-./nofx
-```
-
-### Backend Won't Start
-
-```bash
-# ~~Check if config.json exists~~
-# ~~ls -l config.json~~
-
-# Check if database file exists
-ls -l trading.db
-
-# Check permissions
-chmod +x nofx
-
-# Run manually to see errors
-./nofx
-```
-
-### Frontend Not Accessible
-
-```bash
-# Check node_modules
-cd web && npm install
-
-# Manual start test
-npm run dev
-```
-
----
-
-## 🎯 Production Environment Recommendations
-
-### 1. Use Production Mode
-
-Modify `pm2.config.js`:
-
-```javascript
-{
-  name: 'nofx-frontend',
-  script: 'npm',
-  args: 'run preview',  // Change to preview (requires npm run build first)
-  env: {
-    NODE_ENV: 'production'
-  }
-}
-```
-
-### 2. Increase Instances (Load Balancing)
-
-```javascript
-{
-  name: 'nofx-backend',
-  script: './nofx',
-  instances: 2,  // Start 2 instances
-  exec_mode: 'cluster'
-}
-```
-
-### 3. Auto Restart Strategy
-
-```javascript
-{
-  autorestart: true,
-  max_restarts: 10,
-  min_uptime: '10s',
-  max_memory_restart: '500M'
-}
-```
-
----
-
-## 📦 Comparison with Docker Deployment
-
-| Feature | PM2 Deployment | Docker Deployment |
-|---------|---------------|-------------------|
-| Startup Speed | ⚡ Fast | 🐌 Slower |
-| Resource Usage | 💚 Low | 🟡 Medium |
-| Isolation | 🟡 Medium | 💚 High |
-| Use Case | Dev/Single-machine | Production/Cluster |
-| Configuration Complexity | 💚 Simple | 🟡 Medium |
-
-**Recommendations:**
-- **Development Environment**: Use `./pm2.sh`
-- **Production Environment**: Use `./start.sh` (Docker)
-
----
-
-## 🆘 Getting Help
-
-```bash
-./pm2.sh help
-```
-
-Or check PM2 official documentation: https://pm2.keymetrics.io/
-
----
-
-## 📄 License
-
-MIT
diff --git a/docs/getting-started/pm2-deploy.md b/docs/getting-started/pm2-deploy.md
deleted file mode 100644
index 3668a29e..00000000
--- a/docs/getting-started/pm2-deploy.md
+++ /dev/null
@@ -1,303 +0,0 @@
-# NoFX Trading Bot - PM2 部署指南
-
-使用 PM2 进行本地开发和生产部署的完整指南。
-
-## 🚀 快速开始
-
-### 1. 安装 PM2
-
-```bash
-npm install -g pm2
-```
-
-### 2. 一键启动
-
-```bash
-./pm2.sh start
-```
-
-就这么简单！前后端将自动启动。
-
----
-
-## 📋 所有命令
-
-### 服务管理
-
-```bash
-# 启动服务
-./pm2.sh start
-
-# 停止服务
-./pm2.sh stop
-
-# 重启服务
-./pm2.sh restart
-
-# 查看状态
-./pm2.sh status
-
-# 删除服务
-./pm2.sh delete
-```
-
-### 日志查看
-
-```bash
-# 查看所有日志（实时）
-./pm2.sh logs
-
-# 只看后端日志
-./pm2.sh logs backend
-
-# 只看前端日志
-./pm2.sh logs frontend
-```
-
-### 构建与编译
-
-```bash
-# 编译后端
-./pm2.sh build
-
-# 重新编译后端并重启
-./pm2.sh rebuild
-```
-
-### 监控
-
-```bash
-# 打开 PM2 监控面板（实时CPU/内存）
-./pm2.sh monitor
-```
-
----
-
-## 📊 访问地址
-
-启动成功后：
-
-- **前端 Web 界面**: http://localhost:3000
-- **后端 API**: http://localhost:8080
-- **健康检查**: http://localhost:8080/api/health
-
----
-
-## 🔧 配置文件
-
-### pm2.config.js
-
-PM2 配置文件，定义了前后端的启动参数：
-
-```javascript
-const path = require('path');
-
-module.exports = {
-  apps: [
-    {
-      name: 'nofx-backend',
-      script: './nofx',           // Go 二进制文件
-      cwd: __dirname,             // 动态获取当前目录
-      autorestart: true,
-      max_memory_restart: '500M'
-    },
-    {
-      name: 'nofx-frontend',
-      script: 'npm',
-      args: 'run dev',            // Vite 开发服务器
-      cwd: path.join(__dirname, 'web'), // 动态拼接路径
-      autorestart: true,
-      max_memory_restart: '300M'
-    }
-  ]
-};
-```
-
-**修改配置后需要重启：**
-```bash
-./pm2.sh restart
-```
-
----
-
-## 📝 日志文件位置
-
-- **后端日志**: `./logs/backend-error.log` 和 `./logs/backend-out.log`
-- **前端日志**: `./web/logs/frontend-error.log` 和 `./web/logs/frontend-out.log`
-
----
-
-## 🔄 开机自启动
-
-设置 PM2 开机自启动：
-
-```bash
-# 1. 启动服务
-./pm2.sh start
-
-# 2. 保存当前进程列表
-pm2 save
-
-# 3. 生成启动脚本
-pm2 startup
-
-# 4. 按照提示执行命令（需要 sudo）
-```
-
-**取消开机自启动：**
-```bash
-pm2 unstartup
-```
-
----
-
-## 🛠️ 常见操作
-
-### 修改代码后重启
-
-**后端修改：**
-```bash
-./pm2.sh rebuild  # 自动编译并重启
-```
-
-**前端修改：**
-```bash
-./pm2.sh restart  # Vite 会自动热重载，无需重启
-```
-
-### 查看实时资源占用
-
-```bash
-./pm2.sh monitor
-```
-
-### 查看详细信息
-
-```bash
-pm2 info nofx-backend   # 后端详情
-pm2 info nofx-frontend  # 前端详情
-```
-
-### 清空日志
-
-```bash
-pm2 flush
-```
-
----
-
-## 🐛 故障排查
-
-### 服务启动失败
-
-```bash
-# 1. 查看详细错误
-./pm2.sh logs
-
-# 2. 检查端口占用
-lsof -i :8080  # 后端端口
-lsof -i :3000  # 前端端口
-
-# 3. 手动编译测试
-go build -o nofx
-./nofx
-```
-
-### 后端无法启动
-
-```bash
-# ~~检查 config.json 是否存在~~
-# ~~ls -l config.json~~
-
-# 检查数据库文件是否存在
-ls -l trading.db
-
-# 检查权限
-chmod +x nofx
-
-# 手动运行看报错
-./nofx
-```
-
-### 前端无法访问
-
-```bash
-# 检查 node_modules
-cd web && npm install
-
-# 手动启动测试
-npm run dev
-```
-
----
-
-## 🎯 生产环境建议
-
-### 1. 使用生产模式
-
-修改 `pm2.config.js`：
-
-```javascript
-{
-  name: 'nofx-frontend',
-  script: 'npm',
-  args: 'run preview',  // 改为 preview（需先 npm run build）
-  env: {
-    NODE_ENV: 'production'
-  }
-}
-```
-
-### 2. 增加实例数（负载均衡）
-
-```javascript
-{
-  name: 'nofx-backend',
-  script: './nofx',
-  instances: 2,  // 启动 2 个实例
-  exec_mode: 'cluster'
-}
-```
-
-### 3. 自动重启策略
-
-```javascript
-{
-  autorestart: true,
-  max_restarts: 10,
-  min_uptime: '10s',
-  max_memory_restart: '500M'
-}
-```
-
----
-
-## 📦 与 Docker 部署的对比
-
-| 特性 | PM2 部署 | Docker 部署 |
-|------|---------|------------|
-| 启动速度 | ⚡ 快 | 🐌 较慢 |
-| 资源占用 | 💚 低 | 🟡 中等 |
-| 隔离性 | 🟡 中等 | 💚 高 |
-| 适用场景 | 开发/单机 | 生产/集群 |
-| 配置复杂度 | 💚 简单 | 🟡 中等 |
-
-**建议：**
-- **开发环境**: 使用 `./pm2.sh`
-- **生产环境**: 使用 `./start.sh` (Docker)
-
----
-
-## 🆘 获取帮助
-
-```bash
-./pm2.sh help
-```
-
-或查看 PM2 官方文档：https://pm2.keymetrics.io/
-
----
-
-## 📄 License
-
-MIT
diff --git a/docs/guides/TROUBLESHOOTING.md b/docs/guides/TROUBLESHOOTING.md
index e2ccf179..0094ca6a 100644
--- a/docs/guides/TROUBLESHOOTING.md
+++ b/docs/guides/TROUBLESHOOTING.md
@@ -403,20 +403,22 @@ docker compose up -d
 #### ❌ Trader Configuration Not Saving
 
 **Check:**
-1. **Permissions:**
+1. **PostgreSQL container health**
    ```bash
-   ls -l config.db trading.db
-   # Should be writable by current user
+   docker compose ps postgres
+   docker compose exec postgres pg_isready -U nofx -d nofx
    ```
 
-2. **Disk Space:**
+2. **Inspect data directly**
    ```bash
-   df -h  # Ensure disk not full
+   ./scripts/view_pg_data.sh                        # quick overview
+   docker compose exec postgres \
+     psql -U nofx -d nofx -c "SELECT COUNT(*) FROM traders;"
    ```
 
-3. **Database Integrity:**
+3. **Disk space**
    ```bash
-   sqlite3 config.db "PRAGMA integrity_check;"
+   df -h  # Ensure disk not full
    ```
 
 ---
@@ -437,15 +439,9 @@ docker compose logs -f backend
 docker compose logs backend --tail=500 > backend_logs.txt
 ```
 
-**Manual/PM2:**
+**Manual binary:**
 ```bash
-# Terminal where you ran ./nofx shows logs
-
-# PM2:
-pm2 logs nofx --lines 100
-
-# Save to file
-pm2 logs nofx --lines 500 > backend_logs.txt
+# If running without Docker, the terminal running ./nofx prints logs
 ```
 
 ---
@@ -532,13 +528,16 @@ docker compose restart frontend
 
 ```bash
 # Check traders in database
-sqlite3 config.db "SELECT id, name, ai_model_id, exchange_id, is_running FROM traders;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT id, name, ai_model_id, exchange_id, is_running FROM traders;"
 
 # Check AI models
-sqlite3 config.db "SELECT id, name, model_type, enabled FROM ai_models;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT id, name, provider, enabled FROM ai_models;"
 
 # Check system config
-sqlite3 config.db "SELECT key, value FROM system_config;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT key, value FROM system_config;"
 ```
 
 ---
@@ -572,12 +571,12 @@ If you've tried all the above and still have problems:
 # Stop everything
 docker compose down
 
-# Backup databases (just in case)
-cp config.db config.db.backup
-cp trading.db trading.db.backup
+# Optional: back up PostgreSQL data
+docker compose exec postgres \
+  pg_dump -U nofx -d nofx > backup_nofx.sql
 
-# Remove databases (fresh start)
-rm config.db trading.db
+# Remove all persisted volumes (fresh start)
+docker compose down -v
 
 # Restart
 docker compose up -d --build
diff --git a/docs/guides/TROUBLESHOOTING.zh-CN.md b/docs/guides/TROUBLESHOOTING.zh-CN.md
index b070c8a0..ca140d96 100644
--- a/docs/guides/TROUBLESHOOTING.zh-CN.md
+++ b/docs/guides/TROUBLESHOOTING.zh-CN.md
@@ -403,20 +403,22 @@ docker compose up -d
 #### ❌ 交易员配置无法保存
 
 **检查:**
-1. **权限:**
+1. **PostgreSQL 容器状态**
    ```bash
-   ls -l config.db trading.db
-   # 应该对当前用户可写
+   docker compose ps postgres
+   docker compose exec postgres pg_isready -U nofx -d nofx
    ```
 
-2. **磁盘空间:**
+2. **直接检查数据库数据**
    ```bash
-   df -h  # 确保磁盘未满
+   ./scripts/view_pg_data.sh                        # 快速总览
+   docker compose exec postgres \
+     psql -U nofx -d nofx -c "SELECT COUNT(*) FROM traders;"
    ```
 
-3. **数据库完整性:**
+3. **磁盘空间**
    ```bash
-   sqlite3 config.db "PRAGMA integrity_check;"
+   df -h  # 确保磁盘未满
    ```
 
 ---
@@ -437,15 +439,9 @@ docker compose logs -f backend
 docker compose logs backend --tail=500 > backend_logs.txt
 ```
 
-**手动/PM2:**
+**手动运行:**
 ```bash
-# 运行 ./nofx 的终端会显示日志
-
-# PM2:
-pm2 logs nofx --lines 100
-
-# 保存到文件
-pm2 logs nofx --lines 500 > backend_logs.txt
+# 如果不是通过 Docker，而是手动运行 ./nofx，可直接在终端查看日志
 ```
 
 ---
@@ -532,13 +528,16 @@ docker compose restart frontend
 
 ```bash
 # 检查数据库中的交易员
-sqlite3 config.db "SELECT id, name, ai_model_id, exchange_id, is_running FROM traders;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT id, name, ai_model_id, exchange_id, is_running FROM traders;"
 
 # 检查 AI 模型
-sqlite3 config.db "SELECT id, name, model_type, enabled FROM ai_models;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT id, name, provider, enabled FROM ai_models;"
 
 # 检查系统配置
-sqlite3 config.db "SELECT key, value FROM system_config;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT key, value FROM system_config;"
 ```
 
 ---
@@ -572,12 +571,12 @@ sqlite3 config.db "SELECT key, value FROM system_config;"
 # 停止所有服务
 docker compose down
 
-# 备份数据库（以防万一）
-cp config.db config.db.backup
-cp trading.db trading.db.backup
+# 可选：备份 PostgreSQL 数据
+docker compose exec postgres \
+  pg_dump -U nofx -d nofx > backup_nofx.sql
 
-# 删除数据库（全新开始）
-rm config.db trading.db
+# 删除所有持久化卷（全新开始）
+docker compose down -v
 
 # 重启
 docker compose up -d --build
diff --git a/docs/guides/faq.en.md b/docs/guides/faq.en.md
index abe3dd5c..644de323 100644
--- a/docs/guides/faq.en.md
+++ b/docs/guides/faq.en.md
@@ -152,18 +152,17 @@ Yes, to some extent. NOFX provides historical performance feedback in each decis
 ## Data & Privacy
 
 ### Where is my data stored?
-All data is stored **locally** on your machine in SQLite databases:
-- `config.db` - Trader configurations
-- `trading.db` - Trade history
+All data is stored **locally** in PostgreSQL (Docker volume `postgres_data`) plus:
 - `decision_logs/` - AI decision records
 
 ### Is my API key secure?
 API keys are stored in local databases. Never share your databases or `.env` files. We recommend using API keys with IP whitelist restrictions.
 
 ### Can I export my trading history?
-Yes! Trading data is in SQLite format. You can query it directly:
+Yes! Use `pg_dump` or `psql` to export data:
 ```bash
-sqlite3 trading.db "SELECT * FROM trades;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT * FROM trades;"
 ```
 
 ---
diff --git a/docs/guides/faq.zh-CN.md b/docs/guides/faq.zh-CN.md
index 2c74ca89..b33a4282 100644
--- a/docs/guides/faq.zh-CN.md
+++ b/docs/guides/faq.zh-CN.md
@@ -152,18 +152,17 @@ docker compose up -d
 ## 数据与隐私
 
 ### 我的数据存储在哪里？
-所有数据都**本地存储**在您的机器上，使用 SQLite 数据库：
-- `config.db` - 交易员配置
-- `trading.db` - 交易历史
+所有数据都**本地存储**在 PostgreSQL（Docker 卷 `postgres_data`）中，另有：
 - `decision_logs/` - AI 决策记录
 
 ### API 密钥安全吗？
 API 密钥存储在本地数据库中。永远不要分享您的数据库或 `.env` 文件。我们建议使用带 IP 白名单限制的 API 密钥。
 
 ### 可以导出交易历史吗？
-可以！交易数据是 SQLite 格式。您可以直接查询：
+可以！使用 `pg_dump` 或 `psql` 导出数据：
 ```bash
-sqlite3 trading.db "SELECT * FROM trades;"
+docker compose exec postgres \
+  psql -U nofx -d nofx -c "SELECT * FROM trades;"
 ```
 
 ---
diff --git a/docs/i18n/ja/README.md b/docs/i18n/ja/README.md
index 48455f11..eca32114 100644
--- a/docs/i18n/ja/README.md
+++ b/docs/i18n/ja/README.md
@@ -8,8 +8,6 @@
 
 **言語:** [English](../../../README.md) | [中文](../zh-CN/README.md) | [Українська](../uk/README.md) | [Русский](../ru/README.md) | [日本語](README.md)
 
-**公式Twitter:** [@nofx_ai](https://x.com/nofx_ai)
-
 ---
 
 ## 📑 目次
@@ -55,15 +53,12 @@
 ### 👥 コアチーム
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
 
 ### 💼 シードラウンド募集中
 
 現在、**シードラウンド**の資金調達を行っています。
 
-**投資に関するお問い合わせ**は、TwitterでTinkleまたはZackにDMをお送りください。
-
-**パートナーシップおよび協業**については、公式Twitter [@nofx_ai](https://x.com/nofx_ai)にDMをお送りください。
+**投資に関するお問い合わせ**は、TwitterでTinkleにDMをお送りください。
 
 ---
 
@@ -350,9 +345,9 @@ docker compose up -d --build
 ```
 
 **📖 詳細なDockerデプロイガイド、トラブルシューティング、高度な設定について：**
-- **English**: See [DOCKER_DEPLOY.en.md](DOCKER_DEPLOY.en.md)
-- **中文**: 查看 [DOCKER_DEPLOY.md](DOCKER_DEPLOY.md)
-- **日本語**: [DOCKER_DEPLOY.ja.md](DOCKER_DEPLOY.ja.md)を参照
+- **English**: See [docker-deploy.md](../../getting-started/docker-deploy.en.md)
+- **中文**: 查看 [docker-deploy.zh-CN.md](../../getting-started/docker-deploy.zh-CN.md)
+- **日本語**: [docker-deploy.md](docker-deploy.md)を参照
 
 ---
 
diff --git a/DOCKER_DEPLOY.ja.md b/docs/i18n/ja/docker-deploy.md
similarity index 100%
rename from DOCKER_DEPLOY.ja.md
rename to docs/i18n/ja/docker-deploy.md
diff --git a/docs/i18n/ru/README.md b/docs/i18n/ru/README.md
index eaa9bb9c..33d0ce11 100644
--- a/docs/i18n/ru/README.md
+++ b/docs/i18n/ru/README.md
@@ -8,8 +8,6 @@
 
 **Языки / Languages:** [English](../../../README.md) | [中文](../zh-CN/README.md) | [Українська](../uk/README.md) | [Русский](../ru/README.md) | [日本語](../ja/README.md)
 
-**Официальный Twitter:** [@nofx_ai](https://x.com/nofx_ai)
-
 **📚 Документация:** [Главная](../../README.md) | [Начало работы](../../getting-started/README.md) | [Журнал изменений](../../../CHANGELOG.zh-CN.md) | [Сообщество](../../community/README.md)
 
 ---
@@ -49,15 +47,12 @@
 ### 👥 Основная Команда
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
 
 ### 💼 Открыт Посевной Раунд Финансирования
 
 Мы в настоящее время привлекаем **посевной раунд**.
 
-**По вопросам инвестиций**, пишите в DM **Tinkle** или **Zack** в Twitter.
-
-**По вопросам партнерства и сотрудничества**, пишите в DM нашего официального Twitter [@nofx_ai](https://x.com/nofx_ai).
+**По вопросам инвестиций**, пишите в DM **Tinkle** в Twitter.
 
 ---
 
@@ -145,6 +140,79 @@ NOFX теперь поддерживает **три основные биржи*
 
 ---
 
+## ✨ Текущая реализация - Рынки криптовалют
+
+NOFX в настоящее время **полностью работает на криптовалютных рынках** со следующими проверенными возможностями:
+
+### 🏆 Структура конкуренции Multi-Agent
+- **Реальная битва AI-агентов**: Торговое соревнование моделей Qwen vs DeepSeek в реальном времени
+- **Независимое управление счетами**: Каждый агент ведет отдельные журналы решений и метрики производительности
+- **Сравнение производительности в реальном времени**: Отслеживание ROI в реальном времени, статистика винрейта, прямой анализ
+- **Цикл самоэволюции**: Агенты учатся на исторической производительности, постоянно совершенствуясь
+
+### 🧠 AI Самообучение и Оптимизация
+- **Система исторической обратной связи**: Анализ последних 20 торговых циклов перед каждым решением
+- **Интеллектуальный анализ производительности**:
+  - Определяет лучшие/худшие активы по производительности
+  - Рассчитывает винрейт, коэффициент прибыли/убытка, среднюю прибыль в реальных USDT
+  - Избегает повторяющихся ошибок (паттерны последовательных убытков)
+  - Усиливает успешные стратегии (высокие паттерны винрейта)
+- **Динамическая корректировка стратегии**: AI автономно регулирует торговый стиль на основе результатов бэктеста
+
+### 📊 Универсальный слой рыночных данных (Криптореализация)
+- **Многотаймфреймовый анализ**: 3-минутные реальные данные + 4-часовые трендовые данные
+- **Технические индикаторы**: EMA20/50, MACD, RSI(7/14), ATR
+- **Отслеживание открытого интереса**: Анализ настроений рынка, денежных потоков
+- **Фильтрация ликвидности**: Автоматическая фильтрация активов с низкой ликвидностью (<15M USD)
+- **Поддержка кросс-биржевой торговли**: Binance, Hyperliquid, Aster DEX, единый интерфейс данных
+
+### 🎯 Единая система контроля рисков
+- **Лимиты позиций**: Лимиты на актив (Альткоины≤1.5x капитал, BTC/ETH≤10x капитал)
+- **Настраиваемое кредитное плечо**: Динамическая настройка от 1x до 50x на основе класса активов и типа счета
+- **Управление маржой**: Общее использование≤90%, AI контролирует распределение
+- **Принудительное соотношение риск/вознаграждение**: Обязательное соотношение стоп-лосс/тейк-профит ≥1:2
+- **Защита от наслоения**: Предотвращает дублирование позиций по одному активу/направлению
+
+### ⚡ Движок исполнения с низкой задержкой
+- **Интеграция API множества бирж**: Binance Futures, Hyperliquid DEX, Aster DEX
+- **Автоматическая обработка точности**: Интеллектуальное форматирование размера и цены ордера для каждой биржи
+- **Приоритетное исполнение**: Сначала закрытие существующих позиций, затем открытие новых
+- **Контроль проскальзывания**: Проверка перед исполнением, проверка точности в реальном времени
+
+### 🎨 Профессиональный интерфейс мониторинга
+- **Dashboard в стиле Binance**: Профессиональная темная тема с обновлениями в реальном времени
+- **Кривые капитала**: Историческое отслеживание стоимости счета (переключение USD/процент)
+- **Графики производительности**: Сравнение ROI множества AI-агентов, обновления в реальном времени
+- **Полные журналы решений**: Полное рассуждение цепочки мыслей (CoT) для каждой сделки
+- **5-секундное обновление данных**: Обновления счета, позиций и P&L в реальном времени
+
+---
+
+## 🔮 Дорожная карта - Расширение универсального рынка
+
+Миссия NOFX - стать **универсальной AI-торговой ОС для всех финансовых рынков**.
+
+**Видение:** Одна архитектура. Одна агентная структура. Все рынки.
+
+**Расширяемые рынки:**
+- 📈 **Фондовые рынки**: Акции США, акции Китая, Гонконгские акции
+- 📊 **Фьючерсные рынки**: Товарные фьючерсы, индексные фьючерсы
+- 🎯 **Опционная торговля**: Опционы на акции, криптоопционы
+- 💱 **Рынок Forex**: Основные валютные пары, кросс-пары
+
+**Предстоящие функции:**
+- Расширенные возможности AI (GPT-4, Claude 3, Gemini Pro, гибкие шаблоны промптов)
+- Интеграция новых бирж (OKX, Bybit, Lighter, EdgeX + CEX/Perp-DEX)
+- Рефакторинг структуры проекта (высокая связность, низкая связанность, принципы SOLID)
+- Улучшения безопасности (AES-256 шифрование API-ключей, RBAC, улучшенная 2FA)
+- Улучшения UX (отзывчивость мобильных устройств, графики TradingView, система оповещений)
+
+📖 **Для детальной дорожной карты и графиков см.:**
+- **English:** [Roadmap Documentation](../../roadmap/README.md)
+- **中文:** [路线图文档](../../roadmap/README.zh-CN.md)
+
+---
+
 ## ✨ Основные возможности
 
 ### 🏆 Режим конкуренции нескольких AI
@@ -297,8 +365,8 @@ nano config.json  # или используйте любой редактор
 #### Шаг 2: Запуск в один клик
 ```bash
 # Вариант 1: Используйте удобный скрипт (Рекомендуется)
-chmod +x start.sh
-./start.sh start --build
+chmod +x scripts/start.sh
+./scripts/start.sh start --build
 
 # Вариант 2: Используйте docker compose напрямую
 # Этот проект использует синтаксис Docker Compose V2 (с пробелами)
@@ -313,10 +381,10 @@ docker compose up -d --build
 
 #### Управление вашей системой
 ```bash
-./start.sh logs      # Просмотреть логи
-./start.sh status    # Проверить статус
-./start.sh stop      # Остановить сервисы
-./start.sh restart   # Перезапустить сервисы
+./scripts/start.sh logs      # Просмотреть логи
+./scripts/start.sh status    # Проверить статус
+./scripts/start.sh stop      # Остановить сервисы
+./scripts/start.sh restart   # Перезапустить сервисы
 ```
 
 **📖 Подробное руководство по развертыванию Docker, устранению неполадок и расширенной конфигурации:**
diff --git a/docs/i18n/uk/README.md b/docs/i18n/uk/README.md
index 38c40fdd..f4c46454 100644
--- a/docs/i18n/uk/README.md
+++ b/docs/i18n/uk/README.md
@@ -8,8 +8,6 @@
 
 **Мови / Languages:** [English](../../../README.md) | [中文](../zh-CN/README.md) | [Українська](../uk/README.md) | [Русский](../ru/README.md) | [日本語](../ja/README.md)
 
-**Офіційний Twitter:** [@nofx_ai](https://x.com/nofx_ai)
-
 **📚 Документація:** [Головна](../../README.md) | [Початок роботи](../../getting-started/README.md) | [Спільнота](../../community/README.md) | [Журнал Змін](../../../CHANGELOG.md)
 
 ---
@@ -50,15 +48,12 @@
 ### 👥 Основна Команда
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
 
 ### 💼 Відкритий Посівний Раунд Фінансування
 
 Ми зараз залучаємо **посівний раунд**.
 
-**З питань інвестицій**, пишіть в DM **Tinkle** або **Zack** в Twitter.
-
-**З питань партнерства та співпраці**, пишіть в DM нашого офіційного Twitter [@nofx_ai](https://x.com/nofx_ai).
+**З питань інвестицій**, пишіть в DM **Tinkle** в Twitter.
 
 ---
 
@@ -146,6 +141,79 @@ NOFX тепер підтримує **три основні біржі**: Binance
 
 ---
 
+## ✨ Поточна реалізація - Ринки криптовалют
+
+NOFX наразі **повністю працює на криптовалютних ринках** з наступними перевіреними можливостями:
+
+### 🏆 Структура конкуренції Multi-Agent
+- **Реальна битва AI-агентів**: Торгове змагання моделей Qwen vs DeepSeek у реальному часі
+- **Незалежне управління рахунками**: Кожен агент веде окремі журнали рішень та метрики продуктивності
+- **Порівняння продуктивності в реальному часі**: Відстеження ROI в реальному часі, статистика вінрейту, прямий аналіз
+- **Цикл самоеволюції**: Агенти вчаться на історичній продуктивності, постійно вдосконалюючись
+
+### 🧠 AI Самонавчання та Оптимізація
+- **Система історичного зворотного зв'язку**: Аналіз останніх 20 торгових циклів перед кожним рішенням
+- **Інтелектуальний аналіз продуктивності**:
+  - Визначає кращі/гірші активи за продуктивністю
+  - Розраховує вінрейт, коефіцієнт прибутку/збитку, середній прибуток у реальних USDT
+  - Уникає повторюваних помилок (патерни послідовних збитків)
+  - Посилює успішні стратегії (високі патерни вінрейту)
+- **Динамічне коригування стратегії**: AI автономно регулює торговий стиль на основі результатів бектесту
+
+### 📊 Універсальний шар ринкових даних (Криптореалізація)
+- **Багатотаймфреймовий аналіз**: 3-хвилинні реальні дані + 4-годинні трендові дані
+- **Технічні індикатори**: EMA20/50, MACD, RSI(7/14), ATR
+- **Відстеження відкритого інтересу**: Аналіз настроїв ринку, грошових потоків
+- **Фільтрація ліквідності**: Автоматична фільтрація активів з низькою ліквідністю (<15M USD)
+- **Підтримка крос-біржової торгівлі**: Binance, Hyperliquid, Aster DEX, єдиний інтерфейс даних
+
+### 🎯 Єдина система контролю ризиків
+- **Ліміти позицій**: Ліміти на актив (Альткоїни≤1.5x капітал, BTC/ETH≤10x капітал)
+- **Налаштоване кредитне плече**: Динамічне налаштування від 1x до 50x на основі класу активів та типу рахунку
+- **Управління маржею**: Загальне використання≤90%, AI контролює розподіл
+- **Примусове співвідношення ризик/винагорода**: Обов'язкове співвідношення стоп-лосс/тейк-профіт ≥1:2
+- **Захист від нашарування**: Запобігає дублюванню позицій по одному активу/напрямку
+
+### ⚡ Рушій виконання з низькою затримкою
+- **Інтеграція API множини бірж**: Binance Futures, Hyperliquid DEX, Aster DEX
+- **Автоматична обробка точності**: Інтелектуальне форматування розміру та ціни ордера для кожної біржі
+- **Пріоритетне виконання**: Спочатку закриття існуючих позицій, потім відкриття нових
+- **Контроль прослизання**: Перевірка перед виконанням, перевірка точності в реальному часі
+
+### 🎨 Професійний інтерфейс моніторингу
+- **Dashboard у стилі Binance**: Професійна темна тема з оновленнями в реальному часі
+- **Криві капіталу**: Історичне відстеження вартості рахунку (перемикання USD/відсоток)
+- **Графіки продуктивності**: Порівняння ROI множини AI-агентів, оновлення в реальному часі
+- **Повні журнали рішень**: Повне міркування ланцюга думок (CoT) для кожної угоди
+- **5-секундне оновлення даних**: Оновлення рахунку, позицій та P&L у реальному часі
+
+---
+
+## 🔮 Дорожня карта - Розширення універсального ринку
+
+Місія NOFX - стати **універсальною AI-торговою ОС для всіх фінансових ринків**.
+
+**Бачення:** Одна архітектура. Одна агентна структура. Всі ринки.
+
+**Розширювані ринки:**
+- 📈 **Фондові ринки**: Акції США, акції Китаю, Гонконгські акції
+- 📊 **Ф'ючерсні ринки**: Товарні ф'ючерси, індексні ф'ючерси
+- 🎯 **Опціонна торгівля**: Опціони на акції, крипто-опціони
+- 💱 **Ринок Forex**: Основні валютні пари, крос-пари
+
+**Майбутні функції:**
+- Розширені можливості AI (GPT-4, Claude 3, Gemini Pro, гнучкі шаблони промптів)
+- Інтеграція нових бірж (OKX, Bybit, Lighter, EdgeX + CEX/Perp-DEX)
+- Рефакторинг структури проекту (висока зв'язність, низька зв'язаність, принципи SOLID)
+- Поліпшення безпеки (AES-256 шифрування API-ключів, RBAC, покращена 2FA)
+- Поліпшення UX (відгук мобільних пристроїв, графіки TradingView, система сповіщень)
+
+📖 **Для детальної дорожньої карти та графіків див.:**
+- **English:** [Roadmap Documentation](../../roadmap/README.md)
+- **中文:** [路线图文档](../../roadmap/README.zh-CN.md)
+
+---
+
 ## ✨ Основні можливості
 
 ### 🏆 Режим змагання кількох AI
@@ -300,8 +368,8 @@ nano config.json  # або використайте будь-який редак
 #### Крок 2: Запуск в один клік
 ```bash
 # Варіант 1: Використайте зручний скрипт (Рекомендується)
-chmod +x start.sh
-./start.sh start --build
+chmod +x scripts/start.sh
+./scripts/start.sh start --build
 
 # Варіант 2: Використайте docker compose безпосередньо
 # Цей проект використовує синтаксис Docker Compose V2 (з пробілами)
@@ -316,10 +384,10 @@ docker compose up -d --build
 
 #### Керування вашою системою
 ```bash
-./start.sh logs      # Переглянути логи
-./start.sh status    # Перевірити статус
-./start.sh stop      # Зупинити сервіси
-./start.sh restart   # Перезапустити сервіси
+./scripts/start.sh logs      # Переглянути логи
+./scripts/start.sh status    # Перевірити статус
+./scripts/start.sh stop      # Зупинити сервіси
+./scripts/start.sh restart   # Перезапустити сервіси
 ```
 
 **📖 Детальний посібник з розгортання Docker, усунення несправностей та розширеної конфігурації:**
diff --git a/docs/i18n/zh-CN/README.md b/docs/i18n/zh-CN/README.md
index bb23e4ef..0d11bd28 100644
--- a/docs/i18n/zh-CN/README.md
+++ b/docs/i18n/zh-CN/README.md
@@ -8,8 +8,6 @@
 
 **语言 / Languages:** [English](../../../README.md) | [中文](../zh-CN/README.md) | [Українська](../uk/README.md) | [Русский](../ru/README.md) | [日本語](../ja/README.md)
 
-**官方推特:** [@nofx_ai](https://x.com/nofx_ai)
-
 **📚 文档中心:** [文档首页](../../README.md) | [快速开始](../../getting-started/README.zh-CN.md) | [更新日志](../../../CHANGELOG.zh-CN.md) | [社区指南](../../community/README.md)
 
 ---
@@ -57,15 +55,12 @@
 ### 👥 核心团队
 
 - **Tinkle** - [@Web3Tinkle](https://x.com/Web3Tinkle)
-- **Zack** - [@0x_ZackH](https://x.com/0x_ZackH)
 
 ### 💼 种子轮融资进行中
 
 我们正在进行**种子轮融资**。
 
-**投资咨询**，请通过 Twitter 私信联系 **Tinkle** 或 **Zack**。
-
-**商务合作**，请私信官方推特 [@nofx_ai](https://x.com/nofx_ai)。
+**投资咨询**，请通过 Twitter 私信联系 **Tinkle**。
 
 ---
 
@@ -296,8 +291,8 @@ nano config.json  # 或使用其他编辑器
 #### 步骤2：一键启动
 ```bash
 # 方式1：使用便捷脚本（推荐）
-chmod +x start.sh
-./start.sh start --build
+chmod +x scripts/start.sh
+./scripts/start.sh start --build
 
 
 # 方式2：直接使用docker compose
@@ -312,10 +307,10 @@ docker compose up -d --build
 
 #### 管理你的系统
 ```bash
-./start.sh logs      # 查看日志
-./start.sh status    # 检查状态
-./start.sh stop      # 停止服务
-./start.sh restart   # 重启服务
+./scripts/start.sh logs      # 查看日志
+./scripts/start.sh status    # 检查状态
+./scripts/start.sh stop      # 停止服务
+./scripts/start.sh restart   # 重启服务
 ```
 
 **📖 详细的Docker部署教程、故障排查和高级配置：**
diff --git a/docs/pnl.md b/docs/pnl.md
new file mode 100644
index 00000000..8f1c57ca
--- /dev/null
+++ b/docs/pnl.md
@@ -0,0 +1,299 @@
+# PNL计算重构方案 - 最终设计
+
+## 📋 核心问题与答案
+
+### 1. **Initial Balance（初始余额）**
+
+**定义：** 创建trader时的账户净值（Total Equity），作为所有PNL计算的基准
+
+**设置时机：**
+- ✅ **创建trader时自动获取** - 从交易所API获取当前的Total Equity
+- ✅ **允许用户手动更新** - 充值/提现后可通过前端主动同步
+
+**存储位置：**
+- 数据库：`traders.initial_balance` 字段
+
+**计算公式：**
+```
+Initial Balance = Total Wallet Balance + Total Unrealized Profit
+                = 当前账户净值（创建时快照）
+```
+
+---
+
+### 2. **Equity（账户净值）**
+
+**定义：** 账户的实时总价值
+
+**计算公式：**
+```
+Total Equity = Total Wallet Balance + Total Unrealized Profit
+```
+
+**数据来源：** 实时从交易所API获取
+
+**说明：**
+- `Total Wallet Balance`: 账户中的实际USDT余额（包括已实现盈亏）
+- `Total Unrealized Profit`: 所有持仓的未实现盈亏总和
+- Equity会随着市场价格波动和持仓变化实时变化
+
+---
+
+### 3. **PNL（盈亏）**
+
+#### 3.1 Total PNL（总盈亏）
+
+**计算公式：**
+```
+Total PNL = Current Equity - Initial Balance
+Total PNL % = (Total PNL / Initial Balance) × 100%
+```
+
+**示例：**
+```
+Initial Balance: 10,000 USDT  （创建时）
+Current Equity:  11,500 USDT  （实时）
+-----------------------------------
+Total PNL:       +1,500 USDT
+Total PNL %:     +15%
+```
+
+#### 3.2 Unrealized PNL（未实现盈亏）
+
+**定义：** 当前所有持仓的未实现盈亏总和
+
+**来源：** 直接从交易所API获取 `totalUnrealizedProfit`
+
+#### 3.3 单个持仓的PNL%
+
+**计算公式：**
+```
+Position PNL % = (Unrealized PnL / Margin Used) × 100%
+```
+
+其中：`Margin Used = Position Value / Leverage`
+
+---
+
+## 🎯 最终实现方案
+
+### 核心原则
+
+| 原则 | 说明 |
+|-----|------|
+| ❌ **禁用自动同步** | 系统**不会**自动修改Initial Balance |
+| ✅ **创建时自动获取** | 创建trader时从交易所获取真实equity |
+| ✅ **允许手动更新** | 用户可通过前端主动同步（充值/提现后） |
+| 🔒 **常规更新保护** | UpdateTrader方法**不允许**修改Initial Balance |
+
+---
+
+## 🔧 实现细节
+
+### 1. 创建Trader时自动获取Initial Balance
+
+**文件：** `api/server.go:handleCreateTrader()`
+
+**逻辑：**
+```go
+// 查询交易所余额
+balanceInfo, _ := tempTrader.GetBalance()
+
+// 提取钱包余额和未实现盈亏
+totalWalletBalance := balanceInfo["totalWalletBalance"].(float64)
+totalUnrealizedProfit := balanceInfo["totalUnrealizedProfit"].(float64)
+
+// 计算Total Equity作为Initial Balance
+initialEquity := totalWalletBalance + totalUnrealizedProfit
+
+// 存入数据库
+trader := &config.TraderRecord{
+    InitialBalance: initialEquity,  // 自动设置
+    // ... 其他字段
+}
+```
+
+---
+
+### 2. 禁用自动同步机制
+
+**修改：** `trader/auto_trader.go:autoSyncBalanceIfNeeded()`
+
+**操作：**
+- 函数重命名为 `autoSyncBalanceIfNeeded_DEPRECATED()`
+- 在 `runCycle()` 中注释掉调用
+
+**效果：** 系统运行过程中**不会**自动修改Initial Balance
+
+---
+
+### 3. 保护UpdateTrader方法
+
+**文件：** `config/database.go:UpdateTrader()`
+
+**修改：** 从SQL UPDATE语句中移除 `initial_balance` 字段
+
+**效果：** 常规的配置更新操作**无法**修改Initial Balance
+
+---
+
+### 4. 提供手动更新API
+
+**端点：** `POST /traders/:id`
+
+**实现：** `api/server.go:handleUpdateTrader()`
+
+**用途：** update trader, 包括Initial Balance基准值
+
+**请求体：**
+```json
+{
+  "initial_balance": 10000.0
+}
+```
+
+**流程：**
+```
+1. 用户输入新的initial_balance值
+2. 更新数据库的initial_balance字段
+3. 重新加载trader到内存
+4. 返回更新前后的对比信息
+```
+
+**特点：**
+- ✅ 用户可以输入**任意值**，不限于交易所当前余额
+- ✅ 适用于充值/提现后重置基准
+- ✅ 也可用于手动校正或调整统计基准
+
+---
+
+## 📊 数据流设计
+
+```
+┌─────────────────────────────────────────┐
+│ 1. 创建Trader                            │
+│    - 用户配置AI模型、交易所              │
+│    - 系统自动获取当前equity               │
+│    → initial_balance = Total Equity     │
+└──────────────┬──────────────────────────┘
+               │
+               ▼
+┌─────────────────────────────────────────┐
+│ 2. 运行期间                              │
+│    - 系统不会自动修改initial_balance     │
+│    - 实时计算：                          │
+│      current_equity = API获取            │
+│      total_pnl = current - initial      │
+└──────────────┬──────────────────────────┘
+               │
+               ▼
+┌─────────────────────────────────────────┐
+│ 3. 充值/提现后                          │
+│    - 用户点击"更新初始余额"按钮         │
+│    - 更新initial_balance                │
+│    - PNL计算重新基于新的基准            │
+└─────────────────────────────────────────┘
+```
+
+---
+
+## 📝 字段定义总结
+
+| 字段 | 定义 | 计算方式 | 存储位置 | 更新频率 |
+|-----|------|---------|---------|---------|
+| **Initial Balance** | 基准余额 | 创建/手动同步时获取equity | DB: traders.initial_balance | 创建时+手动 |
+| **Current Equity** | 当前净值 | wallet + unrealized | 不存储（实时计算） | 实时 |
+| **Total PNL** | 总盈亏 | current_equity - initial_balance | 不存储（实时计算） | 实时 |
+| **Total PNL %** | 盈亏百分比 | (total_pnl / initial_balance) × 100 | 不存储（实时计算） | 实时 |
+
+---
+
+## 🎮 用户操作场景
+
+### 场景1：创建新的Trader
+```
+用户操作：填写基本配置（不需要输入余额）
+系统行为：自动从交易所获取当前equity，设置为initial_balance
+结果：initial_balance = 当前账户净值
+```
+
+### 场景2：正常交易运行
+```
+用户操作：无
+系统行为：实时计算PNL，不修改initial_balance
+结果：PNL = 当前equity - initial_balance
+```
+
+### 场景3：充值后重新校准
+```
+用户操作：充值 → 输入新的Initial Balance（如：10000 + 5000 = 15000）
+系统行为：更新initial_balance为15000
+结果：PNL统计基于新的基准15000计算
+```
+
+### 场景4：提现后重新校准
+```
+用户操作：提现 → 输入新的Initial Balance（如：10000 - 2000 = 8000）
+系统行为：更新initial_balance为8000
+结果：PNL统计基于新的基准8000计算
+```
+
+### 场景5：手动调整统计基准
+```
+用户操作：想重新开始统计PNL → 输入当前账户净值作为新基准
+系统行为：更新initial_balance为用户输入的值
+结果：PNL统计重置，从新基准开始计算
+```
+
+---
+
+## ✅ 优势分析
+
+1. **稳定性**：PNL基准不会自动变化，统计更可靠
+2. **灵活性**：用户可以在需要时主动校准
+3. **准确性**：Initial Balance基于真实equity，不是手动输入
+4. **可控性**：充值/提现后，用户可以重置PNL统计
+
+---
+
+## 🚀 前端需要做的改动
+
+### 1. 创建Trader页面
+- ✅ 移除"初始资金"输入框
+- ✅ 添加说明：系统将自动获取您的账户净值
+
+### 2. Trader详情页面
+- ✅ 添加"更新初始余额"按钮/表单
+- ✅ 弹窗/输入框：让用户输入新的Initial Balance值
+- ✅ 提示文案：
+  ```
+  当前初始余额: 10,000 USDT
+  请输入新的初始余额（用于重新校准PNL统计）
+  ```
+
+
+### 4. 用户体验建议
+- 💡 可以在输入框旁边显示当前账户净值作为参考
+- 💡 充值/提现后，提示用户是否需要更新Initial Balance
+- 💡 显示更新前后的对比信息，让用户确认
+
+---
+
+## 📖 关键代码位置
+
+| 功能 | 文件 | 行号/函数 |
+|-----|------|----------|
+| 创建时自动获取equity | api/server.go | handleCreateTrader:540-625 |
+| 禁用自动同步 | trader/auto_trader.go | autoSyncBalanceIfNeeded_DEPRECATED:291 |
+| 保护UpdateTrader | config/database.go | UpdateTrader:954-969 |
+| 手动同步API | api/server.go | handleSyncBalance:937-1050 |
+| 手动同步数据库方法 | config/database.go | UpdateTraderInitialBalance:977-982 |
+
+---
+
+## 🎯 总结
+
+这个设计平衡了**稳定性**和**灵活性**：
+- Initial Balance不会被系统自动修改，确保PNL统计的一致性
+- 用户拥有主动权，可以在充值/提现后重新校准
+- 创建时自动获取真实equity，避免手动输入错误
diff --git a/generate_beta_code.sh b/generate_beta_code.sh
deleted file mode 100755
index cee2ca3a..00000000
--- a/generate_beta_code.sh
+++ /dev/null
@@ -1,221 +0,0 @@
-#!/bin/bash
-
-# 内测码生成脚本
-# 生成6位不重复的内测码并写入 beta_codes.txt
-
-BETA_CODES_FILE="beta_codes.txt"
-COUNT=1
-LIST_ONLY=false
-CODE_LENGTH=6
-
-# 字符集（避免易混淆字符：0/O, 1/I/l）
-CHARSET="23456789abcdefghjkmnpqrstuvwxyz"
-
-# 显示帮助信息
-show_help() {
-    cat << EOF
-用法: $0 [选项]
-
-选项:
-    -c COUNT    生成内测码数量 (默认: 1)
-    -l          列出现有内测码
-    -f FILE     内测码文件路径 (默认: beta_codes.txt)
-    -h          显示此帮助信息
-
-示例:
-    $0 -c 10                   # 生成10个内测码
-    $0 -l                      # 列出现有内测码
-    $0 -f custom.txt -c 5      # 在自定义文件中生成5个内测码
-EOF
-}
-
-# 生成随机内测码
-generate_beta_code() {
-    local length="$1"
-    local charset="$2"
-    local code=""
-    
-    for ((i=0; i<length; i++)); do
-        local random_index=$((RANDOM % ${#charset}))
-        code+="${charset:$random_index:1}"
-    done
-    
-    echo "$code"
-}
-
-# 读取现有内测码
-read_existing_codes() {
-    local file="$1"
-    if [ -f "$file" ]; then
-        grep -v '^$' "$file" 2>/dev/null | tr -d ' \t' | grep -v '^#' || true
-    fi
-}
-
-# 检查内测码是否已存在
-code_exists() {
-    local code="$1"
-    local file="$2"
-    if [ -f "$file" ]; then
-        grep -Fxq "$code" "$file" 2>/dev/null
-    else
-        return 1
-    fi
-}
-
-# 添加内测码到文件
-add_code_to_file() {
-    local code="$1"
-    local file="$2"
-    echo "$code" >> "$file"
-}
-
-# 验证内测码格式
-validate_code() {
-    local code="$1"
-    # 检查长度
-    if [ ${#code} -ne $CODE_LENGTH ]; then
-        return 1
-    fi
-    # 检查字符是否都在允许的字符集中
-    if [[ ! "$code" =~ ^[$CHARSET]+$ ]]; then
-        return 1
-    fi
-    return 0
-}
-
-# 去重并排序内测码
-dedupe_and_sort_codes() {
-    local file="$1"
-    if [ -f "$file" ]; then
-        # 过滤空行和注释，去重并排序
-        grep -v '^$' "$file" | grep -v '^#' | sort -u > "${file}.tmp" && mv "${file}.tmp" "$file"
-    fi
-}
-
-# 解析命令行参数
-while getopts "c:lf:h" opt; do
-    case $opt in
-        c)
-            COUNT="$OPTARG"
-            if ! [[ "$COUNT" =~ ^[0-9]+$ ]] || [ "$COUNT" -lt 1 ]; then
-                echo "错误: count 必须是正整数" >&2
-                exit 1
-            fi
-            ;;
-        l)
-            LIST_ONLY=true
-            ;;
-        f)
-            BETA_CODES_FILE="$OPTARG"
-            ;;
-        h)
-            show_help
-            exit 0
-            ;;
-        \?)
-            echo "无效选项: -$OPTARG" >&2
-            echo "使用 -h 查看帮助信息" >&2
-            exit 1
-            ;;
-    esac
-done
-
-# 如果是列出现有内测码
-if [ "$LIST_ONLY" = true ]; then
-    if [ -f "$BETA_CODES_FILE" ]; then
-        existing_codes=$(read_existing_codes "$BETA_CODES_FILE")
-        if [ -z "$existing_codes" ]; then
-            echo "内测码列表为空"
-        else
-            count=$(echo "$existing_codes" | wc -l | tr -d ' ')
-            echo "当前内测码 ($count 个):"
-            echo "$existing_codes" | nl -w3 -s'. '
-        fi
-    else
-        echo "内测码文件不存在: $BETA_CODES_FILE"
-    fi
-    exit 0
-fi
-
-# 读取现有内测码
-existing_codes=$(read_existing_codes "$BETA_CODES_FILE")
-
-# 生成新内测码
-new_codes=()
-max_attempts=1000  # 防止无限循环
-
-echo "正在生成 $COUNT 个内测码..."
-
-for ((i=1; i<=COUNT; i++)); do
-    attempts=0
-    while [ $attempts -lt $max_attempts ]; do
-        code=$(generate_beta_code $CODE_LENGTH "$CHARSET")
-        
-        # 验证格式
-        if ! validate_code "$code"; then
-            ((attempts++))
-            continue
-        fi
-        
-        # 检查是否已存在
-        if code_exists "$code" "$BETA_CODES_FILE"; then
-            ((attempts++))
-            continue
-        fi
-        
-        # 检查是否与本次生成的重复
-        duplicate=false
-        for existing_code in "${new_codes[@]}"; do
-            if [ "$code" = "$existing_code" ]; then
-                duplicate=true
-                break
-            fi
-        done
-        
-        if [ "$duplicate" = false ]; then
-            new_codes+=("$code")
-            break
-        fi
-        
-        ((attempts++))
-    done
-    
-    if [ $attempts -eq $max_attempts ]; then
-        echo "警告: 生成第 $i 个内测码时达到最大尝试次数，可能字符空间不足" >&2
-        break
-    fi
-done
-
-# 检查是否成功生成了内测码
-if [ ${#new_codes[@]} -eq 0 ]; then
-    echo "未能生成任何新的内测码"
-    exit 1
-fi
-
-# 添加到文件
-for code in "${new_codes[@]}"; do
-    add_code_to_file "$code" "$BETA_CODES_FILE"
-done
-
-# 去重并排序
-dedupe_and_sort_codes "$BETA_CODES_FILE"
-
-echo "成功生成 ${#new_codes[@]} 个内测码:"
-printf '  %s\n' "${new_codes[@]}"
-echo
-echo "内测码文件: $BETA_CODES_FILE"
-
-# 显示当前总数
-if [ -f "$BETA_CODES_FILE" ]; then
-    total_count=$(read_existing_codes "$BETA_CODES_FILE" | wc -l | tr -d ' ')
-    echo "当前内测码总计: $total_count 个"
-fi
-
-# 显示文件头部信息（如果是新文件）
-if [ ! -s "$BETA_CODES_FILE" ] || [ $(wc -l < "$BETA_CODES_FILE") -eq ${#new_codes[@]} ]; then
-    echo
-    echo "内测码规则："
-    echo "- 长度: $CODE_LENGTH 位"
-    echo "- 字符集: 数字 2-9, 小写字母 a-z (排除 0,1,i,l,o 避免混淆)"
-    echo "- 每个内测码唯一且不重复"
-fi
\ No newline at end of file
diff --git a/logger/decision_logger.go b/logger/decision_logger.go
index 81ae52ef..1886f51c 100644
--- a/logger/decision_logger.go
+++ b/logger/decision_logger.go
@@ -36,6 +36,7 @@ type AccountSnapshot struct {
 	TotalUnrealizedProfit float64 `json:"total_unrealized_profit"`
 	PositionCount         int     `json:"position_count"`
 	MarginUsedPct         float64 `json:"margin_used_pct"`
+	InitialBalance        float64 `json:"initial_balance"` // 记录当时的初始余额基准
 }
 
 // PositionSnapshot 持仓快照
@@ -63,6 +64,22 @@ type DecisionAction struct {
 	Error     string    `json:"error"`     // 错误信息
 }
 
+// IDecisionLogger 决策日志记录器接口
+type IDecisionLogger interface {
+	// LogDecision 记录决策
+	LogDecision(record *DecisionRecord) error
+	// GetLatestRecords 获取最近N条记录（按时间正序：从旧到新）
+	GetLatestRecords(n int) ([]*DecisionRecord, error)
+	// GetRecordByDate 获取指定日期的所有记录
+	GetRecordByDate(date time.Time) ([]*DecisionRecord, error)
+	// CleanOldRecords 清理N天前的旧记录
+	CleanOldRecords(days int) error
+	// GetStatistics 获取统计信息
+	GetStatistics() (*Statistics, error)
+	// AnalyzePerformance 分析最近N个周期的交易表现
+	AnalyzePerformance(lookbackCycles int) (*PerformanceAnalysis, error)
+}
+
 // DecisionLogger 决策日志记录器
 type DecisionLogger struct {
 	logDir      string
@@ -70,7 +87,7 @@ type DecisionLogger struct {
 }
 
 // NewDecisionLogger 创建决策日志记录器
-func NewDecisionLogger(logDir string) *DecisionLogger {
+func NewDecisionLogger(logDir string) IDecisionLogger {
 	if logDir == "" {
 		logDir = "decision_logs"
 	}
diff --git a/manager/trader_manager.go b/manager/trader_manager.go
index 9e1e9fb7..f331f3e4 100644
--- a/manager/trader_manager.go
+++ b/manager/trader_manager.go
@@ -590,48 +590,51 @@ func (tm *TraderManager) getConcurrentTraderData(traders []*trader.AutoTrader) [
 			case account := <-accountChan:
 				// 成功获取账户信息
 				traderData = map[string]interface{}{
-					"trader_id":       trader.GetID(),
-					"trader_name":     trader.GetName(),
-					"ai_model":        trader.GetAIModel(),
-					"exchange":        trader.GetExchange(),
-					"total_equity":    account["total_equity"],
-					"total_pnl":       account["total_pnl"],
-					"total_pnl_pct":   account["total_pnl_pct"],
-					"position_count":  account["position_count"],
-					"margin_used_pct": account["margin_used_pct"],
-					"is_running":      status["is_running"],
+					"trader_id":              trader.GetID(),
+					"trader_name":            trader.GetName(),
+					"ai_model":               trader.GetAIModel(),
+					"exchange":               trader.GetExchange(),
+					"total_equity":           account["total_equity"],
+					"total_pnl":              account["total_pnl"],
+					"total_pnl_pct":          account["total_pnl_pct"],
+					"position_count":         account["position_count"],
+					"margin_used_pct":        account["margin_used_pct"],
+					"is_running":             status["is_running"],
+					"system_prompt_template": trader.GetSystemPromptTemplate(),
 				}
 			case err := <-errorChan:
 				// 获取账户信息失败
 				log.Printf("⚠️ 获取交易员 %s 账户信息失败: %v", trader.GetID(), err)
 				traderData = map[string]interface{}{
-					"trader_id":       trader.GetID(),
-					"trader_name":     trader.GetName(),
-					"ai_model":        trader.GetAIModel(),
-					"exchange":        trader.GetExchange(),
-					"total_equity":    0.0,
-					"total_pnl":       0.0,
-					"total_pnl_pct":   0.0,
-					"position_count":  0,
-					"margin_used_pct": 0.0,
-					"is_running":      status["is_running"],
-					"error":           "账户数据获取失败",
+					"trader_id":              trader.GetID(),
+					"trader_name":            trader.GetName(),
+					"ai_model":               trader.GetAIModel(),
+					"exchange":               trader.GetExchange(),
+					"total_equity":           0.0,
+					"total_pnl":              0.0,
+					"total_pnl_pct":          0.0,
+					"position_count":         0,
+					"margin_used_pct":        0.0,
+					"is_running":             status["is_running"],
+					"system_prompt_template": trader.GetSystemPromptTemplate(),
+					"error":                  "账户数据获取失败",
 				}
 			case <-ctx.Done():
 				// 超时
 				log.Printf("⏰ 获取交易员 %s 账户信息超时", trader.GetID())
 				traderData = map[string]interface{}{
-					"trader_id":       trader.GetID(),
-					"trader_name":     trader.GetName(),
-					"ai_model":        trader.GetAIModel(),
-					"exchange":        trader.GetExchange(),
-					"total_equity":    0.0,
-					"total_pnl":       0.0,
-					"total_pnl_pct":   0.0,
-					"position_count":  0,
-					"margin_used_pct": 0.0,
-					"is_running":      status["is_running"],
-					"error":           "获取超时",
+					"trader_id":              trader.GetID(),
+					"trader_name":            trader.GetName(),
+					"ai_model":               trader.GetAIModel(),
+					"exchange":               trader.GetExchange(),
+					"total_equity":           0.0,
+					"total_pnl":              0.0,
+					"total_pnl_pct":          0.0,
+					"position_count":         0,
+					"margin_used_pct":        0.0,
+					"is_running":             status["is_running"],
+					"system_prompt_template": trader.GetSystemPromptTemplate(),
+					"error":                  "获取超时",
 				}
 			}
 
@@ -1086,3 +1089,15 @@ func (tm *TraderManager) loadSingleTrader(traderCfg *config.TraderRecord, aiMode
 	log.Printf("✓ Trader '%s' (%s + %s) 已为用户加载到内存", traderCfg.Name, aiModelCfg.Provider, exchangeCfg.ID)
 	return nil
 }
+
+// RemoveTrader 从内存中移除指定的trader（不影响数据库）
+// 用于更新trader配置时强制重新加载
+func (tm *TraderManager) RemoveTrader(traderID string) {
+	tm.mu.Lock()
+	defer tm.mu.Unlock()
+
+	if _, exists := tm.traders[traderID]; exists {
+		delete(tm.traders, traderID)
+		log.Printf("✓ Trader %s 已从内存中移除", traderID)
+	}
+}
diff --git a/manager/trader_manager_test.go b/manager/trader_manager_test.go
new file mode 100644
index 00000000..c5344d95
--- /dev/null
+++ b/manager/trader_manager_test.go
@@ -0,0 +1,87 @@
+package manager
+
+import (
+	"testing"
+)
+
+// TestRemoveTrader 测试从内存中移除trader
+func TestRemoveTrader(t *testing.T) {
+	tm := NewTraderManager()
+
+	// 创建一个模拟的 trader 并添加到 map
+	traderID := "test-trader-123"
+	tm.traders[traderID] = nil // 使用 nil 作为占位符，实际测试中只需验证删除逻辑
+
+	// 验证 trader 存在
+	if _, exists := tm.traders[traderID]; !exists {
+		t.Fatal("trader 应该存在于 map 中")
+	}
+
+	// 调用 RemoveTrader
+	tm.RemoveTrader(traderID)
+
+	// 验证 trader 已被移除
+	if _, exists := tm.traders[traderID]; exists {
+		t.Error("trader 应该已从 map 中移除")
+	}
+}
+
+// TestRemoveTrader_NonExistent 测试移除不存在的trader不会报错
+func TestRemoveTrader_NonExistent(t *testing.T) {
+	tm := NewTraderManager()
+
+	// 尝试移除不存在的 trader，不应该 panic
+	defer func() {
+		if r := recover(); r != nil {
+			t.Errorf("移除不存在的 trader 不应该 panic: %v", r)
+		}
+	}()
+
+	tm.RemoveTrader("non-existent-trader")
+}
+
+// TestRemoveTrader_Concurrent 测试并发移除trader的安全性
+func TestRemoveTrader_Concurrent(t *testing.T) {
+	tm := NewTraderManager()
+	traderID := "test-trader-concurrent"
+
+	// 添加 trader
+	tm.traders[traderID] = nil
+
+	// 并发调用 RemoveTrader
+	done := make(chan bool, 10)
+	for i := 0; i < 10; i++ {
+		go func() {
+			tm.RemoveTrader(traderID)
+			done <- true
+		}()
+	}
+
+	// 等待所有 goroutine 完成
+	for i := 0; i < 10; i++ {
+		<-done
+	}
+
+	// 验证 trader 已被移除
+	if _, exists := tm.traders[traderID]; exists {
+		t.Error("trader 应该已从 map 中移除")
+	}
+}
+
+// TestGetTrader_AfterRemove 测试移除后获取trader返回错误
+func TestGetTrader_AfterRemove(t *testing.T) {
+	tm := NewTraderManager()
+	traderID := "test-trader-get"
+
+	// 添加 trader
+	tm.traders[traderID] = nil
+
+	// 移除 trader
+	tm.RemoveTrader(traderID)
+
+	// 尝试获取已移除的 trader
+	_, err := tm.GetTrader(traderID)
+	if err == nil {
+		t.Error("获取已移除的 trader 应该返回错误")
+	}
+}
diff --git a/market/data.go b/market/data.go
index 3ea1a248..fdbc1af5 100644
--- a/market/data.go
+++ b/market/data.go
@@ -3,7 +3,7 @@ package market
 import (
 	"encoding/json"
 	"fmt"
-	"io/ioutil"
+	"io"
 	"log"
 	"math"
 	"strconv"
@@ -333,7 +333,7 @@ func getOpenInterestData(symbol string) (*OIData, error) {
 	}
 	defer resp.Body.Close()
 
-	body, err := ioutil.ReadAll(resp.Body)
+	body, err := io.ReadAll(resp.Body)
 	if err != nil {
 		return nil, err
 	}
@@ -378,7 +378,7 @@ func getFundingRate(symbol string) (float64, error) {
 	}
 	defer resp.Body.Close()
 
-	body, err := ioutil.ReadAll(resp.Body)
+	body, err := io.ReadAll(resp.Body)
 	if err != nil {
 		return 0, err
 	}
diff --git a/market/monitor.go b/market/monitor.go
index 340613ac..717c96fe 100644
--- a/market/monitor.go
+++ b/market/monitor.go
@@ -232,26 +232,26 @@ func (m *WSMonitor) processKlineUpdate(symbol string, wsData KlineWSData, _time
 	klineDataMap.Store(symbol, klines)
 }
 
-func (m *WSMonitor) GetCurrentKlines(symbol string, _time string) ([]Kline, error) {
+func (m *WSMonitor) GetCurrentKlines(symbol string, duration string) ([]Kline, error) {
 	// 对每一个进来的symbol检测是否存在内类 是否的话就订阅它
-	value, exists := m.getKlineDataMap(_time).Load(symbol)
+	value, exists := m.getKlineDataMap(duration).Load(symbol)
 	if !exists {
 		// 如果Ws数据未初始化完成时,单独使用api获取 - 兼容性代码 (防止在未初始化完成是,已经有交易员运行)
 		apiClient := NewAPIClient()
-		klines, err := apiClient.GetKlines(symbol, _time, 100)
+		klines, err := apiClient.GetKlines(symbol, duration, 100)
 		if err != nil {
-			return nil, fmt.Errorf("获取%v分钟K线失败: %v", _time, err)
+			return nil, fmt.Errorf("获取%v分钟K线失败: %v", duration, err)
 		}
 
 		// 动态缓存进缓存
-		m.getKlineDataMap(_time).Store(strings.ToUpper(symbol), klines)
+		m.getKlineDataMap(duration).Store(strings.ToUpper(symbol), klines)
 
 		// 订阅 WebSocket 流
-		subStr := m.subscribeSymbol(symbol, _time)
+		subStr := m.subscribeSymbol(symbol, duration)
 		subErr := m.combinedClient.subscribeStreams(subStr)
 		log.Printf("动态订阅流: %v", subStr)
 		if subErr != nil {
-			log.Printf("警告: 动态订阅%v分钟K线失败: %v (使用API数据)", _time, subErr)
+			log.Printf("警告: 动态订阅%v分钟K线失败: %v (使用API数据)", duration, subErr)
 		}
 
 		// ✅ FIX: 返回深拷贝而非引用
diff --git a/mcp/client.go b/mcp/client.go
index 0f785534..ab34f402 100644
--- a/mcp/client.go
+++ b/mcp/client.go
@@ -5,108 +5,115 @@ import (
 	"encoding/json"
 	"fmt"
 	"io"
-	"log"
 	"net/http"
-	"os"
-	"strconv"
 	"strings"
 	"time"
 )
 
-// Provider AI提供商类型
-type Provider string
-
 const (
-	ProviderDeepSeek Provider = "deepseek"
-	ProviderQwen     Provider = "qwen"
-	ProviderCustom   Provider = "custom"
+	ProviderCustom = "custom"
+
+	MCPClientTemperature = 0.5
+)
+
+var (
+	DefaultTimeout = 120 * time.Second
+
+	MaxRetryTimes = 3
+
+	retryableErrors = []string{
+		"EOF",
+		"timeout",
+		"connection reset",
+		"connection refused",
+		"temporary failure",
+		"no such host",
+		"stream error",   // HTTP/2 stream 错误
+		"INTERNAL_ERROR", // 服务端内部错误
+	}
 )
 
 // Client AI API配置
 type Client struct {
-	Provider   Provider
+	Provider   string
 	APIKey     string
 	BaseURL    string
 	Model      string
-	Timeout    time.Duration
 	UseFullURL bool // 是否使用完整URL（不添加/chat/completions）
 	MaxTokens  int  // AI响应的最大token数
-}
 
-func New() *Client {
-	// 从环境变量读取 MaxTokens，默认 2000
-	maxTokens := 2000
-	if envMaxTokens := os.Getenv("AI_MAX_TOKENS"); envMaxTokens != "" {
-		if parsed, err := strconv.Atoi(envMaxTokens); err == nil && parsed > 0 {
-			maxTokens = parsed
-			log.Printf("🔧 [MCP] 使用环境变量 AI_MAX_TOKENS: %d", maxTokens)
-		} else {
-			log.Printf("⚠️  [MCP] 环境变量 AI_MAX_TOKENS 无效 (%s)，使用默认值: %d", envMaxTokens, maxTokens)
-		}
-	}
+	httpClient *http.Client
+	logger     Logger // 日志器（可替换）
+	config     *Config // 配置对象（保存所有配置）
 
-	// 默认配置
-	return &Client{
-		Provider:  ProviderDeepSeek,
-		BaseURL:   "https://api.deepseek.com/v1",
-		Model:     "deepseek-chat",
-		Timeout:   120 * time.Second, // 增加到120秒，因为AI需要分析大量数据
-		MaxTokens: maxTokens,
-	}
+	// hooks 用于实现动态分派（多态）
+	// 当 DeepSeekClient 嵌入 Client 时，hooks 指向 DeepSeekClient
+	// 这样 call() 中调用的方法会自动分派到子类重写的版本
+	hooks clientHooks
 }
 
-// SetDeepSeekAPIKey 设置DeepSeek API密钥
-// customURL 为空时使用默认URL，customModel 为空时使用默认模型
-func (client *Client) SetDeepSeekAPIKey(apiKey string, customURL string, customModel string) {
-	client.Provider = ProviderDeepSeek
-	client.APIKey = apiKey
-	if customURL != "" {
-		client.BaseURL = customURL
-		log.Printf("🔧 [MCP] DeepSeek 使用自定义 BaseURL: %s", customURL)
-	} else {
-		client.BaseURL = "https://api.deepseek.com/v1"
-		log.Printf("🔧 [MCP] DeepSeek 使用默认 BaseURL: %s", client.BaseURL)
-	}
-	if customModel != "" {
-		client.Model = customModel
-		log.Printf("🔧 [MCP] DeepSeek 使用自定义 Model: %s", customModel)
-	} else {
-		client.Model = "deepseek-chat"
-		log.Printf("🔧 [MCP] DeepSeek 使用默认 Model: %s", client.Model)
-	}
-	// 打印 API Key 的前后各4位用于验证
-	if len(apiKey) > 8 {
-		log.Printf("🔧 [MCP] DeepSeek API Key: %s...%s", apiKey[:4], apiKey[len(apiKey)-4:])
-	}
+// New 创建默认客户端（向前兼容）
+//
+// Deprecated: 推荐使用 NewClient(...opts) 以获得更好的灵活性
+func New() AIClient {
+	return NewClient()
 }
 
-// SetQwenAPIKey 设置阿里云Qwen API密钥
-// customURL 为空时使用默认URL，customModel 为空时使用默认模型
-func (client *Client) SetQwenAPIKey(apiKey string, customURL string, customModel string) {
-	client.Provider = ProviderQwen
-	client.APIKey = apiKey
-	if customURL != "" {
-		client.BaseURL = customURL
-		log.Printf("🔧 [MCP] Qwen 使用自定义 BaseURL: %s", customURL)
-	} else {
-		client.BaseURL = "https://dashscope.aliyuncs.com/compatible-mode/v1"
-		log.Printf("🔧 [MCP] Qwen 使用默认 BaseURL: %s", client.BaseURL)
+// NewClient 创建客户端（支持选项模式）
+//
+// 使用示例：
+//   // 基础用法（向前兼容）
+//   client := mcp.NewClient()
+//
+//   // 自定义日志
+//   client := mcp.NewClient(mcp.WithLogger(customLogger))
+//
+//   // 自定义超时
+//   client := mcp.NewClient(mcp.WithTimeout(60*time.Second))
+//
+//   // 组合多个选项
+//   client := mcp.NewClient(
+//       mcp.WithDeepSeekConfig("sk-xxx"),
+//       mcp.WithLogger(customLogger),
+//       mcp.WithTimeout(60*time.Second),
+//   )
+func NewClient(opts ...ClientOption) AIClient {
+	// 1. 创建默认配置
+	cfg := DefaultConfig()
+
+	// 2. 应用用户选项
+	for _, opt := range opts {
+		opt(cfg)
 	}
-	if customModel != "" {
-		client.Model = customModel
-		log.Printf("🔧 [MCP] Qwen 使用自定义 Model: %s", customModel)
-	} else {
-		client.Model = "qwen3-max"
-		log.Printf("🔧 [MCP] Qwen 使用默认 Model: %s", client.Model)
+
+	// 3. 创建客户端实例
+	client := &Client{
+		Provider:   cfg.Provider,
+		APIKey:     cfg.APIKey,
+		BaseURL:    cfg.BaseURL,
+		Model:      cfg.Model,
+		MaxTokens:  cfg.MaxTokens,
+		UseFullURL: cfg.UseFullURL,
+		httpClient: cfg.HTTPClient,
+		logger:     cfg.Logger,
+		config:     cfg,
 	}
-	// 打印 API Key 的前后各4位用于验证
-	if len(apiKey) > 8 {
-		log.Printf("🔧 [MCP] Qwen API Key: %s...%s", apiKey[:4], apiKey[len(apiKey)-4:])
+
+	// 4. 设置默认 Provider（如果未设置）
+	if client.Provider == "" {
+		client.Provider = ProviderDeepSeek
+		client.BaseURL = DefaultDeepSeekBaseURL
+		client.Model = DefaultDeepSeekModel
 	}
+
+	// 5. 设置 hooks 指向自己
+	client.hooks = client
+
+	return client
 }
 
 // SetCustomAPI 设置自定义OpenAI兼容API
-func (client *Client) SetCustomAPI(apiURL, apiKey, modelName string) {
+func (client *Client) SetAPIKey(apiKey, apiURL, customModel string) {
 	client.Provider = ProviderCustom
 	client.APIKey = apiKey
 
@@ -119,51 +126,47 @@ func (client *Client) SetCustomAPI(apiURL, apiKey, modelName string) {
 		client.UseFullURL = false
 	}
 
-	client.Model = modelName
-	client.Timeout = 120 * time.Second
+	client.Model = customModel
 }
 
-// SetClient 设置完整的AI配置（高级用户）
-func (client *Client) SetClient(Client Client) {
-	if Client.Timeout == 0 {
-		Client.Timeout = 30 * time.Second
-	}
-	client = &Client
+func (client *Client) SetTimeout(timeout time.Duration) {
+	client.httpClient.Timeout = timeout
 }
 
-// CallWithMessages 使用 system + user prompt 调用AI API（推荐）
+// CallWithMessages 模板方法 - 固定的重试流程（不可重写）
 func (client *Client) CallWithMessages(systemPrompt, userPrompt string) (string, error) {
 	if client.APIKey == "" {
-		return "", fmt.Errorf("AI API密钥未设置，请先调用 SetDeepSeekAPIKey() 或 SetQwenAPIKey()")
+		return "", fmt.Errorf("AI API密钥未设置，请先调用 SetAPIKey")
 	}
 
-	// 重试配置
-	maxRetries := 3
+	// 固定的重试流程
 	var lastErr error
+	maxRetries := client.config.MaxRetries
 
 	for attempt := 1; attempt <= maxRetries; attempt++ {
 		if attempt > 1 {
-			fmt.Printf("⚠️  AI API调用失败，正在重试 (%d/%d)...\n", attempt, maxRetries)
+			client.logger.Warnf("⚠️  AI API调用失败，正在重试 (%d/%d)...", attempt, maxRetries)
 		}
 
-		result, err := client.callOnce(systemPrompt, userPrompt)
+		// 调用固定的单次调用流程
+		result, err := client.hooks.call(systemPrompt, userPrompt)
 		if err == nil {
 			if attempt > 1 {
-				fmt.Printf("✓ AI API重试成功\n")
+				client.logger.Infof("✓ AI API重试成功")
 			}
 			return result, nil
 		}
 
 		lastErr = err
-		// 如果不是网络错误，不重试
-		if !isRetryableError(err) {
+		// 通过 hooks 判断是否可重试（支持子类自定义重试策略）
+		if !client.hooks.isRetryableError(err) {
 			return "", err
 		}
 
 		// 重试前等待
 		if attempt < maxRetries {
-			waitTime := time.Duration(attempt) * 2 * time.Second
-			fmt.Printf("⏳ 等待%v后重试...\n", waitTime)
+			waitTime := client.config.RetryWaitBase * time.Duration(attempt)
+			client.logger.Infof("⏳ 等待%v后重试...", waitTime)
 			time.Sleep(waitTime)
 		}
 	}
@@ -171,18 +174,11 @@ func (client *Client) CallWithMessages(systemPrompt, userPrompt string) (string,
 	return "", fmt.Errorf("重试%d次后仍然失败: %w", maxRetries, lastErr)
 }
 
-// callOnce 单次调用AI API（内部使用）
-func (client *Client) callOnce(systemPrompt, userPrompt string) (string, error) {
-	// 打印当前 AI 配置
-	log.Printf("📡 [MCP] AI 请求配置:")
-	log.Printf("   Provider: %s", client.Provider)
-	log.Printf("   BaseURL: %s", client.BaseURL)
-	log.Printf("   Model: %s", client.Model)
-	log.Printf("   UseFullURL: %v", client.UseFullURL)
-	if len(client.APIKey) > 8 {
-		log.Printf("   API Key: %s...%s", client.APIKey[:4], client.APIKey[len(client.APIKey)-4:])
-	}
+func (client *Client) setAuthHeader(reqHeader http.Header) {
+	reqHeader.Set("Authorization", fmt.Sprintf("Bearer %s", client.APIKey))
+}
 
+func (client *Client) buildMCPRequestBody(systemPrompt, userPrompt string) map[string]any {
 	// 构建 messages 数组
 	messages := []map[string]string{}
 
@@ -193,7 +189,6 @@ func (client *Client) callOnce(systemPrompt, userPrompt string) (string, error)
 			"content": systemPrompt,
 		})
 	}
-
 	// 添加 user message
 	messages = append(messages, map[string]string{
 		"role":    "user",
@@ -204,104 +199,310 @@ func (client *Client) callOnce(systemPrompt, userPrompt string) (string, error)
 	requestBody := map[string]interface{}{
 		"model":       client.Model,
 		"messages":    messages,
-		"temperature": 0.5, // 降低temperature以提高JSON格式稳定性
+		"temperature": client.config.Temperature, // 使用配置的 temperature
 		"max_tokens":  client.MaxTokens,
 	}
+	return requestBody
+}
 
-	// 注意：response_format 参数仅 OpenAI 支持，DeepSeek/Qwen 不支持
-	// 我们通过强化 prompt 和后处理来确保 JSON 格式正确
-
+// can be used to marshal the request body and can be overridden
+func (client *Client) marshalRequestBody(requestBody map[string]any) ([]byte, error) {
 	jsonData, err := json.Marshal(requestBody)
 	if err != nil {
-		return "", fmt.Errorf("序列化请求失败: %w", err)
+		return nil, fmt.Errorf("序列化请求失败: %w", err)
+	}
+	return jsonData, nil
+}
+
+func (client *Client) parseMCPResponse(body []byte) (string, error) {
+	var result struct {
+		Choices []struct {
+			Message struct {
+				Content string `json:"content"`
+			} `json:"message"`
+		} `json:"choices"`
 	}
 
-	// 创建HTTP请求
-	var url string
+	if err := json.Unmarshal(body, &result); err != nil {
+		return "", fmt.Errorf("解析响应失败: %w", err)
+	}
+
+	if len(result.Choices) == 0 {
+		return "", fmt.Errorf("API返回空响应")
+	}
+
+	return result.Choices[0].Message.Content, nil
+}
+
+func (client *Client) buildUrl() string {
 	if client.UseFullURL {
-		// 使用完整URL，不添加/chat/completions
-		url = client.BaseURL
-	} else {
-		// 默认行为：添加/chat/completions
-		url = fmt.Sprintf("%s/chat/completions", client.BaseURL)
+		return client.BaseURL
 	}
-	log.Printf("📡 [MCP] 请求 URL: %s", url)
+	return fmt.Sprintf("%s/chat/completions", client.BaseURL)
+}
 
+func (client *Client) buildRequest(url string, jsonData []byte) (*http.Request, error) {
+	// Create HTTP request
 	req, err := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
 	if err != nil {
-		return "", fmt.Errorf("创建请求失败: %w", err)
+		return nil, fmt.Errorf("fail to build request: %w", err)
 	}
 
 	req.Header.Set("Content-Type", "application/json")
 
-	// 根据不同的Provider设置认证方式
-	switch client.Provider {
-	case ProviderDeepSeek:
-		req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", client.APIKey))
-	case ProviderQwen:
-		// 阿里云Qwen使用API-Key认证
-		req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", client.APIKey))
-		// 注意：如果使用的不是兼容模式，可能需要不同的认证方式
-	default:
-		req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", client.APIKey))
-	}
-
-	// 发送请求
-	httpClient := &http.Client{Timeout: client.Timeout}
-	resp, err := httpClient.Do(req)
+	// 通过 hooks 设置认证头（支持子类重写）
+	client.hooks.setAuthHeader(req.Header)
+
+	return req, nil
+}
+
+// call 单次调用AI API（固定流程，不可重写）
+func (client *Client) call(systemPrompt, userPrompt string) (string, error) {
+	// 打印当前 AI 配置
+	client.logger.Infof("📡 [%s] Request AI Server: BaseURL: %s", client.String(), client.BaseURL)
+	client.logger.Debugf("[%s] UseFullURL: %v", client.String(), client.UseFullURL)
+	if len(client.APIKey) > 8 {
+		client.logger.Debugf("[%s]   API Key: %s...%s", client.String(), client.APIKey[:4], client.APIKey[len(client.APIKey)-4:])
+	}
+
+	// Step 1: 构建请求体（通过 hooks 实现动态分派）
+	requestBody := client.hooks.buildMCPRequestBody(systemPrompt, userPrompt)
+
+	// Step 2: 序列化请求体（通过 hooks 实现动态分派）
+	jsonData, err := client.hooks.marshalRequestBody(requestBody)
+	if err != nil {
+		return "", err
+	}
+
+	// Step 3: 构建 URL（通过 hooks 实现动态分派）
+	url := client.hooks.buildUrl()
+	client.logger.Infof("📡 [MCP %s] 请求 URL: %s", client.String(), url)
+
+	// Step 4: 创建 HTTP 请求（固定逻辑）
+	req, err := client.hooks.buildRequest(url, jsonData)
+	if err != nil {
+		return "", fmt.Errorf("创建请求失败: %w", err)
+	}
+
+	// Step 5: 发送 HTTP 请求（固定逻辑）
+	resp, err := client.httpClient.Do(req)
 	if err != nil {
 		return "", fmt.Errorf("发送请求失败: %w", err)
 	}
 	defer resp.Body.Close()
 
-	// 读取响应
+	// Step 6: 读取响应体（固定逻辑）
 	body, err := io.ReadAll(resp.Body)
 	if err != nil {
 		return "", fmt.Errorf("读取响应失败: %w", err)
 	}
 
+	// Step 7: 检查 HTTP 状态码（固定逻辑）
 	if resp.StatusCode != http.StatusOK {
 		return "", fmt.Errorf("API返回错误 (status %d): %s", resp.StatusCode, string(body))
 	}
 
-	// 解析响应
-	var result struct {
-		Choices []struct {
-			Message struct {
-				Content string `json:"content"`
-			} `json:"message"`
-		} `json:"choices"`
-	}
-
-	if err := json.Unmarshal(body, &result); err != nil {
-		return "", fmt.Errorf("解析响应失败: %w", err)
+	// Step 8: 解析响应（通过 hooks 实现动态分派）
+	result, err := client.hooks.parseMCPResponse(body)
+	if err != nil {
+		return "", fmt.Errorf("fail to parse AI server response: %w", err)
 	}
 
-	if len(result.Choices) == 0 {
-		return "", fmt.Errorf("API返回空响应")
-	}
+	return result, nil
+}
 
-	return result.Choices[0].Message.Content, nil
+func (client *Client) String() string {
+	return fmt.Sprintf("[Provider: %s, Model: %s]",
+		client.Provider, client.Model)
 }
 
-// isRetryableError 判断错误是否可重试
-func isRetryableError(err error) bool {
+// isRetryableError 判断错误是否可重试（网络错误、超时等）
+func (client *Client) isRetryableError(err error) bool {
 	errStr := err.Error()
 	// 网络错误、超时、EOF等可以重试
-	retryableErrors := []string{
-		"EOF",
-		"timeout",
-		"connection reset",
-		"connection refused",
-		"temporary failure",
-		"no such host",
-		"stream error",   // HTTP/2 stream 错误
-		"INTERNAL_ERROR", // 服务端内部错误
-	}
-	for _, retryable := range retryableErrors {
+	for _, retryable := range client.config.RetryableErrors {
 		if strings.Contains(errStr, retryable) {
 			return true
 		}
 	}
 	return false
 }
+
+// ============================================================
+// 构建器模式 API（高级功能）
+// ============================================================
+
+// CallWithRequest 使用 Request 对象调用 AI API（支持高级功能）
+//
+// 此方法支持：
+// - 多轮对话历史
+// - 精细参数控制（temperature、top_p、penalties 等）
+// - Function Calling / Tools
+// - 流式响应（未来支持）
+//
+// 使用示例：
+//   request := NewRequestBuilder().
+//       WithSystemPrompt("You are helpful").
+//       WithUserPrompt("Hello").
+//       WithTemperature(0.8).
+//       Build()
+//   result, err := client.CallWithRequest(request)
+func (client *Client) CallWithRequest(req *Request) (string, error) {
+	if client.APIKey == "" {
+		return "", fmt.Errorf("AI API密钥未设置，请先调用 SetAPIKey")
+	}
+
+	// 如果 Request 中没有设置 Model，使用 Client 的 Model
+	if req.Model == "" {
+		req.Model = client.Model
+	}
+
+	// 固定的重试流程
+	var lastErr error
+	maxRetries := client.config.MaxRetries
+
+	for attempt := 1; attempt <= maxRetries; attempt++ {
+		if attempt > 1 {
+			client.logger.Warnf("⚠️  AI API调用失败，正在重试 (%d/%d)...", attempt, maxRetries)
+		}
+
+		// 调用单次请求
+		result, err := client.callWithRequest(req)
+		if err == nil {
+			if attempt > 1 {
+				client.logger.Infof("✓ AI API重试成功")
+			}
+			return result, nil
+		}
+
+		lastErr = err
+		// 判断是否可重试
+		if !client.hooks.isRetryableError(err) {
+			return "", err
+		}
+
+		// 重试前等待
+		if attempt < maxRetries {
+			waitTime := client.config.RetryWaitBase * time.Duration(attempt)
+			client.logger.Infof("⏳ 等待%v后重试...", waitTime)
+			time.Sleep(waitTime)
+		}
+	}
+
+	return "", fmt.Errorf("重试%d次后仍然失败: %w", maxRetries, lastErr)
+}
+
+// callWithRequest 单次调用 AI API（使用 Request 对象）
+func (client *Client) callWithRequest(req *Request) (string, error) {
+	// 打印当前 AI 配置
+	client.logger.Infof("📡 [%s] Request AI Server with Builder: BaseURL: %s", client.String(), client.BaseURL)
+	client.logger.Debugf("[%s] Messages count: %d", client.String(), len(req.Messages))
+
+	// 构建请求体（从 Request 对象）
+	requestBody := client.buildRequestBodyFromRequest(req)
+
+	// 序列化请求体
+	jsonData, err := client.hooks.marshalRequestBody(requestBody)
+	if err != nil {
+		return "", err
+	}
+
+	// 构建 URL
+	url := client.hooks.buildUrl()
+	client.logger.Infof("📡 [MCP %s] 请求 URL: %s", client.String(), url)
+
+	// 创建 HTTP 请求
+	httpReq, err := client.hooks.buildRequest(url, jsonData)
+	if err != nil {
+		return "", fmt.Errorf("创建请求失败: %w", err)
+	}
+
+	// 发送 HTTP 请求
+	resp, err := client.httpClient.Do(httpReq)
+	if err != nil {
+		return "", fmt.Errorf("发送请求失败: %w", err)
+	}
+	defer resp.Body.Close()
+
+	// 读取响应体
+	body, err := io.ReadAll(resp.Body)
+	if err != nil {
+		return "", fmt.Errorf("读取响应失败: %w", err)
+	}
+
+	// 检查 HTTP 状态码
+	if resp.StatusCode != http.StatusOK {
+		return "", fmt.Errorf("API返回错误 (status %d): %s", resp.StatusCode, string(body))
+	}
+
+	// 解析响应
+	result, err := client.hooks.parseMCPResponse(body)
+	if err != nil {
+		return "", fmt.Errorf("fail to parse AI server response: %w", err)
+	}
+
+	return result, nil
+}
+
+// buildRequestBodyFromRequest 从 Request 对象构建请求体
+func (client *Client) buildRequestBodyFromRequest(req *Request) map[string]any {
+	// 转换 Message 为 API 格式
+	messages := make([]map[string]string, 0, len(req.Messages))
+	for _, msg := range req.Messages {
+		messages = append(messages, map[string]string{
+			"role":    msg.Role,
+			"content": msg.Content,
+		})
+	}
+
+	// 构建基础请求体
+	requestBody := map[string]interface{}{
+		"model":    req.Model,
+		"messages": messages,
+	}
+
+	// 添加可选参数（只添加非 nil 的参数）
+	if req.Temperature != nil {
+		requestBody["temperature"] = *req.Temperature
+	} else {
+		// 如果 Request 中没有设置，使用 Client 的配置
+		requestBody["temperature"] = client.config.Temperature
+	}
+
+	if req.MaxTokens != nil {
+		requestBody["max_tokens"] = *req.MaxTokens
+	} else {
+		// 如果 Request 中没有设置，使用 Client 的 MaxTokens
+		requestBody["max_tokens"] = client.MaxTokens
+	}
+
+	if req.TopP != nil {
+		requestBody["top_p"] = *req.TopP
+	}
+
+	if req.FrequencyPenalty != nil {
+		requestBody["frequency_penalty"] = *req.FrequencyPenalty
+	}
+
+	if req.PresencePenalty != nil {
+		requestBody["presence_penalty"] = *req.PresencePenalty
+	}
+
+	if len(req.Stop) > 0 {
+		requestBody["stop"] = req.Stop
+	}
+
+	if len(req.Tools) > 0 {
+		requestBody["tools"] = req.Tools
+	}
+
+	if req.ToolChoice != "" {
+		requestBody["tool_choice"] = req.ToolChoice
+	}
+
+	if req.Stream {
+		requestBody["stream"] = true
+	}
+
+	return requestBody
+}
diff --git a/mcp/client_test.go b/mcp/client_test.go
new file mode 100644
index 00000000..4a0e9e46
--- /dev/null
+++ b/mcp/client_test.go
@@ -0,0 +1,419 @@
+package mcp
+
+import (
+	"errors"
+	"net/http"
+	"testing"
+	"time"
+)
+
+// ============================================================
+// 测试 Client 创建和配置
+// ============================================================
+
+func TestNewClient_Default(t *testing.T) {
+	client := NewClient()
+
+	if client == nil {
+		t.Fatal("client should not be nil")
+	}
+
+	c := client.(*Client)
+	if c.Provider == "" {
+		t.Error("Provider should have default value")
+	}
+
+	if c.MaxTokens <= 0 {
+		t.Error("MaxTokens should be positive")
+	}
+
+	if c.logger == nil {
+		t.Error("logger should not be nil")
+	}
+
+	if c.httpClient == nil {
+		t.Error("httpClient should not be nil")
+	}
+
+	if c.hooks == nil {
+		t.Error("hooks should not be nil")
+	}
+}
+
+func TestNewClient_WithOptions(t *testing.T) {
+	mockLogger := NewMockLogger()
+	mockHTTP := &http.Client{Timeout: 30 * time.Second}
+
+	client := NewClient(
+		WithLogger(mockLogger),
+		WithHTTPClient(mockHTTP),
+		WithMaxTokens(4000),
+		WithTimeout(60*time.Second),
+		WithAPIKey("test-key"),
+	)
+
+	c := client.(*Client)
+
+	if c.logger != mockLogger {
+		t.Error("logger should be set from option")
+	}
+
+	if c.httpClient != mockHTTP {
+		t.Error("httpClient should be set from option")
+	}
+
+	if c.MaxTokens != 4000 {
+		t.Error("MaxTokens should be 4000")
+	}
+
+	if c.APIKey != "test-key" {
+		t.Error("APIKey should be test-key")
+	}
+}
+
+// ============================================================
+// 测试 CallWithMessages
+// ============================================================
+
+func TestClient_CallWithMessages_Success(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("AI response content")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("test-key"),
+		WithBaseURL("https://api.test.com"),
+	)
+
+	result, err := client.CallWithMessages("system prompt", "user prompt")
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	if result != "AI response content" {
+		t.Errorf("expected 'AI response content', got '%s'", result)
+	}
+
+	// 验证请求
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Errorf("expected 1 request, got %d", len(requests))
+	}
+
+	if len(requests) > 0 {
+		req := requests[0]
+		if req.Header.Get("Authorization") == "" {
+			t.Error("Authorization header should be set")
+		}
+		if req.Header.Get("Content-Type") != "application/json" {
+			t.Error("Content-Type should be application/json")
+		}
+	}
+}
+
+func TestClient_CallWithMessages_NoAPIKey(t *testing.T) {
+	client := NewClient()
+
+	_, err := client.CallWithMessages("system", "user")
+
+	if err == nil {
+		t.Error("should error when API key is not set")
+	}
+
+	if err.Error() != "AI API密钥未设置，请先调用 SetAPIKey" {
+		t.Errorf("unexpected error message: %v", err)
+	}
+}
+
+func TestClient_CallWithMessages_HTTPError(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetErrorResponse(500, "Internal Server Error")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("test-key"),
+	)
+
+	_, err := client.CallWithMessages("system", "user")
+
+	if err == nil {
+		t.Error("should error on HTTP error")
+	}
+}
+
+// ============================================================
+// 测试重试逻辑
+// ============================================================
+
+func TestClient_Retry_Success(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockLogger := NewMockLogger()
+
+	// 模拟：第一次失败，第二次成功
+	callCount := 0
+	mockHTTP.ResponseFunc = func(req *http.Request) (*http.Response, error) {
+		callCount++
+		if callCount == 1 {
+			return nil, errors.New("connection reset")
+		}
+		return &http.Response{
+			StatusCode: 200,
+			Body:       http.NoBody,
+		}, nil
+	}
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("test-key"),
+		WithMaxRetries(3),
+	)
+
+	// 由于我们的 client 使用 hooks.call，需要特殊处理
+	// 这里我们测试的是 CallWithMessages 会调用 retry 逻辑
+	c := client.(*Client)
+
+	// 临时修改重试等待时间为 0 以加速测试
+	oldRetries := MaxRetryTimes
+	MaxRetryTimes = 3
+	defer func() { MaxRetryTimes = oldRetries }()
+
+	_, err := c.CallWithMessages("system", "user")
+
+	// 第一次失败（connection reset），第二次成功，但是响应格式不对，会失败
+	// 但至少验证了重试逻辑被触发
+	if callCount < 2 {
+		t.Errorf("should retry, got %d calls", callCount)
+	}
+
+	// 检查日志中是否有重试信息
+	logs := mockLogger.GetLogsByLevel("WARN")
+	hasRetryLog := false
+	for _, log := range logs {
+		if log.Message == "⚠️  AI API调用失败，正在重试 (2/3)..." {
+			hasRetryLog = true
+			break
+		}
+	}
+
+	if !hasRetryLog && callCount >= 2 {
+		// 如果确实重试了，应该有警告日志
+		// 但由于我们的测试设置，可能不会触发，所以这里只是检查
+		t.Log("Retry was attempted")
+	}
+
+	_ = err // 忽略错误，我们主要测试重试逻辑被触发
+}
+
+func TestClient_Retry_NonRetryableError(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetErrorResponse(400, "Bad Request")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("test-key"),
+	)
+
+	_, err := client.CallWithMessages("system", "user")
+
+	if err == nil {
+		t.Error("should error")
+	}
+
+	// 验证没有重试（因为 400 不是可重试错误）
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Errorf("should not retry for 400 error, got %d requests", len(requests))
+	}
+}
+
+// ============================================================
+// 测试钩子方法
+// ============================================================
+
+func TestClient_BuildMCPRequestBody(t *testing.T) {
+	client := NewClient()
+	c := client.(*Client)
+
+	body := c.buildMCPRequestBody("system prompt", "user prompt")
+
+	if body == nil {
+		t.Fatal("body should not be nil")
+	}
+
+	if body["model"] == nil {
+		t.Error("body should have model field")
+	}
+
+	messages, ok := body["messages"].([]map[string]string)
+	if !ok {
+		t.Fatal("messages should be []map[string]string")
+	}
+
+	if len(messages) != 2 {
+		t.Errorf("expected 2 messages, got %d", len(messages))
+	}
+
+	if messages[0]["role"] != "system" {
+		t.Error("first message should be system")
+	}
+
+	if messages[1]["role"] != "user" {
+		t.Error("second message should be user")
+	}
+}
+
+func TestClient_BuildUrl(t *testing.T) {
+	tests := []struct {
+		name       string
+		baseURL    string
+		useFullURL bool
+		expected   string
+	}{
+		{
+			name:       "normal URL",
+			baseURL:    "https://api.test.com/v1",
+			useFullURL: false,
+			expected:   "https://api.test.com/v1/chat/completions",
+		},
+		{
+			name:       "full URL",
+			baseURL:    "https://api.test.com/custom/endpoint",
+			useFullURL: true,
+			expected:   "https://api.test.com/custom/endpoint",
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			client := NewClient(
+				WithProvider("test-provider"), // Prevent default DeepSeek settings
+				WithBaseURL(tt.baseURL),
+				WithUseFullURL(tt.useFullURL),
+			)
+			c := client.(*Client)
+
+			url := c.buildUrl()
+			if url != tt.expected {
+				t.Errorf("expected '%s', got '%s'", tt.expected, url)
+			}
+		})
+	}
+}
+
+func TestClient_SetAuthHeader(t *testing.T) {
+	client := NewClient(WithAPIKey("test-api-key"))
+	c := client.(*Client)
+
+	headers := make(http.Header)
+	c.setAuthHeader(headers)
+
+	authHeader := headers.Get("Authorization")
+	if authHeader != "Bearer test-api-key" {
+		t.Errorf("expected 'Bearer test-api-key', got '%s'", authHeader)
+	}
+}
+
+func TestClient_IsRetryableError(t *testing.T) {
+	client := NewClient()
+	c := client.(*Client)
+
+	tests := []struct {
+		name     string
+		err      error
+		expected bool
+	}{
+		{
+			name:     "EOF error",
+			err:      errors.New("unexpected EOF"),
+			expected: true,
+		},
+		{
+			name:     "timeout error",
+			err:      errors.New("timeout exceeded"),
+			expected: true,
+		},
+		{
+			name:     "connection reset",
+			err:      errors.New("connection reset by peer"),
+			expected: true,
+		},
+		{
+			name:     "normal error",
+			err:      errors.New("bad request"),
+			expected: false,
+		},
+		{
+			name:     "validation error",
+			err:      errors.New("invalid input"),
+			expected: false,
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			result := c.isRetryableError(tt.err)
+			if result != tt.expected {
+				t.Errorf("expected %v, got %v", tt.expected, result)
+			}
+		})
+	}
+}
+
+// ============================================================
+// 测试 SetTimeout
+// ============================================================
+
+func TestClient_SetTimeout(t *testing.T) {
+	client := NewClient()
+
+	newTimeout := 90 * time.Second
+	client.SetTimeout(newTimeout)
+
+	c := client.(*Client)
+	if c.httpClient.Timeout != newTimeout {
+		t.Errorf("expected timeout %v, got %v", newTimeout, c.httpClient.Timeout)
+	}
+}
+
+// ============================================================
+// 测试 String 方法
+// ============================================================
+
+func TestClient_String(t *testing.T) {
+	client := NewClient(
+		WithProvider("test-provider"),
+		WithModel("test-model"),
+	)
+
+	c := client.(*Client)
+	str := c.String()
+
+	expectedContains := []string{"test-provider", "test-model"}
+	for _, exp := range expectedContains {
+		if !contains(str, exp) {
+			t.Errorf("String() should contain '%s', got '%s'", exp, str)
+		}
+	}
+}
+
+// 辅助函数
+func contains(s, substr string) bool {
+	return len(s) >= len(substr) && (s == substr || len(s) > len(substr) && findSubstring(s, substr))
+}
+
+func findSubstring(s, substr string) bool {
+	for i := 0; i <= len(s)-len(substr); i++ {
+		if s[i:i+len(substr)] == substr {
+			return true
+		}
+	}
+	return false
+}
diff --git a/mcp/config.go b/mcp/config.go
new file mode 100644
index 00000000..a32686a5
--- /dev/null
+++ b/mcp/config.go
@@ -0,0 +1,69 @@
+package mcp
+
+import (
+	"net/http"
+	"os"
+	"strconv"
+	"time"
+)
+
+// Config 客户端配置（集中管理所有配置）
+type Config struct {
+	// Provider 配置
+	Provider string
+	APIKey   string
+	BaseURL  string
+	Model    string
+
+	// 行为配置
+	MaxTokens   int
+	Temperature float64
+	UseFullURL  bool
+
+	// 重试配置
+	MaxRetries     int
+	RetryWaitBase  time.Duration
+	RetryableErrors []string
+
+	// 超时配置
+	Timeout time.Duration
+
+	// 依赖注入
+	Logger     Logger
+	HTTPClient *http.Client
+}
+
+// DefaultConfig 返回默认配置
+func DefaultConfig() *Config {
+	return &Config{
+		// 默认值
+		MaxTokens:      getEnvInt("AI_MAX_TOKENS", 2000),
+		Temperature:    MCPClientTemperature,
+		MaxRetries:     MaxRetryTimes,
+		RetryWaitBase:  2 * time.Second,
+		Timeout:        DefaultTimeout,
+		RetryableErrors: retryableErrors,
+
+		// 默认依赖
+		Logger:     &defaultLogger{},
+		HTTPClient: &http.Client{Timeout: DefaultTimeout},
+	}
+}
+
+// getEnvInt 从环境变量读取整数，失败则返回默认值
+func getEnvInt(key string, defaultValue int) int {
+	if val := os.Getenv(key); val != "" {
+		if parsed, err := strconv.Atoi(val); err == nil && parsed > 0 {
+			return parsed
+		}
+	}
+	return defaultValue
+}
+
+// getEnvString 从环境变量读取字符串，为空则返回默认值
+func getEnvString(key string, defaultValue string) string {
+	if val := os.Getenv(key); val != "" {
+		return val
+	}
+	return defaultValue
+}
diff --git a/mcp/config_usage_test.go b/mcp/config_usage_test.go
new file mode 100644
index 00000000..0972cb20
--- /dev/null
+++ b/mcp/config_usage_test.go
@@ -0,0 +1,262 @@
+package mcp
+
+import (
+	"bytes"
+	"encoding/json"
+	"errors"
+	"io"
+	"net/http"
+	"testing"
+	"time"
+)
+
+// ============================================================
+// 测试 Config 字段真正被使用（验证问题2修复）
+// ============================================================
+
+func TestConfig_MaxRetries_IsUsed(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockLogger := NewMockLogger()
+
+	// 设置 HTTP 客户端返回错误
+	callCount := 0
+	mockHTTP.ResponseFunc = func(req *http.Request) (*http.Response, error) {
+		callCount++
+		return nil, errors.New("connection reset")
+	}
+
+	// 创建客户端并设置自定义重试次数为 5
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+		WithMaxRetries(5), // ✅ 设置重试5次
+	)
+
+	// 调用 API（应该失败）
+	_, err := client.CallWithMessages("system", "user")
+
+	if err == nil {
+		t.Error("should error")
+	}
+
+	// 验证确实重试了5次（而不是默认的3次）
+	if callCount != 5 {
+		t.Errorf("expected 5 retry attempts (from WithMaxRetries(5)), got %d", callCount)
+	}
+
+	// 验证日志中显示正确的重试次数
+	logs := mockLogger.GetLogsByLevel("WARN")
+	expectedWarningCount := 4 // 第2、3、4、5次重试时会打印警告
+	actualWarningCount := 0
+	for _, log := range logs {
+		if log.Message == "⚠️  AI API调用失败，正在重试 (2/5)..." ||
+			log.Message == "⚠️  AI API调用失败，正在重试 (3/5)..." ||
+			log.Message == "⚠️  AI API调用失败，正在重试 (4/5)..." ||
+			log.Message == "⚠️  AI API调用失败，正在重试 (5/5)..." {
+			actualWarningCount++
+		}
+	}
+
+	if actualWarningCount != expectedWarningCount {
+		t.Errorf("expected %d warning logs, got %d", expectedWarningCount, actualWarningCount)
+		for _, log := range logs {
+			t.Logf("  WARN: %s", log.Message)
+		}
+	}
+}
+
+func TestConfig_Temperature_IsUsed(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("AI response")
+	mockLogger := NewMockLogger()
+
+	customTemperature := 0.8
+
+	// 创建客户端并设置自定义 temperature
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+		WithTemperature(customTemperature), // ✅ 设置自定义 temperature
+	)
+
+	c := client.(*Client)
+
+	// 构建请求体
+	requestBody := c.buildMCPRequestBody("system", "user")
+
+	// 验证 temperature 字段
+	temp, ok := requestBody["temperature"].(float64)
+	if !ok {
+		t.Fatal("temperature should be float64")
+	}
+
+	if temp != customTemperature {
+		t.Errorf("expected temperature %f (from WithTemperature), got %f", customTemperature, temp)
+	}
+
+	// 也可以通过实际 HTTP 请求验证
+	_, err := client.CallWithMessages("system", "user")
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	// 检查发送的请求体
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Fatalf("expected 1 request, got %d", len(requests))
+	}
+
+	// 解析请求体
+	var body map[string]interface{}
+	decoder := json.NewDecoder(requests[0].Body)
+	if err := decoder.Decode(&body); err != nil {
+		t.Fatalf("failed to decode request body: %v", err)
+	}
+
+	// 验证 temperature
+	if body["temperature"] != customTemperature {
+		t.Errorf("expected temperature %f in HTTP request, got %v", customTemperature, body["temperature"])
+	}
+}
+
+func TestConfig_RetryWaitBase_IsUsed(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockLogger := NewMockLogger()
+
+	// 设置成功响应（在 ResponseFunc 之前）
+	mockHTTP.SetSuccessResponse("AI response")
+
+	// 设置 HTTP 客户端前2次返回错误，第3次成功
+	callCount := 0
+	successResponse := mockHTTP.Response // 保存成功响应字符串
+	mockHTTP.ResponseFunc = func(req *http.Request) (*http.Response, error) {
+		callCount++
+		if callCount <= 2 {
+			return nil, errors.New("timeout exceeded")
+		}
+		// 第3次返回成功响应
+		return &http.Response{
+			StatusCode: 200,
+			Body:       io.NopCloser(bytes.NewBufferString(successResponse)),
+			Header:     make(http.Header),
+		}, nil
+	}
+
+	// 设置自定义重试等待基数为 1 秒（而不是默认的 2 秒）
+	customWaitBase := 1 * time.Second
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+		WithRetryWaitBase(customWaitBase), // ✅ 设置自定义等待时间
+		WithMaxRetries(3),
+	)
+
+	// 记录开始时间
+	start := time.Now()
+
+	// 调用 API
+	_, err := client.CallWithMessages("system", "user")
+
+	// 记录结束时间
+	elapsed := time.Since(start)
+
+	// 第3次成功，但前面失败了2次
+	if err != nil {
+		t.Fatalf("should succeed on 3rd attempt, got error: %v", err)
+	}
+
+	if callCount != 3 {
+		t.Errorf("expected 3 attempts, got %d", callCount)
+	}
+
+	// 验证等待时间
+	// 第1次失败后等待 1s (customWaitBase * 1)
+	// 第2次失败后等待 2s (customWaitBase * 2)
+	// 总等待时间应该约为 3s (允许一些误差)
+	expectedWait := 3 * time.Second
+	tolerance := 200 * time.Millisecond
+
+	if elapsed < expectedWait-tolerance || elapsed > expectedWait+tolerance {
+		t.Errorf("expected total time ~%v (with RetryWaitBase=%v), got %v", expectedWait, customWaitBase, elapsed)
+	}
+}
+
+func TestConfig_RetryableErrors_IsUsed(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockLogger := NewMockLogger()
+
+	// 自定义可重试错误列表（只包含 "custom error"）
+	customRetryableErrors := []string{"custom error"}
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	c := client.(*Client)
+
+	// 修改 config 的 RetryableErrors（暂时没有 WithRetryableErrors 选项）
+	c.config.RetryableErrors = customRetryableErrors
+
+	tests := []struct {
+		name      string
+		err       error
+		retryable bool
+	}{
+		{
+			name:      "custom error should be retryable",
+			err:       errors.New("custom error occurred"),
+			retryable: true,
+		},
+		{
+			name:      "EOF should NOT be retryable (not in custom list)",
+			err:       errors.New("unexpected EOF"),
+			retryable: false,
+		},
+		{
+			name:      "timeout should NOT be retryable (not in custom list)",
+			err:       errors.New("timeout exceeded"),
+			retryable: false,
+		},
+	}
+
+	for _, tt := range tests {
+		t.Run(tt.name, func(t *testing.T) {
+			result := c.isRetryableError(tt.err)
+			if result != tt.retryable {
+				t.Errorf("expected isRetryableError(%v) = %v, got %v", tt.err, tt.retryable, result)
+			}
+		})
+	}
+}
+
+// ============================================================
+// 测试默认值
+// ============================================================
+
+func TestConfig_DefaultValues(t *testing.T) {
+	client := NewClient()
+	c := client.(*Client)
+
+	// 验证默认值
+	if c.config.MaxRetries != 3 {
+		t.Errorf("default MaxRetries should be 3, got %d", c.config.MaxRetries)
+	}
+
+	if c.config.Temperature != 0.5 {
+		t.Errorf("default Temperature should be 0.5, got %f", c.config.Temperature)
+	}
+
+	if c.config.RetryWaitBase != 2*time.Second {
+		t.Errorf("default RetryWaitBase should be 2s, got %v", c.config.RetryWaitBase)
+	}
+
+	if len(c.config.RetryableErrors) == 0 {
+		t.Error("default RetryableErrors should not be empty")
+	}
+}
diff --git a/mcp/deepseek_client.go b/mcp/deepseek_client.go
new file mode 100644
index 00000000..62e28490
--- /dev/null
+++ b/mcp/deepseek_client.go
@@ -0,0 +1,83 @@
+package mcp
+
+import (
+	"net/http"
+)
+
+const (
+	ProviderDeepSeek       = "deepseek"
+	DefaultDeepSeekBaseURL = "https://api.deepseek.com/v1"
+	DefaultDeepSeekModel   = "deepseek-chat"
+)
+
+type DeepSeekClient struct {
+	*Client
+}
+
+// NewDeepSeekClient 创建 DeepSeek 客户端（向前兼容）
+//
+// Deprecated: 推荐使用 NewDeepSeekClientWithOptions 以获得更好的灵活性
+func NewDeepSeekClient() AIClient {
+	return NewDeepSeekClientWithOptions()
+}
+
+// NewDeepSeekClientWithOptions 创建 DeepSeek 客户端（支持选项模式）
+//
+// 使用示例：
+//   // 基础用法
+//   client := mcp.NewDeepSeekClientWithOptions()
+//
+//   // 自定义配置
+//   client := mcp.NewDeepSeekClientWithOptions(
+//       mcp.WithAPIKey("sk-xxx"),
+//       mcp.WithLogger(customLogger),
+//       mcp.WithTimeout(60*time.Second),
+//   )
+func NewDeepSeekClientWithOptions(opts ...ClientOption) AIClient {
+	// 1. 创建 DeepSeek 预设选项
+	deepseekOpts := []ClientOption{
+		WithProvider(ProviderDeepSeek),
+		WithModel(DefaultDeepSeekModel),
+		WithBaseURL(DefaultDeepSeekBaseURL),
+	}
+
+	// 2. 合并用户选项（用户选项优先级更高）
+	allOpts := append(deepseekOpts, opts...)
+
+	// 3. 创建基础客户端
+	baseClient := NewClient(allOpts...).(*Client)
+
+	// 4. 创建 DeepSeek 客户端
+	dsClient := &DeepSeekClient{
+		Client: baseClient,
+	}
+
+	// 5. 设置 hooks 指向 DeepSeekClient（实现动态分派）
+	baseClient.hooks = dsClient
+
+	return dsClient
+}
+
+func (dsClient *DeepSeekClient) SetAPIKey(apiKey string, customURL string, customModel string) {
+	dsClient.APIKey = apiKey
+
+	if len(apiKey) > 8 {
+		dsClient.logger.Infof("🔧 [MCP] DeepSeek API Key: %s...%s", apiKey[:4], apiKey[len(apiKey)-4:])
+	}
+	if customURL != "" {
+		dsClient.BaseURL = customURL
+		dsClient.logger.Infof("🔧 [MCP] DeepSeek 使用自定义 BaseURL: %s", customURL)
+	} else {
+		dsClient.logger.Infof("🔧 [MCP] DeepSeek 使用默认 BaseURL: %s", dsClient.BaseURL)
+	}
+	if customModel != "" {
+		dsClient.Model = customModel
+		dsClient.logger.Infof("🔧 [MCP] DeepSeek 使用自定义 Model: %s", customModel)
+	} else {
+		dsClient.logger.Infof("🔧 [MCP] DeepSeek 使用默认 Model: %s", dsClient.Model)
+	}
+}
+
+func (dsClient *DeepSeekClient) setAuthHeader(reqHeaders http.Header) {
+	dsClient.Client.setAuthHeader(reqHeaders)
+}
diff --git a/mcp/deepseek_client_test.go b/mcp/deepseek_client_test.go
new file mode 100644
index 00000000..8be91d52
--- /dev/null
+++ b/mcp/deepseek_client_test.go
@@ -0,0 +1,272 @@
+package mcp
+
+import (
+	"testing"
+	"time"
+)
+
+// ============================================================
+// 测试 DeepSeekClient 创建和配置
+// ============================================================
+
+func TestNewDeepSeekClient_Default(t *testing.T) {
+	client := NewDeepSeekClient()
+
+	if client == nil {
+		t.Fatal("client should not be nil")
+	}
+
+	// 类型断言检查
+	dsClient, ok := client.(*DeepSeekClient)
+	if !ok {
+		t.Fatal("client should be *DeepSeekClient")
+	}
+
+	// 验证默认值
+	if dsClient.Provider != ProviderDeepSeek {
+		t.Errorf("Provider should be '%s', got '%s'", ProviderDeepSeek, dsClient.Provider)
+	}
+
+	if dsClient.BaseURL != DefaultDeepSeekBaseURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", DefaultDeepSeekBaseURL, dsClient.BaseURL)
+	}
+
+	if dsClient.Model != DefaultDeepSeekModel {
+		t.Errorf("Model should be '%s', got '%s'", DefaultDeepSeekModel, dsClient.Model)
+	}
+
+	if dsClient.logger == nil {
+		t.Error("logger should not be nil")
+	}
+
+	if dsClient.httpClient == nil {
+		t.Error("httpClient should not be nil")
+	}
+}
+
+func TestNewDeepSeekClientWithOptions(t *testing.T) {
+	mockLogger := NewMockLogger()
+	customModel := "deepseek-v2"
+	customAPIKey := "sk-custom-key"
+
+	client := NewDeepSeekClientWithOptions(
+		WithLogger(mockLogger),
+		WithModel(customModel),
+		WithAPIKey(customAPIKey),
+		WithMaxTokens(4000),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	// 验证自定义选项被应用
+	if dsClient.logger != mockLogger {
+		t.Error("logger should be set from option")
+	}
+
+	if dsClient.Model != customModel {
+		t.Error("Model should be set from option")
+	}
+
+	if dsClient.APIKey != customAPIKey {
+		t.Error("APIKey should be set from option")
+	}
+
+	if dsClient.MaxTokens != 4000 {
+		t.Error("MaxTokens should be 4000")
+	}
+
+	// 验证 DeepSeek 默认值仍然保留
+	if dsClient.Provider != ProviderDeepSeek {
+		t.Errorf("Provider should still be '%s'", ProviderDeepSeek)
+	}
+
+	if dsClient.BaseURL != DefaultDeepSeekBaseURL {
+		t.Errorf("BaseURL should still be '%s'", DefaultDeepSeekBaseURL)
+	}
+}
+
+// ============================================================
+// 测试 SetAPIKey
+// ============================================================
+
+func TestDeepSeekClient_SetAPIKey(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewDeepSeekClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	// 测试设置 API Key（默认 URL 和 Model）
+	dsClient.SetAPIKey("sk-test-key-12345678", "", "")
+
+	if dsClient.APIKey != "sk-test-key-12345678" {
+		t.Errorf("APIKey should be 'sk-test-key-12345678', got '%s'", dsClient.APIKey)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	if len(logs) == 0 {
+		t.Error("should have logged API key setting")
+	}
+
+	// 验证 BaseURL 和 Model 保持默认
+	if dsClient.BaseURL != DefaultDeepSeekBaseURL {
+		t.Error("BaseURL should remain default")
+	}
+
+	if dsClient.Model != DefaultDeepSeekModel {
+		t.Error("Model should remain default")
+	}
+}
+
+func TestDeepSeekClient_SetAPIKey_WithCustomURL(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewDeepSeekClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	customURL := "https://custom.api.com/v1"
+	dsClient.SetAPIKey("sk-test-key-12345678", customURL, "")
+
+	if dsClient.BaseURL != customURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", customURL, dsClient.BaseURL)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	hasCustomURLLog := false
+	for _, log := range logs {
+		if log.Format == "🔧 [MCP] DeepSeek 使用自定义 BaseURL: %s" {
+			hasCustomURLLog = true
+			break
+		}
+	}
+
+	if !hasCustomURLLog {
+		t.Error("should have logged custom BaseURL")
+	}
+}
+
+func TestDeepSeekClient_SetAPIKey_WithCustomModel(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewDeepSeekClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	customModel := "deepseek-v3"
+	dsClient.SetAPIKey("sk-test-key-12345678", "", customModel)
+
+	if dsClient.Model != customModel {
+		t.Errorf("Model should be '%s', got '%s'", customModel, dsClient.Model)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	hasCustomModelLog := false
+	for _, log := range logs {
+		if log.Format == "🔧 [MCP] DeepSeek 使用自定义 Model: %s" {
+			hasCustomModelLog = true
+			break
+		}
+	}
+
+	if !hasCustomModelLog {
+		t.Error("should have logged custom Model")
+	}
+}
+
+// ============================================================
+// 测试集成功能
+// ============================================================
+
+func TestDeepSeekClient_CallWithMessages_Success(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("DeepSeek AI response")
+	mockLogger := NewMockLogger()
+
+	client := NewDeepSeekClientWithOptions(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	result, err := client.CallWithMessages("system prompt", "user prompt")
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	if result != "DeepSeek AI response" {
+		t.Errorf("expected 'DeepSeek AI response', got '%s'", result)
+	}
+
+	// 验证请求
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Fatalf("expected 1 request, got %d", len(requests))
+	}
+
+	req := requests[0]
+
+	// 验证 URL
+	expectedURL := DefaultDeepSeekBaseURL + "/chat/completions"
+	if req.URL.String() != expectedURL {
+		t.Errorf("expected URL '%s', got '%s'", expectedURL, req.URL.String())
+	}
+
+	// 验证 Authorization header
+	authHeader := req.Header.Get("Authorization")
+	if authHeader != "Bearer sk-test-key" {
+		t.Errorf("expected 'Bearer sk-test-key', got '%s'", authHeader)
+	}
+
+	// 验证 Content-Type
+	if req.Header.Get("Content-Type") != "application/json" {
+		t.Error("Content-Type should be application/json")
+	}
+}
+
+func TestDeepSeekClient_Timeout(t *testing.T) {
+	client := NewDeepSeekClientWithOptions(
+		WithTimeout(30 * time.Second),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	if dsClient.httpClient.Timeout != 30*time.Second {
+		t.Errorf("expected timeout 30s, got %v", dsClient.httpClient.Timeout)
+	}
+
+	// 测试 SetTimeout
+	client.SetTimeout(60 * time.Second)
+
+	if dsClient.httpClient.Timeout != 60*time.Second {
+		t.Errorf("expected timeout 60s after SetTimeout, got %v", dsClient.httpClient.Timeout)
+	}
+}
+
+// ============================================================
+// 测试 hooks 机制
+// ============================================================
+
+func TestDeepSeekClient_HooksIntegration(t *testing.T) {
+	client := NewDeepSeekClientWithOptions()
+	dsClient := client.(*DeepSeekClient)
+
+	// 验证 hooks 指向 dsClient 自己（实现多态）
+	if dsClient.hooks != dsClient {
+		t.Error("hooks should point to dsClient for polymorphism")
+	}
+
+	// 验证 buildUrl 使用 DeepSeek 配置
+	url := dsClient.buildUrl()
+	expectedURL := DefaultDeepSeekBaseURL + "/chat/completions"
+	if url != expectedURL {
+		t.Errorf("expected URL '%s', got '%s'", expectedURL, url)
+	}
+}
diff --git a/mcp/examples_test.go b/mcp/examples_test.go
new file mode 100644
index 00000000..2aa20829
--- /dev/null
+++ b/mcp/examples_test.go
@@ -0,0 +1,296 @@
+package mcp_test
+
+import (
+	"fmt"
+	"net/http"
+	"time"
+
+	"nofx/mcp"
+)
+
+// ============================================================
+// 示例 1: 基础用法（向前兼容）
+// ============================================================
+
+func Example_backward_compatible() {
+	// ✅ 旧代码继续工作，无需修改
+	client := mcp.New()
+	client.SetAPIKey("sk-xxx", "https://api.custom.com", "gpt-4")
+
+	// 使用
+	result, _ := client.CallWithMessages("system prompt", "user prompt")
+	fmt.Println(result)
+}
+
+func Example_deepseek_backward_compatible() {
+	// ✅ DeepSeek 旧代码继续工作
+	client := mcp.NewDeepSeekClient()
+	client.SetAPIKey("sk-xxx", "", "")
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 2: 新的推荐用法（选项模式）
+// ============================================================
+
+func Example_new_client_basic() {
+	// 使用默认配置
+	client := mcp.NewClient()
+
+	// 使用 DeepSeek
+	client = mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+	)
+
+	// 使用 Qwen
+	client = mcp.NewClient(
+		mcp.WithQwenConfig("sk-xxx"),
+	)
+
+	_ = client
+}
+
+func Example_new_client_with_options() {
+	// 组合多个选项
+	client := mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+		mcp.WithTimeout(60*time.Second),
+		mcp.WithMaxRetries(5),
+		mcp.WithMaxTokens(4000),
+		mcp.WithTemperature(0.7),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 3: 自定义日志器
+// ============================================================
+
+// CustomLogger 自定义日志器示例
+type CustomLogger struct{}
+
+func (l *CustomLogger) Debugf(format string, args ...any) {
+	fmt.Printf("[DEBUG] "+format+"\n", args...)
+}
+
+func (l *CustomLogger) Infof(format string, args ...any) {
+	fmt.Printf("[INFO] "+format+"\n", args...)
+}
+
+func (l *CustomLogger) Warnf(format string, args ...any) {
+	fmt.Printf("[WARN] "+format+"\n", args...)
+}
+
+func (l *CustomLogger) Errorf(format string, args ...any) {
+	fmt.Printf("[ERROR] "+format+"\n", args...)
+}
+
+func Example_custom_logger() {
+	// 使用自定义日志器
+	customLogger := &CustomLogger{}
+
+	client := mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+		mcp.WithLogger(customLogger),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+func Example_no_logger_for_testing() {
+	// 测试时禁用日志
+	client := mcp.NewClient(
+		mcp.WithLogger(mcp.NewNoopLogger()),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 4: 自定义 HTTP 客户端
+// ============================================================
+
+func Example_custom_http_client() {
+	// 自定义 HTTP 客户端（添加代理、TLS等）
+	customHTTP := &http.Client{
+		Timeout: 30 * time.Second,
+		Transport: &http.Transport{
+			Proxy: http.ProxyFromEnvironment,
+			// 自定义 TLS、连接池等
+		},
+	}
+
+	client := mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+		mcp.WithHTTPClient(customHTTP),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 5: DeepSeek 客户端（新 API）
+// ============================================================
+
+func Example_deepseek_new_api() {
+	// 基础用法
+	client := mcp.NewDeepSeekClientWithOptions(
+		mcp.WithAPIKey("sk-xxx"),
+	)
+
+	// 高级用法
+	client = mcp.NewDeepSeekClientWithOptions(
+		mcp.WithAPIKey("sk-xxx"),
+		mcp.WithLogger(&CustomLogger{}),
+		mcp.WithTimeout(90*time.Second),
+		mcp.WithMaxTokens(8000),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 6: Qwen 客户端（新 API）
+// ============================================================
+
+func Example_qwen_new_api() {
+	// 基础用法
+	client := mcp.NewQwenClientWithOptions(
+		mcp.WithAPIKey("sk-xxx"),
+	)
+
+	// 高级用法
+	client = mcp.NewQwenClientWithOptions(
+		mcp.WithAPIKey("sk-xxx"),
+		mcp.WithLogger(&CustomLogger{}),
+		mcp.WithTimeout(90*time.Second),
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 7: 在 trader/auto_trader.go 中的迁移示例
+// ============================================================
+
+func Example_trader_migration() {
+	// === 旧代码（继续工作）===
+	oldStyleClient := func(apiKey, customURL, customModel string) mcp.AIClient {
+		client := mcp.NewDeepSeekClient()
+		client.SetAPIKey(apiKey, customURL, customModel)
+		return client
+	}
+
+	// === 新代码（推荐）===
+	newStyleClient := func(apiKey, customURL, customModel string) mcp.AIClient {
+		opts := []mcp.ClientOption{
+			mcp.WithAPIKey(apiKey),
+		}
+
+		if customURL != "" {
+			opts = append(opts, mcp.WithBaseURL(customURL))
+		}
+
+		if customModel != "" {
+			opts = append(opts, mcp.WithModel(customModel))
+		}
+
+		return mcp.NewDeepSeekClientWithOptions(opts...)
+	}
+
+	// 两种方式都能工作
+	_ = oldStyleClient("sk-xxx", "", "")
+	_ = newStyleClient("sk-xxx", "", "")
+}
+
+// ============================================================
+// 示例 8: 测试场景
+// ============================================================
+
+// MockHTTPClient Mock HTTP 客户端
+type MockHTTPClient struct {
+	Response string
+}
+
+func (m *MockHTTPClient) Do(req *http.Request) (*http.Response, error) {
+	// 返回预设的响应
+	return &http.Response{
+		StatusCode: 200,
+		Body:       nil, // 实际测试中需要实现
+	}, nil
+}
+
+func Example_testing_with_mock() {
+	// 测试时使用 Mock
+	// mockHTTP := &MockHTTPClient{
+	// 	Response: `{"choices":[{"message":{"content":"test response"}}]}`,
+	// }
+
+	client := mcp.NewClient(
+		// mcp.WithHTTPClient(mockHTTP), // 实际测试中使用 mockHTTP
+		mcp.WithLogger(mcp.NewNoopLogger()), // 禁用日志
+	)
+
+	result, _ := client.CallWithMessages("system", "user")
+	fmt.Println(result)
+}
+
+// ============================================================
+// 示例 9: 环境特定配置
+// ============================================================
+
+func Example_environment_specific() {
+	// 开发环境：详细日志
+	devClient := mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+		mcp.WithLogger(&CustomLogger{}), // 详细日志
+	)
+
+	// 生产环境：结构化日志 + 超时保护
+	prodClient := mcp.NewClient(
+		mcp.WithDeepSeekConfig("sk-xxx"),
+		// mcp.WithLogger(&ZapLogger{}), // 生产级日志
+		mcp.WithTimeout(30*time.Second),
+		mcp.WithMaxRetries(3),
+	)
+
+	_, _ = devClient.CallWithMessages("system", "user")
+	_, _ = prodClient.CallWithMessages("system", "user")
+}
+
+// ============================================================
+// 示例 10: 完整实战示例
+// ============================================================
+
+func Example_real_world_usage() {
+	// 创建带有完整配置的客户端
+	client := mcp.NewDeepSeekClientWithOptions(
+		mcp.WithAPIKey("sk-xxxxxxxxxx"),
+		mcp.WithTimeout(60*time.Second),
+		mcp.WithMaxRetries(5),
+		mcp.WithMaxTokens(4000),
+		mcp.WithTemperature(0.5),
+		mcp.WithLogger(&CustomLogger{}),
+	)
+
+	// 使用客户端
+	systemPrompt := "你是一个专业的量化交易顾问"
+	userPrompt := "分析 BTC 当前走势"
+
+	result, err := client.CallWithMessages(systemPrompt, userPrompt)
+	if err != nil {
+		fmt.Printf("Error: %v\n", err)
+		return
+	}
+
+	fmt.Printf("AI 响应: %s\n", result)
+}
diff --git a/mcp/interface.go b/mcp/interface.go
new file mode 100644
index 00000000..e155ac01
--- /dev/null
+++ b/mcp/interface.go
@@ -0,0 +1,30 @@
+package mcp
+
+import (
+	"net/http"
+	"time"
+)
+
+// AIClient AI客户端公开接口（给外部使用）
+type AIClient interface {
+	SetAPIKey(apiKey string, customURL string, customModel string)
+	SetTimeout(timeout time.Duration)
+	CallWithMessages(systemPrompt, userPrompt string) (string, error)
+	CallWithRequest(req *Request) (string, error) // 构建器模式 API（支持高级功能）
+}
+
+// clientHooks 内部钩子接口（用于子类重写特定步骤）
+// 这些方法只在包内部使用，实现动态分派
+type clientHooks interface {
+	// 可被子类重写的钩子方法
+
+	call(systemPrompt, userPrompt string) (string, error)
+
+	buildMCPRequestBody(systemPrompt, userPrompt string) map[string]any
+	buildUrl() string
+	buildRequest(url string, jsonData []byte) (*http.Request, error)
+	setAuthHeader(reqHeaders http.Header)
+	marshalRequestBody(requestBody map[string]any) ([]byte, error)
+	parseMCPResponse(body []byte) (string, error)
+	isRetryableError(err error) bool
+}
diff --git a/mcp/intro/BUILDER_EXAMPLES.md b/mcp/intro/BUILDER_EXAMPLES.md
new file mode 100644
index 00000000..8ec8af9e
--- /dev/null
+++ b/mcp/intro/BUILDER_EXAMPLES.md
@@ -0,0 +1,572 @@
+# RequestBuilder 使用示例
+
+## 📋 目录
+1. [基础用法](#基础用法)
+2. [多轮对话](#多轮对话)
+3. [参数精细控制](#参数精细控制)
+4. [Function Calling](#function-calling)
+5. [预设场景](#预设场景)
+6. [完整示例](#完整示例)
+
+---
+
+## 基础用法
+
+### 简单对话
+
+```go
+package main
+
+import (
+    "fmt"
+    "nofx/mcp"
+)
+
+func main() {
+    // 创建客户端
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey("sk-xxx"),
+    )
+
+    // 使用构建器创建请求
+    request := mcp.NewRequestBuilder().
+        WithSystemPrompt("You are a helpful assistant").
+        WithUserPrompt("What is Go programming language?").
+        Build()
+
+    // 调用 API
+    result, err := client.CallWithRequest(request)
+    if err != nil {
+        panic(err)
+    }
+
+    fmt.Println(result)
+}
+```
+
+### 与传统方式对比
+
+```go
+// 传统方式（仍然可用）
+result, err := client.CallWithMessages(
+    "You are a helpful assistant",
+    "What is Go?",
+)
+
+// 构建器方式（新API，功能更强大）
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a helpful assistant").
+    WithUserPrompt("What is Go?").
+    Build()
+result, err := client.CallWithRequest(request)
+```
+
+---
+
+## 多轮对话
+
+### 带上下文的对话
+
+```go
+// 构建包含历史的多轮对话
+request := mcp.NewRequestBuilder().
+    AddSystemMessage("You are a trading advisor").
+    AddUserMessage("Analyze BTC price").
+    AddAssistantMessage("BTC is currently in an upward trend...").
+    AddUserMessage("What's the best entry point?").  // 继续对话
+    WithTemperature(0.3).  // 低温度，更精确
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+### 从历史记录构建
+
+```go
+// 假设你有保存的对话历史
+history := []mcp.Message{
+    mcp.NewUserMessage("Hello"),
+    mcp.NewAssistantMessage("Hi! How can I help?"),
+    mcp.NewUserMessage("What's the weather?"),
+    mcp.NewAssistantMessage("It's sunny today"),
+}
+
+// 继续对话
+request := mcp.NewRequestBuilder().
+    AddSystemMessage("You are helpful").
+    AddConversationHistory(history).  // 添加历史
+    AddUserMessage("What about tomorrow?").  // 新问题
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+---
+
+## 参数精细控制
+
+### 代码生成（低温度、精确）
+
+```go
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a Go expert").
+    WithUserPrompt("Generate a HTTP server").
+    WithTemperature(0.2).        // 低温度 = 更确定
+    WithTopP(0.1).               // 低 top_p = 更聚焦
+    WithMaxTokens(2000).
+    AddStopSequence("```").      // 遇到代码块结束符停止
+    Build()
+
+code, err := client.CallWithRequest(request)
+```
+
+### 创意写作（高温度、随机）
+
+```go
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a creative writer").
+    WithUserPrompt("Write a sci-fi story about AI").
+    WithTemperature(1.2).        // 高温度 = 更创意
+    WithTopP(0.95).              // 高 top_p = 更多样
+    WithPresencePenalty(0.6).    // 避免重复主题
+    WithFrequencyPenalty(0.5).   // 避免重复词汇
+    WithMaxTokens(4000).
+    Build()
+
+story, err := client.CallWithRequest(request)
+```
+
+### 精确分析（平衡参数）
+
+```go
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a quantitative analyst").
+    WithUserPrompt("Analyze BTC/USDT chart pattern").
+    WithTemperature(0.5).        // 中等温度
+    WithMaxTokens(1500).
+    WithStopSequences([]string{"---", "END"}).  // 多个停止序列
+    Build()
+
+analysis, err := client.CallWithRequest(request)
+```
+
+---
+
+## Function Calling
+
+### 天气查询工具
+
+```go
+// 定义工具参数 schema（JSON Schema 格式）
+weatherParams := map[string]any{
+    "type": "object",
+    "properties": map[string]any{
+        "location": map[string]any{
+            "type":        "string",
+            "description": "City name, e.g., Beijing, Shanghai",
+        },
+        "unit": map[string]any{
+            "type": "string",
+            "enum": []string{"celsius", "fahrenheit"},
+        },
+    },
+    "required": []string{"location"},
+}
+
+// 构建请求
+request := mcp.NewRequestBuilder().
+    WithUserPrompt("北京今天天气怎么样？").
+    AddFunction(
+        "get_weather",                 // 函数名
+        "Get current weather",         // 函数描述
+        weatherParams,                 // 参数定义
+    ).
+    WithToolChoice("auto").            // 让 AI 自动决定是否调用
+    Build()
+
+response, err := client.CallWithRequest(request)
+
+// AI 可能返回 tool_calls，你需要执行函数并返回结果
+// （具体实现取决于 AI provider 的响应格式）
+```
+
+### 多个工具
+
+```go
+// 定义多个工具
+request := mcp.NewRequestBuilder().
+    WithUserPrompt("帮我查询北京天气，并计算100的平方根").
+    AddFunction("get_weather", "Get weather", weatherParams).
+    AddFunction("calculate", "Calculate math", calcParams).
+    AddFunction("search_web", "Search web", searchParams).
+    WithToolChoice("auto").
+    Build()
+
+response, err := client.CallWithRequest(request)
+// AI 会选择调用相应的工具
+```
+
+### 强制使用特定工具
+
+```go
+request := mcp.NewRequestBuilder().
+    WithUserPrompt("北京").
+    AddFunction("get_weather", "Get weather", weatherParams).
+    WithToolChoice(`{"type": "function", "function": {"name": "get_weather"}}`).
+    Build()
+
+// AI 必须调用 get_weather 函数
+```
+
+---
+
+## 预设场景
+
+### ForChat - 聊天场景
+
+```go
+// 预设参数：temperature=0.7, maxTokens=2000
+request := mcp.ForChat().
+    WithSystemPrompt("You are a friendly chatbot").
+    WithUserPrompt("Hello!").
+    Build()
+
+// 等价于
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a friendly chatbot").
+    WithUserPrompt("Hello!").
+    WithTemperature(0.7).
+    WithMaxTokens(2000).
+    Build()
+```
+
+### ForCodeGeneration - 代码生成场景
+
+```go
+// 预设参数：temperature=0.2, topP=0.1, maxTokens=2000
+request := mcp.ForCodeGeneration().
+    WithUserPrompt("Generate a REST API in Go").
+    Build()
+
+// 自动使用低温度和低 top_p，确保代码准确性
+```
+
+### ForCreativeWriting - 创意写作场景
+
+```go
+// 预设参数：
+// temperature=1.2, topP=0.95, maxTokens=4000
+// presencePenalty=0.6, frequencyPenalty=0.5
+request := mcp.ForCreativeWriting().
+    WithSystemPrompt("You are a novelist").
+    WithUserPrompt("Write a fantasy story").
+    Build()
+
+// 自动使用高温度和惩罚参数，增加创意和多样性
+```
+
+---
+
+## 完整示例
+
+### 量化交易 AI 顾问
+
+```go
+package main
+
+import (
+    "fmt"
+    "log"
+    "nofx/mcp"
+    "os"
+)
+
+func main() {
+    // 创建客户端
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(os.Getenv("DEEPSEEK_API_KEY")),
+        mcp.WithMaxRetries(5),
+        mcp.WithTimeout(60 * time.Second),
+    )
+
+    // 场景1: 市场分析（需要精确）
+    analysisRequest := mcp.NewRequestBuilder().
+        WithSystemPrompt("You are a professional quantitative trader").
+        WithUserPrompt("Analyze BTC/USDT 1H chart, current price $45,000").
+        WithTemperature(0.3).  // 低温度，更精确
+        WithMaxTokens(1500).
+        Build()
+
+    analysis, err := client.CallWithRequest(analysisRequest)
+    if err != nil {
+        log.Fatal(err)
+    }
+    fmt.Println("=== Market Analysis ===")
+    fmt.Println(analysis)
+
+    // 场景2: 继续对话，询问入场点
+    followUpRequest := mcp.NewRequestBuilder().
+        AddSystemMessage("You are a professional quantitative trader").
+        AddUserMessage("Analyze BTC/USDT 1H chart, current price $45,000").
+        AddAssistantMessage(analysis).  // 添加之前的回复
+        AddUserMessage("Based on your analysis, what's the best entry point?").
+        WithTemperature(0.3).
+        Build()
+
+    entryPoint, err := client.CallWithRequest(followUpRequest)
+    if err != nil {
+        log.Fatal(err)
+    }
+    fmt.Println("\n=== Entry Point Suggestion ===")
+    fmt.Println(entryPoint)
+}
+```
+
+### 代码评审助手
+
+```go
+func reviewCode(client mcp.AIClient, code string) (string, error) {
+    request := mcp.ForCodeGeneration().  // 使用代码场景预设
+        WithSystemPrompt("You are a senior Go developer reviewing code").
+        WithUserPrompt(fmt.Sprintf("Review this code:\n\n```go\n%s\n```", code)).
+        WithMaxTokens(2000).
+        AddStopSequence("---END---").
+        Build()
+
+    return client.CallWithRequest(request)
+}
+
+func main() {
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(os.Getenv("DEEPSEEK_API_KEY")),
+    )
+
+    code := `
+func Add(a, b int) int {
+    return a + b
+}
+`
+
+    review, err := reviewCode(client, code)
+    if err != nil {
+        log.Fatal(err)
+    }
+    fmt.Println(review)
+}
+```
+
+### AI 聊天机器人（带历史记录）
+
+```go
+type ChatBot struct {
+    client  mcp.AIClient
+    history []mcp.Message
+}
+
+func NewChatBot(client mcp.AIClient, systemPrompt string) *ChatBot {
+    return &ChatBot{
+        client: client,
+        history: []mcp.Message{
+            mcp.NewSystemMessage(systemPrompt),
+        },
+    }
+}
+
+func (bot *ChatBot) Chat(userMessage string) (string, error) {
+    // 添加用户消息到历史
+    bot.history = append(bot.history, mcp.NewUserMessage(userMessage))
+
+    // 构建请求（包含完整历史）
+    request := mcp.ForChat().
+        AddMessages(bot.history...).
+        Build()
+
+    // 调用 API
+    response, err := bot.client.CallWithRequest(request)
+    if err != nil {
+        return "", err
+    }
+
+    // 添加 AI 回复到历史
+    bot.history = append(bot.history, mcp.NewAssistantMessage(response))
+
+    return response, nil
+}
+
+func main() {
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(os.Getenv("DEEPSEEK_API_KEY")),
+    )
+
+    bot := NewChatBot(client, "You are a friendly and helpful assistant")
+
+    // 对话1
+    resp1, _ := bot.Chat("What is Go?")
+    fmt.Println("User: What is Go?")
+    fmt.Println("Bot:", resp1)
+
+    // 对话2（带上下文）
+    resp2, _ := bot.Chat("What are its main features?")
+    fmt.Println("\nUser: What are its main features?")
+    fmt.Println("Bot:", resp2)
+
+    // 对话3（继续上下文）
+    resp3, _ := bot.Chat("Show me an example")
+    fmt.Println("\nUser: Show me an example")
+    fmt.Println("Bot:", resp3)
+}
+```
+
+### Function Calling 完整示例
+
+```go
+package main
+
+import (
+    "encoding/json"
+    "fmt"
+    "nofx/mcp"
+    "os"
+)
+
+// 天气查询函数（模拟）
+func getWeather(location string) string {
+    return fmt.Sprintf("Weather in %s: Sunny, 25°C", location)
+}
+
+func main() {
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(os.Getenv("DEEPSEEK_API_KEY")),
+    )
+
+    // 定义工具
+    weatherParams := map[string]any{
+        "type": "object",
+        "properties": map[string]any{
+            "location": map[string]any{
+                "type":        "string",
+                "description": "City name",
+            },
+        },
+        "required": []string{"location"},
+    }
+
+    // 第一步：发送带工具的请求
+    request := mcp.NewRequestBuilder().
+        WithUserPrompt("北京天气怎么样？").
+        AddFunction("get_weather", "Get current weather", weatherParams).
+        WithToolChoice("auto").
+        Build()
+
+    response, err := client.CallWithRequest(request)
+    if err != nil {
+        panic(err)
+    }
+
+    fmt.Println("AI Response:", response)
+
+    // 第二步：如果 AI 返回了 tool_call（实际需要解析 JSON 响应）
+    // 这里是示例，实际需要根据 provider 的响应格式解析
+    // toolCall := parseToolCall(response)
+    // weatherResult := getWeather(toolCall.Arguments.Location)
+
+    // 第三步：将工具结果返回给 AI
+    // followUp := mcp.NewRequestBuilder().
+    //     AddConversationHistory(previousMessages).
+    //     AddToolResult(toolCall.ID, weatherResult).
+    //     Build()
+    //
+    // finalResponse, _ := client.CallWithRequest(followUp)
+}
+```
+
+---
+
+## 最佳实践
+
+### 1. 使用 MustBuild() vs Build()
+
+```go
+// Build() - 返回 error，需要处理
+request, err := NewRequestBuilder().
+    WithUserPrompt("Hello").
+    Build()
+if err != nil {
+    log.Fatal(err)
+}
+
+// MustBuild() - 如果失败会 panic，适用于确定不会错的场景
+request := NewRequestBuilder().
+    WithSystemPrompt("You are helpful").
+    WithUserPrompt("Hello").
+    MustBuild()  // 构建失败会 panic
+```
+
+### 2. 重用构建器
+
+```go
+// 创建基础构建器
+baseBuilder := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are a trading advisor").
+    WithTemperature(0.3)
+
+// 为不同问题添加用户消息
+question1 := baseBuilder.
+    AddUserMessage("Analyze BTC").
+    Build()
+
+question2 := baseBuilder.
+    ClearMessages().  // 清空之前的消息
+    AddSystemMessage("You are a trading advisor").
+    AddUserMessage("Analyze ETH").
+    Build()
+```
+
+### 3. 选择合适的预设
+
+```go
+// ✅ 代码生成 - 使用 ForCodeGeneration
+ForCodeGeneration().WithUserPrompt("Generate code")
+
+// ✅ 聊天 - 使用 ForChat
+ForChat().WithUserPrompt("Hello")
+
+// ✅ 创意写作 - 使用 ForCreativeWriting
+ForCreativeWriting().WithUserPrompt("Write a story")
+
+// ✅ 自定义 - 使用 NewRequestBuilder
+NewRequestBuilder().WithTemperature(0.6).WithUserPrompt("...")
+```
+
+---
+
+## 迁移指南
+
+### 从旧 API 迁移
+
+```go
+// 旧 API（仍然可用）
+result, err := client.CallWithMessages("system", "user")
+
+// 迁移到新 API
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("system").
+    WithUserPrompt("user").
+    Build()
+result, err := client.CallWithRequest(request)
+
+// 如果需要更多控制
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("system").
+    WithUserPrompt("user").
+    WithTemperature(0.8).      // 新功能
+    WithMaxTokens(2000).       // 新功能
+    Build()
+result, err := client.CallWithRequest(request)
+```
+
+---
+
+更多信息请参考：
+- [构建器模式价值分析](./BUILDER_PATTERN_BENEFITS.md)
+- [MCP 使用指南](./README.md)
diff --git a/mcp/intro/BUILDER_PATTERN_BENEFITS.md b/mcp/intro/BUILDER_PATTERN_BENEFITS.md
new file mode 100644
index 00000000..04ff2587
--- /dev/null
+++ b/mcp/intro/BUILDER_PATTERN_BENEFITS.md
@@ -0,0 +1,716 @@
+# 构建器模式在 MCP 模块中的应用价值
+
+## 📋 目录
+1. [当前实现的局限性](#当前实现的局限性)
+2. [构建器模式的好处](#构建器模式的好处)
+3. [实际应用场景](#实际应用场景)
+4. [对比示例](#对比示例)
+5. [是否需要引入](#是否需要引入)
+
+---
+
+## 当前实现的局限性
+
+### 现状分析
+
+**当前 buildMCPRequestBody 实现**:
+```go
+func (client *Client) buildMCPRequestBody(systemPrompt, userPrompt string) map[string]any {
+    messages := []map[string]string{}
+
+    if systemPrompt != "" {
+        messages = append(messages, map[string]string{
+            "role":    "system",
+            "content": systemPrompt,
+        })
+    }
+    messages = append(messages, map[string]string{
+        "role":    "user",
+        "content": userPrompt,
+    })
+
+    return map[string]interface{}{
+        "model":       client.Model,
+        "messages":    messages,
+        "temperature": client.config.Temperature,
+        "max_tokens":  client.MaxTokens,
+    }
+}
+```
+
+### 存在的限制
+
+1. **只支持简单对话**
+   - ❌ 无法添加多轮对话历史
+   - ❌ 无法添加 assistant 回复
+   - ❌ 无法构建复杂的对话上下文
+
+2. **参数固定**
+   - ❌ 无法动态添加可选参数（如 top_p、frequency_penalty）
+   - ❌ 无法为单次请求自定义 temperature（会影响全局配置）
+   - ❌ 无法添加 function calling、tools 等高级功能
+
+3. **扩展性差**
+   - ❌ 每次添加新参数都需要修改方法签名
+   - ❌ 参数列表会越来越长
+   - ❌ 子类重写时需要处理所有参数
+
+---
+
+## 构建器模式的好处
+
+### 1. 🎯 **灵活性和可读性**
+
+#### 当前方式（参数传递）
+```go
+// 问题：参数多了会很混乱
+client.CallWithCustomParams(
+    "system prompt",
+    "user prompt",
+    0.8,              // temperature - 这是什么？
+    2000,             // max_tokens - 这是什么？
+    0.9,              // top_p - 这是什么？
+    0.5,              // frequency_penalty
+    nil,              // stop sequences
+    false,            // stream
+)
+```
+
+#### 构建器方式
+```go
+// 清晰、自解释
+request := NewRequestBuilder().
+    WithSystemPrompt("You are a helpful assistant").
+    WithUserPrompt("Tell me about Go").
+    WithTemperature(0.8).
+    WithMaxTokens(2000).
+    WithTopP(0.9).
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+---
+
+### 2. 📚 **支持复杂场景**
+
+#### 场景1: 多轮对话
+
+**当前方式**: 😢 不支持
+```go
+// ❌ 无法实现
+client.CallWithMessages("system", "user prompt")
+```
+
+**构建器方式**: ✅ 支持
+```go
+request := NewRequestBuilder().
+    AddSystemMessage("You are a helpful assistant").
+    AddUserMessage("What is the weather?").
+    AddAssistantMessage("It's sunny today").
+    AddUserMessage("What about tomorrow?").  // 继续对话
+    WithTemperature(0.7).
+    Build()
+```
+
+#### 场景2: 函数调用（Function Calling）
+
+**当前方式**: 😢 不支持
+```go
+// ❌ 无法添加 tools/functions
+```
+
+**构建器方式**: ✅ 支持
+```go
+request := NewRequestBuilder().
+    WithUserPrompt("What's the weather in Beijing?").
+    AddTool(Tool{
+        Type: "function",
+        Function: FunctionDef{
+            Name:        "get_weather",
+            Description: "Get current weather",
+            Parameters:  weatherParamsSchema,
+        },
+    }).
+    WithToolChoice("auto").
+    Build()
+```
+
+#### 场景3: 流式响应
+
+**当前方式**: 😢 需要修改整个架构
+```go
+// ❌ CallWithMessages 不支持流式
+```
+
+**构建器方式**: ✅ 易于扩展
+```go
+request := NewRequestBuilder().
+    WithUserPrompt("Write a long story").
+    WithStream(true).
+    Build()
+
+stream, err := client.CallStream(request)
+for chunk := range stream {
+    fmt.Print(chunk)
+}
+```
+
+---
+
+### 3. 🔧 **易于扩展和维护**
+
+#### 添加新参数
+
+**当前方式**: 😢 破坏性修改
+```go
+// 需要修改方法签名（破坏现有代码）
+func (client *Client) buildMCPRequestBody(
+    systemPrompt, userPrompt string,
+    // 新增参数会导致所有调用处都要修改
+    topP float64,
+    presencePenalty float64,
+) map[string]any
+```
+
+**构建器方式**: ✅ 向后兼容
+```go
+// 只需添加新方法，不影响现有代码
+func (b *RequestBuilder) WithPresencePenalty(p float64) *RequestBuilder {
+    b.presencePenalty = p
+    return b
+}
+
+// 旧代码不受影响
+request := builder.WithUserPrompt("Hello").Build()
+
+// 新代码可以使用新功能
+request := builder.
+    WithUserPrompt("Hello").
+    WithPresencePenalty(0.6).  // 新参数
+    Build()
+```
+
+---
+
+### 4. 🎨 **可选参数处理**
+
+**当前方式**: 😢 难以处理可选参数
+```go
+// 方案1: 传 nil/0 值（不优雅）
+client.CallWithParams(system, user, 0, 0, nil, nil)
+
+// 方案2: 使用选项模式（但每次调用都要传）
+client.CallWithParams(system, user, WithTopP(0.9), WithPenalty(0.5))
+
+// 方案3: 配置对象（需要创建临时对象）
+config := &RequestConfig{
+    SystemPrompt: system,
+    UserPrompt:   user,
+    TopP:         0.9,
+}
+```
+
+**构建器方式**: ✅ 优雅处理
+```go
+// 只设置需要的参数，其他使用默认值
+request := NewRequestBuilder().
+    WithUserPrompt("Hello").
+    // 不设置 temperature，使用默认值
+    // 不设置 topP，使用默认值
+    Build()
+
+// 也可以全部自定义
+request := NewRequestBuilder().
+    WithUserPrompt("Hello").
+    WithTemperature(0.8).
+    WithTopP(0.9).
+    WithMaxTokens(2000).
+    Build()
+```
+
+---
+
+### 5. ✅ **类型安全和验证**
+
+**当前方式**: 😢 运行时才发现错误
+```go
+// ❌ 编译时无法发现问题
+client.CallWithMessages("", "")  // 空 prompt
+client.CallWithMessages("system", "user")  // temperature 可能不合法
+```
+
+**构建器方式**: ✅ 提前验证
+```go
+type RequestBuilder struct {
+    messages    []Message
+    temperature float64
+    maxTokens   int
+}
+
+func (b *RequestBuilder) WithTemperature(t float64) *RequestBuilder {
+    if t < 0 || t > 2 {
+        panic("temperature must be between 0 and 2")  // 或返回 error
+    }
+    b.temperature = t
+    return b
+}
+
+func (b *RequestBuilder) Build() (*Request, error) {
+    if len(b.messages) == 0 {
+        return nil, errors.New("at least one message is required")
+    }
+    if b.maxTokens <= 0 {
+        return nil, errors.New("maxTokens must be positive")
+    }
+    return &Request{...}, nil
+}
+```
+
+---
+
+## 实际应用场景
+
+### 场景1: 量化交易 AI 顾问（多轮对话）
+
+```go
+// 构建包含市场数据的上下文对话
+request := NewRequestBuilder().
+    AddSystemMessage("You are a quantitative trading advisor").
+    AddUserMessage("Analyze BTC trend").
+    AddAssistantMessage("BTC is in an upward trend based on...").
+    AddUserMessage("What about entry points?").  // 继续对话
+    WithTemperature(0.3).  // 低温度，更精确
+    WithMaxTokens(1000).
+    Build()
+
+analysis, err := client.CallWithRequest(request)
+```
+
+### 场景2: 代码生成（需要精确控制）
+
+```go
+request := NewRequestBuilder().
+    WithSystemPrompt("You are a Go expert").
+    WithUserPrompt("Generate a HTTP server").
+    WithTemperature(0.2).        // 低温度，更确定性
+    WithTopP(0.1).               // 低 top_p，更聚焦
+    WithMaxTokens(2000).
+    WithStopSequences([]string{"```"}).  // 遇到代码块结束符停止
+    Build()
+```
+
+### 场景3: 创意写作（需要随机性）
+
+```go
+request := NewRequestBuilder().
+    WithSystemPrompt("You are a creative writer").
+    WithUserPrompt("Write a sci-fi story").
+    WithTemperature(1.2).        // 高温度，更创意
+    WithTopP(0.95).              // 高 top_p，更多样性
+    WithPresencePenalty(0.6).    // 避免重复
+    WithFrequencyPenalty(0.5).
+    WithMaxTokens(4000).
+    Build()
+```
+
+### 场景4: 函数调用（工具使用）
+
+```go
+// 定义工具
+weatherTool := Tool{
+    Type: "function",
+    Function: FunctionDef{
+        Name:        "get_weather",
+        Description: "Get current weather for a location",
+        Parameters: map[string]any{
+            "type": "object",
+            "properties": map[string]any{
+                "location": map[string]any{
+                    "type":        "string",
+                    "description": "City name",
+                },
+            },
+            "required": []string{"location"},
+        },
+    },
+}
+
+request := NewRequestBuilder().
+    WithUserPrompt("What's the weather in Beijing?").
+    AddTool(weatherTool).
+    WithToolChoice("auto").
+    Build()
+
+response, err := client.CallWithRequest(request)
+// 解析 response.ToolCalls 并执行实际的天气查询
+```
+
+---
+
+## 对比示例
+
+### 示例1: 基础用法
+
+#### 当前实现
+```go
+result, err := client.CallWithMessages(
+    "You are a helpful assistant",
+    "What is Go?",
+)
+```
+
+#### 构建器模式
+```go
+request := NewRequestBuilder().
+    WithSystemPrompt("You are a helpful assistant").
+    WithUserPrompt("What is Go?").
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+**分析**: 基础用法下，构建器稍显冗长，但更清晰。
+
+---
+
+### 示例2: 复杂用法
+
+#### 当前实现（假设扩展后）
+```go
+// 😢 参数太多，难以理解
+result, err := client.CallWithMessagesAdvanced(
+    "system prompt",
+    "user prompt",
+    nil,    // messages history?
+    0.8,    // temperature
+    2000,   // max_tokens
+    0.9,    // top_p
+    0.5,    // frequency_penalty
+    0.6,    // presence_penalty
+    nil,    // stop sequences
+    false,  // stream
+    nil,    // tools
+    "",     // tool_choice
+)
+```
+
+#### 构建器模式
+```go
+// ✅ 清晰、自解释
+request := NewRequestBuilder().
+    WithSystemPrompt("system prompt").
+    WithUserPrompt("user prompt").
+    WithTemperature(0.8).
+    WithMaxTokens(2000).
+    WithTopP(0.9).
+    WithFrequencyPenalty(0.5).
+    WithPresencePenalty(0.6).
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+**分析**: 复杂场景下，构建器模式优势明显。
+
+---
+
+## 是否需要引入？
+
+### ✅ 建议引入的情况
+
+1. **需要支持多轮对话**
+   - 聊天机器人
+   - 上下文相关的 AI 助手
+
+2. **需要精细控制 AI 参数**
+   - 不同任务需要不同 temperature
+   - 需要使用 top_p、penalty 等高级参数
+
+3. **需要使用 AI 高级功能**
+   - Function Calling / Tools
+   - 流式响应
+   - Vision API（图片输入）
+
+4. **API 接口可能频繁变化**
+   - AI 提供商经常添加新参数
+   - 需要向后兼容
+
+### ⚠️ 可以暂缓的情况
+
+1. **只有简单的单轮对话**
+   - 当前 `CallWithMessages` 已足够
+
+2. **参数固定不变**
+   - 所有请求使用相同配置
+
+3. **团队规模小，代码量少**
+   - 引入新模式的学习成本 > 收益
+
+---
+
+## 推荐方案
+
+### 方案1: 渐进式引入（推荐）
+
+**第一阶段**: 保留现有 API，新增构建器
+```go
+// 旧 API 继续工作（向后兼容）
+result, err := client.CallWithMessages("system", "user")
+
+// 新 API 提供高级功能
+request := NewRequestBuilder().
+    WithUserPrompt("user").
+    WithTemperature(0.8).
+    Build()
+result, err := client.CallWithRequest(request)
+```
+
+**第二阶段**: 逐步迁移
+```go
+// 在文档中推荐使用构建器
+// 旧 API 标记为 Deprecated（但不删除）
+```
+
+### 方案2: 仅用于高级场景
+
+只在需要复杂功能时使用构建器：
+```go
+// 简单场景：使用现有 API
+client.CallWithMessages("system", "user")
+
+// 复杂场景：使用构建器
+client.CallWithRequest(
+    NewRequestBuilder().
+        AddConversationHistory(history).
+        AddUserMessage("new question").
+        WithTools(tools).
+        Build(),
+)
+```
+
+---
+
+## 实现示例
+
+### 完整的构建器实现
+
+```go
+package mcp
+
+type Message struct {
+    Role    string `json:"role"`
+    Content string `json:"content"`
+}
+
+type Tool struct {
+    Type     string      `json:"type"`
+    Function FunctionDef `json:"function"`
+}
+
+type Request struct {
+    Model             string    `json:"model"`
+    Messages          []Message `json:"messages"`
+    Temperature       float64   `json:"temperature,omitempty"`
+    MaxTokens         int       `json:"max_tokens,omitempty"`
+    TopP              float64   `json:"top_p,omitempty"`
+    FrequencyPenalty  float64   `json:"frequency_penalty,omitempty"`
+    PresencePenalty   float64   `json:"presence_penalty,omitempty"`
+    Stop              []string  `json:"stop,omitempty"`
+    Tools             []Tool    `json:"tools,omitempty"`
+    ToolChoice        string    `json:"tool_choice,omitempty"`
+    Stream            bool      `json:"stream,omitempty"`
+}
+
+type RequestBuilder struct {
+    model            string
+    messages         []Message
+    temperature      *float64
+    maxTokens        *int
+    topP             *float64
+    frequencyPenalty *float64
+    presencePenalty  *float64
+    stop             []string
+    tools            []Tool
+    toolChoice       string
+    stream           bool
+}
+
+func NewRequestBuilder() *RequestBuilder {
+    return &RequestBuilder{
+        messages: make([]Message, 0),
+    }
+}
+
+func (b *RequestBuilder) WithModel(model string) *RequestBuilder {
+    b.model = model
+    return b
+}
+
+func (b *RequestBuilder) WithSystemPrompt(prompt string) *RequestBuilder {
+    if prompt != "" {
+        b.messages = append(b.messages, Message{
+            Role:    "system",
+            Content: prompt,
+        })
+    }
+    return b
+}
+
+func (b *RequestBuilder) WithUserPrompt(prompt string) *RequestBuilder {
+    b.messages = append(b.messages, Message{
+        Role:    "user",
+        Content: prompt,
+    })
+    return b
+}
+
+func (b *RequestBuilder) AddUserMessage(content string) *RequestBuilder {
+    return b.WithUserPrompt(content)
+}
+
+func (b *RequestBuilder) AddSystemMessage(content string) *RequestBuilder {
+    return b.WithSystemPrompt(content)
+}
+
+func (b *RequestBuilder) AddAssistantMessage(content string) *RequestBuilder {
+    b.messages = append(b.messages, Message{
+        Role:    "assistant",
+        Content: content,
+    })
+    return b
+}
+
+func (b *RequestBuilder) AddMessage(role, content string) *RequestBuilder {
+    b.messages = append(b.messages, Message{
+        Role:    role,
+        Content: content,
+    })
+    return b
+}
+
+func (b *RequestBuilder) AddConversationHistory(history []Message) *RequestBuilder {
+    b.messages = append(b.messages, history...)
+    return b
+}
+
+func (b *RequestBuilder) WithTemperature(t float64) *RequestBuilder {
+    if t < 0 || t > 2 {
+        panic("temperature must be between 0 and 2")
+    }
+    b.temperature = &t
+    return b
+}
+
+func (b *RequestBuilder) WithMaxTokens(tokens int) *RequestBuilder {
+    b.maxTokens = &tokens
+    return b
+}
+
+func (b *RequestBuilder) WithTopP(p float64) *RequestBuilder {
+    b.topP = &p
+    return b
+}
+
+func (b *RequestBuilder) WithFrequencyPenalty(p float64) *RequestBuilder {
+    b.frequencyPenalty = &p
+    return b
+}
+
+func (b *RequestBuilder) WithPresencePenalty(p float64) *RequestBuilder {
+    b.presencePenalty = &p
+    return b
+}
+
+func (b *RequestBuilder) WithStopSequences(sequences []string) *RequestBuilder {
+    b.stop = sequences
+    return b
+}
+
+func (b *RequestBuilder) AddTool(tool Tool) *RequestBuilder {
+    b.tools = append(b.tools, tool)
+    return b
+}
+
+func (b *RequestBuilder) WithToolChoice(choice string) *RequestBuilder {
+    b.toolChoice = choice
+    return b
+}
+
+func (b *RequestBuilder) WithStream(stream bool) *RequestBuilder {
+    b.stream = stream
+    return b
+}
+
+func (b *RequestBuilder) Build() (*Request, error) {
+    if len(b.messages) == 0 {
+        return nil, errors.New("at least one message is required")
+    }
+
+    req := &Request{
+        Model:      b.model,
+        Messages:   b.messages,
+        Stop:       b.stop,
+        Tools:      b.tools,
+        ToolChoice: b.toolChoice,
+        Stream:     b.stream,
+    }
+
+    // 只设置非 nil 的可选参数
+    if b.temperature != nil {
+        req.Temperature = *b.temperature
+    }
+    if b.maxTokens != nil {
+        req.MaxTokens = *b.maxTokens
+    }
+    if b.topP != nil {
+        req.TopP = *b.topP
+    }
+    if b.frequencyPenalty != nil {
+        req.FrequencyPenalty = *b.frequencyPenalty
+    }
+    if b.presencePenalty != nil {
+        req.PresencePenalty = *b.presencePenalty
+    }
+
+    return req, nil
+}
+```
+
+### Client 集成
+
+```go
+// 新增方法（不影响现有代码）
+func (client *Client) CallWithRequest(req *Request) (string, error) {
+    // 使用 req 中的参数发送请求
+    // ...
+}
+```
+
+---
+
+## 总结
+
+### 核心优势
+1. ✅ **灵活性** - 轻松支持复杂场景
+2. ✅ **可读性** - 代码自解释，易于理解
+3. ✅ **可扩展性** - 添加新功能不破坏现有代码
+4. ✅ **类型安全** - 编译时检查，提前发现错误
+5. ✅ **向后兼容** - 可以与现有 API 共存
+
+### 建议
+- **当前阶段**: 如果只需要简单对话，现有实现已足够
+- **未来扩展**: 当需要以下功能时再引入
+  - 多轮对话
+  - Function Calling
+  - 流式响应
+  - 精细参数控制
+
+### 最佳实践
+采用**渐进式引入**策略：
+1. 保留现有 `CallWithMessages` API
+2. 新增 `CallWithRequest` + 构建器
+3. 在文档中推荐新 API，但不强制迁移
+4. 根据实际需求逐步完善构建器功能
+
+这样既能保持向后兼容，又能为未来的功能扩展做好准备。
diff --git a/mcp/intro/LOGRUS_INTEGRATION.md b/mcp/intro/LOGRUS_INTEGRATION.md
new file mode 100644
index 00000000..13630e02
--- /dev/null
+++ b/mcp/intro/LOGRUS_INTEGRATION.md
@@ -0,0 +1,268 @@
+# Logrus 集成指南
+
+本文档展示如何将 MCP 模块与 Logrus 日志库集成。
+
+## 📦 安装 Logrus
+
+```bash
+go get github.com/sirupsen/logrus
+```
+
+## 🔧 集成步骤
+
+### 1. 创建 Logrus 适配器
+
+创建一个实现 `mcp.Logger` 接口的适配器：
+
+```go
+package main
+
+import (
+    "github.com/sirupsen/logrus"
+    "nofx/mcp"
+)
+
+// LogrusLogger Logrus 日志适配器
+type LogrusLogger struct {
+    logger *logrus.Logger
+}
+
+// NewLogrusLogger 创建 Logrus 日志适配器
+func NewLogrusLogger(logger *logrus.Logger) *LogrusLogger {
+    return &LogrusLogger{logger: logger}
+}
+
+// Debugf 实现 Debug 日志
+func (l *LogrusLogger) Debugf(format string, args ...any) {
+    l.logger.Debugf(format, args...)
+}
+
+// Infof 实现 Info 日志
+func (l *LogrusLogger) Infof(format string, args ...any) {
+    l.logger.Infof(format, args...)
+}
+
+// Warnf 实现 Warn 日志
+func (l *LogrusLogger) Warnf(format string, args ...any) {
+    l.logger.Warnf(format, args...)
+}
+
+// Errorf 实现 Error 日志
+func (l *LogrusLogger) Errorf(format string, args ...any) {
+    l.logger.Errorf(format, args...)
+}
+```
+
+### 2. 使用 Logrus Logger
+
+```go
+package main
+
+import (
+    "github.com/sirupsen/logrus"
+    "nofx/mcp"
+)
+
+func main() {
+    // 1. 创建 Logrus logger
+    logger := logrus.New()
+
+    // 2. 配置 Logrus
+    logger.SetLevel(logrus.DebugLevel)
+    logger.SetFormatter(&logrus.JSONFormatter{})
+
+    // 3. 创建适配器
+    logrusAdapter := NewLogrusLogger(logger)
+
+    // 4. 使用 MCP 客户端
+    client := mcp.NewClient(
+        mcp.WithDeepSeekConfig("sk-xxx"),
+        mcp.WithLogger(logrusAdapter), // 注入 Logrus 日志器
+    )
+
+    // 5. 调用 AI
+    result, err := client.CallWithMessages("system", "user")
+    if err != nil {
+        logger.Errorf("AI 调用失败: %v", err)
+        return
+    }
+
+    logger.Infof("AI 响应: %s", result)
+}
+```
+
+## 🎨 高级配置
+
+### JSON 格式输出
+
+```go
+logger := logrus.New()
+logger.SetFormatter(&logrus.JSONFormatter{
+    TimestampFormat: "2006-01-02 15:04:05",
+    PrettyPrint:     true,
+})
+```
+
+输出示例：
+```json
+{
+  "level": "info",
+  "msg": "📡 [Provider: deepseek, Model: deepseek-chat] Request AI Server: BaseURL: https://api.deepseek.com/v1",
+  "time": "2024-01-15 10:30:45"
+}
+```
+
+### 添加固定字段
+
+```go
+logger := logrus.New()
+logger.WithFields(logrus.Fields{
+    "service": "trading-bot",
+    "version": "1.0.0",
+})
+```
+
+### 不同环境配置
+
+```go
+func createLogger(env string) *logrus.Logger {
+    logger := logrus.New()
+
+    switch env {
+    case "production":
+        // 生产环境：JSON 格式，只记录 Info 以上
+        logger.SetLevel(logrus.InfoLevel)
+        logger.SetFormatter(&logrus.JSONFormatter{})
+
+    case "development":
+        // 开发环境：文本格式，记录所有级别
+        logger.SetLevel(logrus.DebugLevel)
+        logger.SetFormatter(&logrus.TextFormatter{
+            FullTimestamp: true,
+        })
+
+    case "test":
+        // 测试环境：静默模式
+        logger.SetLevel(logrus.FatalLevel)
+    }
+
+    return logger
+}
+
+// 使用
+logger := createLogger("production")
+mcpClient := mcp.NewClient(
+    mcp.WithLogger(NewLogrusLogger(logger)),
+)
+```
+
+## 📝 完整示例
+
+```go
+package main
+
+import (
+    "os"
+
+    "github.com/sirupsen/logrus"
+    "nofx/mcp"
+)
+
+// LogrusLogger Logrus 适配器
+type LogrusLogger struct {
+    logger *logrus.Logger
+}
+
+func NewLogrusLogger(logger *logrus.Logger) *LogrusLogger {
+    return &LogrusLogger{logger: logger}
+}
+
+func (l *LogrusLogger) Debugf(format string, args ...any) {
+    l.logger.Debugf(format, args...)
+}
+
+func (l *LogrusLogger) Infof(format string, args ...any) {
+    l.logger.Infof(format, args...)
+}
+
+func (l *LogrusLogger) Warnf(format string, args ...any) {
+    l.logger.Warnf(format, args...)
+}
+
+func (l *LogrusLogger) Errorf(format string, args ...any) {
+    l.logger.Errorf(format, args...)
+}
+
+func main() {
+    // 创建 Logrus logger
+    logger := logrus.New()
+    logger.SetLevel(logrus.DebugLevel)
+    logger.SetFormatter(&logrus.TextFormatter{
+        FullTimestamp: true,
+        ForceColors:   true,
+    })
+    logger.SetOutput(os.Stdout)
+
+    // 创建 MCP 客户端
+    client := mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(os.Getenv("DEEPSEEK_API_KEY")),
+        mcp.WithLogger(NewLogrusLogger(logger)),
+        mcp.WithMaxRetries(5),
+    )
+
+    // 调用 AI
+    logger.Info("开始调用 AI...")
+    result, err := client.CallWithMessages(
+        "你是一个专业的量化交易顾问",
+        "分析 BTC 当前走势",
+    )
+
+    if err != nil {
+        logger.WithError(err).Error("AI 调用失败")
+        return
+    }
+
+    logger.WithField("result", result).Info("AI 调用成功")
+}
+```
+
+## 🔍 输出示例
+
+### 开发环境（Text 格式）
+
+```
+INFO[2024-01-15 10:30:45] 开始调用 AI...
+INFO[2024-01-15 10:30:45] 📡 [Provider: deepseek, Model: deepseek-chat] Request AI Server: BaseURL: https://api.deepseek.com/v1
+DEBUG[2024-01-15 10:30:45] [Provider: deepseek, Model: deepseek-chat] UseFullURL: false
+DEBUG[2024-01-15 10:30:45] [Provider: deepseek, Model: deepseek-chat]   API Key: sk-x...xxx
+INFO[2024-01-15 10:30:45] 📡 [MCP Provider: deepseek, Model: deepseek-chat] 请求 URL: https://api.deepseek.com/v1/chat/completions
+INFO[2024-01-15 10:30:46] AI 调用成功 result="[AI 响应内容]"
+```
+
+### 生产环境（JSON 格式）
+
+```json
+{"level":"info","msg":"开始调用 AI...","time":"2024-01-15T10:30:45+08:00"}
+{"level":"info","msg":"📡 [Provider: deepseek, Model: deepseek-chat] Request AI Server: BaseURL: https://api.deepseek.com/v1","time":"2024-01-15T10:30:45+08:00"}
+{"level":"info","msg":"AI 调用成功","result":"[AI 响应内容]","time":"2024-01-15T10:30:46+08:00"}
+```
+
+## 🎯 最佳实践
+
+1. **生产环境使用 JSON 格式**，便于日志收集和分析
+2. **开发环境使用 Text 格式**，便于阅读
+3. **测试环境关闭日志**，提高测试速度
+4. **添加请求 ID**，方便追踪请求链路
+5. **记录错误堆栈**，便于问题排查
+
+## 📊 性能优化
+
+Logrus 在高并发场景下可能有性能瓶颈，推荐使用 [Zap](https://github.com/uber-go/zap) 获得更好的性能。
+
+MCP 模块也支持 Zap，集成方式类似。
+
+## 🔗 相关资源
+
+- [Logrus 官方文档](https://github.com/sirupsen/logrus)
+- [Zap 集成示例](./ZAP_INTEGRATION.md)
+- [MCP README](./README.md)
diff --git a/mcp/intro/MIGRATION_GUIDE.md b/mcp/intro/MIGRATION_GUIDE.md
new file mode 100644
index 00000000..fa6655ec
--- /dev/null
+++ b/mcp/intro/MIGRATION_GUIDE.md
@@ -0,0 +1,361 @@
+# MCP 模块重构迁移指南
+
+## 📋 重构概览
+
+本次重构采用**渐进式、向前兼容**的设计，现有代码**无需修改**即可继续使用，同时提供了更强大的新 API。
+
+### 重构目标
+
+- ✅ **100% 向前兼容** - 所有现有 API 继续工作
+- ✅ **模块独立** - 可作为独立 Go module 发布
+- ✅ **依赖可替换** - 日志、HTTP 客户端都可自定义
+- ✅ **易于测试** - 支持依赖注入和 mock
+- ✅ **配置灵活** - 支持选项模式 (Functional Options)
+
+---
+
+## 🔄 向前兼容保证
+
+### ✅ 所有现有代码继续工作
+
+```go
+// ✅ 这些代码无需修改，继续正常工作
+mcpClient := mcp.New()
+mcpClient.SetAPIKey(apiKey, url, model)
+
+// ✅ 这些也继续工作
+dsClient := mcp.NewDeepSeekClient()
+qwenClient := mcp.NewQwenClient()
+```
+
+**重要**：虽然标记为 `Deprecated`，但这些函数会一直保留，不会被删除。
+
+---
+
+## 🆕 新特性使用指南
+
+### 1. 基础用法（推荐）
+
+```go
+// 新的推荐用法
+client := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+    mcp.WithTimeout(60 * time.Second),
+)
+```
+
+### 2. 自定义日志
+
+```go
+// 使用自定义日志器（如 zap, logrus）
+type MyLogger struct {
+    zapLogger *zap.Logger
+}
+
+func (l *MyLogger) Info(msg string, args ...any) {
+    l.zapLogger.Sugar().Infof(msg, args...)
+}
+
+// 注入自定义日志器
+client := mcp.NewClient(
+    mcp.WithLogger(&MyLogger{zapLogger}),
+)
+```
+
+### 3. 自定义 HTTP 客户端
+
+```go
+// 添加代理、追踪、自定义 TLS 等
+customHTTP := &http.Client{
+    Timeout: 30 * time.Second,
+    Transport: &http.Transport{
+        Proxy: http.ProxyFromEnvironment,
+        TLSClientConfig: &tls.Config{/* ... */},
+    },
+}
+
+client := mcp.NewClient(
+    mcp.WithHTTPClient(customHTTP),
+)
+```
+
+### 4. 测试场景
+
+```go
+func TestMyCode(t *testing.T) {
+    // Mock HTTP 客户端
+    mockHTTP := &MockHTTPClient{
+        // 返回预设的响应
+    }
+
+    // 禁用日志
+    client := mcp.NewClient(
+        mcp.WithHTTPClient(mockHTTP),
+        mcp.WithLogger(mcp.NewNoopLogger()),
+    )
+
+    // 测试...
+}
+```
+
+### 5. 组合多个选项
+
+```go
+client := mcp.NewDeepSeekClientWithOptions(
+    mcp.WithAPIKey("sk-xxx"),
+    mcp.WithLogger(customLogger),
+    mcp.WithTimeout(60 * time.Second),
+    mcp.WithMaxRetries(5),
+    mcp.WithMaxTokens(4000),
+)
+```
+
+---
+
+## 📊 API 对比表
+
+### 构造函数对比
+
+| 旧 API (仍可用) | 新 API (推荐) | 说明 |
+|----------------|--------------|------|
+| `mcp.New()` | `mcp.NewClient(opts...)` | 支持选项模式 |
+| `mcp.NewDeepSeekClient()` | `mcp.NewDeepSeekClientWithOptions(opts...)` | 支持自定义配置 |
+| `mcp.NewQwenClient()` | `mcp.NewQwenClientWithOptions(opts...)` | 支持自定义配置 |
+
+### 配置选项
+
+| 选项函数 | 说明 | 使用示例 |
+|---------|------|---------|
+| `WithLogger(logger)` | 自定义日志器 | `WithLogger(zapLogger)` |
+| `WithHTTPClient(client)` | 自定义 HTTP 客户端 | `WithHTTPClient(customHTTP)` |
+| `WithTimeout(duration)` | 设置超时 | `WithTimeout(60*time.Second)` |
+| `WithMaxRetries(n)` | 设置重试次数 | `WithMaxRetries(5)` |
+| `WithMaxTokens(n)` | 设置最大 token | `WithMaxTokens(4000)` |
+| `WithTemperature(t)` | 设置温度参数 | `WithTemperature(0.7)` |
+| `WithAPIKey(key)` | 设置 API Key | `WithAPIKey("sk-xxx")` |
+| `WithDeepSeekConfig(key)` | 快速配置 DeepSeek | `WithDeepSeekConfig("sk-xxx")` |
+| `WithQwenConfig(key)` | 快速配置 Qwen | `WithQwenConfig("sk-xxx")` |
+
+---
+
+## 🔧 迁移步骤
+
+### Phase 1: 继续使用现有代码（无需改动）
+
+```go
+// trader/auto_trader.go 中的现有代码
+mcpClient := mcp.New()
+
+if config.AIModel == "qwen" {
+    mcpClient = mcp.NewQwenClient()
+    mcpClient.SetAPIKey(config.QwenKey, config.CustomAPIURL, config.CustomModelName)
+} else {
+    mcpClient = mcp.NewDeepSeekClient()
+    mcpClient.SetAPIKey(config.DeepSeekKey, config.CustomAPIURL, config.CustomModelName)
+}
+
+// ✅ 继续工作，无需修改
+```
+
+### Phase 2: 可选升级到新 API（推荐）
+
+```go
+// 升级后的代码（可选）
+var mcpClient mcp.AIClient
+
+if config.AIModel == "qwen" {
+    mcpClient = mcp.NewQwenClientWithOptions(
+        mcp.WithAPIKey(config.QwenKey),
+        mcp.WithBaseURL(config.CustomAPIURL),
+        mcp.WithModel(config.CustomModelName),
+    )
+} else {
+    mcpClient = mcp.NewDeepSeekClientWithOptions(
+        mcp.WithAPIKey(config.DeepSeekKey),
+        mcp.WithBaseURL(config.CustomAPIURL),
+        mcp.WithModel(config.CustomModelName),
+    )
+}
+```
+
+### Phase 3: 添加自定义配置（高级）
+
+```go
+// 添加自定义日志
+customLogger := &MyZapLogger{zap.NewProduction()}
+
+mcpClient := mcp.NewDeepSeekClientWithOptions(
+    mcp.WithAPIKey(config.DeepSeekKey),
+    mcp.WithLogger(customLogger),        // 自定义日志
+    mcp.WithTimeout(90 * time.Second),   // 自定义超时
+    mcp.WithMaxRetries(5),               // 自定义重试次数
+)
+```
+
+---
+
+## 🎯 实际使用场景
+
+### 场景 1: 开发环境详细日志
+
+```go
+// 开发环境：使用详细日志
+devClient := mcp.NewClient(
+    mcp.WithDeepSeekConfig(apiKey),
+    mcp.WithLogger(&defaultLogger{}), // 详细日志
+)
+```
+
+### 场景 2: 生产环境结构化日志
+
+```go
+// 生产环境：使用 zap 结构化日志
+zapLogger, _ := zap.NewProduction()
+prodClient := mcp.NewClient(
+    mcp.WithDeepSeekConfig(apiKey),
+    mcp.WithLogger(&ZapLogger{zapLogger}),
+)
+```
+
+### 场景 3: 测试环境 Mock
+
+```go
+// 测试环境：Mock HTTP 响应
+mockHTTP := &MockHTTPClient{
+    Response: `{"choices":[{"message":{"content":"test"}}]}`,
+}
+
+testClient := mcp.NewClient(
+    mcp.WithHTTPClient(mockHTTP),
+    mcp.WithLogger(mcp.NewNoopLogger()), // 禁用日志
+)
+```
+
+### 场景 4: 需要代理的网络环境
+
+```go
+// 使用代理
+proxyURL, _ := url.Parse("http://proxy.company.com:8080")
+proxyClient := &http.Client{
+    Transport: &http.Transport{
+        Proxy: http.ProxyURL(proxyURL),
+    },
+}
+
+client := mcp.NewClient(
+    mcp.WithDeepSeekConfig(apiKey),
+    mcp.WithHTTPClient(proxyClient),
+)
+```
+
+---
+
+## 📦 作为独立模块发布
+
+重构后，mcp 模块可以独立发布：
+
+### go.mod
+```go
+module github.com/yourorg/mcp
+
+go 1.21
+
+// 无外部依赖！
+```
+
+### 使用方
+```go
+import "github.com/yourorg/mcp"
+
+client := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+)
+```
+
+---
+
+## 🧪 测试支持
+
+### Mock 示例
+
+```go
+package mypackage_test
+
+import (
+    "testing"
+    "github.com/stretchr/testify/assert"
+    "nofx/mcp"
+)
+
+type MockHTTPClient struct {
+    Response string
+    Error    error
+}
+
+func (m *MockHTTPClient) Do(req *http.Request) (*http.Response, error) {
+    if m.Error != nil {
+        return nil, m.Error
+    }
+
+    return &http.Response{
+        StatusCode: 200,
+        Body:       io.NopCloser(strings.NewReader(m.Response)),
+    }, nil
+}
+
+func TestAIIntegration(t *testing.T) {
+    // Arrange
+    mockHTTP := &MockHTTPClient{
+        Response: `{"choices":[{"message":{"content":"success"}}]}`,
+    }
+
+    client := mcp.NewClient(
+        mcp.WithHTTPClient(mockHTTP),
+        mcp.WithLogger(mcp.NewNoopLogger()),
+    )
+
+    // Act
+    result, err := client.CallWithMessages("system", "user")
+
+    // Assert
+    assert.NoError(t, err)
+    assert.Equal(t, "success", result)
+}
+```
+
+---
+
+## ⚠️ 注意事项
+
+1. **向前兼容性**
+   - 所有 `Deprecated` 的 API 会永久保留
+   - 现有代码可以继续使用，不会被破坏
+
+2. **渐进式迁移**
+   - 不需要一次性迁移所有代码
+   - 可以逐步采用新 API
+
+3. **配置优先级**
+   - 用户传入的选项优先级最高
+   - 环境变量次之
+   - 默认配置最低
+
+4. **日志器接口**
+   - 可以适配任何日志库（zap, logrus, etc.）
+   - 测试时可以使用 `NewNoopLogger()` 禁用日志
+
+---
+
+## 📚 进一步阅读
+
+- [选项模式详解](https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis)
+- [依赖注入最佳实践](https://go.dev/blog/wire)
+- [Go 接口设计原则](https://go.dev/blog/laws-of-reflection)
+
+---
+
+## 🤝 贡献
+
+欢迎提交 issue 和 PR！
+
+如有问题，请联系：[your-email@example.com]
diff --git a/mcp/intro/README.md b/mcp/intro/README.md
new file mode 100644
index 00000000..509b4c9c
--- /dev/null
+++ b/mcp/intro/README.md
@@ -0,0 +1,379 @@
+# MCP - Model Context Protocol Client
+
+一个灵活、可扩展的 AI 模型客户端库，支持 DeepSeek、Qwen 等多种 AI 提供商。
+
+## ✨ 特性
+
+- 🔌 **多 Provider 支持** - DeepSeek、Qwen、OpenAI 兼容 API
+- 🎯 **模板方法模式** - 固定流程，可扩展步骤
+- 🏗️ **构建器模式** - 支持多轮对话、Function Calling、精细参数控制
+- 📦 **零外部依赖** - 仅使用 Go 标准库
+- 🔧 **高度可配置** - 支持 Functional Options 模式
+- 🧪 **易于测试** - 支持依赖注入和 Mock
+- ⚡ **向前兼容** - 现有代码无需修改
+- 📝 **丰富的日志** - 可替换的日志接口
+
+## 🚀 快速开始
+
+### 基础用法
+
+```go
+import "nofx/mcp"
+
+// 创建客户端
+client := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+)
+
+// 调用 AI
+result, err := client.CallWithMessages("system prompt", "user prompt")
+if err != nil {
+    log.Fatal(err)
+}
+
+fmt.Println(result)
+```
+
+### DeepSeek 客户端
+
+```go
+client := mcp.NewDeepSeekClientWithOptions(
+    mcp.WithAPIKey("sk-xxx"),
+    mcp.WithTimeout(60 * time.Second),
+)
+```
+
+### Qwen 客户端
+
+```go
+client := mcp.NewQwenClientWithOptions(
+    mcp.WithAPIKey("sk-xxx"),
+    mcp.WithMaxTokens(4000),
+)
+```
+
+### 🏗️ 构建器模式（高级功能）
+
+构建器模式支持多轮对话、精细参数控制、Function Calling 等高级功能。
+
+#### 简单用法
+
+```go
+// 使用构建器创建请求
+request := mcp.NewRequestBuilder().
+    WithSystemPrompt("You are helpful").
+    WithUserPrompt("What is Go?").
+    WithTemperature(0.8).
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+#### 多轮对话
+
+```go
+// 构建包含历史的多轮对话
+request := mcp.NewRequestBuilder().
+    AddSystemMessage("You are a trading advisor").
+    AddUserMessage("Analyze BTC").
+    AddAssistantMessage("BTC is bullish...").
+    AddUserMessage("What about entry point?").  // 继续对话
+    WithTemperature(0.3).
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+#### 预设场景
+
+```go
+// 代码生成（低温度、精确）
+request := mcp.ForCodeGeneration().
+    WithUserPrompt("Generate a HTTP server").
+    Build()
+
+// 创意写作（高温度、随机）
+request := mcp.ForCreativeWriting().
+    WithUserPrompt("Write a story").
+    Build()
+
+// 聊天（平衡参数）
+request := mcp.ForChat().
+    WithUserPrompt("Hello").
+    Build()
+```
+
+#### Function Calling
+
+```go
+// 定义工具
+weatherParams := map[string]any{
+    "type": "object",
+    "properties": map[string]any{
+        "location": map[string]any{"type": "string"},
+    },
+}
+
+request := mcp.NewRequestBuilder().
+    WithUserPrompt("北京天气怎么样？").
+    AddFunction("get_weather", "Get weather", weatherParams).
+    WithToolChoice("auto").
+    Build()
+
+result, err := client.CallWithRequest(request)
+```
+
+## 📖 详细文档
+
+- [构建器模式完整示例](./BUILDER_EXAMPLES.md) - 多轮对话、Function Calling、参数控制
+- [构建器模式价值分析](./BUILDER_PATTERN_BENEFITS.md) - 为什么引入构建器模式
+- [迁移指南](./MIGRATION_GUIDE.md) - 从旧 API 迁移到新 API
+- [Logrus 集成](./LOGRUS_INTEGRATION.md) - 日志框架集成示例
+- [代码审查报告](./CODE_REVIEW.md) - 问题分析和修复记录
+
+## 🎛️ 配置选项
+
+### 依赖注入
+
+```go
+// 自定义日志器
+mcp.WithLogger(customLogger)
+
+// 自定义 HTTP 客户端
+mcp.WithHTTPClient(customHTTP)
+```
+
+### 超时和重试
+
+```go
+mcp.WithTimeout(60 * time.Second)
+mcp.WithMaxRetries(5)
+mcp.WithRetryWaitBase(3 * time.Second)
+```
+
+### AI 参数
+
+```go
+mcp.WithMaxTokens(4000)
+mcp.WithTemperature(0.7)
+```
+
+### Provider 配置
+
+```go
+// 快速配置 DeepSeek
+mcp.WithDeepSeekConfig("sk-xxx")
+
+// 快速配置 Qwen
+mcp.WithQwenConfig("sk-xxx")
+
+// 自定义配置
+mcp.WithAPIKey("sk-xxx")
+mcp.WithBaseURL("https://api.custom.com")
+mcp.WithModel("gpt-4")
+```
+
+## 🧪 测试
+
+```go
+// 使用 Mock HTTP 客户端
+mockHTTP := &MockHTTPClient{
+    Response: `{"choices":[{"message":{"content":"test"}}]}`,
+}
+
+client := mcp.NewClient(
+    mcp.WithHTTPClient(mockHTTP),
+    mcp.WithLogger(mcp.NewNoopLogger()), // 禁用日志
+)
+```
+
+## 🏗️ 架构设计
+
+### 模板方法模式
+
+```
+CallWithMessages (固定重试流程)
+    ↓
+call (固定调用流程)
+    ↓
+hooks (可重写的步骤)
+    ├─ buildMCPRequestBody
+    ├─ marshalRequestBody
+    ├─ buildUrl
+    ├─ setAuthHeader
+    ├─ parseMCPResponse
+    └─ isRetryableError
+```
+
+### 接口分离
+
+```go
+// 公开接口（给外部使用）
+type AIClient interface {
+    SetAPIKey(...)
+    SetTimeout(...)
+    CallWithMessages(...) (string, error)
+}
+
+// 内部钩子接口（供子类重写）
+type clientHooks interface {
+    buildMCPRequestBody(...) map[string]any
+    buildUrl() string
+    setAuthHeader(...)
+    marshalRequestBody(...) ([]byte, error)
+    parseMCPResponse(...) (string, error)
+    isRetryableError(...) bool
+}
+```
+
+## 🔄 向前兼容
+
+所有旧 API 继续工作：
+
+```go
+// ✅ 旧代码无需修改
+client := mcp.New()
+client.SetAPIKey("sk-xxx", "https://api.custom.com", "gpt-4")
+
+dsClient := mcp.NewDeepSeekClient()
+dsClient.SetAPIKey("sk-xxx", "", "")
+```
+
+## 📦 作为独立模块使用
+
+```go
+// go.mod
+module github.com/yourorg/yourproject
+
+require github.com/yourorg/mcp v1.0.0
+```
+
+```go
+// main.go
+import "github.com/yourorg/mcp"
+
+client := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+)
+```
+
+## 🤝 扩展自定义 Provider
+
+```go
+type CustomProvider struct {
+    *mcp.Client
+}
+
+// 重写特定钩子
+func (c *CustomProvider) buildUrl() string {
+    return c.BaseURL + "/custom/endpoint"
+}
+
+func (c *CustomProvider) setAuthHeader(headers http.Header) {
+    headers.Set("X-Custom-Auth", c.APIKey)
+}
+```
+
+## 📝 日志器适配示例
+
+### Zap 日志器
+
+```go
+type ZapLogger struct {
+    logger *zap.Logger
+}
+
+func (l *ZapLogger) Infof(format string, args ...any) {
+    l.logger.Sugar().Infof(format, args...)
+}
+
+func (l *ZapLogger) Debugf(format string, args ...any) {
+    l.logger.Sugar().Debugf(format, args...)
+}
+
+// 使用
+client := mcp.NewClient(
+    mcp.WithLogger(&ZapLogger{zapLogger}),
+)
+```
+
+### Logrus 日志器
+
+```go
+type LogrusLogger struct {
+    logger *logrus.Logger
+}
+
+func (l *LogrusLogger) Infof(format string, args ...any) {
+    l.logger.Infof(format, args...)
+}
+
+func (l *LogrusLogger) Debugf(format string, args ...any) {
+    l.logger.Debugf(format, args...)
+}
+```
+
+## 🎯 使用场景
+
+### 开发环境
+
+```go
+devClient := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+    mcp.WithLogger(&customLogger{}), // 详细日志
+)
+```
+
+### 生产环境
+
+```go
+prodClient := mcp.NewClient(
+    mcp.WithDeepSeekConfig("sk-xxx"),
+    mcp.WithLogger(&zapLogger{}),     // 结构化日志
+    mcp.WithTimeout(30*time.Second),  // 超时保护
+    mcp.WithMaxRetries(3),            // 重试保护
+)
+```
+
+### 测试环境
+
+```go
+testClient := mcp.NewClient(
+    mcp.WithHTTPClient(mockHTTP),
+    mcp.WithLogger(mcp.NewNoopLogger()),
+)
+```
+
+## 📊 性能特性
+
+- ✅ HTTP 连接复用
+- ✅ 智能重试机制
+- ✅ 可配置超时
+- ✅ 零分配日志（使用 NoopLogger）
+
+## 🛡️ 安全性
+
+- ✅ API Key 部分脱敏日志
+- ✅ HTTPS 默认启用
+- ✅ 支持自定义 TLS 配置
+- ✅ 请求超时保护
+
+## 📈 版本兼容性
+
+- Go 1.18+
+- 向前兼容保证
+- 语义化版本管理
+
+## 🤝 贡献
+
+欢迎提交 Issue 和 Pull Request！
+
+## 📄 许可证
+
+MIT License
+
+## 🔗 相关链接
+
+- [DeepSeek API 文档](https://platform.deepseek.com/docs)
+- [Qwen API 文档](https://help.aliyun.com/zh/dashscope/)
+- [OpenAI API 文档](https://platform.openai.com/docs)
diff --git a/mcp/logger.go b/mcp/logger.go
new file mode 100644
index 00000000..863310db
--- /dev/null
+++ b/mcp/logger.go
@@ -0,0 +1,68 @@
+package mcp
+
+import "log"
+
+// Logger 日志接口（抽象依赖）
+// 使用 Printf 风格的方法名，方便集成 logrus、zap 等主流日志库
+type Logger interface {
+	Debugf(format string, args ...any)
+	Infof(format string, args ...any)
+	Warnf(format string, args ...any)
+	Errorf(format string, args ...any)
+}
+
+// defaultLogger 默认日志实现（包装标准库 log）
+type defaultLogger struct{}
+
+func (l *defaultLogger) Debugf(format string, args ...any) {
+	log.Printf("[DEBUG] "+format, args...)
+}
+
+func (l *defaultLogger) Infof(format string, args ...any) {
+	log.Printf("[INFO] "+format, args...)
+}
+
+func (l *defaultLogger) Warnf(format string, args ...any) {
+	log.Printf("[WARN] "+format, args...)
+}
+
+func (l *defaultLogger) Errorf(format string, args ...any) {
+	log.Printf("[ERROR] "+format, args...)
+}
+
+// noopLogger 空日志实现（测试时使用）
+type noopLogger struct{}
+
+func (l *noopLogger) Debugf(format string, args ...any) {}
+func (l *noopLogger) Infof(format string, args ...any)  {}
+func (l *noopLogger) Warnf(format string, args ...any)  {}
+func (l *noopLogger) Errorf(format string, args ...any) {}
+
+// NewNoopLogger 创建空日志器（测试使用）
+func NewNoopLogger() Logger {
+	return &noopLogger{}
+}
+
+// ============================================================
+// 适配第三方日志库示例
+// ============================================================
+
+// Logrus 适配示例：
+// type LogrusLogger struct {
+//     logger *logrus.Logger
+// }
+//
+// func (l *LogrusLogger) Infof(format string, args ...any) {
+//     l.logger.Infof(format, args...)
+// }
+//
+// Zap 适配示例：
+// type ZapLogger struct {
+//     logger *zap.Logger
+// }
+//
+// func (l *ZapLogger) Infof(format string, args ...any) {
+//     l.logger.Sugar().Infof(format, args...)
+// }
+//
+// 然后通过 WithLogger(logger) 注入
diff --git a/mcp/mock_test.go b/mcp/mock_test.go
new file mode 100644
index 00000000..6c39b099
--- /dev/null
+++ b/mcp/mock_test.go
@@ -0,0 +1,310 @@
+package mcp
+
+import (
+	"bytes"
+	"encoding/json"
+	"fmt"
+	"io"
+	"net/http"
+	"sync"
+)
+
+// ============================================================
+// Mock Logger
+// ============================================================
+
+// MockLogger Mock 日志器（用于测试）
+type MockLogger struct {
+	mu      sync.Mutex
+	Logs    []LogEntry
+	Enabled bool // 是否启用日志记录
+}
+
+// LogEntry 日志条目
+type LogEntry struct {
+	Level   string
+	Format  string
+	Args    []any
+	Message string // 格式化后的消息
+}
+
+func NewMockLogger() *MockLogger {
+	return &MockLogger{
+		Logs:    make([]LogEntry, 0),
+		Enabled: true,
+	}
+}
+
+func (m *MockLogger) Debugf(format string, args ...any) {
+	m.log("DEBUG", format, args...)
+}
+
+func (m *MockLogger) Infof(format string, args ...any) {
+	m.log("INFO", format, args...)
+}
+
+func (m *MockLogger) Warnf(format string, args ...any) {
+	m.log("WARN", format, args...)
+}
+
+func (m *MockLogger) Errorf(format string, args ...any) {
+	m.log("ERROR", format, args...)
+}
+
+func (m *MockLogger) log(level, format string, args ...any) {
+	if !m.Enabled {
+		return
+	}
+
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	message := fmt.Sprintf(format, args...)
+	m.Logs = append(m.Logs, LogEntry{
+		Level:   level,
+		Format:  format,
+		Args:    args,
+		Message: message,
+	})
+}
+
+// GetLogs 获取所有日志
+func (m *MockLogger) GetLogs() []LogEntry {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+	return append([]LogEntry{}, m.Logs...)
+}
+
+// GetLogsByLevel 获取指定级别的日志
+func (m *MockLogger) GetLogsByLevel(level string) []LogEntry {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	var result []LogEntry
+	for _, log := range m.Logs {
+		if log.Level == level {
+			result = append(result, log)
+		}
+	}
+	return result
+}
+
+// Clear 清空日志
+func (m *MockLogger) Clear() {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+	m.Logs = make([]LogEntry, 0)
+}
+
+// HasLog 检查是否包含指定消息
+func (m *MockLogger) HasLog(level, message string) bool {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	for _, log := range m.Logs {
+		if log.Level == level && log.Message == message {
+			return true
+		}
+	}
+	return false
+}
+
+// ============================================================
+// Mock HTTP Client (实现 http.RoundTripper)
+// ============================================================
+
+// MockHTTPClient Mock HTTP 客户端（实现 http.RoundTripper）
+type MockHTTPClient struct {
+	mu sync.Mutex
+
+	// 配置
+	Response     string
+	StatusCode   int
+	Error        error
+	ResponseFunc func(req *http.Request) (*http.Response, error) // 自定义响应函数
+
+	// 记录
+	Requests []*http.Request
+}
+
+func NewMockHTTPClient() *MockHTTPClient {
+	return &MockHTTPClient{
+		StatusCode: http.StatusOK,
+		Requests:   make([]*http.Request, 0),
+	}
+}
+
+// ToHTTPClient 转换为 http.Client
+func (m *MockHTTPClient) ToHTTPClient() *http.Client {
+	return &http.Client{
+		Transport: m,
+	}
+}
+
+// RoundTrip 实现 http.RoundTripper 接口
+func (m *MockHTTPClient) RoundTrip(req *http.Request) (*http.Response, error) {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	// 记录请求
+	m.Requests = append(m.Requests, req)
+
+	// 如果有自定义响应函数，使用它
+	if m.ResponseFunc != nil {
+		return m.ResponseFunc(req)
+	}
+
+	// 如果设置了错误，返回错误
+	if m.Error != nil {
+		return nil, m.Error
+	}
+
+	// 返回模拟响应
+	resp := &http.Response{
+		StatusCode: m.StatusCode,
+		Body:       io.NopCloser(bytes.NewBufferString(m.Response)),
+		Header:     make(http.Header),
+	}
+
+	return resp, nil
+}
+
+// GetRequests 获取所有请求
+func (m *MockHTTPClient) GetRequests() []*http.Request {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+	return append([]*http.Request{}, m.Requests...)
+}
+
+// GetLastRequest 获取最后一次请求
+func (m *MockHTTPClient) GetLastRequest() *http.Request {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	if len(m.Requests) == 0 {
+		return nil
+	}
+	return m.Requests[len(m.Requests)-1]
+}
+
+// Reset 重置状态
+func (m *MockHTTPClient) Reset() {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+	m.Requests = make([]*http.Request, 0)
+}
+
+// SetSuccessResponse 设置成功响应
+func (m *MockHTTPClient) SetSuccessResponse(content string) {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	m.StatusCode = http.StatusOK
+	m.Response = `{"choices":[{"message":{"content":"` + content + `"}}]}`
+	m.Error = nil
+}
+
+// SetErrorResponse 设置错误响应
+func (m *MockHTTPClient) SetErrorResponse(statusCode int, message string) {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	m.StatusCode = statusCode
+	m.Response = message
+	m.Error = nil
+}
+
+// SetNetworkError 设置网络错误
+func (m *MockHTTPClient) SetNetworkError(err error) {
+	m.mu.Lock()
+	defer m.mu.Unlock()
+
+	m.Error = err
+}
+
+// ============================================================
+// Mock Client Hooks (用于测试钩子机制)
+// ============================================================
+
+// MockClientHooks Mock 客户端钩子
+type MockClientHooks struct {
+	BuildRequestBodyCalled int
+	BuildUrlCalled         int
+	SetAuthHeaderCalled    int
+	MarshalRequestCalled   int
+	ParseResponseCalled    int
+	IsRetryableErrorCalled int
+
+	// 自定义返回值
+	BuildUrlFunc           func() string
+	ParseResponseFunc      func([]byte) (string, error)
+	IsRetryableErrorFunc   func(error) bool
+	BuildRequestBodyFunc   func(string, string) map[string]any
+	MarshalRequestBodyFunc func(map[string]any) ([]byte, error)
+}
+
+func NewMockClientHooks() *MockClientHooks {
+	return &MockClientHooks{}
+}
+
+func (m *MockClientHooks) buildMCPRequestBody(systemPrompt, userPrompt string) map[string]any {
+	m.BuildRequestBodyCalled++
+	if m.BuildRequestBodyFunc != nil {
+		return m.BuildRequestBodyFunc(systemPrompt, userPrompt)
+	}
+	return map[string]any{
+		"model": "test-model",
+		"messages": []map[string]string{
+			{"role": "system", "content": systemPrompt},
+			{"role": "user", "content": userPrompt},
+		},
+	}
+}
+
+func (m *MockClientHooks) buildUrl() string {
+	m.BuildUrlCalled++
+	if m.BuildUrlFunc != nil {
+		return m.BuildUrlFunc()
+	}
+	return "https://api.test.com/chat/completions"
+}
+
+func (m *MockClientHooks) setAuthHeader(headers http.Header) {
+	m.SetAuthHeaderCalled++
+	headers.Set("Authorization", "Bearer test-key")
+}
+
+func (m *MockClientHooks) marshalRequestBody(body map[string]any) ([]byte, error) {
+	m.MarshalRequestCalled++
+	if m.MarshalRequestBodyFunc != nil {
+		return m.MarshalRequestBodyFunc(body)
+	}
+	return json.Marshal(body)
+}
+
+func (m *MockClientHooks) parseMCPResponse(body []byte) (string, error) {
+	m.ParseResponseCalled++
+	if m.ParseResponseFunc != nil {
+		return m.ParseResponseFunc(body)
+	}
+	return "mocked response", nil
+}
+
+func (m *MockClientHooks) isRetryableError(err error) bool {
+	m.IsRetryableErrorCalled++
+	if m.IsRetryableErrorFunc != nil {
+		return m.IsRetryableErrorFunc(err)
+	}
+	return false
+}
+
+func (m *MockClientHooks) buildRequest(url string, jsonData []byte) (*http.Request, error) {
+	req, _ := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
+	req.Header.Set("Content-Type", "application/json")
+	m.setAuthHeader(req.Header)
+	return req, nil
+}
+
+func (m *MockClientHooks) call(systemPrompt, userPrompt string) (string, error) {
+	return "mocked call result", nil
+}
diff --git a/mcp/options.go b/mcp/options.go
new file mode 100644
index 00000000..c460224f
--- /dev/null
+++ b/mcp/options.go
@@ -0,0 +1,162 @@
+package mcp
+
+import (
+	"net/http"
+	"time"
+)
+
+// ClientOption 客户端选项函数（Functional Options 模式）
+type ClientOption func(*Config)
+
+// ============================================================
+// 依赖注入选项
+// ============================================================
+
+// WithLogger 设置自定义日志器
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithLogger(customLogger))
+func WithLogger(logger Logger) ClientOption {
+	return func(c *Config) {
+		c.Logger = logger
+	}
+}
+
+// WithHTTPClient 设置自定义 HTTP 客户端
+//
+// 使用示例：
+//   httpClient := &http.Client{Timeout: 60 * time.Second}
+//   client := mcp.NewClient(mcp.WithHTTPClient(httpClient))
+func WithHTTPClient(client *http.Client) ClientOption {
+	return func(c *Config) {
+		c.HTTPClient = client
+	}
+}
+
+// ============================================================
+// 超时和重试选项
+// ============================================================
+
+// WithTimeout 设置请求超时时间
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithTimeout(60 * time.Second))
+func WithTimeout(timeout time.Duration) ClientOption {
+	return func(c *Config) {
+		c.Timeout = timeout
+		c.HTTPClient.Timeout = timeout
+	}
+}
+
+// WithMaxRetries 设置最大重试次数
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithMaxRetries(5))
+func WithMaxRetries(maxRetries int) ClientOption {
+	return func(c *Config) {
+		c.MaxRetries = maxRetries
+	}
+}
+
+// WithRetryWaitBase 设置重试等待基础时长
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithRetryWaitBase(3 * time.Second))
+func WithRetryWaitBase(waitTime time.Duration) ClientOption {
+	return func(c *Config) {
+		c.RetryWaitBase = waitTime
+	}
+}
+
+// ============================================================
+// AI 参数选项
+// ============================================================
+
+// WithMaxTokens 设置最大 token 数
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithMaxTokens(4000))
+func WithMaxTokens(maxTokens int) ClientOption {
+	return func(c *Config) {
+		c.MaxTokens = maxTokens
+	}
+}
+
+// WithTemperature 设置温度参数
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithTemperature(0.7))
+func WithTemperature(temperature float64) ClientOption {
+	return func(c *Config) {
+		c.Temperature = temperature
+	}
+}
+
+// ============================================================
+// Provider 配置选项
+// ============================================================
+
+// WithAPIKey 设置 API Key
+func WithAPIKey(apiKey string) ClientOption {
+	return func(c *Config) {
+		c.APIKey = apiKey
+	}
+}
+
+// WithBaseURL 设置基础 URL
+func WithBaseURL(baseURL string) ClientOption {
+	return func(c *Config) {
+		c.BaseURL = baseURL
+	}
+}
+
+// WithModel 设置模型名称
+func WithModel(model string) ClientOption {
+	return func(c *Config) {
+		c.Model = model
+	}
+}
+
+// WithProvider 设置提供商
+func WithProvider(provider string) ClientOption {
+	return func(c *Config) {
+		c.Provider = provider
+	}
+}
+
+// WithUseFullURL 设置是否使用完整 URL
+func WithUseFullURL(useFullURL bool) ClientOption {
+	return func(c *Config) {
+		c.UseFullURL = useFullURL
+	}
+}
+
+// ============================================================
+// 组合选项（便捷方法）
+// ============================================================
+
+// WithDeepSeekConfig 设置 DeepSeek 配置
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithDeepSeekConfig("sk-xxx"))
+func WithDeepSeekConfig(apiKey string) ClientOption {
+	return func(c *Config) {
+		c.Provider = ProviderDeepSeek
+		c.APIKey = apiKey
+		c.BaseURL = DefaultDeepSeekBaseURL
+		c.Model = DefaultDeepSeekModel
+	}
+}
+
+// WithQwenConfig 设置 Qwen 配置
+//
+// 使用示例：
+//   client := mcp.NewClient(mcp.WithQwenConfig("sk-xxx"))
+func WithQwenConfig(apiKey string) ClientOption {
+	return func(c *Config) {
+		c.Provider = ProviderQwen
+		c.APIKey = apiKey
+		c.BaseURL = DefaultQwenBaseURL
+		c.Model = DefaultQwenModel
+	}
+}
diff --git a/mcp/options_test.go b/mcp/options_test.go
new file mode 100644
index 00000000..67ad5b9b
--- /dev/null
+++ b/mcp/options_test.go
@@ -0,0 +1,365 @@
+package mcp
+
+import (
+	"net/http"
+	"testing"
+	"time"
+)
+
+// ============================================================
+// 测试基础选项
+// ============================================================
+
+func TestWithProvider(t *testing.T) {
+	cfg := DefaultConfig()
+	WithProvider("custom-provider")(cfg)
+
+	if cfg.Provider != "custom-provider" {
+		t.Errorf("expected 'custom-provider', got '%s'", cfg.Provider)
+	}
+}
+
+func TestWithAPIKey(t *testing.T) {
+	cfg := DefaultConfig()
+	WithAPIKey("sk-test-key")(cfg)
+
+	if cfg.APIKey != "sk-test-key" {
+		t.Errorf("expected 'sk-test-key', got '%s'", cfg.APIKey)
+	}
+}
+
+func TestWithBaseURL(t *testing.T) {
+	cfg := DefaultConfig()
+	WithBaseURL("https://api.test.com")(cfg)
+
+	if cfg.BaseURL != "https://api.test.com" {
+		t.Errorf("expected 'https://api.test.com', got '%s'", cfg.BaseURL)
+	}
+}
+
+func TestWithModel(t *testing.T) {
+	cfg := DefaultConfig()
+	WithModel("test-model")(cfg)
+
+	if cfg.Model != "test-model" {
+		t.Errorf("expected 'test-model', got '%s'", cfg.Model)
+	}
+}
+
+func TestWithMaxTokens(t *testing.T) {
+	cfg := DefaultConfig()
+	WithMaxTokens(4000)(cfg)
+
+	if cfg.MaxTokens != 4000 {
+		t.Errorf("expected 4000, got %d", cfg.MaxTokens)
+	}
+}
+
+func TestWithTemperature(t *testing.T) {
+	cfg := DefaultConfig()
+	WithTemperature(0.8)(cfg)
+
+	if cfg.Temperature != 0.8 {
+		t.Errorf("expected 0.8, got %f", cfg.Temperature)
+	}
+}
+
+func TestWithUseFullURL(t *testing.T) {
+	cfg := DefaultConfig()
+	WithUseFullURL(true)(cfg)
+
+	if !cfg.UseFullURL {
+		t.Error("UseFullURL should be true")
+	}
+}
+
+func TestWithMaxRetries(t *testing.T) {
+	cfg := DefaultConfig()
+	WithMaxRetries(5)(cfg)
+
+	if cfg.MaxRetries != 5 {
+		t.Errorf("expected 5, got %d", cfg.MaxRetries)
+	}
+}
+
+func TestWithTimeout(t *testing.T) {
+	cfg := DefaultConfig()
+	WithTimeout(60 * time.Second)(cfg)
+
+	if cfg.Timeout != 60*time.Second {
+		t.Errorf("expected 60s, got %v", cfg.Timeout)
+	}
+}
+
+func TestWithLogger(t *testing.T) {
+	cfg := DefaultConfig()
+	mockLogger := NewMockLogger()
+	WithLogger(mockLogger)(cfg)
+
+	if cfg.Logger != mockLogger {
+		t.Error("Logger should be set to mockLogger")
+	}
+}
+
+func TestWithHTTPClient(t *testing.T) {
+	cfg := DefaultConfig()
+	customClient := &http.Client{Timeout: 30 * time.Second}
+	WithHTTPClient(customClient)(cfg)
+
+	if cfg.HTTPClient != customClient {
+		t.Error("HTTPClient should be set to customClient")
+	}
+
+	if cfg.HTTPClient.Timeout != 30*time.Second {
+		t.Errorf("expected 30s, got %v", cfg.HTTPClient.Timeout)
+	}
+}
+
+// ============================================================
+// 测试预设配置选项
+// ============================================================
+
+func TestWithDeepSeekConfig(t *testing.T) {
+	cfg := DefaultConfig()
+	WithDeepSeekConfig("sk-deepseek-key")(cfg)
+
+	if cfg.Provider != ProviderDeepSeek {
+		t.Errorf("Provider should be '%s', got '%s'", ProviderDeepSeek, cfg.Provider)
+	}
+
+	if cfg.APIKey != "sk-deepseek-key" {
+		t.Errorf("APIKey should be 'sk-deepseek-key', got '%s'", cfg.APIKey)
+	}
+
+	if cfg.BaseURL != DefaultDeepSeekBaseURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", DefaultDeepSeekBaseURL, cfg.BaseURL)
+	}
+
+	if cfg.Model != DefaultDeepSeekModel {
+		t.Errorf("Model should be '%s', got '%s'", DefaultDeepSeekModel, cfg.Model)
+	}
+}
+
+func TestWithQwenConfig(t *testing.T) {
+	cfg := DefaultConfig()
+	WithQwenConfig("sk-qwen-key")(cfg)
+
+	if cfg.Provider != ProviderQwen {
+		t.Errorf("Provider should be '%s', got '%s'", ProviderQwen, cfg.Provider)
+	}
+
+	if cfg.APIKey != "sk-qwen-key" {
+		t.Errorf("APIKey should be 'sk-qwen-key', got '%s'", cfg.APIKey)
+	}
+
+	if cfg.BaseURL != DefaultQwenBaseURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", DefaultQwenBaseURL, cfg.BaseURL)
+	}
+
+	if cfg.Model != DefaultQwenModel {
+		t.Errorf("Model should be '%s', got '%s'", DefaultQwenModel, cfg.Model)
+	}
+}
+
+// ============================================================
+// 测试选项组合
+// ============================================================
+
+func TestMultipleOptions(t *testing.T) {
+	mockLogger := NewMockLogger()
+
+	cfg := DefaultConfig()
+
+	// 应用多个选项
+	options := []ClientOption{
+		WithProvider("test-provider"),
+		WithAPIKey("sk-test-key"),
+		WithBaseURL("https://api.test.com"),
+		WithModel("test-model"),
+		WithMaxTokens(4000),
+		WithTemperature(0.8),
+		WithLogger(mockLogger),
+		WithTimeout(60 * time.Second),
+	}
+
+	for _, opt := range options {
+		opt(cfg)
+	}
+
+	// 验证所有选项都被应用
+	if cfg.Provider != "test-provider" {
+		t.Error("Provider should be set")
+	}
+
+	if cfg.APIKey != "sk-test-key" {
+		t.Error("APIKey should be set")
+	}
+
+	if cfg.BaseURL != "https://api.test.com" {
+		t.Error("BaseURL should be set")
+	}
+
+	if cfg.Model != "test-model" {
+		t.Error("Model should be set")
+	}
+
+	if cfg.MaxTokens != 4000 {
+		t.Error("MaxTokens should be 4000")
+	}
+
+	if cfg.Temperature != 0.8 {
+		t.Error("Temperature should be 0.8")
+	}
+
+	if cfg.Logger != mockLogger {
+		t.Error("Logger should be mockLogger")
+	}
+
+	if cfg.Timeout != 60*time.Second {
+		t.Error("Timeout should be 60s")
+	}
+}
+
+func TestOptionsOverride(t *testing.T) {
+	cfg := DefaultConfig()
+
+	// 先应用 DeepSeek 配置
+	WithDeepSeekConfig("sk-deepseek-key")(cfg)
+
+	// 然后覆盖某些选项
+	WithModel("custom-model")(cfg)
+	WithMaxTokens(5000)(cfg)
+
+	// 验证覆盖成功
+	if cfg.Model != "custom-model" {
+		t.Errorf("Model should be overridden to 'custom-model', got '%s'", cfg.Model)
+	}
+
+	if cfg.MaxTokens != 5000 {
+		t.Errorf("MaxTokens should be overridden to 5000, got %d", cfg.MaxTokens)
+	}
+
+	// 验证其他 DeepSeek 配置保持不变
+	if cfg.Provider != ProviderDeepSeek {
+		t.Error("Provider should still be DeepSeek")
+	}
+
+	if cfg.BaseURL != DefaultDeepSeekBaseURL {
+		t.Error("BaseURL should still be DeepSeek default")
+	}
+}
+
+// ============================================================
+// 测试与客户端集成
+// ============================================================
+
+func TestOptionsWithNewClient(t *testing.T) {
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithProvider("test-provider"),
+		WithAPIKey("sk-test-key"),
+		WithModel("test-model"),
+		WithLogger(mockLogger),
+		WithMaxTokens(4000),
+	)
+
+	c := client.(*Client)
+
+	// 验证选项被正确应用到客户端
+	if c.Provider != "test-provider" {
+		t.Error("Provider should be set from options")
+	}
+
+	if c.APIKey != "sk-test-key" {
+		t.Error("APIKey should be set from options")
+	}
+
+	if c.Model != "test-model" {
+		t.Error("Model should be set from options")
+	}
+
+	if c.logger != mockLogger {
+		t.Error("logger should be set from options")
+	}
+
+	if c.MaxTokens != 4000 {
+		t.Error("MaxTokens should be 4000")
+	}
+}
+
+func TestOptionsWithDeepSeekClient(t *testing.T) {
+	mockLogger := NewMockLogger()
+
+	client := NewDeepSeekClientWithOptions(
+		WithAPIKey("sk-deepseek-key"),
+		WithLogger(mockLogger),
+		WithMaxTokens(5000),
+	)
+
+	dsClient := client.(*DeepSeekClient)
+
+	// 验证 DeepSeek 默认值
+	if dsClient.Provider != ProviderDeepSeek {
+		t.Error("Provider should be DeepSeek")
+	}
+
+	if dsClient.BaseURL != DefaultDeepSeekBaseURL {
+		t.Error("BaseURL should be DeepSeek default")
+	}
+
+	if dsClient.Model != DefaultDeepSeekModel {
+		t.Error("Model should be DeepSeek default")
+	}
+
+	// 验证自定义选项
+	if dsClient.APIKey != "sk-deepseek-key" {
+		t.Error("APIKey should be set from options")
+	}
+
+	if dsClient.logger != mockLogger {
+		t.Error("logger should be set from options")
+	}
+
+	if dsClient.MaxTokens != 5000 {
+		t.Error("MaxTokens should be 5000")
+	}
+}
+
+func TestOptionsWithQwenClient(t *testing.T) {
+	mockLogger := NewMockLogger()
+
+	client := NewQwenClientWithOptions(
+		WithAPIKey("sk-qwen-key"),
+		WithLogger(mockLogger),
+		WithMaxTokens(6000),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	// 验证 Qwen 默认值
+	if qwenClient.Provider != ProviderQwen {
+		t.Error("Provider should be Qwen")
+	}
+
+	if qwenClient.BaseURL != DefaultQwenBaseURL {
+		t.Error("BaseURL should be Qwen default")
+	}
+
+	if qwenClient.Model != DefaultQwenModel {
+		t.Error("Model should be Qwen default")
+	}
+
+	// 验证自定义选项
+	if qwenClient.APIKey != "sk-qwen-key" {
+		t.Error("APIKey should be set from options")
+	}
+
+	if qwenClient.logger != mockLogger {
+		t.Error("logger should be set from options")
+	}
+
+	if qwenClient.MaxTokens != 6000 {
+		t.Error("MaxTokens should be 6000")
+	}
+}
diff --git a/mcp/qwen_client.go b/mcp/qwen_client.go
new file mode 100644
index 00000000..f790d08d
--- /dev/null
+++ b/mcp/qwen_client.go
@@ -0,0 +1,83 @@
+package mcp
+
+import (
+	"net/http"
+)
+
+const (
+	ProviderQwen       = "qwen"
+	DefaultQwenBaseURL = "https://dashscope.aliyuncs.com/compatible-mode/v1"
+	DefaultQwenModel   = "qwen3-max"
+)
+
+type QwenClient struct {
+	*Client
+}
+
+// NewQwenClient 创建 Qwen 客户端（向前兼容）
+//
+// Deprecated: 推荐使用 NewQwenClientWithOptions 以获得更好的灵活性
+func NewQwenClient() AIClient {
+	return NewQwenClientWithOptions()
+}
+
+// NewQwenClientWithOptions 创建 Qwen 客户端（支持选项模式）
+//
+// 使用示例：
+//   // 基础用法
+//   client := mcp.NewQwenClientWithOptions()
+//
+//   // 自定义配置
+//   client := mcp.NewQwenClientWithOptions(
+//       mcp.WithAPIKey("sk-xxx"),
+//       mcp.WithLogger(customLogger),
+//       mcp.WithTimeout(60*time.Second),
+//   )
+func NewQwenClientWithOptions(opts ...ClientOption) AIClient {
+	// 1. 创建 Qwen 预设选项
+	qwenOpts := []ClientOption{
+		WithProvider(ProviderQwen),
+		WithModel(DefaultQwenModel),
+		WithBaseURL(DefaultQwenBaseURL),
+	}
+
+	// 2. 合并用户选项（用户选项优先级更高）
+	allOpts := append(qwenOpts, opts...)
+
+	// 3. 创建基础客户端
+	baseClient := NewClient(allOpts...).(*Client)
+
+	// 4. 创建 Qwen 客户端
+	qwenClient := &QwenClient{
+		Client: baseClient,
+	}
+
+	// 5. 设置 hooks 指向 QwenClient（实现动态分派）
+	baseClient.hooks = qwenClient
+
+	return qwenClient
+}
+
+func (qwenClient *QwenClient) SetAPIKey(apiKey string, customURL string, customModel string) {
+	qwenClient.APIKey = apiKey
+
+	if len(apiKey) > 8 {
+		qwenClient.logger.Infof("🔧 [MCP] Qwen API Key: %s...%s", apiKey[:4], apiKey[len(apiKey)-4:])
+	}
+	if customURL != "" {
+		qwenClient.BaseURL = customURL
+		qwenClient.logger.Infof("🔧 [MCP] Qwen 使用自定义 BaseURL: %s", customURL)
+	} else {
+		qwenClient.logger.Infof("🔧 [MCP] Qwen 使用默认 BaseURL: %s", qwenClient.BaseURL)
+	}
+	if customModel != "" {
+		qwenClient.Model = customModel
+		qwenClient.logger.Infof("🔧 [MCP] Qwen 使用自定义 Model: %s", customModel)
+	} else {
+		qwenClient.logger.Infof("🔧 [MCP] Qwen 使用默认 Model: %s", qwenClient.Model)
+	}
+}
+
+func (qwenClient *QwenClient) setAuthHeader(reqHeaders http.Header) {
+	qwenClient.Client.setAuthHeader(reqHeaders)
+}
diff --git a/mcp/qwen_client_test.go b/mcp/qwen_client_test.go
new file mode 100644
index 00000000..d8f0c44c
--- /dev/null
+++ b/mcp/qwen_client_test.go
@@ -0,0 +1,272 @@
+package mcp
+
+import (
+	"testing"
+	"time"
+)
+
+// ============================================================
+// 测试 QwenClient 创建和配置
+// ============================================================
+
+func TestNewQwenClient_Default(t *testing.T) {
+	client := NewQwenClient()
+
+	if client == nil {
+		t.Fatal("client should not be nil")
+	}
+
+	// 类型断言检查
+	qwenClient, ok := client.(*QwenClient)
+	if !ok {
+		t.Fatal("client should be *QwenClient")
+	}
+
+	// 验证默认值
+	if qwenClient.Provider != ProviderQwen {
+		t.Errorf("Provider should be '%s', got '%s'", ProviderQwen, qwenClient.Provider)
+	}
+
+	if qwenClient.BaseURL != DefaultQwenBaseURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", DefaultQwenBaseURL, qwenClient.BaseURL)
+	}
+
+	if qwenClient.Model != DefaultQwenModel {
+		t.Errorf("Model should be '%s', got '%s'", DefaultQwenModel, qwenClient.Model)
+	}
+
+	if qwenClient.logger == nil {
+		t.Error("logger should not be nil")
+	}
+
+	if qwenClient.httpClient == nil {
+		t.Error("httpClient should not be nil")
+	}
+}
+
+func TestNewQwenClientWithOptions(t *testing.T) {
+	mockLogger := NewMockLogger()
+	customModel := "qwen-plus"
+	customAPIKey := "sk-custom-qwen-key"
+
+	client := NewQwenClientWithOptions(
+		WithLogger(mockLogger),
+		WithModel(customModel),
+		WithAPIKey(customAPIKey),
+		WithMaxTokens(4000),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	// 验证自定义选项被应用
+	if qwenClient.logger != mockLogger {
+		t.Error("logger should be set from option")
+	}
+
+	if qwenClient.Model != customModel {
+		t.Error("Model should be set from option")
+	}
+
+	if qwenClient.APIKey != customAPIKey {
+		t.Error("APIKey should be set from option")
+	}
+
+	if qwenClient.MaxTokens != 4000 {
+		t.Error("MaxTokens should be 4000")
+	}
+
+	// 验证 Qwen 默认值仍然保留
+	if qwenClient.Provider != ProviderQwen {
+		t.Errorf("Provider should still be '%s'", ProviderQwen)
+	}
+
+	if qwenClient.BaseURL != DefaultQwenBaseURL {
+		t.Errorf("BaseURL should still be '%s'", DefaultQwenBaseURL)
+	}
+}
+
+// ============================================================
+// 测试 SetAPIKey
+// ============================================================
+
+func TestQwenClient_SetAPIKey(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewQwenClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	// 测试设置 API Key（默认 URL 和 Model）
+	qwenClient.SetAPIKey("sk-test-key-12345678", "", "")
+
+	if qwenClient.APIKey != "sk-test-key-12345678" {
+		t.Errorf("APIKey should be 'sk-test-key-12345678', got '%s'", qwenClient.APIKey)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	if len(logs) == 0 {
+		t.Error("should have logged API key setting")
+	}
+
+	// 验证 BaseURL 和 Model 保持默认
+	if qwenClient.BaseURL != DefaultQwenBaseURL {
+		t.Error("BaseURL should remain default")
+	}
+
+	if qwenClient.Model != DefaultQwenModel {
+		t.Error("Model should remain default")
+	}
+}
+
+func TestQwenClient_SetAPIKey_WithCustomURL(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewQwenClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	customURL := "https://custom.qwen.api.com/v1"
+	qwenClient.SetAPIKey("sk-test-key-12345678", customURL, "")
+
+	if qwenClient.BaseURL != customURL {
+		t.Errorf("BaseURL should be '%s', got '%s'", customURL, qwenClient.BaseURL)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	hasCustomURLLog := false
+	for _, log := range logs {
+		if log.Format == "🔧 [MCP] Qwen 使用自定义 BaseURL: %s" {
+			hasCustomURLLog = true
+			break
+		}
+	}
+
+	if !hasCustomURLLog {
+		t.Error("should have logged custom BaseURL")
+	}
+}
+
+func TestQwenClient_SetAPIKey_WithCustomModel(t *testing.T) {
+	mockLogger := NewMockLogger()
+	client := NewQwenClientWithOptions(
+		WithLogger(mockLogger),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	customModel := "qwen-turbo"
+	qwenClient.SetAPIKey("sk-test-key-12345678", "", customModel)
+
+	if qwenClient.Model != customModel {
+		t.Errorf("Model should be '%s', got '%s'", customModel, qwenClient.Model)
+	}
+
+	// 验证日志记录
+	logs := mockLogger.GetLogsByLevel("INFO")
+	hasCustomModelLog := false
+	for _, log := range logs {
+		if log.Format == "🔧 [MCP] Qwen 使用自定义 Model: %s" {
+			hasCustomModelLog = true
+			break
+		}
+	}
+
+	if !hasCustomModelLog {
+		t.Error("should have logged custom Model")
+	}
+}
+
+// ============================================================
+// 测试集成功能
+// ============================================================
+
+func TestQwenClient_CallWithMessages_Success(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("Qwen AI response")
+	mockLogger := NewMockLogger()
+
+	client := NewQwenClientWithOptions(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	result, err := client.CallWithMessages("system prompt", "user prompt")
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	if result != "Qwen AI response" {
+		t.Errorf("expected 'Qwen AI response', got '%s'", result)
+	}
+
+	// 验证请求
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Fatalf("expected 1 request, got %d", len(requests))
+	}
+
+	req := requests[0]
+
+	// 验证 URL
+	expectedURL := DefaultQwenBaseURL + "/chat/completions"
+	if req.URL.String() != expectedURL {
+		t.Errorf("expected URL '%s', got '%s'", expectedURL, req.URL.String())
+	}
+
+	// 验证 Authorization header
+	authHeader := req.Header.Get("Authorization")
+	if authHeader != "Bearer sk-test-key" {
+		t.Errorf("expected 'Bearer sk-test-key', got '%s'", authHeader)
+	}
+
+	// 验证 Content-Type
+	if req.Header.Get("Content-Type") != "application/json" {
+		t.Error("Content-Type should be application/json")
+	}
+}
+
+func TestQwenClient_Timeout(t *testing.T) {
+	client := NewQwenClientWithOptions(
+		WithTimeout(30 * time.Second),
+	)
+
+	qwenClient := client.(*QwenClient)
+
+	if qwenClient.httpClient.Timeout != 30*time.Second {
+		t.Errorf("expected timeout 30s, got %v", qwenClient.httpClient.Timeout)
+	}
+
+	// 测试 SetTimeout
+	client.SetTimeout(60 * time.Second)
+
+	if qwenClient.httpClient.Timeout != 60*time.Second {
+		t.Errorf("expected timeout 60s after SetTimeout, got %v", qwenClient.httpClient.Timeout)
+	}
+}
+
+// ============================================================
+// 测试 hooks 机制
+// ============================================================
+
+func TestQwenClient_HooksIntegration(t *testing.T) {
+	client := NewQwenClientWithOptions()
+	qwenClient := client.(*QwenClient)
+
+	// 验证 hooks 指向 qwenClient 自己（实现多态）
+	if qwenClient.hooks != qwenClient {
+		t.Error("hooks should point to qwenClient for polymorphism")
+	}
+
+	// 验证 buildUrl 使用 Qwen 配置
+	url := qwenClient.buildUrl()
+	expectedURL := DefaultQwenBaseURL + "/chat/completions"
+	if url != expectedURL {
+		t.Errorf("expected URL '%s', got '%s'", expectedURL, url)
+	}
+}
diff --git a/mcp/request.go b/mcp/request.go
new file mode 100644
index 00000000..d706dd63
--- /dev/null
+++ b/mcp/request.go
@@ -0,0 +1,72 @@
+package mcp
+
+// Message 表示一条对话消息
+type Message struct {
+	Role    string `json:"role"`    // "system", "user", "assistant"
+	Content string `json:"content"` // 消息内容
+}
+
+// Tool 表示 AI 可以调用的工具/函数
+type Tool struct {
+	Type     string      `json:"type"`     // 通常为 "function"
+	Function FunctionDef `json:"function"` // 函数定义
+}
+
+// FunctionDef 函数定义
+type FunctionDef struct {
+	Name        string         `json:"name"`                  // 函数名
+	Description string         `json:"description,omitempty"` // 函数描述
+	Parameters  map[string]any `json:"parameters,omitempty"`  // 参数 schema (JSON Schema)
+}
+
+// Request AI API 请求（支持高级功能）
+type Request struct {
+	// 基础字段
+	Model    string    `json:"model"`              // 模型名称
+	Messages []Message `json:"messages"`           // 对话消息列表
+	Stream   bool      `json:"stream,omitempty"`   // 是否流式响应
+
+	// 可选参数（用于精细控制）
+	Temperature      *float64 `json:"temperature,omitempty"`       // 温度 (0-2)，控制随机性
+	MaxTokens        *int     `json:"max_tokens,omitempty"`        // 最大 token 数
+	TopP             *float64 `json:"top_p,omitempty"`             // 核采样参数 (0-1)
+	FrequencyPenalty *float64 `json:"frequency_penalty,omitempty"` // 频率惩罚 (-2 to 2)
+	PresencePenalty  *float64 `json:"presence_penalty,omitempty"`  // 存在惩罚 (-2 to 2)
+	Stop             []string `json:"stop,omitempty"`              // 停止序列
+
+	// 高级功能
+	Tools      []Tool `json:"tools,omitempty"`       // 可用工具列表
+	ToolChoice string `json:"tool_choice,omitempty"` // 工具选择策略 ("auto", "none", {"type": "function", "function": {"name": "xxx"}})
+}
+
+// NewMessage 创建一条消息
+func NewMessage(role, content string) Message {
+	return Message{
+		Role:    role,
+		Content: content,
+	}
+}
+
+// NewSystemMessage 创建系统消息
+func NewSystemMessage(content string) Message {
+	return Message{
+		Role:    "system",
+		Content: content,
+	}
+}
+
+// NewUserMessage 创建用户消息
+func NewUserMessage(content string) Message {
+	return Message{
+		Role:    "user",
+		Content: content,
+	}
+}
+
+// NewAssistantMessage 创建助手消息
+func NewAssistantMessage(content string) Message {
+	return Message{
+		Role:    "assistant",
+		Content: content,
+	}
+}
diff --git a/mcp/request_builder.go b/mcp/request_builder.go
new file mode 100644
index 00000000..4c61d6a4
--- /dev/null
+++ b/mcp/request_builder.go
@@ -0,0 +1,317 @@
+package mcp
+
+import (
+	"errors"
+)
+
+// RequestBuilder 请求构建器
+type RequestBuilder struct {
+	model            string
+	messages         []Message
+	stream           bool
+	temperature      *float64
+	maxTokens        *int
+	topP             *float64
+	frequencyPenalty *float64
+	presencePenalty  *float64
+	stop             []string
+	tools            []Tool
+	toolChoice       string
+}
+
+// NewRequestBuilder 创建请求构建器
+//
+// 使用示例：
+//   request := NewRequestBuilder().
+//       WithSystemPrompt("You are helpful").
+//       WithUserPrompt("Hello").
+//       WithTemperature(0.8).
+//       Build()
+func NewRequestBuilder() *RequestBuilder {
+	return &RequestBuilder{
+		messages: make([]Message, 0),
+		tools:    make([]Tool, 0),
+	}
+}
+
+// ============================================================
+// 模型和流式配置
+// ============================================================
+
+// WithModel 设置模型名称
+func (b *RequestBuilder) WithModel(model string) *RequestBuilder {
+	b.model = model
+	return b
+}
+
+// WithStream 设置是否使用流式响应
+func (b *RequestBuilder) WithStream(stream bool) *RequestBuilder {
+	b.stream = stream
+	return b
+}
+
+// ============================================================
+// 消息构建方法
+// ============================================================
+
+// WithSystemPrompt 添加系统提示词（便捷方法）
+func (b *RequestBuilder) WithSystemPrompt(prompt string) *RequestBuilder {
+	if prompt != "" {
+		b.messages = append(b.messages, NewSystemMessage(prompt))
+	}
+	return b
+}
+
+// WithUserPrompt 添加用户提示词（便捷方法）
+func (b *RequestBuilder) WithUserPrompt(prompt string) *RequestBuilder {
+	if prompt != "" {
+		b.messages = append(b.messages, NewUserMessage(prompt))
+	}
+	return b
+}
+
+// AddSystemMessage 添加系统消息
+func (b *RequestBuilder) AddSystemMessage(content string) *RequestBuilder {
+	return b.WithSystemPrompt(content)
+}
+
+// AddUserMessage 添加用户消息
+func (b *RequestBuilder) AddUserMessage(content string) *RequestBuilder {
+	return b.WithUserPrompt(content)
+}
+
+// AddAssistantMessage 添加助手消息（用于多轮对话上下文）
+func (b *RequestBuilder) AddAssistantMessage(content string) *RequestBuilder {
+	if content != "" {
+		b.messages = append(b.messages, NewAssistantMessage(content))
+	}
+	return b
+}
+
+// AddMessage 添加自定义角色的消息
+func (b *RequestBuilder) AddMessage(role, content string) *RequestBuilder {
+	if content != "" {
+		b.messages = append(b.messages, NewMessage(role, content))
+	}
+	return b
+}
+
+// AddMessages 批量添加消息
+func (b *RequestBuilder) AddMessages(messages ...Message) *RequestBuilder {
+	b.messages = append(b.messages, messages...)
+	return b
+}
+
+// AddConversationHistory 添加对话历史
+func (b *RequestBuilder) AddConversationHistory(history []Message) *RequestBuilder {
+	b.messages = append(b.messages, history...)
+	return b
+}
+
+// ClearMessages 清空所有消息
+func (b *RequestBuilder) ClearMessages() *RequestBuilder {
+	b.messages = make([]Message, 0)
+	return b
+}
+
+// ============================================================
+// 参数控制方法
+// ============================================================
+
+// WithTemperature 设置温度参数 (0-2)
+// 较高的温度（如 1.2）会使输出更随机，较低的温度（如 0.2）会使输出更确定
+func (b *RequestBuilder) WithTemperature(t float64) *RequestBuilder {
+	if t < 0 || t > 2 {
+		// 可以选择 panic 或者静默忽略，这里选择限制范围
+		if t < 0 {
+			t = 0
+		}
+		if t > 2 {
+			t = 2
+		}
+	}
+	b.temperature = &t
+	return b
+}
+
+// WithMaxTokens 设置最大 token 数
+func (b *RequestBuilder) WithMaxTokens(tokens int) *RequestBuilder {
+	if tokens > 0 {
+		b.maxTokens = &tokens
+	}
+	return b
+}
+
+// WithTopP 设置 top-p 核采样参数 (0-1)
+// 控制考虑的 token 范围，较小的值（如 0.1）使输出更聚焦
+func (b *RequestBuilder) WithTopP(p float64) *RequestBuilder {
+	if p >= 0 && p <= 1 {
+		b.topP = &p
+	}
+	return b
+}
+
+// WithFrequencyPenalty 设置频率惩罚 (-2 to 2)
+// 正值会根据 token 在文本中出现的频率惩罚它们，减少重复
+func (b *RequestBuilder) WithFrequencyPenalty(penalty float64) *RequestBuilder {
+	if penalty >= -2 && penalty <= 2 {
+		b.frequencyPenalty = &penalty
+	}
+	return b
+}
+
+// WithPresencePenalty 设置存在惩罚 (-2 to 2)
+// 正值会根据 token 是否出现在文本中惩罚它们，增加话题多样性
+func (b *RequestBuilder) WithPresencePenalty(penalty float64) *RequestBuilder {
+	if penalty >= -2 && penalty <= 2 {
+		b.presencePenalty = &penalty
+	}
+	return b
+}
+
+// WithStopSequences 设置停止序列
+// 当模型生成这些序列之一时，将停止生成
+func (b *RequestBuilder) WithStopSequences(sequences []string) *RequestBuilder {
+	b.stop = sequences
+	return b
+}
+
+// AddStopSequence 添加单个停止序列
+func (b *RequestBuilder) AddStopSequence(sequence string) *RequestBuilder {
+	if sequence != "" {
+		b.stop = append(b.stop, sequence)
+	}
+	return b
+}
+
+// ============================================================
+// 工具/函数调用相关
+// ============================================================
+
+// AddTool 添加工具
+func (b *RequestBuilder) AddTool(tool Tool) *RequestBuilder {
+	b.tools = append(b.tools, tool)
+	return b
+}
+
+// AddFunction 添加函数（便捷方法）
+func (b *RequestBuilder) AddFunction(name, description string, parameters map[string]any) *RequestBuilder {
+	tool := Tool{
+		Type: "function",
+		Function: FunctionDef{
+			Name:        name,
+			Description: description,
+			Parameters:  parameters,
+		},
+	}
+	b.tools = append(b.tools, tool)
+	return b
+}
+
+// WithToolChoice 设置工具选择策略
+// - "auto": 自动选择是否调用工具
+// - "none": 不调用工具
+// - 也可以指定特定工具: `{"type": "function", "function": {"name": "my_function"}}`
+func (b *RequestBuilder) WithToolChoice(choice string) *RequestBuilder {
+	b.toolChoice = choice
+	return b
+}
+
+// ============================================================
+// 构建方法
+// ============================================================
+
+// Build 构建请求对象
+func (b *RequestBuilder) Build() (*Request, error) {
+	// 验证：至少需要一条消息
+	if len(b.messages) == 0 {
+		return nil, errors.New("至少需要一条消息")
+	}
+
+	// 创建请求
+	req := &Request{
+		Model:      b.model,
+		Messages:   b.messages,
+		Stream:     b.stream,
+		Stop:       b.stop,
+		Tools:      b.tools,
+		ToolChoice: b.toolChoice,
+	}
+
+	// 只设置非 nil 的可选参数（避免发送 0 值覆盖服务端默认值）
+	if b.temperature != nil {
+		req.Temperature = b.temperature
+	}
+	if b.maxTokens != nil {
+		req.MaxTokens = b.maxTokens
+	}
+	if b.topP != nil {
+		req.TopP = b.topP
+	}
+	if b.frequencyPenalty != nil {
+		req.FrequencyPenalty = b.frequencyPenalty
+	}
+	if b.presencePenalty != nil {
+		req.PresencePenalty = b.presencePenalty
+	}
+
+	return req, nil
+}
+
+// MustBuild 构建请求对象，如果失败则 panic
+// 适用于构建过程中确定不会出错的场景
+func (b *RequestBuilder) MustBuild() *Request {
+	req, err := b.Build()
+	if err != nil {
+		panic(err)
+	}
+	return req
+}
+
+// ============================================================
+// 便捷方法：预设场景
+// ============================================================
+
+// ForChat 创建用于聊天的构建器（预设合理的参数）
+func ForChat() *RequestBuilder {
+	temp := 0.7
+	tokens := 2000
+	return &RequestBuilder{
+		messages:    make([]Message, 0),
+		tools:       make([]Tool, 0),
+		temperature: &temp,
+		maxTokens:   &tokens,
+	}
+}
+
+// ForCodeGeneration 创建用于代码生成的构建器（低温度，更确定）
+func ForCodeGeneration() *RequestBuilder {
+	temp := 0.2
+	tokens := 2000
+	topP := 0.1
+	return &RequestBuilder{
+		messages:    make([]Message, 0),
+		tools:       make([]Tool, 0),
+		temperature: &temp,
+		maxTokens:   &tokens,
+		topP:        &topP,
+	}
+}
+
+// ForCreativeWriting 创建用于创意写作的构建器（高温度，更随机）
+func ForCreativeWriting() *RequestBuilder {
+	temp := 1.2
+	tokens := 4000
+	topP := 0.95
+	presencePenalty := 0.6
+	frequencyPenalty := 0.5
+	return &RequestBuilder{
+		messages:         make([]Message, 0),
+		tools:            make([]Tool, 0),
+		temperature:      &temp,
+		maxTokens:        &tokens,
+		topP:             &topP,
+		presencePenalty:  &presencePenalty,
+		frequencyPenalty: &frequencyPenalty,
+	}
+}
diff --git a/mcp/request_builder_test.go b/mcp/request_builder_test.go
new file mode 100644
index 00000000..be78601f
--- /dev/null
+++ b/mcp/request_builder_test.go
@@ -0,0 +1,478 @@
+package mcp
+
+import (
+	"encoding/json"
+	"testing"
+)
+
+// ============================================================
+// 测试 RequestBuilder 基本功能
+// ============================================================
+
+func TestRequestBuilder_BasicUsage(t *testing.T) {
+	request, err := NewRequestBuilder().
+		WithSystemPrompt("You are helpful").
+		WithUserPrompt("Hello").
+		Build()
+
+	if err != nil {
+		t.Fatalf("Build should not error: %v", err)
+	}
+
+	if len(request.Messages) != 2 {
+		t.Errorf("expected 2 messages, got %d", len(request.Messages))
+	}
+
+	if request.Messages[0].Role != "system" {
+		t.Errorf("first message should be system, got %s", request.Messages[0].Role)
+	}
+
+	if request.Messages[1].Role != "user" {
+		t.Errorf("second message should be user, got %s", request.Messages[1].Role)
+	}
+}
+
+func TestRequestBuilder_EmptyMessages(t *testing.T) {
+	_, err := NewRequestBuilder().Build()
+
+	if err == nil {
+		t.Error("Build should error when no messages")
+	}
+
+	if err.Error() != "至少需要一条消息" {
+		t.Errorf("unexpected error: %v", err)
+	}
+}
+
+// ============================================================
+// 测试消息构建方法
+// ============================================================
+
+func TestRequestBuilder_MultipleMessages(t *testing.T) {
+	request := NewRequestBuilder().
+		AddSystemMessage("You are helpful").
+		AddUserMessage("What is Go?").
+		AddAssistantMessage("Go is a programming language").
+		AddUserMessage("Tell me more").
+		MustBuild()
+
+	if len(request.Messages) != 4 {
+		t.Fatalf("expected 4 messages, got %d", len(request.Messages))
+	}
+
+	expectedRoles := []string{"system", "user", "assistant", "user"}
+	for i, expected := range expectedRoles {
+		if request.Messages[i].Role != expected {
+			t.Errorf("message %d: expected role %s, got %s", i, expected, request.Messages[i].Role)
+		}
+	}
+}
+
+func TestRequestBuilder_AddConversationHistory(t *testing.T) {
+	history := []Message{
+		NewUserMessage("Previous question"),
+		NewAssistantMessage("Previous answer"),
+	}
+
+	request := NewRequestBuilder().
+		AddConversationHistory(history).
+		AddUserMessage("New question").
+		MustBuild()
+
+	if len(request.Messages) != 3 {
+		t.Fatalf("expected 3 messages, got %d", len(request.Messages))
+	}
+}
+
+// ============================================================
+// 测试参数控制方法
+// ============================================================
+
+func TestRequestBuilder_WithTemperature(t *testing.T) {
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		WithTemperature(0.8).
+		MustBuild()
+
+	if request.Temperature == nil {
+		t.Fatal("Temperature should be set")
+	}
+
+	if *request.Temperature != 0.8 {
+		t.Errorf("expected temperature 0.8, got %f", *request.Temperature)
+	}
+}
+
+func TestRequestBuilder_WithMaxTokens(t *testing.T) {
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		WithMaxTokens(2000).
+		MustBuild()
+
+	if request.MaxTokens == nil {
+		t.Fatal("MaxTokens should be set")
+	}
+
+	if *request.MaxTokens != 2000 {
+		t.Errorf("expected maxTokens 2000, got %d", *request.MaxTokens)
+	}
+}
+
+func TestRequestBuilder_WithTopP(t *testing.T) {
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		WithTopP(0.9).
+		MustBuild()
+
+	if request.TopP == nil {
+		t.Fatal("TopP should be set")
+	}
+
+	if *request.TopP != 0.9 {
+		t.Errorf("expected topP 0.9, got %f", *request.TopP)
+	}
+}
+
+func TestRequestBuilder_WithPenalties(t *testing.T) {
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		WithFrequencyPenalty(0.5).
+		WithPresencePenalty(0.6).
+		MustBuild()
+
+	if request.FrequencyPenalty == nil || *request.FrequencyPenalty != 0.5 {
+		t.Error("FrequencyPenalty should be 0.5")
+	}
+
+	if request.PresencePenalty == nil || *request.PresencePenalty != 0.6 {
+		t.Error("PresencePenalty should be 0.6")
+	}
+}
+
+func TestRequestBuilder_WithStopSequences(t *testing.T) {
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		WithStopSequences([]string{"STOP", "END"}).
+		MustBuild()
+
+	if len(request.Stop) != 2 {
+		t.Fatalf("expected 2 stop sequences, got %d", len(request.Stop))
+	}
+
+	if request.Stop[0] != "STOP" || request.Stop[1] != "END" {
+		t.Error("stop sequences not set correctly")
+	}
+}
+
+// ============================================================
+// 测试工具/函数调用
+// ============================================================
+
+func TestRequestBuilder_AddTool(t *testing.T) {
+	tool := Tool{
+		Type: "function",
+		Function: FunctionDef{
+			Name:        "get_weather",
+			Description: "Get weather",
+			Parameters: map[string]any{
+				"type": "object",
+				"properties": map[string]any{
+					"location": map[string]any{"type": "string"},
+				},
+			},
+		},
+	}
+
+	request := NewRequestBuilder().
+		WithUserPrompt("What's the weather?").
+		AddTool(tool).
+		WithToolChoice("auto").
+		MustBuild()
+
+	if len(request.Tools) != 1 {
+		t.Fatalf("expected 1 tool, got %d", len(request.Tools))
+	}
+
+	if request.Tools[0].Function.Name != "get_weather" {
+		t.Error("tool not added correctly")
+	}
+
+	if request.ToolChoice != "auto" {
+		t.Error("tool choice not set correctly")
+	}
+}
+
+func TestRequestBuilder_AddFunction(t *testing.T) {
+	params := map[string]any{
+		"type": "object",
+		"properties": map[string]any{
+			"city": map[string]any{"type": "string"},
+		},
+	}
+
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		AddFunction("get_weather", "Get current weather", params).
+		MustBuild()
+
+	if len(request.Tools) != 1 {
+		t.Fatalf("expected 1 tool, got %d", len(request.Tools))
+	}
+
+	if request.Tools[0].Type != "function" {
+		t.Error("tool type should be function")
+	}
+
+	if request.Tools[0].Function.Name != "get_weather" {
+		t.Error("function name not set correctly")
+	}
+}
+
+// ============================================================
+// 测试便捷方法
+// ============================================================
+
+func TestRequestBuilder_ForChat(t *testing.T) {
+	request := ForChat().
+		WithUserPrompt("Hello").
+		MustBuild()
+
+	if request.Temperature == nil {
+		t.Fatal("ForChat should set temperature")
+	}
+
+	if *request.Temperature != 0.7 {
+		t.Errorf("ForChat should set temperature to 0.7, got %f", *request.Temperature)
+	}
+
+	if request.MaxTokens == nil {
+		t.Fatal("ForChat should set maxTokens")
+	}
+
+	if *request.MaxTokens != 2000 {
+		t.Errorf("ForChat should set maxTokens to 2000, got %d", *request.MaxTokens)
+	}
+}
+
+func TestRequestBuilder_ForCodeGeneration(t *testing.T) {
+	request := ForCodeGeneration().
+		WithUserPrompt("Generate code").
+		MustBuild()
+
+	if request.Temperature == nil || *request.Temperature != 0.2 {
+		t.Error("ForCodeGeneration should set low temperature")
+	}
+
+	if request.TopP == nil || *request.TopP != 0.1 {
+		t.Error("ForCodeGeneration should set low topP")
+	}
+}
+
+func TestRequestBuilder_ForCreativeWriting(t *testing.T) {
+	request := ForCreativeWriting().
+		WithUserPrompt("Write a story").
+		MustBuild()
+
+	if request.Temperature == nil || *request.Temperature != 1.2 {
+		t.Error("ForCreativeWriting should set high temperature")
+	}
+
+	if request.PresencePenalty == nil || *request.PresencePenalty != 0.6 {
+		t.Error("ForCreativeWriting should set presence penalty")
+	}
+
+	if request.FrequencyPenalty == nil || *request.FrequencyPenalty != 0.5 {
+		t.Error("ForCreativeWriting should set frequency penalty")
+	}
+}
+
+// ============================================================
+// 测试 CallWithRequest 集成
+// ============================================================
+
+func TestClient_CallWithRequest_Success(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("Builder response")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	request := NewRequestBuilder().
+		WithSystemPrompt("You are helpful").
+		WithUserPrompt("Hello").
+		WithTemperature(0.8).
+		MustBuild()
+
+	result, err := client.CallWithRequest(request)
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	if result != "Builder response" {
+		t.Errorf("expected 'Builder response', got '%s'", result)
+	}
+
+	// 验证请求体
+	requests := mockHTTP.GetRequests()
+	if len(requests) != 1 {
+		t.Fatalf("expected 1 request, got %d", len(requests))
+	}
+
+	// 解析请求体验证参数
+	var body map[string]interface{}
+	decoder := json.NewDecoder(requests[0].Body)
+	if err := decoder.Decode(&body); err != nil {
+		t.Fatalf("failed to decode request body: %v", err)
+	}
+
+	// 验证 temperature
+	if body["temperature"] != 0.8 {
+		t.Errorf("expected temperature 0.8, got %v", body["temperature"])
+	}
+
+	// 验证 messages
+	messages, ok := body["messages"].([]interface{})
+	if !ok || len(messages) != 2 {
+		t.Error("messages not correctly formatted")
+	}
+}
+
+func TestClient_CallWithRequest_MultiRound(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("Multi-round response")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	// 构建多轮对话
+	request := NewRequestBuilder().
+		AddSystemMessage("You are a trading advisor").
+		AddUserMessage("Analyze BTC").
+		AddAssistantMessage("BTC is bullish").
+		AddUserMessage("What about entry point?").
+		WithTemperature(0.3).
+		MustBuild()
+
+	result, err := client.CallWithRequest(request)
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	if result != "Multi-round response" {
+		t.Errorf("expected 'Multi-round response', got '%s'", result)
+	}
+
+	// 验证请求体包含所有消息
+	requests := mockHTTP.GetRequests()
+	var body map[string]interface{}
+	json.NewDecoder(requests[0].Body).Decode(&body)
+
+	messages := body["messages"].([]interface{})
+	if len(messages) != 4 {
+		t.Errorf("expected 4 messages in request, got %d", len(messages))
+	}
+}
+
+func TestClient_CallWithRequest_WithTools(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("Tool response")
+	mockLogger := NewMockLogger()
+
+	client := NewClient(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	request := NewRequestBuilder().
+		WithUserPrompt("What's the weather in Beijing?").
+		AddFunction("get_weather", "Get weather", map[string]any{
+			"type": "object",
+			"properties": map[string]any{
+				"location": map[string]any{"type": "string"},
+			},
+		}).
+		WithToolChoice("auto").
+		MustBuild()
+
+	_, err := client.CallWithRequest(request)
+
+	if err != nil {
+		t.Fatalf("should not error: %v", err)
+	}
+
+	// 验证请求体包含 tools
+	requests := mockHTTP.GetRequests()
+	var body map[string]interface{}
+	json.NewDecoder(requests[0].Body).Decode(&body)
+
+	tools, ok := body["tools"].([]interface{})
+	if !ok || len(tools) == 0 {
+		t.Error("tools should be present in request")
+	}
+
+	toolChoice, ok := body["tool_choice"].(string)
+	if !ok || toolChoice != "auto" {
+		t.Error("tool_choice should be 'auto'")
+	}
+}
+
+func TestClient_CallWithRequest_NoAPIKey(t *testing.T) {
+	client := NewClient()
+
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		MustBuild()
+
+	_, err := client.CallWithRequest(request)
+
+	if err == nil {
+		t.Error("should error when API key not set")
+	}
+
+	if err.Error() != "AI API密钥未设置，请先调用 SetAPIKey" {
+		t.Errorf("unexpected error: %v", err)
+	}
+}
+
+func TestClient_CallWithRequest_UsesClientModel(t *testing.T) {
+	mockHTTP := NewMockHTTPClient()
+	mockHTTP.SetSuccessResponse("Response")
+	mockLogger := NewMockLogger()
+
+	client := NewDeepSeekClientWithOptions(
+		WithHTTPClient(mockHTTP.ToHTTPClient()),
+		WithLogger(mockLogger),
+		WithAPIKey("sk-test-key"),
+	)
+
+	// Request 不设置 model，应该使用 Client 的 model
+	request := NewRequestBuilder().
+		WithUserPrompt("Hello").
+		MustBuild()
+
+	if request.Model != "" {
+		t.Error("request.Model should be empty initially")
+	}
+
+	client.CallWithRequest(request)
+
+	// 验证使用了 DeepSeek 的 model
+	requests := mockHTTP.GetRequests()
+	var body map[string]interface{}
+	json.NewDecoder(requests[0].Body).Decode(&body)
+
+	if body["model"] != DefaultDeepSeekModel {
+		t.Errorf("expected model %s, got %v", DefaultDeepSeekModel, body["model"])
+	}
+}
diff --git a/pm2.config.js b/pm2.config.js
deleted file mode 100644
index 2f166388..00000000
--- a/pm2.config.js
+++ /dev/null
@@ -1,41 +0,0 @@
-const path = require('path');
-
-module.exports = {
-  apps: [
-    {
-      name: 'nofx-backend',
-      script: './nofx',
-      cwd: __dirname, // 使用当前目录（配置文件所在目录）
-      interpreter: 'none', // 不使用解释器，直接执行二进制文件
-      instances: 1,
-      autorestart: true,
-      watch: false,
-      max_memory_restart: '500M',
-      env: {
-        NODE_ENV: 'production'
-      },
-      error_file: './logs/backend-error.log',
-      out_file: './logs/backend-out.log',
-      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
-      merge_logs: true
-    },
-    {
-      name: 'nofx-frontend',
-      script: 'npm',
-      args: 'run dev',
-      cwd: path.join(__dirname, 'web'), // 动态拼接 web 目录
-      instances: 1,
-      autorestart: true,
-      watch: false,
-      max_memory_restart: '300M',
-      env: {
-        NODE_ENV: 'development',
-        PORT: 3000
-      },
-      error_file: './logs/frontend-error.log',
-      out_file: './logs/frontend-out.log',
-      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
-      merge_logs: true
-    }
-  ]
-};
diff --git a/pm2.sh b/pm2.sh
deleted file mode 100755
index b55c8412..00000000
--- a/pm2.sh
+++ /dev/null
@@ -1,258 +0,0 @@
-#!/bin/bash
-
-# NoFX Trading Bot - PM2 管理脚本
-# 用法: ./pm2.sh [start|stop|restart|status|logs|build]
-
-set -e
-
-# 自动获取脚本所在目录（支持符号链接）
-PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
-cd "$PROJECT_ROOT"
-
-# 颜色输出
-RED='\033[0;31m'
-GREEN='\033[0;32m'
-YELLOW='\033[1;33m'
-BLUE='\033[0;34m'
-PURPLE='\033[0;35m'
-CYAN='\033[0;36m'
-NC='\033[0m' # No Color
-
-# 函数：打印带颜色的消息
-print_info() {
-    echo -e "${BLUE}ℹ️  $1${NC}"
-}
-
-print_success() {
-    echo -e "${GREEN}✅ $1${NC}"
-}
-
-print_warning() {
-    echo -e "${YELLOW}⚠️  $1${NC}"
-}
-
-print_error() {
-    echo -e "${RED}❌ $1${NC}"
-}
-
-print_header() {
-    echo -e "${PURPLE}═══════════════════════════════════════${NC}"
-    echo -e "${PURPLE}  🤖 NoFX Trading Bot - PM2 Manager${NC}"
-    echo -e "${PURPLE}═══════════════════════════════════════${NC}"
-    echo ""
-}
-
-# 函数：检查 PM2 是否安装
-check_pm2() {
-    if ! command -v pm2 &> /dev/null; then
-        print_error "PM2 未安装，请先安装: npm install -g pm2"
-        exit 1
-    fi
-}
-
-# 函数：确保日志目录存在
-ensure_log_dirs() {
-    mkdir -p "$PROJECT_ROOT/logs"
-    mkdir -p "$PROJECT_ROOT/web/logs"
-    print_info "日志目录已创建"
-}
-
-# 函数：编译后端
-build_backend() {
-    print_info "正在编译后端..."
-    go build -o nofx
-    if [ $? -eq 0 ]; then
-        print_success "后端编译完成"
-    else
-        print_error "后端编译失败"
-        exit 1
-    fi
-}
-
-# 函数：构建前端（生产环境）
-build_frontend() {
-    print_info "正在构建前端..."
-    cd web
-    npm run build
-    if [ $? -eq 0 ]; then
-        print_success "前端构建完成"
-        cd ..
-    else
-        print_error "前端构建失败"
-        exit 1
-    fi
-}
-
-# 函数：启动服务
-start_services() {
-    print_header
-    ensure_log_dirs
-
-    # 检查后端二进制文件是否存在
-    if [ ! -f "./nofx" ]; then
-        print_warning "后端二进制文件不存在，开始编译..."
-        build_backend
-    fi
-
-    print_info "正在启动服务..."
-    pm2 start pm2.config.js
-
-    sleep 2
-    pm2 status
-
-    echo ""
-    print_success "服务启动完成！"
-    echo ""
-    echo -e "${CYAN}📊 访问地址:${NC}"
-    echo -e "  ${GREEN}前端:${NC} http://localhost:3000"
-    echo -e "  ${GREEN}后端 API:${NC} http://localhost:8080"
-    echo ""
-    echo -e "${CYAN}📝 查看日志:${NC}"
-    echo -e "  ${GREEN}实时日志:${NC} ./pm2.sh logs"
-    echo -e "  ${GREEN}后端日志:${NC} ./pm2.sh logs backend"
-    echo -e "  ${GREEN}前端日志:${NC} ./pm2.sh logs frontend"
-    echo ""
-}
-
-# 函数：停止服务
-stop_services() {
-    print_header
-    print_info "正在停止服务..."
-    pm2 stop pm2.config.js
-    print_success "服务已停止"
-}
-
-# 函数：重启服务
-restart_services() {
-    print_header
-    print_info "正在重启服务..."
-    pm2 restart pm2.config.js
-    sleep 2
-    pm2 status
-    print_success "服务已重启"
-}
-
-# 函数：删除服务
-delete_services() {
-    print_header
-    print_warning "正在删除 PM2 服务..."
-    pm2 delete pm2.config.js || true
-    print_success "PM2 服务已删除"
-}
-
-# 函数：查看状态
-show_status() {
-    print_header
-    pm2 status
-    echo ""
-    print_info "详细信息:"
-    pm2 info nofx-backend
-    echo ""
-    pm2 info nofx-frontend
-}
-
-# 函数：查看日志
-show_logs() {
-    if [ -z "$2" ]; then
-        # 显示所有日志
-        pm2 logs
-    elif [ "$2" = "backend" ]; then
-        pm2 logs nofx-backend
-    elif [ "$2" = "frontend" ]; then
-        pm2 logs nofx-frontend
-    else
-        print_error "未知的日志类型: $2"
-        print_info "用法: ./pm2.sh logs [backend|frontend]"
-        exit 1
-    fi
-}
-
-# 函数：监控
-show_monitor() {
-    print_header
-    print_info "启动 PM2 监控面板..."
-    pm2 monit
-}
-
-# 函数：重新编译并重启
-rebuild_and_restart() {
-    print_header
-    print_info "正在重新编译后端..."
-    build_backend
-
-    print_info "正在重启后端服务..."
-    pm2 restart nofx-backend
-
-    sleep 2
-    pm2 status
-    print_success "后端已重新编译并重启"
-}
-
-# 函数：显示帮助
-show_help() {
-    print_header
-    echo -e "${CYAN}使用方法:${NC}"
-    echo "  ./pm2.sh [command]"
-    echo ""
-    echo -e "${CYAN}可用命令:${NC}"
-    echo -e "  ${GREEN}start${NC}       - 启动前后端服务"
-    echo -e "  ${GREEN}stop${NC}        - 停止所有服务"
-    echo -e "  ${GREEN}restart${NC}     - 重启所有服务"
-    echo -e "  ${GREEN}status${NC}      - 查看服务状态"
-    echo -e "  ${GREEN}logs${NC}        - 查看所有日志 (Ctrl+C 退出)"
-    echo -e "  ${GREEN}logs backend${NC}  - 查看后端日志"
-    echo -e "  ${GREEN}logs frontend${NC} - 查看前端日志"
-    echo -e "  ${GREEN}monitor${NC}     - 打开 PM2 监控面板"
-    echo -e "  ${GREEN}build${NC}       - 编译后端"
-    echo -e "  ${GREEN}rebuild${NC}     - 重新编译后端并重启"
-    echo -e "  ${GREEN}delete${NC}      - 删除 PM2 服务"
-    echo -e "  ${GREEN}help${NC}        - 显示此帮助信息"
-    echo ""
-    echo -e "${CYAN}示例:${NC}"
-    echo "  ./pm2.sh start          # 启动服务"
-    echo "  ./pm2.sh logs backend   # 查看后端日志"
-    echo "  ./pm2.sh rebuild        # 重新编译后端并重启"
-    echo ""
-}
-
-# 主逻辑
-check_pm2
-
-case "${1:-help}" in
-    start)
-        start_services
-        ;;
-    stop)
-        stop_services
-        ;;
-    restart)
-        restart_services
-        ;;
-    status)
-        show_status
-        ;;
-    logs)
-        show_logs "$@"
-        ;;
-    monitor|mon)
-        show_monitor
-        ;;
-    build)
-        build_backend
-        ;;
-    rebuild)
-        rebuild_and_restart
-        ;;
-    delete|remove)
-        delete_services
-        ;;
-    help|--help|-h)
-        show_help
-        ;;
-    *)
-        print_error "未知命令: $1"
-        echo ""
-        show_help
-        exit 1
-        ;;
-esac
diff --git a/trader/auto_trader.go b/trader/auto_trader.go
index fd78e906..4e53a9b4 100644
--- a/trader/auto_trader.go
+++ b/trader/auto_trader.go
@@ -85,8 +85,8 @@ type AutoTrader struct {
 	exchange              string // 交易平台名称
 	config                AutoTraderConfig
 	trader                Trader // 使用Trader接口（支持多平台）
-	mcpClient             *mcp.Client
-	decisionLogger        *logger.DecisionLogger // 决策日志记录器
+	mcpClient             mcp.AIClient
+	decisionLogger        logger.IDecisionLogger // 决策日志记录器
 	initialBalance        float64
 	dailyPnL              float64
 	customPrompt          string   // 自定义交易策略prompt
@@ -131,11 +131,12 @@ func NewAutoTrader(config AutoTraderConfig, database interface{}, userID string)
 	// 初始化AI
 	if config.AIModel == "custom" {
 		// 使用自定义API
-		mcpClient.SetCustomAPI(config.CustomAPIURL, config.CustomAPIKey, config.CustomModelName)
+		mcpClient.SetAPIKey(config.CustomAPIKey, config.CustomAPIURL, config.CustomModelName)
 		log.Printf("🤖 [%s] 使用自定义AI API: %s (模型: %s)", config.Name, config.CustomAPIURL, config.CustomModelName)
 	} else if config.UseQwen || config.AIModel == "qwen" {
 		// 使用Qwen (支持自定义URL和Model)
-		mcpClient.SetQwenAPIKey(config.QwenKey, config.CustomAPIURL, config.CustomModelName)
+		mcpClient = mcp.NewQwenClient()
+		mcpClient.SetAPIKey(config.QwenKey, config.CustomAPIURL, config.CustomModelName)
 		if config.CustomAPIURL != "" || config.CustomModelName != "" {
 			log.Printf("🤖 [%s] 使用阿里云Qwen AI (自定义URL: %s, 模型: %s)", config.Name, config.CustomAPIURL, config.CustomModelName)
 		} else {
@@ -143,7 +144,8 @@ func NewAutoTrader(config AutoTraderConfig, database interface{}, userID string)
 		}
 	} else {
 		// 默认使用DeepSeek (支持自定义URL和Model)
-		mcpClient.SetDeepSeekAPIKey(config.DeepSeekKey, config.CustomAPIURL, config.CustomModelName)
+		mcpClient = mcp.NewDeepSeekClient()
+		mcpClient.SetAPIKey(config.DeepSeekKey, config.CustomAPIURL, config.CustomModelName)
 		if config.CustomAPIURL != "" || config.CustomModelName != "" {
 			log.Printf("🤖 [%s] 使用DeepSeek AI (自定义URL: %s, 模型: %s)", config.Name, config.CustomAPIURL, config.CustomModelName)
 		} else {
@@ -286,101 +288,6 @@ func (at *AutoTrader) Stop() {
 	log.Println("⏹ 自动交易系统停止")
 }
 
-// autoSyncBalanceIfNeeded 自动同步余额（每10分钟检查一次，变化>5%才更新）
-func (at *AutoTrader) autoSyncBalanceIfNeeded() {
-	// 距离上次同步不足10分钟，跳过
-	if time.Since(at.lastBalanceSyncTime) < 10*time.Minute {
-		return
-	}
-
-	log.Printf("🔄 [%s] 开始自动检查余额变化...", at.name)
-
-	// 查询实际余额
-	balanceInfo, err := at.trader.GetBalance()
-	if err != nil {
-		log.Printf("⚠️ [%s] 查询余额失败: %v", at.name, err)
-		at.lastBalanceSyncTime = time.Now() // 即使失败也更新时间，避免频繁重试
-		return
-	}
-
-	// 提取可用余额
-	var actualBalance float64
-	if availableBalance, ok := balanceInfo["available_balance"].(float64); ok && availableBalance > 0 {
-		actualBalance = availableBalance
-	} else if availableBalance, ok := balanceInfo["availableBalance"].(float64); ok && availableBalance > 0 {
-		actualBalance = availableBalance
-	} else if totalBalance, ok := balanceInfo["balance"].(float64); ok && totalBalance > 0 {
-		actualBalance = totalBalance
-	} else {
-		log.Printf("⚠️ [%s] 无法提取可用余额", at.name)
-		at.lastBalanceSyncTime = time.Now()
-		return
-	}
-
-	oldBalance := at.initialBalance
-
-	// 防止除以零：如果初始余额无效，直接更新为实际余额
-	if oldBalance <= 0 {
-		log.Printf("⚠️ [%s] 初始余额无效 (%.2f)，直接更新为实际余额 %.2f USDT", at.name, oldBalance, actualBalance)
-		at.initialBalance = actualBalance
-		if at.database != nil {
-			type DatabaseUpdater interface {
-				UpdateTraderInitialBalance(userID, id string, newBalance float64) error
-			}
-			if db, ok := at.database.(DatabaseUpdater); ok {
-				if err := db.UpdateTraderInitialBalance(at.userID, at.id, actualBalance); err != nil {
-					log.Printf("❌ [%s] 更新数据库失败: %v", at.name, err)
-				} else {
-					log.Printf("✅ [%s] 已自动同步余额到数据库", at.name)
-				}
-			} else {
-				log.Printf("⚠️ [%s] 数据库类型不支持UpdateTraderInitialBalance接口", at.name)
-			}
-		} else {
-			log.Printf("⚠️ [%s] 数据库引用为空，余额仅在内存中更新", at.name)
-		}
-		at.lastBalanceSyncTime = time.Now()
-		return
-	}
-
-	changePercent := ((actualBalance - oldBalance) / oldBalance) * 100
-
-	// 变化超过5%才更新
-	if math.Abs(changePercent) > 5.0 {
-		log.Printf("🔔 [%s] 检测到余额大幅变化: %.2f → %.2f USDT (%.2f%%)",
-			at.name, oldBalance, actualBalance, changePercent)
-
-		// 更新内存中的 initialBalance
-		at.initialBalance = actualBalance
-
-		// 更新数据库（需要类型断言）
-		if at.database != nil {
-			// 这里需要根据实际的数据库类型进行类型断言
-			// 由于使用了 interface{}，我们需要在 TraderManager 层面处理更新
-			// 或者在这里进行类型检查
-			type DatabaseUpdater interface {
-				UpdateTraderInitialBalance(userID, id string, newBalance float64) error
-			}
-			if db, ok := at.database.(DatabaseUpdater); ok {
-				err := db.UpdateTraderInitialBalance(at.userID, at.id, actualBalance)
-				if err != nil {
-					log.Printf("❌ [%s] 更新数据库失败: %v", at.name, err)
-				} else {
-					log.Printf("✅ [%s] 已自动同步余额到数据库", at.name)
-				}
-			} else {
-				log.Printf("⚠️ [%s] 数据库类型不支持UpdateTraderInitialBalance接口", at.name)
-			}
-		} else {
-			log.Printf("⚠️ [%s] 数据库引用为空，余额仅在内存中更新", at.name)
-		}
-	} else {
-		log.Printf("✓ [%s] 余额变化不大 (%.2f%%)，无需更新", at.name, changePercent)
-	}
-
-	at.lastBalanceSyncTime = time.Now()
-}
-
 // runCycle 运行一个交易周期（使用AI全权决策）
 func (at *AutoTrader) runCycle() error {
 	at.callCount++
@@ -412,9 +319,6 @@ func (at *AutoTrader) runCycle() error {
 		log.Println("📅 日盈亏已重置")
 	}
 
-	// 3. 自动同步余额（每10分钟检查一次，充值/提现后自动更新）
-	at.autoSyncBalanceIfNeeded()
-
 	// 4. 收集交易上下文
 	ctx, err := at.buildTradingContext()
 	if err != nil {
@@ -426,11 +330,12 @@ func (at *AutoTrader) runCycle() error {
 
 	// 保存账户状态快照
 	record.AccountState = logger.AccountSnapshot{
-		TotalBalance:          ctx.Account.TotalEquity,
+		TotalBalance:          ctx.Account.TotalEquity - ctx.Account.UnrealizedPnL,
 		AvailableBalance:      ctx.Account.AvailableBalance,
-		TotalUnrealizedProfit: ctx.Account.TotalPnL,
+		TotalUnrealizedProfit: ctx.Account.UnrealizedPnL,
 		PositionCount:         ctx.Account.PositionCount,
 		MarginUsedPct:         ctx.Account.MarginUsedPct,
+		InitialBalance:        at.initialBalance, // 记录当时的初始余额基准
 	}
 
 	// 保存持仓快照
@@ -651,7 +556,7 @@ func (at *AutoTrader) buildTradingContext() (*decision.Context, error) {
 
 		// 获取该持仓的历史最高收益率
 		at.peakPnLCacheMutex.RLock()
-		peakPnlPct := at.peakPnLCache[symbol]
+		peakPnlPct := at.peakPnLCache[posKey]
 		at.peakPnLCacheMutex.RUnlock()
 
 		positionInfos = append(positionInfos, decision.PositionInfo{
@@ -714,6 +619,7 @@ func (at *AutoTrader) buildTradingContext() (*decision.Context, error) {
 		Account: decision.AccountInfo{
 			TotalEquity:      totalEquity,
 			AvailableBalance: availableBalance,
+			UnrealizedPnL:    totalUnrealizedProfit,
 			TotalPnL:         totalPnL,
 			TotalPnLPct:      totalPnLPct,
 			MarginUsed:       totalMarginUsed,
@@ -1301,7 +1207,7 @@ func (at *AutoTrader) GetSystemPromptTemplate() string {
 }
 
 // GetDecisionLogger 获取决策日志记录器
-func (at *AutoTrader) GetDecisionLogger() *logger.DecisionLogger {
+func (at *AutoTrader) GetDecisionLogger() logger.IDecisionLogger {
 	return at.decisionLogger
 }
 
@@ -1361,7 +1267,7 @@ func (at *AutoTrader) GetAccountInfo() (map[string]interface{}, error) {
 	}
 
 	totalMarginUsed := 0.0
-	totalUnrealizedPnL := 0.0
+	totalUnrealizedPnLCalculated := 0.0
 	for _, pos := range positions {
 		markPrice := pos["markPrice"].(float64)
 		quantity := pos["positionAmt"].(float64)
@@ -1369,7 +1275,7 @@ func (at *AutoTrader) GetAccountInfo() (map[string]interface{}, error) {
 			quantity = -quantity
 		}
 		unrealizedPnl := pos["unRealizedProfit"].(float64)
-		totalUnrealizedPnL += unrealizedPnl
+		totalUnrealizedPnLCalculated += unrealizedPnl
 
 		leverage := 10
 		if lev, ok := pos["leverage"].(float64); ok {
@@ -1379,10 +1285,19 @@ func (at *AutoTrader) GetAccountInfo() (map[string]interface{}, error) {
 		totalMarginUsed += marginUsed
 	}
 
+	// 验证未实现盈亏的一致性（API值 vs 从持仓计算）
+	diff := math.Abs(totalUnrealizedProfit - totalUnrealizedPnLCalculated)
+	if diff > 0.1 { // 允许0.01 USDT的误差
+		log.Printf("⚠️ 未实现盈亏不一致: API=%.4f, 计算=%.4f, 差异=%.4f",
+			totalUnrealizedProfit, totalUnrealizedPnLCalculated, diff)
+	}
+
 	totalPnL := totalEquity - at.initialBalance
 	totalPnLPct := 0.0
 	if at.initialBalance > 0 {
 		totalPnLPct = (totalPnL / at.initialBalance) * 100
+	} else {
+		log.Printf("⚠️ Initial Balance异常: %.2f，无法计算PNL百分比", at.initialBalance)
 	}
 
 	marginUsedPct := 0.0
@@ -1394,15 +1309,14 @@ func (at *AutoTrader) GetAccountInfo() (map[string]interface{}, error) {
 		// 核心字段
 		"total_equity":      totalEquity,           // 账户净值 = wallet + unrealized
 		"wallet_balance":    totalWalletBalance,    // 钱包余额（不含未实现盈亏）
-		"unrealized_profit": totalUnrealizedProfit, // 未实现盈亏（从API）
+		"unrealized_profit": totalUnrealizedProfit, // 未实现盈亏（交易所API官方值）
 		"available_balance": availableBalance,      // 可用余额
 
 		// 盈亏统计
-		"total_pnl":            totalPnL,           // 总盈亏 = equity - initial
-		"total_pnl_pct":        totalPnLPct,        // 总盈亏百分比
-		"total_unrealized_pnl": totalUnrealizedPnL, // 未实现盈亏（从持仓计算）
-		"initial_balance":      at.initialBalance,  // 初始余额
-		"daily_pnl":            at.dailyPnL,        // 日盈亏
+		"total_pnl":       totalPnL,          // 总盈亏 = equity - initial
+		"total_pnl_pct":   totalPnLPct,       // 总盈亏百分比
+		"initial_balance": at.initialBalance, // 初始余额
+		"daily_pnl":       at.dailyPnL,       // 日盈亏
 
 		// 持仓信息
 		"position_count":  len(positions),  // 持仓数量
diff --git a/trader/auto_trader_test.go b/trader/auto_trader_test.go
index 09a2c428..9316981f 100644
--- a/trader/auto_trader_test.go
+++ b/trader/auto_trader_test.go
@@ -31,7 +31,7 @@ type AutoTraderTestSuite struct {
 	// Mock 依赖
 	mockTrader *MockTrader
 	mockDB     *MockDatabase
-	mockLogger *logger.DecisionLogger
+	mockLogger logger.IDecisionLogger
 
 	// gomonkey patches
 	patches *gomonkey.Patches
diff --git a/web/package-lock.json b/web/package-lock.json
index b1545cf4..7048f643 100644
--- a/web/package-lock.json
+++ b/web/package-lock.json
@@ -120,7 +120,6 @@
       "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.5.tgz",
       "integrity": "sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==",
       "dev": true,
-      "peer": true,
       "dependencies": {
         "@babel/code-frame": "^7.27.1",
         "@babel/generator": "^7.28.5",
@@ -452,7 +451,6 @@
         }
       ],
       "license": "MIT",
-      "peer": true,
       "engines": {
         "node": ">=18"
       },
@@ -476,7 +474,6 @@
         }
       ],
       "license": "MIT",
-      "peer": true,
       "engines": {
         "node": ">=18"
       }
@@ -1163,181 +1160,6 @@
         "url": "https://github.com/sponsors/nzakas"
       }
     },
-    "node_modules/@inquirer/ansi": {
-      "version": "1.0.1",
-      "resolved": "https://registry.npmjs.org/@inquirer/ansi/-/ansi-1.0.1.tgz",
-      "integrity": "sha512-yqq0aJW/5XPhi5xOAL1xRCpe1eh8UFVgYFpFsjEqmIR8rKLyP+HINvFXwUaxYICflJrVlxnp7lLN6As735kVpw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=18"
-      }
-    },
-    "node_modules/@inquirer/confirm": {
-      "version": "5.1.19",
-      "resolved": "https://registry.npmjs.org/@inquirer/confirm/-/confirm-5.1.19.tgz",
-      "integrity": "sha512-wQNz9cfcxrtEnUyG5PndC8g3gZ7lGDBzmWiXZkX8ot3vfZ+/BLjR8EvyGX4YzQLeVqtAlY/YScZpW7CW8qMoDQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "@inquirer/core": "^10.3.0",
-        "@inquirer/type": "^3.0.9"
-      },
-      "engines": {
-        "node": ">=18"
-      },
-      "peerDependencies": {
-        "@types/node": ">=18"
-      },
-      "peerDependenciesMeta": {
-        "@types/node": {
-          "optional": true
-        }
-      }
-    },
-    "node_modules/@inquirer/core": {
-      "version": "10.3.0",
-      "resolved": "https://registry.npmjs.org/@inquirer/core/-/core-10.3.0.tgz",
-      "integrity": "sha512-Uv2aPPPSK5jeCplQmQ9xadnFx2Zhj9b5Dj7bU6ZeCdDNNY11nhYy4btcSdtDguHqCT2h5oNeQTcUNSGGLA7NTA==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "@inquirer/ansi": "^1.0.1",
-        "@inquirer/figures": "^1.0.14",
-        "@inquirer/type": "^3.0.9",
-        "cli-width": "^4.1.0",
-        "mute-stream": "^2.0.0",
-        "signal-exit": "^4.1.0",
-        "wrap-ansi": "^6.2.0",
-        "yoctocolors-cjs": "^2.1.2"
-      },
-      "engines": {
-        "node": ">=18"
-      },
-      "peerDependencies": {
-        "@types/node": ">=18"
-      },
-      "peerDependenciesMeta": {
-        "@types/node": {
-          "optional": true
-        }
-      }
-    },
-    "node_modules/@inquirer/core/node_modules/ansi-regex": {
-      "version": "5.0.1",
-      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
-      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/@inquirer/core/node_modules/ansi-styles": {
-      "version": "4.3.0",
-      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
-      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "color-convert": "^2.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      },
-      "funding": {
-        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
-      }
-    },
-    "node_modules/@inquirer/core/node_modules/emoji-regex": {
-      "version": "8.0.0",
-      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
-      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
-    "node_modules/@inquirer/core/node_modules/string-width": {
-      "version": "4.2.3",
-      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
-      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "emoji-regex": "^8.0.0",
-        "is-fullwidth-code-point": "^3.0.0",
-        "strip-ansi": "^6.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/@inquirer/core/node_modules/strip-ansi": {
-      "version": "6.0.1",
-      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
-      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "ansi-regex": "^5.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/@inquirer/core/node_modules/wrap-ansi": {
-      "version": "6.2.0",
-      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-6.2.0.tgz",
-      "integrity": "sha512-r6lPcBGxZXlIcymEu7InxDMhdW0KDxpLgoFLcguasxCaJ/SOIZwINatK9KY/tf+ZrlywOKU0UDj3ATXUBfxJXA==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "ansi-styles": "^4.0.0",
-        "string-width": "^4.1.0",
-        "strip-ansi": "^6.0.0"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/@inquirer/figures": {
-      "version": "1.0.14",
-      "resolved": "https://registry.npmjs.org/@inquirer/figures/-/figures-1.0.14.tgz",
-      "integrity": "sha512-DbFgdt+9/OZYFM+19dbpXOSeAstPy884FPy1KjDu4anWwymZeOYhMY1mdFri172htv6mvc/uvIAAi7b7tvjJBQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=18"
-      }
-    },
-    "node_modules/@inquirer/type": {
-      "version": "3.0.9",
-      "resolved": "https://registry.npmjs.org/@inquirer/type/-/type-3.0.9.tgz",
-      "integrity": "sha512-QPaNt/nmE2bLGQa9b7wwyRJoLZ7pN6rcyXvzU0YCmivmJyq1BVo94G98tStRWkoD1RgDX5C+dPlhhHzNdu/W/w==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=18"
-      },
-      "peerDependencies": {
-        "@types/node": ">=18"
-      },
-      "peerDependenciesMeta": {
-        "@types/node": {
-          "optional": true
-        }
-      }
-    },
     "node_modules/@isaacs/cliui": {
       "version": "8.0.2",
       "resolved": "https://registry.npmjs.org/@isaacs/cliui/-/cliui-8.0.2.tgz",
@@ -1400,25 +1222,6 @@
         "@jridgewell/sourcemap-codec": "^1.4.14"
       }
     },
-    "node_modules/@mswjs/interceptors": {
-      "version": "0.40.0",
-      "resolved": "https://registry.npmjs.org/@mswjs/interceptors/-/interceptors-0.40.0.tgz",
-      "integrity": "sha512-EFd6cVbHsgLa6wa4RljGj6Wk75qoHxUSyc5asLyyPSyuhIcdS2Q3Phw6ImS1q+CkALthJRShiYfKANcQMuMqsQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "@open-draft/deferred-promise": "^2.2.0",
-        "@open-draft/logger": "^0.3.0",
-        "@open-draft/until": "^2.0.0",
-        "is-node-process": "^1.2.0",
-        "outvariant": "^1.4.3",
-        "strict-event-emitter": "^0.5.1"
-      },
-      "engines": {
-        "node": ">=18"
-      }
-    },
     "node_modules/@nodelib/fs.scandir": {
       "version": "2.1.5",
       "resolved": "https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz",
@@ -1454,34 +1257,6 @@
         "node": ">= 8"
       }
     },
-    "node_modules/@open-draft/deferred-promise": {
-      "version": "2.2.0",
-      "resolved": "https://registry.npmjs.org/@open-draft/deferred-promise/-/deferred-promise-2.2.0.tgz",
-      "integrity": "sha512-CecwLWx3rhxVQF6V4bAgPS5t+So2sTbPgAzafKkVizyi7tlwpcFpdFqq+wqF2OwNBmqFuu6tOyouTuxgpMfzmA==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
-    "node_modules/@open-draft/logger": {
-      "version": "0.3.0",
-      "resolved": "https://registry.npmjs.org/@open-draft/logger/-/logger-0.3.0.tgz",
-      "integrity": "sha512-X2g45fzhxH238HKO4xbSr7+wBS8Fvw6ixhTDuvLd5mqh6bJJCFAPwU9mPDxbcrRtfxv4u5IHCEH77BmxvXmmxQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "is-node-process": "^1.2.0",
-        "outvariant": "^1.4.0"
-      }
-    },
-    "node_modules/@open-draft/until": {
-      "version": "2.1.0",
-      "resolved": "https://registry.npmjs.org/@open-draft/until/-/until-2.1.0.tgz",
-      "integrity": "sha512-U69T3ItWHvLwGg5eJ0n3I62nWuE6ilHlmz7zM0npLBRvPRd7e6NYmg54vvRtP5mZG7kZqZCFVdsTWo7BPtBujg==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/@pkgjs/parseargs": {
       "version": "0.11.0",
       "resolved": "https://registry.npmjs.org/@pkgjs/parseargs/-/parseargs-0.11.0.tgz",
@@ -2258,7 +2033,8 @@
       "resolved": "https://registry.npmjs.org/@types/aria-query/-/aria-query-5.0.4.tgz",
       "integrity": "sha512-rfT93uj5s0PRL7EzccGMs3brplhcrghnDoV26NqKhCAS1hVo+WdNsPvE/yb6ilfr5hi2MEk6d5EWJTKdxg8jVw==",
       "dev": true,
-      "license": "MIT"
+      "license": "MIT",
+      "peer": true
     },
     "node_modules/@types/babel__core": {
       "version": "7.20.5",
@@ -2379,7 +2155,6 @@
       "resolved": "https://registry.npmjs.org/@types/react/-/react-18.3.26.tgz",
       "integrity": "sha512-RFA/bURkcKzx/X9oumPG9Vp3D3JUgus/d0b67KB0t5S/raciymilkOa66olh78MUI92QLbEJevO7rvqU/kjwKA==",
       "devOptional": true,
-      "peer": true,
       "dependencies": {
         "@types/prop-types": "*",
         "csstype": "^3.0.2"
@@ -2390,19 +2165,10 @@
       "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-18.3.7.tgz",
       "integrity": "sha512-MEe3UeoENYVFXzoXEWsvcpg6ZvlrFNlOQ7EOsvhI3CfAXwzPfO8Qwuxd40nepsYKqyyVQnTdEfv68q91yLcKrQ==",
       "devOptional": true,
-      "peer": true,
       "peerDependencies": {
         "@types/react": "^18.0.0"
       }
     },
-    "node_modules/@types/statuses": {
-      "version": "2.0.6",
-      "resolved": "https://registry.npmjs.org/@types/statuses/-/statuses-2.0.6.tgz",
-      "integrity": "sha512-xMAgYwceFhRA2zY+XbEA7mxYbA093wdiW8Vu6gZPGWy9cmOyU9XesH1tNcEWsKFd5Vzrqx5T3D38PWx1FIIXkA==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/@typescript-eslint/eslint-plugin": {
       "version": "8.46.3",
       "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.46.3.tgz",
@@ -2439,7 +2205,6 @@
       "integrity": "sha512-6m1I5RmHBGTnUGS113G04DMu3CpSdxCAU/UvtjNWL4Nuf3MW9tQhiJqRlHzChIkhy6kZSAQmc+I1bcGjE3yNKg==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "@typescript-eslint/scope-manager": "8.46.3",
         "@typescript-eslint/types": "8.46.3",
@@ -2764,7 +2529,6 @@
       "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "bin": {
         "acorn": "bin/acorn"
       },
@@ -3188,7 +2952,6 @@
           "url": "https://github.com/sponsors/ai"
         }
       ],
-      "peer": true,
       "dependencies": {
         "baseline-browser-mapping": "^2.8.19",
         "caniuse-lite": "^1.0.30001751",
@@ -3460,118 +3223,6 @@
         "url": "https://github.com/sponsors/sindresorhus"
       }
     },
-    "node_modules/cli-width": {
-      "version": "4.1.0",
-      "resolved": "https://registry.npmjs.org/cli-width/-/cli-width-4.1.0.tgz",
-      "integrity": "sha512-ouuZd4/dm2Sw5Gmqy6bGyNNNe1qt9RpmxveLSO7KcgsTnU7RXfsw+/bukWGo1abgBiMAic068rclZsO4IWmmxQ==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "engines": {
-        "node": ">= 12"
-      }
-    },
-    "node_modules/cliui": {
-      "version": "8.0.1",
-      "resolved": "https://registry.npmjs.org/cliui/-/cliui-8.0.1.tgz",
-      "integrity": "sha512-BSeNnyus75C4//NQ9gQt1/csTXyo/8Sb+afLAkzAptFuMsod9HFokGNudZpi/oQV73hnVK+sR+5PVRMd+Dr7YQ==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "dependencies": {
-        "string-width": "^4.2.0",
-        "strip-ansi": "^6.0.1",
-        "wrap-ansi": "^7.0.0"
-      },
-      "engines": {
-        "node": ">=12"
-      }
-    },
-    "node_modules/cliui/node_modules/ansi-regex": {
-      "version": "5.0.1",
-      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
-      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/cliui/node_modules/ansi-styles": {
-      "version": "4.3.0",
-      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
-      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "color-convert": "^2.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      },
-      "funding": {
-        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
-      }
-    },
-    "node_modules/cliui/node_modules/emoji-regex": {
-      "version": "8.0.0",
-      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
-      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
-    "node_modules/cliui/node_modules/string-width": {
-      "version": "4.2.3",
-      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
-      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "emoji-regex": "^8.0.0",
-        "is-fullwidth-code-point": "^3.0.0",
-        "strip-ansi": "^6.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/cliui/node_modules/strip-ansi": {
-      "version": "6.0.1",
-      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
-      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "ansi-regex": "^5.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/cliui/node_modules/wrap-ansi": {
-      "version": "7.0.0",
-      "resolved": "https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-7.0.0.tgz",
-      "integrity": "sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt/Fi7D16Q==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "ansi-styles": "^4.0.0",
-        "string-width": "^4.1.0",
-        "strip-ansi": "^6.0.0"
-      },
-      "engines": {
-        "node": ">=10"
-      },
-      "funding": {
-        "url": "https://github.com/chalk/wrap-ansi?sponsor=1"
-      }
-    },
     "node_modules/clsx": {
       "version": "2.1.1",
       "resolved": "https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz",
@@ -4031,7 +3682,8 @@
       "resolved": "https://registry.npmjs.org/dom-accessibility-api/-/dom-accessibility-api-0.5.16.tgz",
       "integrity": "sha512-X7BJ2yElsnOJ30pZF4uIIDfBEVgF4XEBxL9Bxhy6dnrm5hkzqmsWHGTiHqRiITNhMyFLyAiWndIJP7Z1NTteDg==",
       "dev": true,
-      "license": "MIT"
+      "license": "MIT",
+      "peer": true
     },
     "node_modules/dom-helpers": {
       "version": "5.2.1",
@@ -4354,7 +4006,6 @@
       "integrity": "sha512-BhHmn2yNOFA9H9JmmIVKJmd288g9hrVRDkdoIgRCRuSySRUHH7r/DI6aAXW9T1WwUuY3DFgrcaqB+deURBLR5g==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "@eslint-community/eslint-utils": "^4.8.0",
         "@eslint-community/regexpp": "^4.12.1",
@@ -4415,7 +4066,6 @@
       "integrity": "sha512-82GZUjRS0p/jganf6q1rEO25VSoHH0hKPCTrgillPjdI/3bgBhAE1QzHrHTizjpRvy6pGAvKjDJtk2pF9NDq8w==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "bin": {
         "eslint-config-prettier": "bin/cli.js"
       },
@@ -5039,17 +4689,6 @@
         "node": ">=6.9.0"
       }
     },
-    "node_modules/get-caller-file": {
-      "version": "2.0.5",
-      "resolved": "https://registry.npmjs.org/get-caller-file/-/get-caller-file-2.0.5.tgz",
-      "integrity": "sha512-DyFP3BM/3YHTQOCUL/w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "engines": {
-        "node": "6.* || 8.* || >= 10.*"
-      }
-    },
     "node_modules/get-east-asian-width": {
       "version": "1.4.0",
       "resolved": "https://registry.npmjs.org/get-east-asian-width/-/get-east-asian-width-1.4.0.tgz",
@@ -5211,17 +4850,6 @@
       "dev": true,
       "license": "MIT"
     },
-    "node_modules/graphql": {
-      "version": "16.12.0",
-      "resolved": "https://registry.npmjs.org/graphql/-/graphql-16.12.0.tgz",
-      "integrity": "sha512-DKKrynuQRne0PNpEbzuEdHlYOMksHSUI8Zc9Unei5gTsMNA2/vMpoMz/yKba50pejK56qj98qM0SjYxAKi13gQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": "^12.22.0 || ^14.16.0 || ^16.0.0 || >=17.0.0"
-      }
-    },
     "node_modules/has-bigints": {
       "version": "1.1.0",
       "resolved": "https://registry.npmjs.org/has-bigints/-/has-bigints-1.1.0.tgz",
@@ -5315,14 +4943,6 @@
         "node": ">= 0.4"
       }
     },
-    "node_modules/headers-polyfill": {
-      "version": "4.0.3",
-      "resolved": "https://registry.npmjs.org/headers-polyfill/-/headers-polyfill-4.0.3.tgz",
-      "integrity": "sha512-IScLbePpkvO846sIwOtOTDjutRMWdXdJmXdMvk6gCBHxFO8d+QKOQedyZSxFTTFYRSmlgSTDtXqqq4pcenBXLQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/hermes-estree": {
       "version": "0.25.1",
       "resolved": "https://registry.npmjs.org/hermes-estree/-/hermes-estree-0.25.1.tgz",
@@ -5718,14 +5338,6 @@
         "url": "https://github.com/sponsors/ljharb"
       }
     },
-    "node_modules/is-node-process": {
-      "version": "1.2.0",
-      "resolved": "https://registry.npmjs.org/is-node-process/-/is-node-process-1.2.0.tgz",
-      "integrity": "sha512-Vg4o6/fqPxIjtxgUH5QLJhwZ7gW5diGCVlXpuUfELC62CuxM1iHcRe51f2W1FDy04Ai4KJkagKjx3XaqyfRKXw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/is-number": {
       "version": "7.0.0",
       "resolved": "https://registry.npmjs.org/is-number/-/is-number-7.0.0.tgz",
@@ -5955,7 +5567,6 @@
       "resolved": "https://registry.npmjs.org/jiti/-/jiti-1.21.7.tgz",
       "integrity": "sha512-/imKNG4EbWNrVjoNC/1H5/9GFy+tqjGBHCaSsN+P2RnPqjsLmv6UD3Ej+Kj8nBWaRAwyk7kK5ZUc+OEatnTR3A==",
       "dev": true,
-      "peer": true,
       "bin": {
         "jiti": "bin/jiti.js"
       }
@@ -5984,7 +5595,6 @@
       "integrity": "sha512-8i7LzZj7BF8uplX+ZyOlIz86V6TAsSs+np6m1kpW9u0JWi4z/1t+FzcK1aek+ybTnAC4KhBL4uXCNT0wcUIeCw==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "cssstyle": "^4.1.0",
         "data-urls": "^5.0.0",
@@ -6359,6 +5969,7 @@
       "integrity": "sha512-h5bgJWpxJNswbU7qCrV0tIKQCaS3blPDrqKWx+QxzuzL1zGUzij9XCWLrSLsJPu5t+eWA/ycetzYAO5IOMcWAQ==",
       "dev": true,
       "license": "MIT",
+      "peer": true,
       "bin": {
         "lz-string": "bin/bin.js"
       }
@@ -6496,99 +6107,6 @@
       "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
       "dev": true
     },
-    "node_modules/msw": {
-      "version": "2.11.6",
-      "resolved": "https://registry.npmjs.org/msw/-/msw-2.11.6.tgz",
-      "integrity": "sha512-MCYMykvmiYScyUm7I6y0VCxpNq1rgd5v7kG8ks5dKtvmxRUUPjribX6mUoUNBbM5/3PhUyoelEWiKXGOz84c+w==",
-      "dev": true,
-      "hasInstallScript": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "@inquirer/confirm": "^5.0.0",
-        "@mswjs/interceptors": "^0.40.0",
-        "@open-draft/deferred-promise": "^2.2.0",
-        "@types/statuses": "^2.0.4",
-        "cookie": "^1.0.2",
-        "graphql": "^16.8.1",
-        "headers-polyfill": "^4.0.2",
-        "is-node-process": "^1.2.0",
-        "outvariant": "^1.4.3",
-        "path-to-regexp": "^6.3.0",
-        "picocolors": "^1.1.1",
-        "rettime": "^0.7.0",
-        "statuses": "^2.0.2",
-        "strict-event-emitter": "^0.5.1",
-        "tough-cookie": "^6.0.0",
-        "type-fest": "^4.26.1",
-        "until-async": "^3.0.2",
-        "yargs": "^17.7.2"
-      },
-      "bin": {
-        "msw": "cli/index.js"
-      },
-      "engines": {
-        "node": ">=18"
-      },
-      "funding": {
-        "url": "https://github.com/sponsors/mswjs"
-      },
-      "peerDependencies": {
-        "typescript": ">= 4.8.x"
-      },
-      "peerDependenciesMeta": {
-        "typescript": {
-          "optional": true
-        }
-      }
-    },
-    "node_modules/msw/node_modules/tldts": {
-      "version": "7.0.17",
-      "resolved": "https://registry.npmjs.org/tldts/-/tldts-7.0.17.tgz",
-      "integrity": "sha512-Y1KQBgDd/NUc+LfOtKS6mNsC9CCaH+m2P1RoIZy7RAPo3C3/t8X45+zgut31cRZtZ3xKPjfn3TkGTrctC2TQIQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "tldts-core": "^7.0.17"
-      },
-      "bin": {
-        "tldts": "bin/cli.js"
-      }
-    },
-    "node_modules/msw/node_modules/tldts-core": {
-      "version": "7.0.17",
-      "resolved": "https://registry.npmjs.org/tldts-core/-/tldts-core-7.0.17.tgz",
-      "integrity": "sha512-DieYoGrP78PWKsrXr8MZwtQ7GLCUeLxihtjC1jZsW1DnvSMdKPitJSe8OSYDM2u5H6g3kWJZpePqkp43TfLh0g==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
-    "node_modules/msw/node_modules/tough-cookie": {
-      "version": "6.0.0",
-      "resolved": "https://registry.npmjs.org/tough-cookie/-/tough-cookie-6.0.0.tgz",
-      "integrity": "sha512-kXuRi1mtaKMrsLUxz3sQYvVl37B0Ns6MzfrtV5DvJceE9bPyspOqk9xxv7XbZWcfLWbFmm997vl83qUWVJA64w==",
-      "dev": true,
-      "license": "BSD-3-Clause",
-      "optional": true,
-      "dependencies": {
-        "tldts": "^7.0.5"
-      },
-      "engines": {
-        "node": ">=16"
-      }
-    },
-    "node_modules/mute-stream": {
-      "version": "2.0.0",
-      "resolved": "https://registry.npmjs.org/mute-stream/-/mute-stream-2.0.0.tgz",
-      "integrity": "sha512-WWdIxpyjEn+FhQJQQv9aQAYlHoNVdzIzUySNV1gHUPDSdZJ3yZn7pAAbQcV7B56Mvu881q9FZV+0Vx2xC44VWA==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "engines": {
-        "node": "^18.17.0 || >=20.5.0"
-      }
-    },
     "node_modules/mz": {
       "version": "2.7.0",
       "resolved": "https://registry.npmjs.org/mz/-/mz-2.7.0.tgz",
@@ -6818,14 +6336,6 @@
         "node": ">= 0.8.0"
       }
     },
-    "node_modules/outvariant": {
-      "version": "1.4.3",
-      "resolved": "https://registry.npmjs.org/outvariant/-/outvariant-1.4.3.tgz",
-      "integrity": "sha512-+Sl2UErvtsoajRDKCE5/dBz4DIvHXQQnAxtQTF04OJxY0+DyZXSo5P5Bb7XYWOh81syohlYL24hbDwxedPUJCA==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/own-keys": {
       "version": "1.0.1",
       "resolved": "https://registry.npmjs.org/own-keys/-/own-keys-1.0.1.tgz",
@@ -6955,14 +6465,6 @@
       "integrity": "sha512-JNAzZcXrCt42VGLuYz0zfAzDfAvJWW6AfYlDBQyDV5DClI2m5sAmK+OIO7s59XfsRsWHp02jAJrRadPRGTt6SQ==",
       "dev": true
     },
-    "node_modules/path-to-regexp": {
-      "version": "6.3.0",
-      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-6.3.0.tgz",
-      "integrity": "sha512-Yhpw4T9C6hPpgPeA28us07OJeqZ5EzQTkbfwuhsUg0c237RomFoETJgmp2sa3F/41gfLE6G5cqcYwznmeEeOlQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/pathe": {
       "version": "1.1.2",
       "resolved": "https://registry.npmjs.org/pathe/-/pathe-1.1.2.tgz",
@@ -7058,7 +6560,6 @@
           "url": "https://github.com/sponsors/ai"
         }
       ],
-      "peer": true,
       "dependencies": {
         "nanoid": "^3.3.11",
         "picocolors": "^1.1.1",
@@ -7212,7 +6713,6 @@
       "integrity": "sha512-I7AIg5boAr5R0FFtJ6rCfD+LFsWHp81dolrFD8S79U9tb8Az2nGrJncnMSnys+bpQJfRUzqs9hnA81OAA3hCuQ==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "bin": {
         "prettier": "bin/prettier.cjs"
       },
@@ -7242,6 +6742,7 @@
       "integrity": "sha512-Qb1gy5OrP5+zDf2Bvnzdl3jsTf1qXVMazbvCoKhtKqVs4/YK4ozX4gKQJJVyNe+cajNPn0KoC0MC3FUmaHWEmQ==",
       "dev": true,
       "license": "MIT",
+      "peer": true,
       "dependencies": {
         "ansi-regex": "^5.0.1",
         "ansi-styles": "^5.0.0",
@@ -7257,6 +6758,7 @@
       "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
       "dev": true,
       "license": "MIT",
+      "peer": true,
       "engines": {
         "node": ">=8"
       }
@@ -7267,6 +6769,7 @@
       "integrity": "sha512-Cxwpt2SfTzTtXcfOlzGEee8O+c+MmUgGrNiBcXnuWxuFJHe6a5Hz7qwhwe5OgaSYI0IJvkLqWX1ASG+cJOkEiA==",
       "dev": true,
       "license": "MIT",
+      "peer": true,
       "engines": {
         "node": ">=10"
       },
@@ -7279,7 +6782,8 @@
       "resolved": "https://registry.npmjs.org/react-is/-/react-is-17.0.2.tgz",
       "integrity": "sha512-w2GsyukL62IJnlaff/nRegPQR94C/XXamvMWmSHRJ4y7Ts/4ocGRmTHvOs8PSE6pB3dWOrD/nueuU5sduBsQ4w==",
       "dev": true,
-      "license": "MIT"
+      "license": "MIT",
+      "peer": true
     },
     "node_modules/prop-types": {
       "version": "15.8.1",
@@ -7330,7 +6834,6 @@
       "version": "18.3.1",
       "resolved": "https://registry.npmjs.org/react/-/react-18.3.1.tgz",
       "integrity": "sha512-wS+hAgJShR0KhEvPJArfuPVN1+Hz1t0Y6n5jLrGQbkb4urgPE/0Rve+1kMB1v/oWgHgm4WIcV+i7F2pTVj+2iQ==",
-      "peer": true,
       "dependencies": {
         "loose-envify": "^1.1.0"
       },
@@ -7342,7 +6845,6 @@
       "version": "18.3.1",
       "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-18.3.1.tgz",
       "integrity": "sha512-5m4nQKp+rZRb09LNH59GM4BxTh9251/ylbKIbpe7TpGxfJ+9kv6BLkLBXIjjspbgbnIBNqlI23tRnTWT0snUIw==",
-      "peer": true,
       "dependencies": {
         "loose-envify": "^1.1.0",
         "scheduler": "^0.23.2"
@@ -7619,17 +7121,6 @@
         "url": "https://github.com/sponsors/ljharb"
       }
     },
-    "node_modules/require-directory": {
-      "version": "2.1.1",
-      "resolved": "https://registry.npmjs.org/require-directory/-/require-directory-2.1.1.tgz",
-      "integrity": "sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC/PQr7RsRDSTLUg/bZAZtF+TVIkHc6/4RIKrui+Q==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=0.10.0"
-      }
-    },
     "node_modules/resolve": {
       "version": "1.22.11",
       "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.22.11.tgz",
@@ -7677,14 +7168,6 @@
         "url": "https://github.com/sponsors/sindresorhus"
       }
     },
-    "node_modules/rettime": {
-      "version": "0.7.0",
-      "resolved": "https://registry.npmjs.org/rettime/-/rettime-0.7.0.tgz",
-      "integrity": "sha512-LPRKoHnLKd/r3dVxcwO7vhCW+orkOGj9ViueosEBK6ie89CijnfRlhaDhHq/3Hxu4CkWQtxwlBG0mzTQY6uQjw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/reusify": {
       "version": "1.1.0",
       "resolved": "https://registry.npmjs.org/reusify/-/reusify-1.1.0.tgz",
@@ -8095,17 +7578,6 @@
       "dev": true,
       "license": "MIT"
     },
-    "node_modules/statuses": {
-      "version": "2.0.2",
-      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.2.tgz",
-      "integrity": "sha512-DvEy55V3DB7uknRo+4iOGT5fP1slR8wQohVdknigZPMpMstaKJQWhwiYBACJE3Ul2pTnATihhBYnRhZQHGBiRw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">= 0.8"
-      }
-    },
     "node_modules/std-env": {
       "version": "3.10.0",
       "resolved": "https://registry.npmjs.org/std-env/-/std-env-3.10.0.tgz",
@@ -8127,14 +7599,6 @@
         "node": ">= 0.4"
       }
     },
-    "node_modules/strict-event-emitter": {
-      "version": "0.5.1",
-      "resolved": "https://registry.npmjs.org/strict-event-emitter/-/strict-event-emitter-0.5.1.tgz",
-      "integrity": "sha512-vMgjE/GGEPEFnhFub6pa4FmJBRBVOLpIII2hvCZ8Kzb7K0hlHo7mQv6xYrBvCL2LtAIBwFUK8wvuJgTVSQ5MFQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
     "node_modules/string-argv": {
       "version": "0.3.2",
       "resolved": "https://registry.npmjs.org/string-argv/-/string-argv-0.3.2.tgz",
@@ -8572,7 +8036,6 @@
       "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
       "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
       "dev": true,
-      "peer": true,
       "engines": {
         "node": ">=12"
       },
@@ -8706,20 +8169,6 @@
         "node": ">= 0.8.0"
       }
     },
-    "node_modules/type-fest": {
-      "version": "4.41.0",
-      "resolved": "https://registry.npmjs.org/type-fest/-/type-fest-4.41.0.tgz",
-      "integrity": "sha512-TeTSQ6H5YHvpqVwBRcnLDCBnDOHWYu7IvGbHT6N8AOymcr9PJGjc1GTtiWZTYg0NCgYwvnYWEkVChQAr9bjfwA==",
-      "dev": true,
-      "license": "(MIT OR CC0-1.0)",
-      "optional": true,
-      "engines": {
-        "node": ">=16"
-      },
-      "funding": {
-        "url": "https://github.com/sponsors/sindresorhus"
-      }
-    },
     "node_modules/typed-array-buffer": {
       "version": "1.0.3",
       "resolved": "https://registry.npmjs.org/typed-array-buffer/-/typed-array-buffer-1.0.3.tgz",
@@ -8803,7 +8252,6 @@
       "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.9.3.tgz",
       "integrity": "sha512-jl1vZzPDinLr9eUt3J/t7V6FgNEw9QjvBPdysz9KfQDD41fQrC2Y4vKQdiaUpFT4bXlb1RHhLpp8wtm6M5TgSw==",
       "dev": true,
-      "peer": true,
       "bin": {
         "tsc": "bin/tsc",
         "tsserver": "bin/tsserver"
@@ -8831,17 +8279,6 @@
         "url": "https://github.com/sponsors/ljharb"
       }
     },
-    "node_modules/until-async": {
-      "version": "3.0.2",
-      "resolved": "https://registry.npmjs.org/until-async/-/until-async-3.0.2.tgz",
-      "integrity": "sha512-IiSk4HlzAMqTUseHHe3VhIGyuFmN90zMTpD3Z3y8jeQbzLIq500MVM7Jq2vUAnTKAFPJrqwkzr6PoTcPhGcOiw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "funding": {
-        "url": "https://github.com/sponsors/kettanaito"
-      }
-    },
     "node_modules/update-browserslist-db": {
       "version": "1.1.4",
       "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.1.4.tgz",
@@ -8965,7 +8402,6 @@
       "resolved": "https://registry.npmjs.org/vite/-/vite-6.4.1.tgz",
       "integrity": "sha512-+Oxm7q9hDoLMyJOYfUYBuHQo+dkAloi33apOPP56pzj+vsdJDzr+j1NISE5pyaAuKL4A3UD34qd0lx5+kfKp2g==",
       "dev": true,
-      "peer": true,
       "dependencies": {
         "esbuild": "^0.25.0",
         "fdir": "^6.4.4",
@@ -9570,7 +9006,6 @@
       "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
       "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
       "dev": true,
-      "peer": true,
       "engines": {
         "node": ">=12"
       },
@@ -10107,7 +9542,6 @@
       "integrity": "sha512-o5a9xKjbtuhY6Bi5S3+HvbRERmouabWbyUcpXXUA1u+GNUKoROi9byOJ8M0nHbHYHkYICiMlqxkg1KkYmm25Sw==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "dependencies": {
         "esbuild": "^0.21.3",
         "postcss": "^8.4.43",
@@ -10483,17 +9917,6 @@
       "dev": true,
       "license": "MIT"
     },
-    "node_modules/y18n": {
-      "version": "5.0.8",
-      "resolved": "https://registry.npmjs.org/y18n/-/y18n-5.0.8.tgz",
-      "integrity": "sha512-0pfFzegeDWJHJIAmTLRP2DwHjdF5s7jo9tuztdQxAhINCdvS+3nGINqPd00AphqJR/0LhANUS6/+7SCb98YOfA==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "engines": {
-        "node": ">=10"
-      }
-    },
     "node_modules/yallist": {
       "version": "3.1.1",
       "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
@@ -10513,86 +9936,6 @@
         "node": ">= 14.6"
       }
     },
-    "node_modules/yargs": {
-      "version": "17.7.2",
-      "resolved": "https://registry.npmjs.org/yargs/-/yargs-17.7.2.tgz",
-      "integrity": "sha512-7dSzzRQ++CKnNI/krKnYRV7JKKPUXMEh61soaHKg9mrWEhzFWhFnxPxGl+69cD1Ou63C13NUPCnmIcrvqCuM6w==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "cliui": "^8.0.1",
-        "escalade": "^3.1.1",
-        "get-caller-file": "^2.0.5",
-        "require-directory": "^2.1.1",
-        "string-width": "^4.2.3",
-        "y18n": "^5.0.5",
-        "yargs-parser": "^21.1.1"
-      },
-      "engines": {
-        "node": ">=12"
-      }
-    },
-    "node_modules/yargs-parser": {
-      "version": "21.1.1",
-      "resolved": "https://registry.npmjs.org/yargs-parser/-/yargs-parser-21.1.1.tgz",
-      "integrity": "sha512-tVpsJW7DdjecAiFpbIB1e3qxIQsE6NoPc5/eTdrbbIC4h0LVsWhnoa3g+m2HclBIujHzsxZ4VJVA+GUuc2/LBw==",
-      "dev": true,
-      "license": "ISC",
-      "optional": true,
-      "engines": {
-        "node": ">=12"
-      }
-    },
-    "node_modules/yargs/node_modules/ansi-regex": {
-      "version": "5.0.1",
-      "resolved": "https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz",
-      "integrity": "sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/yargs/node_modules/emoji-regex": {
-      "version": "8.0.0",
-      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-8.0.0.tgz",
-      "integrity": "sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo/RPgnr1/GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true
-    },
-    "node_modules/yargs/node_modules/string-width": {
-      "version": "4.2.3",
-      "resolved": "https://registry.npmjs.org/string-width/-/string-width-4.2.3.tgz",
-      "integrity": "sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO/9jIB6UyevL+tXuOqrng8j/cxKTWyWUwvSTriiZz/g==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "emoji-regex": "^8.0.0",
-        "is-fullwidth-code-point": "^3.0.0",
-        "strip-ansi": "^6.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
-    "node_modules/yargs/node_modules/strip-ansi": {
-      "version": "6.0.1",
-      "resolved": "https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz",
-      "integrity": "sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "dependencies": {
-        "ansi-regex": "^5.0.1"
-      },
-      "engines": {
-        "node": ">=8"
-      }
-    },
     "node_modules/yocto-queue": {
       "version": "0.1.0",
       "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
@@ -10606,27 +9949,12 @@
         "url": "https://github.com/sponsors/sindresorhus"
       }
     },
-    "node_modules/yoctocolors-cjs": {
-      "version": "2.1.3",
-      "resolved": "https://registry.npmjs.org/yoctocolors-cjs/-/yoctocolors-cjs-2.1.3.tgz",
-      "integrity": "sha512-U/PBtDf35ff0D8X8D0jfdzHYEPFxAI7jJlxZXwCSez5M3190m+QobIfh+sWDWSHMCWWJN2AWamkegn6vr6YBTw==",
-      "dev": true,
-      "license": "MIT",
-      "optional": true,
-      "engines": {
-        "node": ">=18"
-      },
-      "funding": {
-        "url": "https://github.com/sponsors/sindresorhus"
-      }
-    },
     "node_modules/zod": {
       "version": "4.1.12",
       "resolved": "https://registry.npmjs.org/zod/-/zod-4.1.12.tgz",
       "integrity": "sha512-JInaHOamG8pt5+Ey8kGmdcAcg3OL9reK8ltczgHTAwNhMys/6ThXHityHxVV2p3fkw/c+MAvBHFVYHFZDmjMCQ==",
       "dev": true,
       "license": "MIT",
-      "peer": true,
       "funding": {
         "url": "https://github.com/sponsors/colinhacks"
       }
diff --git a/web/src/components/AITradersPage.tsx b/web/src/components/AITradersPage.tsx
index 5e066661..3f05c5e1 100644
--- a/web/src/components/AITradersPage.tsx
+++ b/web/src/components/AITradersPage.tsx
@@ -244,7 +244,8 @@ export function AITradersPage({ onTraderSelect }: AITradersPageProps) {
         error: '创建失败',
       })
       setShowCreateModal(false)
-      mutateTraders()
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
     } catch (error) {
       console.error('Failed to create trader:', error)
       toast.error(t('createTraderFailed', language))
@@ -303,7 +304,8 @@ export function AITradersPage({ onTraderSelect }: AITradersPageProps) {
       })
       setShowEditModal(false)
       setEditingTrader(null)
-      mutateTraders()
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
     } catch (error) {
       console.error('Failed to update trader:', error)
       toast.error(t('updateTraderFailed', language))
@@ -322,7 +324,9 @@ export function AITradersPage({ onTraderSelect }: AITradersPageProps) {
         success: '删除成功',
         error: '删除失败',
       })
-      mutateTraders()
+
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
     } catch (error) {
       console.error('Failed to delete trader:', error)
       toast.error(t('deleteTraderFailed', language))
@@ -344,7 +348,9 @@ export function AITradersPage({ onTraderSelect }: AITradersPageProps) {
           error: '启动失败',
         })
       }
-      mutateTraders()
+
+      // Immediately refresh traders list to update running status
+      await mutateTraders()
     } catch (error) {
       console.error('Failed to toggle trader:', error)
       toast.error(t('operationFailed', language))
diff --git a/web/src/components/ComparisonChart.tsx b/web/src/components/ComparisonChart.tsx
index dc81c9cf..554c9b50 100644
--- a/web/src/components/ComparisonChart.tsx
+++ b/web/src/components/ComparisonChart.tsx
@@ -100,14 +100,9 @@ export function ComparisonChart({ traders }: ComparisonChartProps) {
           })
         }
 
-        // 计算盈亏百分比：从total_pnl和balance计算
-        // 假设初始余额 = balance - total_pnl
-        const initialBalance = point.balance - point.total_pnl
-        const pnlPct =
-          initialBalance > 0 ? (point.total_pnl / initialBalance) * 100 : 0
-
+        // 直接使用后端返回的盈亏百分比，不要在前端重新计算
         timestampMap.get(ts)!.traders.set(trader.trader_id, {
-          pnl_pct: pnlPct,
+          pnl_pct: point.total_pnl_pct || 0,
           equity: point.total_equity,
         })
       })
diff --git a/web/src/components/HeaderBar.tsx b/web/src/components/HeaderBar.tsx
index 3c1870c4..7d3bd1c6 100644
--- a/web/src/components/HeaderBar.tsx
+++ b/web/src/components/HeaderBar.tsx
@@ -4,6 +4,7 @@ import { motion } from 'framer-motion'
 import { Menu, X, ChevronDown } from 'lucide-react'
 import { t, type Language } from '../i18n/translations'
 import { Container } from './Container'
+import { useSystemConfig } from '../hooks/useSystemConfig'
 
 interface HeaderBarProps {
   onLoginClick?: () => void
@@ -33,6 +34,8 @@ export default function HeaderBar({
   const [userDropdownOpen, setUserDropdownOpen] = useState(false)
   const dropdownRef = useRef<HTMLDivElement>(null)
   const userDropdownRef = useRef<HTMLDivElement>(null)
+  const { config: systemConfig } = useSystemConfig()
+  const registrationEnabled = systemConfig?.registration_enabled !== false
 
   // Close dropdown when clicking outside
   useEffect(() => {
@@ -464,16 +467,18 @@ export default function HeaderBar({
                   >
                     {t('signIn', language)}
                   </a>
-                  <a
-                    href="/register"
-                    className="px-4 py-2 rounded font-semibold text-sm transition-colors hover:opacity-90"
-                    style={{
-                      background: 'var(--brand-yellow)',
-                      color: 'var(--brand-black)',
-                    }}
-                  >
-                    {t('signUp', language)}
-                  </a>
+                  {registrationEnabled && (
+                    <a
+                      href="/register"
+                      className="px-4 py-2 rounded font-semibold text-sm transition-colors hover:opacity-90"
+                      style={{
+                        background: 'var(--brand-yellow)',
+                        color: 'var(--brand-black)',
+                      }}
+                    >
+                      {t('signUp', language)}
+                    </a>
+                  )}
                 </div>
               )
             )}
@@ -901,17 +906,19 @@ export default function HeaderBar({
                 >
                   {t('signIn', language)}
                 </a>
-                <a
-                  href="/register"
-                  className="block w-full px-4 py-2 rounded font-semibold text-sm text-center transition-colors"
-                  style={{
-                    background: 'var(--brand-yellow)',
-                    color: 'var(--brand-black)',
-                  }}
-                  onClick={() => setMobileMenuOpen(false)}
-                >
-                  {t('signUp', language)}
-                </a>
+                {registrationEnabled && (
+                  <a
+                    href="/register"
+                    className="block w-full px-4 py-2 rounded font-semibold text-sm text-center transition-colors"
+                    style={{
+                      background: 'var(--brand-yellow)',
+                      color: 'var(--brand-black)',
+                    }}
+                    onClick={() => setMobileMenuOpen(false)}
+                  >
+                    {t('signUp', language)}
+                  </a>
+                )}
               </div>
             )}
         </div>
diff --git a/web/src/components/LoginPage.tsx b/web/src/components/LoginPage.tsx
index e498d91d..a7d04d1a 100644
--- a/web/src/components/LoginPage.tsx
+++ b/web/src/components/LoginPage.tsx
@@ -1,4 +1,4 @@
-import React, { useState } from 'react'
+import React, { useState, useEffect } from 'react'
 import { useNavigate } from 'react-router-dom'
 import { useAuth } from '../contexts/AuthContext'
 import { useLanguage } from '../contexts/LanguageContext'
@@ -6,6 +6,7 @@ import { t } from '../i18n/translations'
 import { Eye, EyeOff } from 'lucide-react'
 import { Input } from './ui/input'
 import { toast } from 'sonner'
+import { useSystemConfig } from '../hooks/useSystemConfig'
 
 export function LoginPage() {
   const { language } = useLanguage()
@@ -21,6 +22,20 @@ export function LoginPage() {
   const [loading, setLoading] = useState(false)
   const [adminPassword, setAdminPassword] = useState('')
   const adminMode = false
+  const { config: systemConfig } = useSystemConfig()
+  const registrationEnabled = systemConfig?.registration_enabled !== false
+  const [expiredToastId, setExpiredToastId] = useState<string | number | null>(null)
+
+  // Show notification if user was redirected here due to 401
+  useEffect(() => {
+    if (sessionStorage.getItem('from401') === 'true') {
+      const id = toast.warning(t('sessionExpired', language), {
+        duration: Infinity // Keep showing until user dismisses or logs in
+      })
+      setExpiredToastId(id)
+      sessionStorage.removeItem('from401')
+    }
+  }, [language])
 
   const handleAdminLogin = async (e: React.FormEvent) => {
     e.preventDefault()
@@ -31,6 +46,11 @@ export function LoginPage() {
       const msg = result.message || t('loginFailed', language)
       setError(msg)
       toast.error(msg)
+    } else {
+      // Dismiss the "login expired" toast on successful login
+      if (expiredToastId) {
+        toast.dismiss(expiredToastId)
+      }
     }
     setLoading(false)
   }
@@ -46,6 +66,11 @@ export function LoginPage() {
       if (result.requiresOTP && result.userID) {
         setUserID(result.userID)
         setStep('otp')
+      } else {
+        // Dismiss the "login expired" toast on successful login (no OTP required)
+        if (expiredToastId) {
+          toast.dismiss(expiredToastId)
+        }
       }
     } else {
       const msg = result.message || t('loginFailed', language)
@@ -67,6 +92,11 @@ export function LoginPage() {
       const msg = result.message || t('verificationFailed', language)
       setError(msg)
       toast.error(msg)
+    } else {
+      // Dismiss the "login expired" toast on successful OTP verification
+      if (expiredToastId) {
+        toast.dismiss(expiredToastId)
+      }
     }
     // 成功的话AuthContext会自动处理登录状态
 
@@ -313,7 +343,7 @@ export function LoginPage() {
         </div>
 
         {/* Register Link */}
-        {!adminMode && (
+        {!adminMode && registrationEnabled && (
           <div className="text-center mt-6">
             <p className="text-sm" style={{ color: 'var(--text-secondary)' }}>
               还没有账户？{' '}
diff --git a/web/src/components/RegisterPage.tsx b/web/src/components/RegisterPage.tsx
index 5f31c9d7..4131ad2c 100644
--- a/web/src/components/RegisterPage.tsx
+++ b/web/src/components/RegisterPage.tsx
@@ -9,6 +9,7 @@ import { copyWithToast } from '../lib/clipboard'
 import { Eye, EyeOff } from 'lucide-react'
 import { Input } from './ui/input'
 import PasswordChecklist from 'react-password-checklist'
+import { RegistrationDisabled } from './RegistrationDisabled'
 
 export function RegisterPage() {
   const { language } = useLanguage()
@@ -22,6 +23,7 @@ export function RegisterPage() {
   const [confirmPassword, setConfirmPassword] = useState('')
   const [betaCode, setBetaCode] = useState('')
   const [betaMode, setBetaMode] = useState(false)
+  const [registrationEnabled, setRegistrationEnabled] = useState(true)
   const [otpCode, setOtpCode] = useState('')
   const [userID, setUserID] = useState('')
   const [otpSecret, setOtpSecret] = useState('')
@@ -33,16 +35,22 @@ export function RegisterPage() {
   const [showConfirmPassword, setShowConfirmPassword] = useState(false)
 
   useEffect(() => {
-    // 获取系统配置，检查是否开启内测模式
+    // 获取系统配置，检查是否开启内测模式和注册功能
     getSystemConfig()
       .then((config) => {
         setBetaMode(config.beta_mode || false)
+        setRegistrationEnabled(config.registration_enabled !== false)
       })
       .catch((err) => {
         console.error('Failed to fetch system config:', err)
       })
   }, [])
 
+  // 如果注册功能被禁用，显示注册已关闭页面
+  if (!registrationEnabled) {
+    return <RegistrationDisabled />
+  }
+
   const handleRegister = async (e: React.FormEvent) => {
     e.preventDefault()
     setError('')
diff --git a/web/src/components/RegistrationDisabled.test.tsx b/web/src/components/RegistrationDisabled.test.tsx
new file mode 100644
index 00000000..beec1b83
--- /dev/null
+++ b/web/src/components/RegistrationDisabled.test.tsx
@@ -0,0 +1,103 @@
+import { describe, it, expect, vi } from 'vitest'
+import { render, screen, fireEvent } from '@testing-library/react'
+import { RegistrationDisabled } from './RegistrationDisabled'
+import { LanguageProvider } from '../contexts/LanguageContext'
+
+// Mock useLanguage hook
+vi.mock('../contexts/LanguageContext', async () => {
+  const actual = await vi.importActual('../contexts/LanguageContext')
+  return {
+    ...actual,
+    useLanguage: () => ({ language: 'en' }),
+  }
+})
+
+/**
+ * RegistrationDisabled Component Tests
+ *
+ * Tests the component that displays when registration is disabled
+ * This is part of the registration toggle feature
+ */
+describe('RegistrationDisabled Component', () => {
+  const renderComponent = () => {
+    return render(
+      <LanguageProvider>
+        <RegistrationDisabled />
+      </LanguageProvider>
+    )
+  }
+
+  describe('Rendering', () => {
+    it('should render the component without errors', () => {
+      const { container } = renderComponent()
+      expect(container).toBeTruthy()
+    })
+
+    it('should display the NoFx logo', () => {
+      renderComponent()
+      const logo = screen.getByAltText('NoFx Logo')
+      expect(logo).toBeTruthy()
+      expect(logo.getAttribute('src')).toBe('/icons/nofx.svg')
+    })
+
+    it('should display registration closed heading', () => {
+      renderComponent()
+      const heading = screen.getByText('Registration Closed')
+      expect(heading).toBeTruthy()
+    })
+
+    it('should display registration closed message', () => {
+      renderComponent()
+      const message = screen.getByText(/User registration is currently disabled/i)
+      expect(message).toBeTruthy()
+    })
+
+    it('should display back to login button', () => {
+      renderComponent()
+      const button = screen.getByRole('button', { name: /back to login/i })
+      expect(button).toBeTruthy()
+    })
+  })
+
+  describe('Navigation', () => {
+    it('should navigate to login page when button is clicked', () => {
+      const pushStateSpy = vi.spyOn(window.history, 'pushState')
+      const dispatchEventSpy = vi.spyOn(window, 'dispatchEvent')
+
+      renderComponent()
+      const button = screen.getByRole('button', { name: /back to login/i })
+
+      fireEvent.click(button)
+
+      expect(pushStateSpy).toHaveBeenCalledWith({}, '', '/login')
+      expect(dispatchEventSpy).toHaveBeenCalled()
+
+      pushStateSpy.mockRestore()
+      dispatchEventSpy.mockRestore()
+    })
+  })
+
+  describe('Styling', () => {
+    it('should have correct background color', () => {
+      const { container } = renderComponent()
+      const mainDiv = container.firstChild as HTMLElement
+      // Browser converts hex to rgb
+      expect(mainDiv.style.background).toMatch(/rgb\(11,\s*14,\s*17\)|#0B0E11/i)
+    })
+
+    it('should have correct text color', () => {
+      const { container } = renderComponent()
+      const mainDiv = container.firstChild as HTMLElement
+      // Browser converts hex to rgb
+      expect(mainDiv.style.color).toMatch(/rgb\(234,\s*236,\s*239\)|#EAECEF/i)
+    })
+
+    it('should have centered layout', () => {
+      const { container } = renderComponent()
+      const mainDiv = container.firstChild as HTMLElement
+      expect(mainDiv.className).toContain('flex')
+      expect(mainDiv.className).toContain('items-center')
+      expect(mainDiv.className).toContain('justify-center')
+    })
+  })
+})
diff --git a/web/src/components/RegistrationDisabled.tsx b/web/src/components/RegistrationDisabled.tsx
new file mode 100644
index 00000000..048a9d62
--- /dev/null
+++ b/web/src/components/RegistrationDisabled.tsx
@@ -0,0 +1,39 @@
+import { useLanguage } from '../contexts/LanguageContext'
+import { t } from '../i18n/translations'
+
+export function RegistrationDisabled() {
+  const { language } = useLanguage()
+
+  const handleBackToLogin = () => {
+    window.history.pushState({}, '', '/login')
+    window.dispatchEvent(new PopStateEvent('popstate'))
+  }
+
+  return (
+    <div
+      className="min-h-screen flex items-center justify-center"
+      style={{ background: '#0B0E11', color: '#EAECEF' }}
+    >
+      <div className="text-center max-w-md px-6">
+        <img
+          src="/icons/nofx.svg"
+          alt="NoFx Logo"
+          className="w-16 h-16 mx-auto mb-4"
+        />
+        <h1 className="text-2xl font-semibold mb-3">
+          {t('registrationClosed', language)}
+        </h1>
+        <p className="text-sm text-gray-400">
+          {t('registrationClosedMessage', language)}
+        </p>
+        <button
+          className="mt-6 px-4 py-2 rounded text-sm font-semibold transition-colors hover:opacity-90"
+          style={{ background: '#F0B90B', color: '#000' }}
+          onClick={handleBackToLogin}
+        >
+          {t('backToLogin', language)}
+        </button>
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/TraderConfigModal.tsx b/web/src/components/TraderConfigModal.tsx
index f0655213..2fa53a7f 100644
--- a/web/src/components/TraderConfigModal.tsx
+++ b/web/src/components/TraderConfigModal.tsx
@@ -4,6 +4,7 @@ import { useLanguage } from '../contexts/LanguageContext'
 import { t } from '../i18n/translations'
 import { toast } from 'sonner'
 import { Pencil, Plus, X as IconX } from 'lucide-react'
+import { httpClient } from '../lib/httpClient'
 
 // 提取下划线后面的名称部分
 function getShortName(fullName: string): string {
@@ -25,7 +26,7 @@ interface TraderConfigData {
   is_cross_margin: boolean
   use_coin_pool: boolean
   use_oi_top: boolean
-  initial_balance: number
+  initial_balance?: number // 可选：创建时不需要，编辑时使用
   scan_interval_minutes: number
 }
 
@@ -62,7 +63,6 @@ export function TraderConfigModal({
     is_cross_margin: true,
     use_coin_pool: false,
     use_oi_top: false,
-    initial_balance: 1000,
     scan_interval_minutes: 3,
   })
   const [isSaving, setIsSaving] = useState(false)
@@ -115,7 +115,7 @@ export function TraderConfigModal({
   useEffect(() => {
     const fetchConfig = async () => {
       try {
-        const response = await fetch('/api/config')
+        const response = await httpClient.get('/api/config')
         const config = await response.json()
         if (config.default_coins) {
           setAvailableCoins(config.default_coins)
@@ -141,7 +141,7 @@ export function TraderConfigModal({
   useEffect(() => {
     const fetchPromptTemplates = async () => {
       try {
-        const response = await fetch('/api/prompt-templates')
+        const response = await httpClient.get('/api/prompt-templates')
         const data = await response.json()
         if (data.templates) {
           setPromptTemplates(data.templates)
@@ -199,19 +199,13 @@ export function TraderConfigModal({
         throw new Error('未登录，请先登录')
       }
 
-      const response = await fetch(
+      const response = await httpClient.get(
         `/api/account?trader_id=${traderData.trader_id}`,
         {
-          headers: {
-            Authorization: `Bearer ${token}`,
-          },
+          Authorization: `Bearer ${token}`,
         }
       )
 
-      if (!response.ok) {
-        throw new Error('获取账户余额失败')
-      }
-
       const data = await response.json()
 
       // total_equity = 当前账户净值（包含未实现盈亏）
@@ -247,9 +241,14 @@ export function TraderConfigModal({
         is_cross_margin: formData.is_cross_margin,
         use_coin_pool: formData.use_coin_pool,
         use_oi_top: formData.use_oi_top,
-        initial_balance: formData.initial_balance,
         scan_interval_minutes: formData.scan_interval_minutes,
       }
+
+      // 只在编辑模式时包含initial_balance（用于手动更新）
+      if (isEditMode && formData.initial_balance !== undefined) {
+        saveData.initial_balance = formData.initial_balance
+      }
+
       await toast.promise(onSave(saveData), {
         loading: '正在保存…',
         success: '保存成功',
@@ -404,15 +403,12 @@ export function TraderConfigModal({
                     </button>
                   </div>
                 </div>
-                <div>
-                  <div className="flex items-center justify-between mb-2">
-                    <label className="text-sm text-[#EAECEF]">
-                      初始余额 ($)
-                      {!isEditMode && (
-                        <span className="text-[#F0B90B] ml-1">*</span>
-                      )}
-                    </label>
-                    {isEditMode && (
+                {isEditMode && (
+                  <div>
+                    <div className="flex items-center justify-between mb-2">
+                      <label className="text-sm text-[#EAECEF]">
+                        初始余额 ($)
+                      </label>
                       <button
                         type="button"
                         onClick={handleFetchCurrentBalance}
@@ -421,33 +417,46 @@ export function TraderConfigModal({
                       >
                         {isFetchingBalance ? '获取中...' : '获取当前余额'}
                       </button>
+                    </div>
+                    <input
+                      type="number"
+                      value={formData.initial_balance || 0}
+                      onChange={(e) =>
+                        handleInputChange(
+                          'initial_balance',
+                          Number(e.target.value)
+                        )
+                      }
+                      onBlur={(e) => {
+                        // Force minimum value on blur
+                        const value = Number(e.target.value)
+                        if (value < 100) {
+                          handleInputChange('initial_balance', 100)
+                        }
+                      }}
+                      className="w-full px-3 py-2 bg-[#0B0E11] border border-[#2B3139] rounded text-[#EAECEF] focus:border-[#F0B90B] focus:outline-none"
+                      min="100"
+                      step="0.01"
+                    />
+                    <p className="text-xs text-[#848E9C] mt-1">
+                      用于手动更新初始余额基准（例如充值/提现后）
+                    </p>
+                    {balanceFetchError && (
+                      <p className="text-xs text-red-500 mt-1">
+                        {balanceFetchError}
+                      </p>
                     )}
                   </div>
-                  <input
-                    type="number"
-                    value={formData.initial_balance}
-                    onChange={(e) =>
-                      handleInputChange(
-                        'initial_balance',
-                        Number(e.target.value)
-                      )
-                    }
-                    onBlur={(e) => {
-                      // Force minimum value on blur
-                      const value = Number(e.target.value)
-                      if (value < 100) {
-                        handleInputChange('initial_balance', 100)
-                      }
-                    }}
-                    className="w-full px-3 py-2 bg-[#0B0E11] border border-[#2B3139] rounded text-[#EAECEF] focus:border-[#F0B90B] focus:outline-none"
-                    min="100"
-                    step="0.01"
-                  />
-                  {!isEditMode && (
-                    <p className="text-xs text-[#F0B90B] mt-1 flex items-center gap-1">
+                )}
+                {!isEditMode && (
+                  <div>
+                    <label className="text-sm text-[#EAECEF] mb-2 block">
+                      初始余额
+                    </label>
+                    <div className="w-full px-3 py-2 bg-[#1E2329] border border-[#2B3139] rounded text-[#848E9C] flex items-center gap-2">
                       <svg
                         xmlns="http://www.w3.org/2000/svg"
-                        className="w-3.5 h-3.5"
+                        className="w-4 h-4 text-[#F0B90B]"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
@@ -455,24 +464,16 @@ export function TraderConfigModal({
                         strokeLinecap="round"
                         strokeLinejoin="round"
                       >
-                        <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z" />
-                        <line x1="12" x2="12" y1="9" y2="13" />
-                        <line x1="12" x2="12.01" y1="17" y2="17" />
+                        <circle cx="12" cy="12" r="10" />
+                        <line x1="12" x2="12" y1="8" y2="12" />
+                        <line x1="12" x2="12.01" y1="16" y2="16" />
                       </svg>
-                      请输入您交易所账户的当前实际余额。如果输入不准确，P&L统计将会错误。
-                    </p>
-                  )}
-                  {isEditMode && (
-                    <p className="text-xs text-[#848E9C] mt-1">
-                      点击"获取当前余额"按钮可自动获取您交易所账户的当前净值
-                    </p>
-                  )}
-                  {balanceFetchError && (
-                    <p className="text-xs text-red-500 mt-1">
-                      {balanceFetchError}
-                    </p>
-                  )}
-                </div>
+                      <span className="text-sm">
+                        系统将自动获取您的账户净值作为初始余额
+                      </span>
+                    </div>
+                  </div>
+                )}
               </div>
 
               {/* 第二行：AI 扫描决策间隔 */}
diff --git a/web/src/components/landing/LoginModal.tsx b/web/src/components/landing/LoginModal.tsx
index 44032c6e..3abaf1b8 100644
--- a/web/src/components/landing/LoginModal.tsx
+++ b/web/src/components/landing/LoginModal.tsx
@@ -1,6 +1,7 @@
 import { motion } from 'framer-motion'
 import { X } from 'lucide-react'
 import { t, Language } from '../../i18n/translations'
+import { useSystemConfig } from '../../hooks/useSystemConfig'
 
 interface LoginModalProps {
   onClose: () => void
@@ -8,6 +9,9 @@ interface LoginModalProps {
 }
 
 export default function LoginModal({ onClose, language }: LoginModalProps) {
+  const { config: systemConfig } = useSystemConfig()
+  const registrationEnabled = systemConfig?.registration_enabled !== false
+
   return (
     <motion.div
       className="fixed inset-0 z-50 flex items-center justify-center p-4"
@@ -66,23 +70,25 @@ export default function LoginModal({ onClose, language }: LoginModalProps) {
           >
             {t('signIn', language)}
           </motion.button>
-          <motion.button
-            onClick={() => {
-              window.history.pushState({}, '', '/register')
-              window.dispatchEvent(new PopStateEvent('popstate'))
-              onClose()
-            }}
-            className="block w-full px-6 py-3 rounded-lg font-semibold text-center"
-            style={{
-              background: 'var(--brand-dark-gray)',
-              color: 'var(--brand-light-gray)',
-              border: '1px solid rgba(240, 185, 11, 0.2)',
-            }}
-            whileHover={{ scale: 1.05, borderColor: 'var(--brand-yellow)' }}
-            whileTap={{ scale: 0.95 }}
-          >
-            {t('registerNewAccount', language)}
-          </motion.button>
+          {registrationEnabled && (
+            <motion.button
+              onClick={() => {
+                window.history.pushState({}, '', '/register')
+                window.dispatchEvent(new PopStateEvent('popstate'))
+                onClose()
+              }}
+              className="block w-full px-6 py-3 rounded-lg font-semibold text-center"
+              style={{
+                background: 'var(--brand-dark-gray)',
+                color: 'var(--brand-light-gray)',
+                border: '1px solid rgba(240, 185, 11, 0.2)',
+              }}
+              whileHover={{ scale: 1.05, borderColor: 'var(--brand-yellow)' }}
+              whileTap={{ scale: 0.95 }}
+            >
+              {t('registerNewAccount', language)}
+            </motion.button>
+          )}
         </div>
       </motion.div>
     </motion.div>
diff --git a/web/src/components/traders/ExchangeConfigModal.tsx b/web/src/components/traders/ExchangeConfigModal.tsx
new file mode 100644
index 00000000..29dc286c
--- /dev/null
+++ b/web/src/components/traders/ExchangeConfigModal.tsx
@@ -0,0 +1,926 @@
+import React, { useState, useEffect } from 'react'
+import type { Exchange } from '../../types'
+import { t, type Language } from '../../i18n/translations'
+import { api } from '../../lib/api'
+import { getExchangeIcon } from '../ExchangeIcons'
+import {
+  TwoStageKeyModal,
+  type TwoStageKeyModalResult,
+} from '../TwoStageKeyModal'
+import {
+  WebCryptoEnvironmentCheck,
+  type WebCryptoCheckStatus,
+} from '../WebCryptoEnvironmentCheck'
+import { BookOpen, Trash2, HelpCircle } from 'lucide-react'
+import { toast } from 'sonner'
+import { Tooltip } from './Tooltip'
+import { getShortName } from './utils'
+
+interface ExchangeConfigModalProps {
+  allExchanges: Exchange[]
+  editingExchangeId: string | null
+  onSave: (
+    exchangeId: string,
+    apiKey: string,
+    secretKey?: string,
+    testnet?: boolean,
+    hyperliquidWalletAddr?: string,
+    asterUser?: string,
+    asterSigner?: string,
+    asterPrivateKey?: string
+  ) => Promise<void>
+  onDelete: (exchangeId: string) => void
+  onClose: () => void
+  language: Language
+}
+
+export function ExchangeConfigModal({
+  allExchanges,
+  editingExchangeId,
+  onSave,
+  onDelete,
+  onClose,
+  language,
+}: ExchangeConfigModalProps) {
+  const [selectedExchangeId, setSelectedExchangeId] = useState(
+    editingExchangeId || ''
+  )
+  const [apiKey, setApiKey] = useState('')
+  const [secretKey, setSecretKey] = useState('')
+  const [passphrase, setPassphrase] = useState('')
+  const [testnet, setTestnet] = useState(false)
+  const [showGuide, setShowGuide] = useState(false)
+  const [serverIP, setServerIP] = useState<{
+    public_ip: string
+    message: string
+  } | null>(null)
+  const [loadingIP, setLoadingIP] = useState(false)
+  const [copiedIP, setCopiedIP] = useState(false)
+  const [webCryptoStatus, setWebCryptoStatus] =
+    useState<WebCryptoCheckStatus>('idle')
+
+  // 币安配置指南展开状态
+  const [showBinanceGuide, setShowBinanceGuide] = useState(false)
+
+  // Aster 特定字段
+  const [asterUser, setAsterUser] = useState('')
+  const [asterSigner, setAsterSigner] = useState('')
+  const [asterPrivateKey, setAsterPrivateKey] = useState('')
+
+  // Hyperliquid 特定字段
+  const [hyperliquidWalletAddr, setHyperliquidWalletAddr] = useState('')
+
+  // 安全输入状态
+  const [secureInputTarget, setSecureInputTarget] = useState<
+    null | 'hyperliquid' | 'aster'
+  >(null)
+
+  // 获取当前编辑的交易所信息
+  const selectedExchange = allExchanges?.find(
+    (e) => e.id === selectedExchangeId
+  )
+
+  // 如果是编辑现有交易所，初始化表单数据
+  useEffect(() => {
+    if (editingExchangeId && selectedExchange) {
+      setApiKey(selectedExchange.apiKey || '')
+      setSecretKey(selectedExchange.secretKey || '')
+      setPassphrase('') // Don't load existing passphrase for security
+      setTestnet(selectedExchange.testnet || false)
+
+      // Aster 字段
+      setAsterUser(selectedExchange.asterUser || '')
+      setAsterSigner(selectedExchange.asterSigner || '')
+      setAsterPrivateKey('') // Don't load existing private key for security
+
+      // Hyperliquid 字段
+      setHyperliquidWalletAddr(selectedExchange.hyperliquidWalletAddr || '')
+    }
+  }, [editingExchangeId, selectedExchange])
+
+  // 加载服务器IP（当选择binance时）
+  useEffect(() => {
+    if (selectedExchangeId === 'binance' && !serverIP) {
+      setLoadingIP(true)
+      api
+        .getServerIP()
+        .then((data) => {
+          setServerIP(data)
+        })
+        .catch((err) => {
+          console.error('Failed to load server IP:', err)
+        })
+        .finally(() => {
+          setLoadingIP(false)
+        })
+    }
+  }, [selectedExchangeId])
+
+  const handleCopyIP = async (ip: string) => {
+    try {
+      // 优先使用现代 Clipboard API
+      if (navigator.clipboard && navigator.clipboard.writeText) {
+        await navigator.clipboard.writeText(ip)
+        setCopiedIP(true)
+        setTimeout(() => setCopiedIP(false), 2000)
+        toast.success(t('ipCopied', language))
+      } else {
+        // 降级方案: 使用传统的 execCommand 方法
+        const textArea = document.createElement('textarea')
+        textArea.value = ip
+        textArea.style.position = 'fixed'
+        textArea.style.left = '-999999px'
+        textArea.style.top = '-999999px'
+        document.body.appendChild(textArea)
+        textArea.focus()
+        textArea.select()
+
+        try {
+          const successful = document.execCommand('copy')
+          if (successful) {
+            setCopiedIP(true)
+            setTimeout(() => setCopiedIP(false), 2000)
+            toast.success(t('ipCopied', language))
+          } else {
+            throw new Error('复制命令执行失败')
+          }
+        } finally {
+          document.body.removeChild(textArea)
+        }
+      }
+    } catch (err) {
+      console.error('复制失败:', err)
+      // 显示错误提示
+      toast.error(
+        t('copyIPFailed', language) || `复制失败: ${ip}\n请手动复制此IP地址`
+      )
+    }
+  }
+
+  // 安全输入处理函数
+  const secureInputContextLabel =
+    secureInputTarget === 'aster'
+      ? t('asterExchangeName', language)
+      : secureInputTarget === 'hyperliquid'
+        ? t('hyperliquidExchangeName', language)
+        : undefined
+
+  const handleSecureInputCancel = () => {
+    setSecureInputTarget(null)
+  }
+
+  const handleSecureInputComplete = ({
+    value,
+    obfuscationLog,
+  }: TwoStageKeyModalResult) => {
+    const trimmed = value.trim()
+    if (secureInputTarget === 'hyperliquid') {
+      setApiKey(trimmed)
+    }
+    if (secureInputTarget === 'aster') {
+      setAsterPrivateKey(trimmed)
+    }
+    console.log('Secure input obfuscation log:', obfuscationLog)
+    setSecureInputTarget(null)
+  }
+
+  // 掩盖敏感数据显示
+  const maskSecret = (secret: string) => {
+    if (!secret || secret.length === 0) return ''
+    if (secret.length <= 8) return '*'.repeat(secret.length)
+    return (
+      secret.slice(0, 4) +
+      '*'.repeat(Math.max(secret.length - 8, 4)) +
+      secret.slice(-4)
+    )
+  }
+
+  const handleSubmit = async (e: React.FormEvent) => {
+    e.preventDefault()
+    if (!selectedExchangeId) return
+
+    // 根据交易所类型验证不同字段
+    if (selectedExchange?.id === 'binance') {
+      if (!apiKey.trim() || !secretKey.trim()) return
+      await onSave(selectedExchangeId, apiKey.trim(), secretKey.trim(), testnet)
+    } else if (selectedExchange?.id === 'hyperliquid') {
+      if (!apiKey.trim() || !hyperliquidWalletAddr.trim()) return // 验证私钥和钱包地址
+      await onSave(
+        selectedExchangeId,
+        apiKey.trim(),
+        '',
+        testnet,
+        hyperliquidWalletAddr.trim()
+      )
+    } else if (selectedExchange?.id === 'aster') {
+      if (!asterUser.trim() || !asterSigner.trim() || !asterPrivateKey.trim())
+        return
+      await onSave(
+        selectedExchangeId,
+        '',
+        '',
+        testnet,
+        undefined,
+        asterUser.trim(),
+        asterSigner.trim(),
+        asterPrivateKey.trim()
+      )
+    } else if (selectedExchange?.id === 'okx') {
+      if (!apiKey.trim() || !secretKey.trim() || !passphrase.trim()) return
+      await onSave(selectedExchangeId, apiKey.trim(), secretKey.trim(), testnet)
+    } else {
+      // 默认情况（其他CEX交易所）
+      if (!apiKey.trim() || !secretKey.trim()) return
+      await onSave(selectedExchangeId, apiKey.trim(), secretKey.trim(), testnet)
+    }
+  }
+
+  // 可选择的交易所列表（所有支持的交易所）
+  const availableExchanges = allExchanges || []
+
+  return (
+    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
+      <div
+        className="bg-gray-800 rounded-lg w-full max-w-lg relative my-8"
+        style={{
+          background: '#1E2329',
+          maxHeight: 'calc(100vh - 4rem)',
+        }}
+      >
+        <div
+          className="flex items-center justify-between p-6 pb-4 sticky top-0 z-10"
+          style={{ background: '#1E2329' }}
+        >
+          <h3 className="text-xl font-bold" style={{ color: '#EAECEF' }}>
+            {editingExchangeId
+              ? t('editExchange', language)
+              : t('addExchange', language)}
+          </h3>
+          <div className="flex items-center gap-2">
+            {selectedExchange?.id === 'binance' && (
+              <button
+                type="button"
+                onClick={() => setShowGuide(true)}
+                className="px-3 py-2 rounded text-sm font-semibold transition-all hover:scale-105 flex items-center gap-2"
+                style={{
+                  background: 'rgba(240, 185, 11, 0.1)',
+                  color: '#F0B90B',
+                }}
+              >
+                <BookOpen className="w-4 h-4" />
+                {t('viewGuide', language)}
+              </button>
+            )}
+            {editingExchangeId && (
+              <button
+                type="button"
+                onClick={() => onDelete(editingExchangeId)}
+                className="p-2 rounded hover:bg-red-100 transition-colors"
+                style={{
+                  background: 'rgba(246, 70, 93, 0.1)',
+                  color: '#F6465D',
+                }}
+                title={t('delete', language)}
+              >
+                <Trash2 className="w-4 h-4" />
+              </button>
+            )}
+          </div>
+        </div>
+
+        <form onSubmit={handleSubmit} className="px-6 pb-6">
+          <div
+            className="space-y-4 overflow-y-auto"
+            style={{ maxHeight: 'calc(100vh - 16rem)' }}
+          >
+            {!editingExchangeId && (
+              <div className="space-y-3">
+                <div className="space-y-2">
+                  <div
+                    className="text-xs font-semibold uppercase tracking-wide"
+                    style={{ color: '#F0B90B' }}
+                  >
+                    {t('environmentSteps.checkTitle', language)}
+                  </div>
+                  <WebCryptoEnvironmentCheck
+                    language={language}
+                    variant="card"
+                    onStatusChange={setWebCryptoStatus}
+                  />
+                </div>
+                <div className="space-y-2">
+                  <div
+                    className="text-xs font-semibold uppercase tracking-wide"
+                    style={{ color: '#F0B90B' }}
+                  >
+                    {t('environmentSteps.selectTitle', language)}
+                  </div>
+                  <select
+                    value={selectedExchangeId}
+                    onChange={(e) => setSelectedExchangeId(e.target.value)}
+                    className="w-full px-3 py-2 rounded"
+                    style={{
+                      background: '#0B0E11',
+                      border: '1px solid #2B3139',
+                      color: '#EAECEF',
+                    }}
+                    aria-label={t('selectExchange', language)}
+                    disabled={webCryptoStatus !== 'secure'}
+                    required
+                  >
+                    <option value="">
+                      {t('pleaseSelectExchange', language)}
+                    </option>
+                    {availableExchanges.map((exchange) => (
+                      <option key={exchange.id} value={exchange.id}>
+                        {getShortName(exchange.name)} (
+                        {exchange.type.toUpperCase()})
+                      </option>
+                    ))}
+                  </select>
+                </div>
+              </div>
+            )}
+
+            {selectedExchange && (
+              <div
+                className="p-4 rounded"
+                style={{ background: '#0B0E11', border: '1px solid #2B3139' }}
+              >
+                <div className="flex items-center gap-3 mb-3">
+                  <div className="w-8 h-8 flex items-center justify-center">
+                    {getExchangeIcon(selectedExchange.id, {
+                      width: 32,
+                      height: 32,
+                    })}
+                  </div>
+                  <div>
+                    <div className="font-semibold" style={{ color: '#EAECEF' }}>
+                      {getShortName(selectedExchange.name)}
+                    </div>
+                    <div className="text-xs" style={{ color: '#848E9C' }}>
+                      {selectedExchange.type.toUpperCase()} •{' '}
+                      {selectedExchange.id}
+                    </div>
+                  </div>
+                </div>
+              </div>
+            )}
+
+            {selectedExchange && (
+              <>
+                {/* Binance 和其他 CEX 交易所的字段 */}
+                {(selectedExchange.id === 'binance' ||
+                  selectedExchange.type === 'cex') &&
+                  selectedExchange.id !== 'hyperliquid' &&
+                  selectedExchange.id !== 'aster' && (
+                    <>
+                      {/* 币安用户配置提示 (D1 方案) */}
+                      {selectedExchange.id === 'binance' && (
+                        <div
+                          className="mb-4 p-3 rounded cursor-pointer transition-colors"
+                          style={{
+                            background: '#1a3a52',
+                            border: '1px solid #2b5278',
+                          }}
+                          onClick={() => setShowBinanceGuide(!showBinanceGuide)}
+                        >
+                          <div className="flex items-center justify-between">
+                            <div className="flex items-center gap-2">
+                              <span style={{ color: '#58a6ff' }}>ℹ️</span>
+                              <span
+                                className="text-sm font-medium"
+                                style={{ color: '#EAECEF' }}
+                              >
+                                <strong>币安用户必读：</strong>
+                                使用「现货与合约交易」API，不要用「统一账户
+                                API」
+                              </span>
+                            </div>
+                            <span style={{ color: '#8b949e' }}>
+                              {showBinanceGuide ? '▲' : '▼'}
+                            </span>
+                          </div>
+
+                          {/* 展开的详细说明 */}
+                          {showBinanceGuide && (
+                            <div
+                              className="mt-3 pt-3"
+                              style={{
+                                borderTop: '1px solid #2b5278',
+                                fontSize: '0.875rem',
+                                color: '#c9d1d9',
+                              }}
+                              onClick={(e) => e.stopPropagation()}
+                            >
+                              <p className="mb-2" style={{ color: '#8b949e' }}>
+                                <strong>原因：</strong>统一账户 API
+                                权限结构不同，会导致订单提交失败
+                              </p>
+
+                              <p
+                                className="font-semibold mb-1"
+                                style={{ color: '#EAECEF' }}
+                              >
+                                正确配置步骤：
+                              </p>
+                              <ol
+                                className="list-decimal list-inside space-y-1 mb-3"
+                                style={{ paddingLeft: '0.5rem' }}
+                              >
+                                <li>
+                                  登录币安 → 个人中心 →{' '}
+                                  <strong>API 管理</strong>
+                                </li>
+                                <li>
+                                  创建 API → 选择「
+                                  <strong>系统生成的 API 密钥</strong>」
+                                </li>
+                                <li>
+                                  勾选「<strong>现货与合约交易</strong>」（
+                                  <span style={{ color: '#f85149' }}>
+                                    不选统一账户
+                                  </span>
+                                  ）
+                                </li>
+                                <li>
+                                  IP 限制选「<strong>无限制</strong>
+                                  」或添加服务器 IP
+                                </li>
+                              </ol>
+
+                              <p
+                                className="mb-2 p-2 rounded"
+                                style={{
+                                  background: '#3d2a00',
+                                  border: '1px solid #9e6a03',
+                                }}
+                              >
+                                💡 <strong>多资产模式用户注意：</strong>
+                                如果您开启了多资产模式，将强制使用全仓模式。建议关闭多资产模式以支持逐仓交易。
+                              </p>
+
+                              <a
+                                href="https://www.binance.com/zh-CN/support/faq/how-to-create-api-keys-on-binance-360002502072"
+                                target="_blank"
+                                rel="noopener noreferrer"
+                                className="inline-block text-sm hover:underline"
+                                style={{ color: '#58a6ff' }}
+                              >
+                                📖 查看币安官方教程 ↗
+                              </a>
+                            </div>
+                          )}
+                        </div>
+                      )}
+
+                      <div>
+                        <label
+                          className="block text-sm font-semibold mb-2"
+                          style={{ color: '#EAECEF' }}
+                        >
+                          {t('apiKey', language)}
+                        </label>
+                        <input
+                          type="password"
+                          value={apiKey}
+                          onChange={(e) => setApiKey(e.target.value)}
+                          placeholder={t('enterAPIKey', language)}
+                          className="w-full px-3 py-2 rounded"
+                          style={{
+                            background: '#0B0E11',
+                            border: '1px solid #2B3139',
+                            color: '#EAECEF',
+                          }}
+                          required
+                        />
+                      </div>
+
+                      <div>
+                        <label
+                          className="block text-sm font-semibold mb-2"
+                          style={{ color: '#EAECEF' }}
+                        >
+                          {t('secretKey', language)}
+                        </label>
+                        <input
+                          type="password"
+                          value={secretKey}
+                          onChange={(e) => setSecretKey(e.target.value)}
+                          placeholder={t('enterSecretKey', language)}
+                          className="w-full px-3 py-2 rounded"
+                          style={{
+                            background: '#0B0E11',
+                            border: '1px solid #2B3139',
+                            color: '#EAECEF',
+                          }}
+                          required
+                        />
+                      </div>
+
+                      {selectedExchange.id === 'okx' && (
+                        <div>
+                          <label
+                            className="block text-sm font-semibold mb-2"
+                            style={{ color: '#EAECEF' }}
+                          >
+                            {t('passphrase', language)}
+                          </label>
+                          <input
+                            type="password"
+                            value={passphrase}
+                            onChange={(e) => setPassphrase(e.target.value)}
+                            placeholder={t('enterPassphrase', language)}
+                            className="w-full px-3 py-2 rounded"
+                            style={{
+                              background: '#0B0E11',
+                              border: '1px solid #2B3139',
+                              color: '#EAECEF',
+                            }}
+                            required
+                          />
+                        </div>
+                      )}
+
+                      {/* Binance 白名单IP提示 */}
+                      {selectedExchange.id === 'binance' && (
+                        <div
+                          className="p-4 rounded"
+                          style={{
+                            background: 'rgba(240, 185, 11, 0.1)',
+                            border: '1px solid rgba(240, 185, 11, 0.2)',
+                          }}
+                        >
+                          <div
+                            className="text-sm font-semibold mb-2"
+                            style={{ color: '#F0B90B' }}
+                          >
+                            {t('whitelistIP', language)}
+                          </div>
+                          <div
+                            className="text-xs mb-3"
+                            style={{ color: '#848E9C' }}
+                          >
+                            {t('whitelistIPDesc', language)}
+                          </div>
+
+                          {loadingIP ? (
+                            <div
+                              className="text-xs"
+                              style={{ color: '#848E9C' }}
+                            >
+                              {t('loadingServerIP', language)}
+                            </div>
+                          ) : serverIP && serverIP.public_ip ? (
+                            <div
+                              className="flex items-center gap-2 p-2 rounded"
+                              style={{ background: '#0B0E11' }}
+                            >
+                              <code
+                                className="flex-1 text-sm font-mono"
+                                style={{ color: '#F0B90B' }}
+                              >
+                                {serverIP.public_ip}
+                              </code>
+                              <button
+                                type="button"
+                                onClick={() => handleCopyIP(serverIP.public_ip)}
+                                className="px-3 py-1 rounded text-xs font-semibold transition-all hover:scale-105"
+                                style={{
+                                  background: 'rgba(240, 185, 11, 0.2)',
+                                  color: '#F0B90B',
+                                }}
+                              >
+                                {copiedIP
+                                  ? t('ipCopied', language)
+                                  : t('copyIP', language)}
+                              </button>
+                            </div>
+                          ) : null}
+                        </div>
+                      )}
+                    </>
+                  )}
+
+                {/* Aster 交易所的字段 */}
+                {selectedExchange.id === 'aster' && (
+                  <>
+                    <div>
+                      <label
+                        className="block text-sm font-semibold mb-2 flex items-center gap-2"
+                        style={{ color: '#EAECEF' }}
+                      >
+                        {t('user', language)}
+                        <Tooltip content={t('asterUserDesc', language)}>
+                          <HelpCircle
+                            className="w-4 h-4 cursor-help"
+                            style={{ color: '#F0B90B' }}
+                          />
+                        </Tooltip>
+                      </label>
+                      <input
+                        type="text"
+                        value={asterUser}
+                        onChange={(e) => setAsterUser(e.target.value)}
+                        placeholder={t('enterUser', language)}
+                        className="w-full px-3 py-2 rounded"
+                        style={{
+                          background: '#0B0E11',
+                          border: '1px solid #2B3139',
+                          color: '#EAECEF',
+                        }}
+                        required
+                      />
+                    </div>
+
+                    <div>
+                      <label
+                        className="block text-sm font-semibold mb-2 flex items-center gap-2"
+                        style={{ color: '#EAECEF' }}
+                      >
+                        {t('signer', language)}
+                        <Tooltip content={t('asterSignerDesc', language)}>
+                          <HelpCircle
+                            className="w-4 h-4 cursor-help"
+                            style={{ color: '#F0B90B' }}
+                          />
+                        </Tooltip>
+                      </label>
+                      <input
+                        type="text"
+                        value={asterSigner}
+                        onChange={(e) => setAsterSigner(e.target.value)}
+                        placeholder={t('enterSigner', language)}
+                        className="w-full px-3 py-2 rounded"
+                        style={{
+                          background: '#0B0E11',
+                          border: '1px solid #2B3139',
+                          color: '#EAECEF',
+                        }}
+                        required
+                      />
+                    </div>
+
+                    <div>
+                      <label
+                        className="block text-sm font-semibold mb-2 flex items-center gap-2"
+                        style={{ color: '#EAECEF' }}
+                      >
+                        {t('privateKey', language)}
+                        <Tooltip content={t('asterPrivateKeyDesc', language)}>
+                          <HelpCircle
+                            className="w-4 h-4 cursor-help"
+                            style={{ color: '#F0B90B' }}
+                          />
+                        </Tooltip>
+                      </label>
+                      <input
+                        type="password"
+                        value={asterPrivateKey}
+                        onChange={(e) => setAsterPrivateKey(e.target.value)}
+                        placeholder={t('enterPrivateKey', language)}
+                        className="w-full px-3 py-2 rounded"
+                        style={{
+                          background: '#0B0E11',
+                          border: '1px solid #2B3139',
+                          color: '#EAECEF',
+                        }}
+                        required
+                      />
+                    </div>
+                  </>
+                )}
+
+                {/* Hyperliquid 交易所的字段 */}
+                {selectedExchange.id === 'hyperliquid' && (
+                  <>
+                    {/* 安全提示 banner */}
+                    <div
+                      className="p-3 rounded mb-4"
+                      style={{
+                        background: 'rgba(240, 185, 11, 0.1)',
+                        border: '1px solid rgba(240, 185, 11, 0.3)',
+                      }}
+                    >
+                      <div className="flex items-start gap-2">
+                        <span style={{ color: '#F0B90B', fontSize: '16px' }}>
+                          🔐
+                        </span>
+                        <div className="flex-1">
+                          <div
+                            className="text-sm font-semibold mb-1"
+                            style={{ color: '#F0B90B' }}
+                          >
+                            {t('hyperliquidAgentWalletTitle', language)}
+                          </div>
+                          <div
+                            className="text-xs"
+                            style={{ color: '#848E9C', lineHeight: '1.5' }}
+                          >
+                            {t('hyperliquidAgentWalletDesc', language)}
+                          </div>
+                        </div>
+                      </div>
+                    </div>
+
+                    {/* Agent Private Key 字段 */}
+                    <div>
+                      <label
+                        className="block text-sm font-semibold mb-2"
+                        style={{ color: '#EAECEF' }}
+                      >
+                        {t('hyperliquidAgentPrivateKey', language)}
+                      </label>
+                      <div className="flex flex-col gap-2">
+                        <div className="flex gap-2">
+                          <input
+                            type="text"
+                            value={maskSecret(apiKey)}
+                            readOnly
+                            placeholder={t(
+                              'enterHyperliquidAgentPrivateKey',
+                              language
+                            )}
+                            className="w-full px-3 py-2 rounded"
+                            style={{
+                              background: '#0B0E11',
+                              border: '1px solid #2B3139',
+                              color: '#EAECEF',
+                            }}
+                          />
+                          <button
+                            type="button"
+                            onClick={() => setSecureInputTarget('hyperliquid')}
+                            className="px-3 py-2 rounded text-xs font-semibold transition-all hover:scale-105"
+                            style={{
+                              background: '#F0B90B',
+                              color: '#000',
+                              whiteSpace: 'nowrap',
+                            }}
+                          >
+                            {apiKey
+                              ? t('secureInputReenter', language)
+                              : t('secureInputButton', language)}
+                          </button>
+                          {apiKey && (
+                            <button
+                              type="button"
+                              onClick={() => setApiKey('')}
+                              className="px-3 py-2 rounded text-xs font-semibold transition-all hover:scale-105"
+                              style={{
+                                background: '#1B1F2B',
+                                color: '#848E9C',
+                                whiteSpace: 'nowrap',
+                              }}
+                            >
+                              {t('secureInputClear', language)}
+                            </button>
+                          )}
+                        </div>
+                        {apiKey && (
+                          <div className="text-xs" style={{ color: '#848E9C' }}>
+                            {t('secureInputHint', language)}
+                          </div>
+                        )}
+                      </div>
+                      <div
+                        className="text-xs mt-1"
+                        style={{ color: '#848E9C' }}
+                      >
+                        {t('hyperliquidAgentPrivateKeyDesc', language)}
+                      </div>
+                    </div>
+
+                    {/* Main Wallet Address 字段 */}
+                    <div>
+                      <label
+                        className="block text-sm font-semibold mb-2"
+                        style={{ color: '#EAECEF' }}
+                      >
+                        {t('hyperliquidMainWalletAddress', language)}
+                      </label>
+                      <input
+                        type="text"
+                        value={hyperliquidWalletAddr}
+                        onChange={(e) =>
+                          setHyperliquidWalletAddr(e.target.value)
+                        }
+                        placeholder={t(
+                          'enterHyperliquidMainWalletAddress',
+                          language
+                        )}
+                        className="w-full px-3 py-2 rounded"
+                        style={{
+                          background: '#0B0E11',
+                          border: '1px solid #2B3139',
+                          color: '#EAECEF',
+                        }}
+                        required
+                      />
+                      <div
+                        className="text-xs mt-1"
+                        style={{ color: '#848E9C' }}
+                      >
+                        {t('hyperliquidMainWalletAddressDesc', language)}
+                      </div>
+                    </div>
+                  </>
+                )}
+              </>
+            )}
+          </div>
+
+          <div
+            className="flex gap-3 mt-6 pt-4 sticky bottom-0"
+            style={{ background: '#1E2329' }}
+          >
+            <button
+              type="button"
+              onClick={onClose}
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold"
+              style={{ background: '#2B3139', color: '#848E9C' }}
+            >
+              {t('cancel', language)}
+            </button>
+            <button
+              type="submit"
+              disabled={
+                !selectedExchange ||
+                (selectedExchange.id === 'binance' &&
+                  (!apiKey.trim() || !secretKey.trim())) ||
+                (selectedExchange.id === 'okx' &&
+                  (!apiKey.trim() ||
+                    !secretKey.trim() ||
+                    !passphrase.trim())) ||
+                (selectedExchange.id === 'hyperliquid' &&
+                  (!apiKey.trim() || !hyperliquidWalletAddr.trim())) || // 验证私钥和钱包地址
+                (selectedExchange.id === 'aster' &&
+                  (!asterUser.trim() ||
+                    !asterSigner.trim() ||
+                    !asterPrivateKey.trim())) ||
+                (selectedExchange.type === 'cex' &&
+                  selectedExchange.id !== 'hyperliquid' &&
+                  selectedExchange.id !== 'aster' &&
+                  selectedExchange.id !== 'binance' &&
+                  selectedExchange.id !== 'okx' &&
+                  (!apiKey.trim() || !secretKey.trim()))
+              }
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold disabled:opacity-50"
+              style={{ background: '#F0B90B', color: '#000' }}
+            >
+              {t('saveConfig', language)}
+            </button>
+          </div>
+        </form>
+      </div>
+
+      {/* Binance Setup Guide Modal */}
+      {showGuide && (
+        <div
+          className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
+          onClick={() => setShowGuide(false)}
+        >
+          <div
+            className="bg-gray-800 rounded-lg p-6 w-full max-w-4xl relative"
+            style={{ background: '#1E2329' }}
+            onClick={(e) => e.stopPropagation()}
+          >
+            <div className="flex items-center justify-between mb-4">
+              <h3
+                className="text-xl font-bold flex items-center gap-2"
+                style={{ color: '#EAECEF' }}
+              >
+                <BookOpen className="w-6 h-6" style={{ color: '#F0B90B' }} />
+                {t('binanceSetupGuide', language)}
+              </h3>
+              <button
+                onClick={() => setShowGuide(false)}
+                className="px-4 py-2 rounded text-sm font-semibold transition-all hover:scale-105"
+                style={{ background: '#2B3139', color: '#848E9C' }}
+              >
+                {t('closeGuide', language)}
+              </button>
+            </div>
+            <div className="overflow-y-auto max-h-[80vh]">
+              <img
+                src="/images/guide.png"
+                alt={t('binanceSetupGuide', language)}
+                className="w-full h-auto rounded"
+              />
+            </div>
+          </div>
+        </div>
+      )}
+
+      {/* Two Stage Key Modal */}
+      <TwoStageKeyModal
+        isOpen={secureInputTarget !== null}
+        language={language}
+        contextLabel={secureInputContextLabel}
+        expectedLength={64}
+        onCancel={handleSecureInputCancel}
+        onComplete={handleSecureInputComplete}
+      />
+    </div>
+  )
+}
diff --git a/web/src/components/traders/ModelConfigModal.tsx b/web/src/components/traders/ModelConfigModal.tsx
new file mode 100644
index 00000000..86297ba5
--- /dev/null
+++ b/web/src/components/traders/ModelConfigModal.tsx
@@ -0,0 +1,291 @@
+import { useState, useEffect } from 'react'
+import { Trash2 } from 'lucide-react'
+import { t, type Language } from '../../i18n/translations'
+import type { AIModel } from '../../types'
+import { getModelIcon } from '../ModelIcons'
+import { getShortName } from './utils'
+
+interface ModelConfigModalProps {
+  allModels: AIModel[]
+  configuredModels: AIModel[]
+  editingModelId: string | null
+  onSave: (
+    modelId: string,
+    apiKey: string,
+    baseUrl?: string,
+    modelName?: string
+  ) => void
+  onDelete: (modelId: string) => void
+  onClose: () => void
+  language: Language
+}
+
+export function ModelConfigModal({
+  allModels,
+  configuredModels,
+  editingModelId,
+  onSave,
+  onDelete,
+  onClose,
+  language,
+}: ModelConfigModalProps) {
+  const [selectedModelId, setSelectedModelId] = useState(editingModelId || '')
+  const [apiKey, setApiKey] = useState('')
+  const [baseUrl, setBaseUrl] = useState('')
+  const [modelName, setModelName] = useState('')
+
+  // 获取当前编辑的模型信息 - 编辑时从已配置的模型中查找,新建时从所有支持的模型中查找
+  const selectedModel = editingModelId
+    ? configuredModels?.find((m) => m.id === selectedModelId)
+    : allModels?.find((m) => m.id === selectedModelId)
+
+  // 如果是编辑现有模型,初始化API Key、Base URL和Model Name
+  useEffect(() => {
+    if (editingModelId && selectedModel) {
+      setApiKey(selectedModel.apiKey || '')
+      setBaseUrl(selectedModel.customApiUrl || '')
+      setModelName(selectedModel.customModelName || '')
+    }
+  }, [editingModelId, selectedModel])
+
+  const handleSubmit = (e: React.FormEvent) => {
+    e.preventDefault()
+    if (!selectedModelId || !apiKey.trim()) return
+
+    onSave(
+      selectedModelId,
+      apiKey.trim(),
+      baseUrl.trim() || undefined,
+      modelName.trim() || undefined
+    )
+  }
+
+  // 可选择的模型列表(所有支持的模型)
+  const availableModels = allModels || []
+
+  return (
+    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
+      <div
+        className="bg-gray-800 rounded-lg w-full max-w-lg relative my-8"
+        style={{
+          background: '#1E2329',
+          maxHeight: 'calc(100vh - 4rem)',
+        }}
+      >
+        <div
+          className="flex items-center justify-between p-6 pb-4 sticky top-0 z-10"
+          style={{ background: '#1E2329' }}
+        >
+          <h3 className="text-xl font-bold" style={{ color: '#EAECEF' }}>
+            {editingModelId
+              ? t('editAIModel', language)
+              : t('addAIModel', language)}
+          </h3>
+          {editingModelId && (
+            <button
+              type="button"
+              onClick={() => onDelete(editingModelId)}
+              className="p-2 rounded hover:bg-red-100 transition-colors"
+              style={{ background: 'rgba(246, 70, 93, 0.1)', color: '#F6465D' }}
+              title={t('delete', language)}
+            >
+              <Trash2 className="w-4 h-4" />
+            </button>
+          )}
+        </div>
+
+        <form onSubmit={handleSubmit} className="px-6 pb-6">
+          <div
+            className="space-y-4 overflow-y-auto"
+            style={{ maxHeight: 'calc(100vh - 16rem)' }}
+          >
+            {!editingModelId && (
+              <div>
+                <label
+                  className="block text-sm font-semibold mb-2"
+                  style={{ color: '#EAECEF' }}
+                >
+                  {t('selectModel', language)}
+                </label>
+                <select
+                  value={selectedModelId}
+                  onChange={(e) => setSelectedModelId(e.target.value)}
+                  className="w-full px-3 py-2 rounded"
+                  style={{
+                    background: '#0B0E11',
+                    border: '1px solid #2B3139',
+                    color: '#EAECEF',
+                  }}
+                  required
+                >
+                  <option value="">{t('pleaseSelectModel', language)}</option>
+                  {availableModels.map((model) => (
+                    <option key={model.id} value={model.id}>
+                      {getShortName(model.name)} ({model.provider})
+                    </option>
+                  ))}
+                </select>
+              </div>
+            )}
+
+            {selectedModel && (
+              <div
+                className="p-4 rounded"
+                style={{ background: '#0B0E11', border: '1px solid #2B3139' }}
+              >
+                <div className="flex items-center gap-3 mb-3">
+                  <div className="w-8 h-8 flex items-center justify-center">
+                    {getModelIcon(selectedModel.provider || selectedModel.id, {
+                      width: 32,
+                      height: 32,
+                    }) || (
+                      <div
+                        className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
+                        style={{
+                          background:
+                            selectedModel.id === 'deepseek'
+                              ? '#60a5fa'
+                              : '#c084fc',
+                          color: '#fff',
+                        }}
+                      >
+                        {selectedModel.name[0]}
+                      </div>
+                    )}
+                  </div>
+                  <div>
+                    <div className="font-semibold" style={{ color: '#EAECEF' }}>
+                      {getShortName(selectedModel.name)}
+                    </div>
+                    <div className="text-xs" style={{ color: '#848E9C' }}>
+                      {selectedModel.provider} • {selectedModel.id}
+                    </div>
+                  </div>
+                </div>
+              </div>
+            )}
+
+            {selectedModel && (
+              <>
+                <div>
+                  <label
+                    className="block text-sm font-semibold mb-2"
+                    style={{ color: '#EAECEF' }}
+                  >
+                    API Key
+                  </label>
+                  <input
+                    type="password"
+                    value={apiKey}
+                    onChange={(e) => setApiKey(e.target.value)}
+                    placeholder={t('enterAPIKey', language)}
+                    className="w-full px-3 py-2 rounded"
+                    style={{
+                      background: '#0B0E11',
+                      border: '1px solid #2B3139',
+                      color: '#EAECEF',
+                    }}
+                    required
+                  />
+                </div>
+
+                <div>
+                  <label
+                    className="block text-sm font-semibold mb-2"
+                    style={{ color: '#EAECEF' }}
+                  >
+                    {t('customBaseURL', language)}
+                  </label>
+                  <input
+                    type="url"
+                    value={baseUrl}
+                    onChange={(e) => setBaseUrl(e.target.value)}
+                    placeholder={t('customBaseURLPlaceholder', language)}
+                    className="w-full px-3 py-2 rounded"
+                    style={{
+                      background: '#0B0E11',
+                      border: '1px solid #2B3139',
+                      color: '#EAECEF',
+                    }}
+                  />
+                  <div className="text-xs mt-1" style={{ color: '#848E9C' }}>
+                    {t('leaveBlankForDefault', language)}
+                  </div>
+                </div>
+
+                <div>
+                  <label
+                    className="block text-sm font-semibold mb-2"
+                    style={{ color: '#EAECEF' }}
+                  >
+                    Model Name (可选)
+                  </label>
+                  <input
+                    type="text"
+                    value={modelName}
+                    onChange={(e) => setModelName(e.target.value)}
+                    placeholder="例如: deepseek-chat, qwen3-max, gpt-5"
+                    className="w-full px-3 py-2 rounded"
+                    style={{
+                      background: '#0B0E11',
+                      border: '1px solid #2B3139',
+                      color: '#EAECEF',
+                    }}
+                  />
+                  <div className="text-xs mt-1" style={{ color: '#848E9C' }}>
+                    留空使用默认模型名称
+                  </div>
+                </div>
+
+                <div
+                  className="p-4 rounded"
+                  style={{
+                    background: 'rgba(240, 185, 11, 0.1)',
+                    border: '1px solid rgba(240, 185, 11, 0.2)',
+                  }}
+                >
+                  <div
+                    className="text-sm font-semibold mb-2"
+                    style={{ color: '#F0B90B' }}
+                  >
+                    ℹ️ {t('information', language)}
+                  </div>
+                  <div
+                    className="text-xs space-y-1"
+                    style={{ color: '#848E9C' }}
+                  >
+                    <div>{t('modelConfigInfo1', language)}</div>
+                    <div>{t('modelConfigInfo2', language)}</div>
+                    <div>{t('modelConfigInfo3', language)}</div>
+                  </div>
+                </div>
+              </>
+            )}
+          </div>
+
+          <div
+            className="flex gap-3 mt-6 pt-4 sticky bottom-0"
+            style={{ background: '#1E2329' }}
+          >
+            <button
+              type="button"
+              onClick={onClose}
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold"
+              style={{ background: '#2B3139', color: '#848E9C' }}
+            >
+              {t('cancel', language)}
+            </button>
+            <button
+              type="submit"
+              disabled={!selectedModel || !apiKey.trim()}
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold disabled:opacity-50"
+              style={{ background: '#F0B90B', color: '#000' }}
+            >
+              {t('saveConfig', language)}
+            </button>
+          </div>
+        </form>
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/SignalSourceModal.tsx b/web/src/components/traders/SignalSourceModal.tsx
new file mode 100644
index 00000000..7c0fe814
--- /dev/null
+++ b/web/src/components/traders/SignalSourceModal.tsx
@@ -0,0 +1,138 @@
+import { useState } from 'react'
+import { t, type Language } from '../../i18n/translations'
+
+interface SignalSourceModalProps {
+  coinPoolUrl: string
+  oiTopUrl: string
+  onSave: (coinPoolUrl: string, oiTopUrl: string) => void
+  onClose: () => void
+  language: Language
+}
+
+export function SignalSourceModal({
+  coinPoolUrl,
+  oiTopUrl,
+  onSave,
+  onClose,
+  language,
+}: SignalSourceModalProps) {
+  const [coinPool, setCoinPool] = useState(coinPoolUrl || '')
+  const [oiTop, setOiTop] = useState(oiTopUrl || '')
+
+  const handleSubmit = (e: React.FormEvent) => {
+    e.preventDefault()
+    onSave(coinPool.trim(), oiTop.trim())
+  }
+
+  return (
+    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
+      <div
+        className="bg-gray-800 rounded-lg w-full max-w-lg relative my-8"
+        style={{
+          background: '#1E2329',
+          maxHeight: 'calc(100vh - 4rem)',
+        }}
+      >
+        <h3 className="text-xl font-bold mb-4" style={{ color: '#EAECEF' }}>
+          {t('signalSourceConfig', language)}
+        </h3>
+
+        <form onSubmit={handleSubmit} className="px-6 pb-6">
+          <div
+            className="space-y-4 overflow-y-auto"
+            style={{ maxHeight: 'calc(100vh - 16rem)' }}
+          >
+            <div>
+              <label
+                className="block text-sm font-semibold mb-2"
+                style={{ color: '#EAECEF' }}
+              >
+                COIN POOL URL
+              </label>
+              <input
+                type="url"
+                value={coinPool}
+                onChange={(e) => setCoinPool(e.target.value)}
+                placeholder="https://api.example.com/coinpool"
+                className="w-full px-3 py-2 rounded"
+                style={{
+                  background: '#0B0E11',
+                  border: '1px solid #2B3139',
+                  color: '#EAECEF',
+                }}
+              />
+              <div className="text-xs mt-1" style={{ color: '#848E9C' }}>
+                {t('coinPoolDescription', language)}
+              </div>
+            </div>
+
+            <div>
+              <label
+                className="block text-sm font-semibold mb-2"
+                style={{ color: '#EAECEF' }}
+              >
+                OI TOP URL
+              </label>
+              <input
+                type="url"
+                value={oiTop}
+                onChange={(e) => setOiTop(e.target.value)}
+                placeholder="https://api.example.com/oitop"
+                className="w-full px-3 py-2 rounded"
+                style={{
+                  background: '#0B0E11',
+                  border: '1px solid #2B3139',
+                  color: '#EAECEF',
+                }}
+              />
+              <div className="text-xs mt-1" style={{ color: '#848E9C' }}>
+                {t('oiTopDescription', language)}
+              </div>
+            </div>
+
+            <div
+              className="p-4 rounded"
+              style={{
+                background: 'rgba(240, 185, 11, 0.1)',
+                border: '1px solid rgba(240, 185, 11, 0.2)',
+              }}
+            >
+              <div
+                className="text-sm font-semibold mb-2"
+                style={{ color: '#F0B90B' }}
+              >
+                ℹ️ {t('information', language)}
+              </div>
+              <div className="text-xs space-y-1" style={{ color: '#848E9C' }}>
+                <div>{t('signalSourceInfo1', language)}</div>
+                <div>{t('signalSourceInfo2', language)}</div>
+                <div>{t('signalSourceInfo3', language)}</div>
+              </div>
+            </div>
+          </div>
+
+          <div
+            className="flex gap-3 mt-6 pt-4 sticky bottom-0"
+            style={{ background: '#1E2329' }}
+          >
+            <button
+              type="button"
+              onClick={onClose}
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold"
+              style={{ background: '#2B3139', color: '#848E9C' }}
+            >
+              {t('cancel', language)}
+            </button>
+            <button
+              type="submit"
+              className="flex-1 px-4 py-2 rounded text-sm font-semibold"
+              style={{ background: '#F0B90B', color: '#000' }}
+            >
+              {t('save', language)}
+            </button>
+          </div>
+        </form>
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/Tooltip.tsx b/web/src/components/traders/Tooltip.tsx
new file mode 100644
index 00000000..3b31b799
--- /dev/null
+++ b/web/src/components/traders/Tooltip.tsx
@@ -0,0 +1,44 @@
+import { useState } from 'react'
+
+interface TooltipProps {
+  content: string
+  children: React.ReactNode
+}
+
+export function Tooltip({ content, children }: TooltipProps) {
+  const [show, setShow] = useState(false)
+
+  return (
+    <div className="relative inline-block">
+      <div
+        onMouseEnter={() => setShow(true)}
+        onMouseLeave={() => setShow(false)}
+        onClick={() => setShow(!show)}
+      >
+        {children}
+      </div>
+      {show && (
+        <div
+          className="absolute z-10 px-3 py-2 text-sm rounded-lg shadow-lg w-64 left-1/2 transform -translate-x-1/2 bottom-full mb-2"
+          style={{
+            background: '#2B3139',
+            color: '#EAECEF',
+            border: '1px solid #474D57',
+          }}
+        >
+          {content}
+          <div
+            className="absolute left-1/2 transform -translate-x-1/2 top-full"
+            style={{
+              width: 0,
+              height: 0,
+              borderLeft: '6px solid transparent',
+              borderRight: '6px solid transparent',
+              borderTop: '6px solid #2B3139',
+            }}
+          />
+        </div>
+      )}
+    </div>
+  )
+}
diff --git a/web/src/components/traders/index.ts b/web/src/components/traders/index.ts
new file mode 100644
index 00000000..4c0528fc
--- /dev/null
+++ b/web/src/components/traders/index.ts
@@ -0,0 +1,5 @@
+export { Tooltip } from './Tooltip'
+export { SignalSourceModal } from './SignalSourceModal'
+export { ModelConfigModal } from './ModelConfigModal'
+export { ExchangeConfigModal } from './ExchangeConfigModal'
+export { getModelDisplayName, getShortName } from './utils'
diff --git a/web/src/components/traders/sections/AIModelsSection.tsx b/web/src/components/traders/sections/AIModelsSection.tsx
new file mode 100644
index 00000000..059c8fa5
--- /dev/null
+++ b/web/src/components/traders/sections/AIModelsSection.tsx
@@ -0,0 +1,97 @@
+import { Brain } from 'lucide-react'
+import { t, Language } from '../../../i18n/translations'
+import { getModelIcon } from '../../ModelIcons'
+import { getShortName } from '../utils'
+import type { AIModel } from '../../../types'
+
+interface AIModelsSectionProps {
+  language: Language
+  configuredModels: AIModel[]
+  isModelInUse: (modelId: string) => boolean
+  onModelClick: (modelId: string) => void
+}
+
+export function AIModelsSection({
+  language,
+  configuredModels,
+  isModelInUse,
+  onModelClick,
+}: AIModelsSectionProps) {
+  return (
+    <div className="binance-card p-3 md:p-4">
+      <h3
+        className="text-base md:text-lg font-semibold mb-3 flex items-center gap-2"
+        style={{ color: '#EAECEF' }}
+      >
+        <Brain className="w-4 h-4 md:w-5 md:h-5" style={{ color: '#60a5fa' }} />
+        {t('aiModels', language)}
+      </h3>
+      <div className="space-y-2 md:space-y-3">
+        {configuredModels.map((model) => {
+          const inUse = isModelInUse(model.id)
+          return (
+            <div
+              key={model.id}
+              className={`flex items-center justify-between p-2 md:p-3 rounded transition-all ${
+                inUse
+                  ? 'cursor-not-allowed'
+                  : 'cursor-pointer hover:bg-gray-700'
+              }`}
+              style={{ background: '#0B0E11', border: '1px solid #2B3139' }}
+              onClick={() => onModelClick(model.id)}
+            >
+              <div className="flex items-center gap-2 md:gap-3">
+                <div className="w-7 h-7 md:w-8 md:h-8 flex items-center justify-center flex-shrink-0">
+                  {getModelIcon(model.provider || model.id, {
+                    width: 28,
+                    height: 28,
+                  }) || (
+                    <div
+                      className="w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold"
+                      style={{
+                        background:
+                          model.id === 'deepseek' ? '#60a5fa' : '#c084fc',
+                        color: '#fff',
+                      }}
+                    >
+                      {getShortName(model.name)[0]}
+                    </div>
+                  )}
+                </div>
+                <div className="min-w-0">
+                  <div
+                    className="font-semibold text-sm md:text-base truncate"
+                    style={{ color: '#EAECEF' }}
+                  >
+                    {getShortName(model.name)}
+                  </div>
+                  <div className="text-xs" style={{ color: '#848E9C' }}>
+                    {inUse
+                      ? t('inUse', language)
+                      : model.enabled
+                        ? t('enabled', language)
+                        : t('configured', language)}
+                  </div>
+                </div>
+              </div>
+              <div
+                className={`w-2.5 h-2.5 md:w-3 md:h-3 rounded-full flex-shrink-0 ${model.enabled ? 'bg-green-400' : 'bg-gray-500'}`}
+              />
+            </div>
+          )
+        })}
+        {configuredModels.length === 0 && (
+          <div
+            className="text-center py-6 md:py-8"
+            style={{ color: '#848E9C' }}
+          >
+            <Brain className="w-10 h-10 md:w-12 md:h-12 mx-auto mb-2 opacity-50" />
+            <div className="text-xs md:text-sm">
+              {t('noModelsConfigured', language)}
+            </div>
+          </div>
+        )}
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/sections/ExchangesSection.tsx b/web/src/components/traders/sections/ExchangesSection.tsx
new file mode 100644
index 00000000..5c0235e2
--- /dev/null
+++ b/web/src/components/traders/sections/ExchangesSection.tsx
@@ -0,0 +1,87 @@
+import { Landmark } from 'lucide-react'
+import { t, type Language } from '../../../i18n/translations'
+import { getExchangeIcon } from '../../ExchangeIcons'
+import { getShortName } from '../index'
+import type { Exchange } from '../../../types'
+
+interface ExchangesSectionProps {
+  language: Language
+  configuredExchanges: Exchange[]
+  isExchangeInUse: (exchangeId: string) => boolean
+  onExchangeClick: (exchangeId: string) => void
+}
+
+export function ExchangesSection({
+  language,
+  configuredExchanges,
+  isExchangeInUse,
+  onExchangeClick,
+}: ExchangesSectionProps) {
+  return (
+    <div className="binance-card p-3 md:p-4">
+      <h3
+        className="text-base md:text-lg font-semibold mb-3 flex items-center gap-2"
+        style={{ color: '#EAECEF' }}
+      >
+        <Landmark
+          className="w-4 h-4 md:w-5 md:h-5"
+          style={{ color: '#F0B90B' }}
+        />
+        {t('exchanges', language)}
+      </h3>
+      <div className="space-y-2 md:space-y-3">
+        {configuredExchanges.map((exchange) => {
+          const inUse = isExchangeInUse(exchange.id)
+          return (
+            <div
+              key={exchange.id}
+              className={`flex items-center justify-between p-2 md:p-3 rounded transition-all ${
+                inUse
+                  ? 'cursor-not-allowed'
+                  : 'cursor-pointer hover:bg-gray-700'
+              }`}
+              style={{ background: '#0B0E11', border: '1px solid #2B3139' }}
+              onClick={() => onExchangeClick(exchange.id)}
+            >
+              <div className="flex items-center gap-2 md:gap-3">
+                <div className="w-7 h-7 md:w-8 md:h-8 flex items-center justify-center flex-shrink-0">
+                  {getExchangeIcon(exchange.id, { width: 28, height: 28 })}
+                </div>
+                <div className="min-w-0">
+                  <div
+                    className="font-semibold text-sm md:text-base truncate"
+                    style={{ color: '#EAECEF' }}
+                  >
+                    {getShortName(exchange.name)}
+                  </div>
+                  <div className="text-xs" style={{ color: '#848E9C' }}>
+                    {exchange.type.toUpperCase()} •{' '}
+                    {inUse
+                      ? t('inUse', language)
+                      : exchange.enabled
+                        ? t('enabled', language)
+                        : t('configured', language)}
+                  </div>
+                </div>
+              </div>
+              <div
+                className={`w-2.5 h-2.5 md:w-3 md:h-3 rounded-full flex-shrink-0 ${exchange.enabled ? 'bg-green-400' : 'bg-gray-500'}`}
+              />
+            </div>
+          )
+        })}
+        {configuredExchanges.length === 0 && (
+          <div
+            className="text-center py-6 md:py-8"
+            style={{ color: '#848E9C' }}
+          >
+            <Landmark className="w-10 h-10 md:w-12 md:h-12 mx-auto mb-2 opacity-50" />
+            <div className="text-xs md:text-sm">
+              {t('noExchangesConfigured', language)}
+            </div>
+          </div>
+        )}
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/sections/PageHeader.tsx b/web/src/components/traders/sections/PageHeader.tsx
new file mode 100644
index 00000000..4584766a
--- /dev/null
+++ b/web/src/components/traders/sections/PageHeader.tsx
@@ -0,0 +1,117 @@
+import { Bot, Plus, Radio } from 'lucide-react'
+import { t, type Language } from '../../../i18n/translations'
+
+interface PageHeaderProps {
+  language: Language
+  tradersCount: number
+  configuredModelsCount: number
+  configuredExchangesCount: number
+  onAddModel: () => void
+  onAddExchange: () => void
+  onConfigureSignalSource: () => void
+  onCreateTrader: () => void
+}
+
+export function PageHeader({
+  language,
+  tradersCount,
+  configuredModelsCount,
+  configuredExchangesCount,
+  onAddModel,
+  onAddExchange,
+  onConfigureSignalSource,
+  onCreateTrader,
+}: PageHeaderProps) {
+  const canCreateTrader =
+    configuredModelsCount > 0 && configuredExchangesCount > 0
+
+  return (
+    <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-3 md:gap-0">
+      <div className="flex items-center gap-3 md:gap-4">
+        <div
+          className="w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center"
+          style={{
+            background: 'linear-gradient(135deg, #F0B90B 0%, #FCD535 100%)',
+            boxShadow: '0 4px 14px rgba(240, 185, 11, 0.4)',
+          }}
+        >
+          <Bot className="w-5 h-5 md:w-6 md:h-6" style={{ color: '#000' }} />
+        </div>
+        <div>
+          <h1
+            className="text-xl md:text-2xl font-bold flex items-center gap-2"
+            style={{ color: '#EAECEF' }}
+          >
+            {t('aiTraders', language)}
+            <span
+              className="text-xs font-normal px-2 py-1 rounded"
+              style={{
+                background: 'rgba(240, 185, 11, 0.15)',
+                color: '#F0B90B',
+              }}
+            >
+              {tradersCount} {t('active', language)}
+            </span>
+          </h1>
+          <p className="text-xs" style={{ color: '#848E9C' }}>
+            {t('manageAITraders', language)}
+          </p>
+        </div>
+      </div>
+
+      <div className="flex gap-2 md:gap-3 w-full md:w-auto overflow-hidden flex-wrap md:flex-nowrap">
+        <button
+          onClick={onAddModel}
+          className="px-3 md:px-4 py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 flex items-center gap-1 md:gap-2 whitespace-nowrap"
+          style={{
+            background: '#2B3139',
+            color: '#EAECEF',
+            border: '1px solid #474D57',
+          }}
+        >
+          <Plus className="w-3 h-3 md:w-4 md:h-4" />
+          {t('aiModels', language)}
+        </button>
+
+        <button
+          onClick={onAddExchange}
+          className="px-3 md:px-4 py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 flex items-center gap-1 md:gap-2 whitespace-nowrap"
+          style={{
+            background: '#2B3139',
+            color: '#EAECEF',
+            border: '1px solid #474D57',
+          }}
+        >
+          <Plus className="w-3 h-3 md:w-4 md:h-4" />
+          {t('exchanges', language)}
+        </button>
+
+        <button
+          onClick={onConfigureSignalSource}
+          className="px-3 md:px-4 py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 flex items-center gap-1 md:gap-2 whitespace-nowrap"
+          style={{
+            background: '#2B3139',
+            color: '#EAECEF',
+            border: '1px solid #474D57',
+          }}
+        >
+          <Radio className="w-3 h-3 md:w-4 md:h-4" />
+          {t('signalSource', language)}
+        </button>
+
+        <button
+          onClick={onCreateTrader}
+          disabled={!canCreateTrader}
+          className="px-3 md:px-4 py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 md:gap-2 whitespace-nowrap"
+          style={{
+            background: canCreateTrader ? '#F0B90B' : '#2B3139',
+            color: canCreateTrader ? '#000' : '#848E9C',
+          }}
+        >
+          <Plus className="w-4 h-4" />
+          {t('createTrader', language)}
+        </button>
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/sections/SignalSourceWarning.tsx b/web/src/components/traders/sections/SignalSourceWarning.tsx
new file mode 100644
index 00000000..5c49f341
--- /dev/null
+++ b/web/src/components/traders/sections/SignalSourceWarning.tsx
@@ -0,0 +1,54 @@
+import { AlertTriangle } from 'lucide-react'
+import { t, type Language } from '../../../i18n/translations'
+
+interface SignalSourceWarningProps {
+  language: Language
+  onConfigure: () => void
+}
+
+export function SignalSourceWarning({
+  language,
+  onConfigure,
+}: SignalSourceWarningProps) {
+  return (
+    <div
+      className="rounded-lg px-4 py-3 flex items-start gap-3 animate-slide-in"
+      style={{
+        background: 'rgba(246, 70, 93, 0.1)',
+        border: '1px solid rgba(246, 70, 93, 0.3)',
+      }}
+    >
+      <AlertTriangle
+        size={20}
+        className="flex-shrink-0 mt-0.5"
+        style={{ color: '#F6465D' }}
+      />
+      <div className="flex-1">
+        <div className="font-semibold mb-1" style={{ color: '#F6465D' }}>
+          ⚠️ {t('signalSourceNotConfigured', language)}
+        </div>
+        <div className="text-sm" style={{ color: '#848E9C' }}>
+          <p className="mb-2">{t('signalSourceWarningMessage', language)}</p>
+          <p>
+            <strong>{t('solutions', language)}</strong>
+          </p>
+          <ul className="list-disc list-inside space-y-1 ml-2 mt-1">
+            <li>点击"{t('signalSource', language)}"按钮配置API地址</li>
+            <li>或在交易员配置中禁用"使用币种池"和"使用OI Top"</li>
+            <li>或在交易员配置中设置自定义币种列表</li>
+          </ul>
+        </div>
+        <button
+          onClick={onConfigure}
+          className="mt-3 px-3 py-1.5 rounded text-sm font-semibold transition-all hover:scale-105"
+          style={{
+            background: '#F0B90B',
+            color: '#000',
+          }}
+        >
+          {t('configureSignalSourceNow', language)}
+        </button>
+      </div>
+    </div>
+  )
+}
diff --git a/web/src/components/traders/sections/TradersGrid.tsx b/web/src/components/traders/sections/TradersGrid.tsx
new file mode 100644
index 00000000..95307aa8
--- /dev/null
+++ b/web/src/components/traders/sections/TradersGrid.tsx
@@ -0,0 +1,172 @@
+import { Bot, BarChart3, Trash2, Pencil } from 'lucide-react'
+import { t, type Language } from '../../../i18n/translations'
+import { getModelDisplayName } from '../index'
+import type { TraderInfo } from '../../../types'
+
+interface TradersGridProps {
+  language: Language
+  traders: TraderInfo[] | undefined
+  onTraderSelect: (traderId: string) => void
+  onEditTrader: (traderId: string) => void
+  onDeleteTrader: (traderId: string) => void
+  onToggleTrader: (traderId: string, running: boolean) => void
+}
+
+export function TradersGrid({
+  language,
+  traders,
+  onTraderSelect,
+  onEditTrader,
+  onDeleteTrader,
+  onToggleTrader,
+}: TradersGridProps) {
+  if (!traders || traders.length === 0) {
+    return (
+      <div className="text-center py-12 md:py-16" style={{ color: '#848E9C' }}>
+        <Bot className="w-16 h-16 md:w-24 md:h-24 mx-auto mb-3 md:mb-4 opacity-50" />
+        <div className="text-base md:text-lg font-semibold mb-2">
+          {t('noTraders', language)}
+        </div>
+        <div className="text-xs md:text-sm mb-3 md:mb-4">
+          {t('createFirstTrader', language)}
+        </div>
+      </div>
+    )
+  }
+
+  return (
+    <div className="space-y-3 md:space-y-4">
+      {traders.map((trader) => (
+        <div
+          key={trader.trader_id}
+          className="flex flex-col md:flex-row md:items-center justify-between p-3 md:p-4 rounded transition-all hover:translate-y-[-1px] gap-3 md:gap-4"
+          style={{ background: '#0B0E11', border: '1px solid #2B3139' }}
+        >
+          <div className="flex items-center gap-3 md:gap-4">
+            <div
+              className="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center flex-shrink-0"
+              style={{
+                background: trader.ai_model.includes('deepseek')
+                  ? '#60a5fa'
+                  : '#c084fc',
+                color: '#fff',
+              }}
+            >
+              <Bot className="w-5 h-5 md:w-6 md:h-6" />
+            </div>
+            <div className="min-w-0">
+              <div
+                className="font-bold text-base md:text-lg truncate"
+                style={{ color: '#EAECEF' }}
+              >
+                {trader.trader_name}
+              </div>
+              <div
+                className="text-xs md:text-sm truncate"
+                style={{
+                  color: trader.ai_model.includes('deepseek')
+                    ? '#60a5fa'
+                    : '#c084fc',
+                }}
+              >
+                {getModelDisplayName(
+                  trader.ai_model.split('_').pop() || trader.ai_model
+                )}{' '}
+                Model • {trader.exchange_id?.toUpperCase()}
+              </div>
+            </div>
+          </div>
+
+          <div className="flex items-center gap-3 md:gap-4 flex-wrap md:flex-nowrap">
+            {/* Status */}
+            <div className="text-center">
+              <div
+                className={`px-2 md:px-3 py-1 rounded text-xs font-bold ${
+                  trader.is_running
+                    ? 'bg-green-100 text-green-800'
+                    : 'bg-red-100 text-red-800'
+                }`}
+                style={
+                  trader.is_running
+                    ? {
+                        background: 'rgba(14, 203, 129, 0.1)',
+                        color: '#0ECB81',
+                      }
+                    : {
+                        background: 'rgba(246, 70, 93, 0.1)',
+                        color: '#F6465D',
+                      }
+                }
+              >
+                {trader.is_running
+                  ? t('running', language)
+                  : t('stopped', language)}
+              </div>
+            </div>
+
+            {/* Actions: 禁止换行,超出横向滚动 */}
+            <div className="flex gap-1.5 md:gap-2 flex-nowrap overflow-x-auto items-center">
+              <button
+                onClick={() => onTraderSelect(trader.trader_id)}
+                className="px-2 md:px-3 py-1.5 md:py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 flex items-center gap-1 whitespace-nowrap"
+                style={{
+                  background: 'rgba(99, 102, 241, 0.1)',
+                  color: '#6366F1',
+                }}
+              >
+                <BarChart3 className="w-3 h-3 md:w-4 md:h-4" />
+                {t('view', language)}
+              </button>
+
+              <button
+                onClick={() => onEditTrader(trader.trader_id)}
+                disabled={trader.is_running}
+                className="px-2 md:px-3 py-1.5 md:py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap flex items-center gap-1"
+                style={{
+                  background: trader.is_running
+                    ? 'rgba(132, 142, 156, 0.1)'
+                    : 'rgba(255, 193, 7, 0.1)',
+                  color: trader.is_running ? '#848E9C' : '#FFC107',
+                }}
+              >
+                <Pencil className="w-3 h-3 md:w-4 md:h-4" />
+                {t('edit', language)}
+              </button>
+
+              <button
+                onClick={() =>
+                  onToggleTrader(trader.trader_id, trader.is_running || false)
+                }
+                className="px-2 md:px-3 py-1.5 md:py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105 whitespace-nowrap"
+                style={
+                  trader.is_running
+                    ? {
+                        background: 'rgba(246, 70, 93, 0.1)',
+                        color: '#F6465D',
+                      }
+                    : {
+                        background: 'rgba(14, 203, 129, 0.1)',
+                        color: '#0ECB81',
+                      }
+                }
+              >
+                {trader.is_running ? t('stop', language) : t('start', language)}
+              </button>
+
+              <button
+                onClick={() => onDeleteTrader(trader.trader_id)}
+                className="px-2 md:px-3 py-1.5 md:py-2 rounded text-xs md:text-sm font-semibold transition-all hover:scale-105"
+                style={{
+                  background: 'rgba(246, 70, 93, 0.1)',
+                  color: '#F6465D',
+                }}
+              >
+                <Trash2 className="w-3 h-3 md:w-4 md:h-4" />
+              </button>
+            </div>
+          </div>
+        </div>
+      ))}
+    </div>
+  )
+}
diff --git a/web/src/components/traders/utils.ts b/web/src/components/traders/utils.ts
new file mode 100644
index 00000000..6235e006
--- /dev/null
+++ b/web/src/components/traders/utils.ts
@@ -0,0 +1,19 @@
+// 获取友好的AI模型名称
+export function getModelDisplayName(modelId: string): string {
+  switch (modelId.toLowerCase()) {
+    case 'deepseek':
+      return 'DeepSeek'
+    case 'qwen':
+      return 'Qwen'
+    case 'claude':
+      return 'Claude'
+    default:
+      return modelId.toUpperCase()
+  }
+}
+
+// 提取下划线后面的名称部分
+export function getShortName(fullName: string): string {
+  const parts = fullName.split('_')
+  return parts.length > 1 ? parts[parts.length - 1] : fullName
+}
diff --git a/web/src/hooks/useTraderActions.ts b/web/src/hooks/useTraderActions.ts
new file mode 100644
index 00000000..47d3c163
--- /dev/null
+++ b/web/src/hooks/useTraderActions.ts
@@ -0,0 +1,639 @@
+import { api } from '../lib/api'
+import type {
+  TraderInfo,
+  CreateTraderRequest,
+  TraderConfigData,
+  AIModel,
+  Exchange,
+} from '../types'
+import { t } from '../i18n/translations'
+import { confirmToast } from '../lib/notify'
+import { toast } from 'sonner'
+import type { Language } from '../i18n/translations'
+
+interface UseTraderActionsParams {
+  traders: TraderInfo[] | undefined
+  allModels: AIModel[]
+  allExchanges: Exchange[]
+  supportedModels: AIModel[]
+  supportedExchanges: Exchange[]
+  language: Language
+  mutateTraders: () => Promise<any>
+  setAllModels: (models: AIModel[]) => void
+  setAllExchanges: (exchanges: Exchange[]) => void
+  setUserSignalSource: (config: {
+    coinPoolUrl: string
+    oiTopUrl: string
+  }) => void
+  setShowCreateModal: (show: boolean) => void
+  setShowEditModal: (show: boolean) => void
+  setShowModelModal: (show: boolean) => void
+  setShowExchangeModal: (show: boolean) => void
+  setShowSignalSourceModal: (show: boolean) => void
+  setEditingModel: (modelId: string | null) => void
+  setEditingExchange: (exchangeId: string | null) => void
+  editingTrader: TraderConfigData | null
+  setEditingTrader: (trader: TraderConfigData | null) => void
+}
+
+export function useTraderActions({
+  traders,
+  allModels,
+  allExchanges,
+  supportedModels,
+  supportedExchanges,
+  language,
+  mutateTraders,
+  setAllModels,
+  setAllExchanges,
+  setUserSignalSource,
+  setShowCreateModal,
+  setShowEditModal,
+  setShowModelModal,
+  setShowExchangeModal,
+  setShowSignalSourceModal,
+  setEditingModel,
+  setEditingExchange,
+  editingTrader,
+  setEditingTrader,
+}: UseTraderActionsParams) {
+  // 检查模型是否正在被运行中的交易员使用(用于UI禁用)
+  const isModelInUse = (modelId: string) => {
+    return traders?.some((t) => t.ai_model === modelId && t.is_running) || false
+  }
+
+  // 检查交易所是否正在被运行中的交易员使用(用于UI禁用)
+  const isExchangeInUse = (exchangeId: string) => {
+    return (
+      traders?.some((t) => t.exchange_id === exchangeId && t.is_running) ||
+      false
+    )
+  }
+
+  // 检查模型是否被任何交易员使用(包括停止状态的)
+  const isModelUsedByAnyTrader = (modelId: string) => {
+    return traders?.some((t) => t.ai_model === modelId) || false
+  }
+
+  // 检查交易所是否被任何交易员使用(包括停止状态的)
+  const isExchangeUsedByAnyTrader = (exchangeId: string) => {
+    return traders?.some((t) => t.exchange_id === exchangeId) || false
+  }
+
+  // 获取使用特定模型的交易员列表
+  const getTradersUsingModel = (modelId: string) => {
+    return traders?.filter((t) => t.ai_model === modelId) || []
+  }
+
+  // 获取使用特定交易所的交易员列表
+  const getTradersUsingExchange = (exchangeId: string) => {
+    return traders?.filter((t) => t.exchange_id === exchangeId) || []
+  }
+
+  const handleCreateTrader = async (data: CreateTraderRequest) => {
+    try {
+      const model = allModels?.find((m) => m.id === data.ai_model_id)
+      const exchange = allExchanges?.find((e) => e.id === data.exchange_id)
+
+      if (!model?.enabled) {
+        toast.error(t('modelNotConfigured', language))
+        return
+      }
+
+      if (!exchange?.enabled) {
+        toast.error(t('exchangeNotConfigured', language))
+        return
+      }
+
+      await toast.promise(api.createTrader(data), {
+        loading: '正在创建…',
+        success: '创建成功',
+        error: '创建失败',
+      })
+      setShowCreateModal(false)
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
+    } catch (error) {
+      console.error('Failed to create trader:', error)
+      toast.error(t('createTraderFailed', language))
+    }
+  }
+
+  const handleEditTrader = async (traderId: string) => {
+    try {
+      const traderConfig = await api.getTraderConfig(traderId)
+      setEditingTrader(traderConfig)
+      setShowEditModal(true)
+    } catch (error) {
+      console.error('Failed to fetch trader config:', error)
+      toast.error(t('getTraderConfigFailed', language))
+    }
+  }
+
+  const handleSaveEditTrader = async (data: CreateTraderRequest) => {
+    if (!editingTrader || !editingTrader.trader_id) return
+
+    try {
+      const enabledModels = allModels?.filter((m) => m.enabled) || []
+      const enabledExchanges =
+        allExchanges?.filter((e) => {
+          if (!e.enabled) return false
+
+          // Aster 交易所需要特殊字段
+          if (e.id === 'aster') {
+            return (
+              e.asterUser &&
+              e.asterUser.trim() !== '' &&
+              e.asterSigner &&
+              e.asterSigner.trim() !== ''
+            )
+          }
+
+          // Hyperliquid 需要钱包地址
+          if (e.id === 'hyperliquid') {
+            return (
+              e.hyperliquidWalletAddr && e.hyperliquidWalletAddr.trim() !== ''
+            )
+          }
+
+          return true
+        }) || []
+
+      const model = enabledModels?.find((m) => m.id === data.ai_model_id)
+      const exchange = enabledExchanges?.find((e) => e.id === data.exchange_id)
+
+      if (!model) {
+        toast.error(t('modelConfigNotExist', language))
+        return
+      }
+
+      if (!exchange) {
+        toast.error(t('exchangeConfigNotExist', language))
+        return
+      }
+
+      const request = {
+        name: data.name,
+        ai_model_id: data.ai_model_id,
+        exchange_id: data.exchange_id,
+        initial_balance: data.initial_balance,
+        scan_interval_minutes: data.scan_interval_minutes,
+        btc_eth_leverage: data.btc_eth_leverage,
+        altcoin_leverage: data.altcoin_leverage,
+        trading_symbols: data.trading_symbols,
+        custom_prompt: data.custom_prompt,
+        override_base_prompt: data.override_base_prompt,
+        system_prompt_template: data.system_prompt_template,
+        is_cross_margin: data.is_cross_margin,
+        use_coin_pool: data.use_coin_pool,
+        use_oi_top: data.use_oi_top,
+      }
+
+      await toast.promise(api.updateTrader(editingTrader.trader_id, request), {
+        loading: '正在保存…',
+        success: '保存成功',
+        error: '保存失败',
+      })
+      setShowEditModal(false)
+      setEditingTrader(null)
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
+    } catch (error) {
+      console.error('Failed to update trader:', error)
+      toast.error(t('updateTraderFailed', language))
+    }
+  }
+
+  const handleDeleteTrader = async (traderId: string) => {
+    {
+      const ok = await confirmToast(t('confirmDeleteTrader', language))
+      if (!ok) return
+    }
+
+    try {
+      await toast.promise(api.deleteTrader(traderId), {
+        loading: '正在删除…',
+        success: '删除成功',
+        error: '删除失败',
+      })
+
+      // Immediately refresh traders list for better UX
+      await mutateTraders()
+    } catch (error) {
+      console.error('Failed to delete trader:', error)
+      toast.error(t('deleteTraderFailed', language))
+    }
+  }
+
+  const handleToggleTrader = async (traderId: string, running: boolean) => {
+    try {
+      if (running) {
+        await toast.promise(api.stopTrader(traderId), {
+          loading: '正在停止…',
+          success: '已停止',
+          error: '停止失败',
+        })
+      } else {
+        await toast.promise(api.startTrader(traderId), {
+          loading: '正在启动…',
+          success: '已启动',
+          error: '启动失败',
+        })
+      }
+
+      // Immediately refresh traders list to update running status
+      await mutateTraders()
+    } catch (error) {
+      console.error('Failed to toggle trader:', error)
+      toast.error(t('operationFailed', language))
+    }
+  }
+
+  const handleModelClick = (modelId: string) => {
+    if (!isModelInUse(modelId)) {
+      setEditingModel(modelId)
+      setShowModelModal(true)
+    }
+  }
+
+  const handleExchangeClick = (exchangeId: string) => {
+    if (!isExchangeInUse(exchangeId)) {
+      setEditingExchange(exchangeId)
+      setShowExchangeModal(true)
+    }
+  }
+
+  // 通用删除配置处理函数
+  const handleDeleteConfig = async <T extends { id: string }>(config: {
+    id: string
+    type: 'model' | 'exchange'
+    checkInUse: (id: string) => boolean
+    getUsingTraders: (id: string) => any[]
+    cannotDeleteKey: string
+    confirmDeleteKey: string
+    allItems: T[] | undefined
+    clearFields: (item: T) => T
+    buildRequest: (items: T[]) => any
+    updateApi: (request: any) => Promise<void>
+    refreshApi: () => Promise<T[]>
+    setItems: (items: T[]) => void
+    closeModal: () => void
+    errorKey: string
+  }) => {
+    // 检查是否有交易员正在使用
+    if (config.checkInUse(config.id)) {
+      const usingTraders = config.getUsingTraders(config.id)
+      const traderNames = usingTraders.map((t) => t.trader_name).join(', ')
+      toast.error(
+        `${t(config.cannotDeleteKey, language)} · ${t('tradersUsing', language)}: ${traderNames} · ${t('pleaseDeleteTradersFirst', language)}`
+      )
+      return
+    }
+
+    {
+      const ok = await confirmToast(t(config.confirmDeleteKey, language))
+      if (!ok) return
+    }
+
+    try {
+      const updatedItems =
+        config.allItems?.map((item) =>
+          item.id === config.id ? config.clearFields(item) : item
+        ) || []
+
+      const request = config.buildRequest(updatedItems)
+      await toast.promise(config.updateApi(request), {
+        loading: '正在更新配置…',
+        success: '配置已更新',
+        error: '更新配置失败',
+      })
+
+      // 重新获取用户配置以确保数据同步
+      const refreshedItems = await config.refreshApi()
+      config.setItems(refreshedItems)
+
+      config.closeModal()
+    } catch (error) {
+      console.error(`Failed to delete ${config.type} config:`, error)
+      toast.error(t(config.errorKey, language))
+    }
+  }
+
+  const handleDeleteModel = async (modelId: string) => {
+    await handleDeleteConfig({
+      id: modelId,
+      type: 'model',
+      checkInUse: isModelUsedByAnyTrader,
+      getUsingTraders: getTradersUsingModel,
+      cannotDeleteKey: 'cannotDeleteModelInUse',
+      confirmDeleteKey: 'confirmDeleteModel',
+      allItems: allModels,
+      clearFields: (m) => ({
+        ...m,
+        apiKey: '',
+        customApiUrl: '',
+        customModelName: '',
+        enabled: false,
+      }),
+      buildRequest: (models) => ({
+        models: Object.fromEntries(
+          models.map((model) => [
+            model.provider,
+            {
+              enabled: model.enabled,
+              api_key: model.apiKey || '',
+              custom_api_url: model.customApiUrl || '',
+              custom_model_name: model.customModelName || '',
+            },
+          ])
+        ),
+      }),
+      updateApi: api.updateModelConfigs,
+      refreshApi: api.getModelConfigs,
+      setItems: (items) => {
+        // 使用函数式更新确保状态正确更新
+        setAllModels([...items])
+      },
+      closeModal: () => {
+        setShowModelModal(false)
+        setEditingModel(null)
+      },
+      errorKey: 'deleteConfigFailed',
+    })
+  }
+
+  const handleSaveModel = async (
+    modelId: string,
+    apiKey: string,
+    customApiUrl?: string,
+    customModelName?: string
+  ) => {
+    try {
+      // 创建或更新用户的模型配置
+      const existingModel = allModels?.find((m) => m.id === modelId)
+      let updatedModels
+
+      // 找到要配置的模型(优先从已配置列表,其次从支持列表)
+      const modelToUpdate =
+        existingModel || supportedModels?.find((m) => m.id === modelId)
+      if (!modelToUpdate) {
+        toast.error(t('modelNotExist', language))
+        return
+      }
+
+      if (existingModel) {
+        // 更新现有配置
+        updatedModels =
+          allModels?.map((m) =>
+            m.id === modelId
+              ? {
+                  ...m,
+                  apiKey,
+                  customApiUrl: customApiUrl || '',
+                  customModelName: customModelName || '',
+                  enabled: true,
+                }
+              : m
+          ) || []
+      } else {
+        // 添加新配置
+        const newModel = {
+          ...modelToUpdate,
+          apiKey,
+          customApiUrl: customApiUrl || '',
+          customModelName: customModelName || '',
+          enabled: true,
+        }
+        updatedModels = [...(allModels || []), newModel]
+      }
+
+      const request = {
+        models: Object.fromEntries(
+          updatedModels.map((model) => [
+            model.provider, // 使用 provider 而不是 id
+            {
+              enabled: model.enabled,
+              api_key: model.apiKey || '',
+              custom_api_url: model.customApiUrl || '',
+              custom_model_name: model.customModelName || '',
+            },
+          ])
+        ),
+      }
+
+      await toast.promise(api.updateModelConfigs(request), {
+        loading: '正在更新模型配置…',
+        success: '模型配置已更新',
+        error: '更新模型配置失败',
+      })
+
+      // 重新获取用户配置以确保数据同步
+      const refreshedModels = await api.getModelConfigs()
+      setAllModels(refreshedModels)
+
+      setShowModelModal(false)
+      setEditingModel(null)
+    } catch (error) {
+      console.error('Failed to save model config:', error)
+      toast.error(t('saveConfigFailed', language))
+    }
+  }
+
+  const handleDeleteExchange = async (exchangeId: string) => {
+    await handleDeleteConfig({
+      id: exchangeId,
+      type: 'exchange',
+      checkInUse: isExchangeUsedByAnyTrader,
+      getUsingTraders: getTradersUsingExchange,
+      cannotDeleteKey: 'cannotDeleteExchangeInUse',
+      confirmDeleteKey: 'confirmDeleteExchange',
+      allItems: allExchanges,
+      clearFields: (e) => ({
+        ...e,
+        apiKey: '',
+        secretKey: '',
+        hyperliquidWalletAddr: '',
+        asterUser: '',
+        asterSigner: '',
+        asterPrivateKey: '',
+        enabled: false,
+      }),
+      buildRequest: (exchanges) => ({
+        exchanges: Object.fromEntries(
+          exchanges.map((exchange) => [
+            exchange.id,
+            {
+              enabled: exchange.enabled,
+              api_key: exchange.apiKey || '',
+              secret_key: exchange.secretKey || '',
+              testnet: exchange.testnet || false,
+              hyperliquid_wallet_addr: exchange.hyperliquidWalletAddr || '',
+              aster_user: exchange.asterUser || '',
+              aster_signer: exchange.asterSigner || '',
+              aster_private_key: exchange.asterPrivateKey || '',
+            },
+          ])
+        ),
+      }),
+      updateApi: api.updateExchangeConfigsEncrypted,
+      refreshApi: api.getExchangeConfigs,
+      setItems: (items) => {
+        // 使用函数式更新确保状态正确更新
+        setAllExchanges([...items])
+      },
+      closeModal: () => {
+        setShowExchangeModal(false)
+        setEditingExchange(null)
+      },
+      errorKey: 'deleteExchangeConfigFailed',
+    })
+  }
+
+  const handleSaveExchange = async (
+    exchangeId: string,
+    apiKey: string,
+    secretKey?: string,
+    testnet?: boolean,
+    hyperliquidWalletAddr?: string,
+    asterUser?: string,
+    asterSigner?: string,
+    asterPrivateKey?: string
+  ) => {
+    try {
+      // 找到要配置的交易所(从supportedExchanges中)
+      const exchangeToUpdate = supportedExchanges?.find(
+        (e) => e.id === exchangeId
+      )
+      if (!exchangeToUpdate) {
+        toast.error(t('exchangeNotExist', language))
+        return
+      }
+
+      // 创建或更新用户的交易所配置
+      const existingExchange = allExchanges?.find((e) => e.id === exchangeId)
+      let updatedExchanges
+
+      if (existingExchange) {
+        // 更新现有配置
+        updatedExchanges =
+          allExchanges?.map((e) =>
+            e.id === exchangeId
+              ? {
+                  ...e,
+                  apiKey,
+                  secretKey,
+                  testnet,
+                  hyperliquidWalletAddr,
+                  asterUser,
+                  asterSigner,
+                  asterPrivateKey,
+                  enabled: true,
+                }
+              : e
+          ) || []
+      } else {
+        // 添加新配置
+        const newExchange = {
+          ...exchangeToUpdate,
+          apiKey,
+          secretKey,
+          testnet,
+          hyperliquidWalletAddr,
+          asterUser,
+          asterSigner,
+          asterPrivateKey,
+          enabled: true,
+        }
+        updatedExchanges = [...(allExchanges || []), newExchange]
+      }
+
+      const request = {
+        exchanges: Object.fromEntries(
+          updatedExchanges.map((exchange) => [
+            exchange.id,
+            {
+              enabled: exchange.enabled,
+              api_key: exchange.apiKey || '',
+              secret_key: exchange.secretKey || '',
+              testnet: exchange.testnet || false,
+              hyperliquid_wallet_addr: exchange.hyperliquidWalletAddr || '',
+              aster_user: exchange.asterUser || '',
+              aster_signer: exchange.asterSigner || '',
+              aster_private_key: exchange.asterPrivateKey || '',
+            },
+          ])
+        ),
+      }
+
+      await toast.promise(api.updateExchangeConfigsEncrypted(request), {
+        loading: '正在更新交易所配置…',
+        success: '交易所配置已更新',
+        error: '更新交易所配置失败',
+      })
+
+      // 重新获取用户配置以确保数据同步
+      const refreshedExchanges = await api.getExchangeConfigs()
+      setAllExchanges(refreshedExchanges)
+
+      setShowExchangeModal(false)
+      setEditingExchange(null)
+    } catch (error) {
+      console.error('Failed to save exchange config:', error)
+      toast.error(t('saveConfigFailed', language))
+    }
+  }
+
+  const handleAddModel = () => {
+    setEditingModel(null)
+    setShowModelModal(true)
+  }
+
+  const handleAddExchange = () => {
+    setEditingExchange(null)
+    setShowExchangeModal(true)
+  }
+
+  const handleSaveSignalSource = async (
+    coinPoolUrl: string,
+    oiTopUrl: string
+  ) => {
+    try {
+      await toast.promise(api.saveUserSignalSource(coinPoolUrl, oiTopUrl), {
+        loading: '正在保存…',
+        success: '保存成功',
+        error: '保存失败',
+      })
+      setUserSignalSource({ coinPoolUrl, oiTopUrl })
+      setShowSignalSourceModal(false)
+    } catch (error) {
+      console.error('Failed to save signal source:', error)
+      toast.error(t('saveSignalSourceFailed', language))
+    }
+  }
+
+  return {
+    // 辅助函数
+    isModelInUse,
+    isExchangeInUse,
+    isModelUsedByAnyTrader,
+    isExchangeUsedByAnyTrader,
+    getTradersUsingModel,
+    getTradersUsingExchange,
+
+    // 事件处理函数
+    handleCreateTrader,
+    handleEditTrader,
+    handleSaveEditTrader,
+    handleDeleteTrader,
+    handleToggleTrader,
+    handleAddModel,
+    handleAddExchange,
+    handleModelClick,
+    handleExchangeClick,
+    handleSaveModel,
+    handleDeleteModel,
+    handleSaveExchange,
+    handleDeleteExchange,
+    handleSaveSignalSource,
+  }
+}
diff --git a/web/src/i18n/translations.ts b/web/src/i18n/translations.ts
index c59164c9..26f7102a 100644
--- a/web/src/i18n/translations.ts
+++ b/web/src/i18n/translations.ts
@@ -474,6 +474,7 @@ export const translations = {
     registrationFailed: 'Registration failed. Please try again.',
     verificationFailed:
       'OTP verification failed. Please check the code and try again.',
+    sessionExpired: 'Session expired, please login again',
     invalidCredentials: 'Invalid email or password',
     weak: 'Weak',
     medium: 'Medium',
@@ -496,6 +497,9 @@ export const translations = {
     exitLogin: 'Sign Out',
     signIn: 'Sign In',
     signUp: 'Sign Up',
+    registrationClosed: 'Registration Closed',
+    registrationClosedMessage:
+      'User registration is currently disabled. Please contact the administrator for access.',
 
     // Hero Section
     githubStarsInDays: '2.5K+ GitHub Stars in 3 days',
@@ -1284,6 +1288,7 @@ export const translations = {
     loginFailed: '登录失败，请检查您的邮箱和密码。',
     registrationFailed: '注册失败，请重试。',
     verificationFailed: 'OTP 验证失败，请检查验证码后重试。',
+    sessionExpired: '登录已过期，请重新登录',
     invalidCredentials: '邮箱或密码错误',
     weak: '弱',
     medium: '中',
@@ -1305,6 +1310,8 @@ export const translations = {
     exitLogin: '退出登录',
     signIn: '登录',
     signUp: '注册',
+    registrationClosed: '注册已关闭',
+    registrationClosedMessage: '平台当前不开放新用户注册，如需访问请联系管理员获取账号。',
 
     // Hero Section
     githubStarsInDays: '3 天内 2.5K+ GitHub Stars',
diff --git a/web/src/lib/api.ts b/web/src/lib/api.ts
index 39ab8e9e..9b70edd4 100644
--- a/web/src/lib/api.ts
+++ b/web/src/lib/api.ts
@@ -5,6 +5,7 @@ import type {
   DecisionRecord,
   Statistics,
   TraderInfo,
+  TraderConfigData,
   AIModel,
   Exchange,
   CreateTraderRequest,
@@ -94,7 +95,7 @@ export const api = {
     if (!res.ok) throw new Error('更新自定义策略失败')
   },
 
-  async getTraderConfig(traderId: string): Promise<any> {
+  async getTraderConfig(traderId: string): Promise<TraderConfigData> {
     const res = await httpClient.get(
       `${API_BASE}/traders/${traderId}/config`,
       getAuthHeaders()
diff --git a/web/src/lib/config.ts b/web/src/lib/config.ts
index 6be8f034..335aacd0 100644
--- a/web/src/lib/config.ts
+++ b/web/src/lib/config.ts
@@ -1,5 +1,6 @@
 export interface SystemConfig {
   beta_mode: boolean
+  registration_enabled?: boolean
 }
 
 let configPromise: Promise<SystemConfig> | null = null
diff --git a/web/src/lib/httpClient.ts b/web/src/lib/httpClient.ts
index 15ebc16c..079e6bdf 100644
--- a/web/src/lib/httpClient.ts
+++ b/web/src/lib/httpClient.ts
@@ -6,10 +6,9 @@
  * - Automatic 401 token expiration handling
  * - Auth state cleanup on unauthorized
  * - Automatic redirect to login page
+ * - Notification shown on login page after redirect
  */
 
-import { toast } from 'sonner'
-
 export class HttpClient {
   // Singleton flag to prevent duplicate 401 handling
   private static isHandling401 = false
@@ -21,13 +20,6 @@ export class HttpClient {
     HttpClient.isHandling401 = false
   }
 
-  /**
-   * Show login required notification to user
-   */
-  private showLoginRequiredNotification(): void {
-    toast.warning('登录已过期，请先登录', { duration: 1800 })
-  }
-
   /**
    * Response interceptor - handles common HTTP errors
    *
@@ -53,23 +45,24 @@ export class HttpClient {
       // Notify global listeners (AuthContext will react to this)
       window.dispatchEvent(new Event('unauthorized'))
 
-      // Show user-friendly notification (only once)
-      this.showLoginRequiredNotification()
+      // Only redirect if not already on login page
+      if (!window.location.pathname.includes('/login')) {
+        // Save current location for post-login redirect
+        const returnUrl = window.location.pathname + window.location.search
+        if (returnUrl !== '/login' && returnUrl !== '/') {
+          sessionStorage.setItem('returnUrl', returnUrl)
+        }
 
-      // Delay redirect to let user see the notification
-      setTimeout(() => {
-        // Only redirect if not already on login page
-        if (!window.location.pathname.includes('/login')) {
-          // Save current location for post-login redirect
-          const returnUrl = window.location.pathname + window.location.search
-          if (returnUrl !== '/login' && returnUrl !== '/') {
-            sessionStorage.setItem('returnUrl', returnUrl)
-          }
+        // Mark that user came from 401 (login page will show notification)
+        sessionStorage.setItem('from401', 'true')
 
-          window.location.href = '/login'
-        }
-        // Note: No need to reset flag since we're redirecting
-      }, 1500) // 1.5秒延迟,让用户看到提示
+        // Redirect immediately to login page
+        window.location.href = '/login'
+
+        // Return pending promise to prevent error from being caught by SWR/React
+        // The notification will be shown on the login page
+        return new Promise(() => {}) as Promise<Response>
+      }
 
       throw new Error('登录已过期，请重新登录')
     }
diff --git a/web/src/lib/registrationToggle.test.ts b/web/src/lib/registrationToggle.test.ts
new file mode 100644
index 00000000..9382fc72
--- /dev/null
+++ b/web/src/lib/registrationToggle.test.ts
@@ -0,0 +1,204 @@
+import { describe, it, expect } from 'vitest'
+
+/**
+ * Registration Toggle Feature Tests
+ *
+ * Tests the logic for determining whether registration is enabled
+ * This validates the registration_enabled configuration behavior
+ */
+describe('Registration Toggle Logic', () => {
+  describe('registration_enabled configuration', () => {
+    it('should default to true when registration_enabled is undefined', () => {
+      const config = {}
+      const registrationEnabled = (config as any).registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should be true when registration_enabled is explicitly true', () => {
+      const config = { registration_enabled: true }
+      const registrationEnabled = config.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should be false when registration_enabled is explicitly false', () => {
+      const config = { registration_enabled: false }
+      const registrationEnabled = config.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(false)
+    })
+
+    it('should default to true when registration_enabled is null', () => {
+      const config = { registration_enabled: null }
+      const registrationEnabled = (config.registration_enabled as any) !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should handle missing config gracefully', () => {
+      const config = null
+      const registrationEnabled = config?.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+  })
+
+  describe('UI component visibility logic', () => {
+    it('should show signup button when registration is enabled', () => {
+      const registrationEnabled = true
+      const shouldShowSignup = registrationEnabled
+
+      expect(shouldShowSignup).toBe(true)
+    })
+
+    it('should hide signup button when registration is disabled', () => {
+      const registrationEnabled = false
+      const shouldShowSignup = registrationEnabled
+
+      expect(shouldShowSignup).toBe(false)
+    })
+  })
+
+  describe('conditional rendering patterns', () => {
+    it('should render signup link with registrationEnabled && pattern', () => {
+      const registrationEnabled = true
+      const signupElement = registrationEnabled && 'SignUpButton'
+
+      expect(signupElement).toBe('SignUpButton')
+    })
+
+    it('should not render signup link when disabled', () => {
+      const registrationEnabled = false
+      const signupElement = registrationEnabled && 'SignUpButton'
+
+      expect(signupElement).toBe(false)
+    })
+  })
+
+  describe('SystemConfig interface compliance', () => {
+    interface SystemConfig {
+      beta_mode: boolean
+      registration_enabled?: boolean
+    }
+
+    it('should have optional registration_enabled field', () => {
+      const config1: SystemConfig = {
+        beta_mode: false,
+      }
+
+      const config2: SystemConfig = {
+        beta_mode: false,
+        registration_enabled: true,
+      }
+
+      expect(config1.beta_mode).toBe(false)
+      expect(config2.registration_enabled).toBe(true)
+    })
+
+    it('should handle both beta_mode and registration_enabled', () => {
+      const config: SystemConfig = {
+        beta_mode: true,
+        registration_enabled: false,
+      }
+
+      expect(config.beta_mode).toBe(true)
+      expect(config.registration_enabled).toBe(false)
+    })
+  })
+
+  describe('edge cases', () => {
+    it('should treat empty string as truthy (not false)', () => {
+      const config = { registration_enabled: '' as any }
+      const registrationEnabled = config.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should treat 0 as truthy (not false)', () => {
+      const config = { registration_enabled: 0 as any }
+      const registrationEnabled = config.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should treat "false" string as truthy (not false)', () => {
+      const config = { registration_enabled: 'false' as any }
+      const registrationEnabled = config.registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+
+    it('should only treat boolean false as disabled', () => {
+      const testCases = [
+        { value: false, expected: false },
+        { value: true, expected: true },
+        { value: null, expected: true },
+        { value: undefined, expected: true },
+        { value: 0, expected: true },
+        { value: '', expected: true },
+        { value: 'false', expected: true },
+        { value: [], expected: true },
+        { value: {}, expected: true },
+      ]
+
+      testCases.forEach(({ value, expected }) => {
+        const config = { registration_enabled: value as any }
+        const registrationEnabled = config.registration_enabled !== false
+        expect(registrationEnabled).toBe(expected)
+      })
+    })
+  })
+
+  describe('backend API response handling', () => {
+    it('should parse backend response with registration_enabled', () => {
+      const apiResponse = {
+        beta_mode: false,
+        default_coins: ['BTCUSDT'],
+        btc_eth_leverage: 5,
+        altcoin_leverage: 5,
+        registration_enabled: true,
+      }
+
+      expect(apiResponse.registration_enabled).toBe(true)
+    })
+
+    it('should handle backend response without registration_enabled', () => {
+      const apiResponse = {
+        beta_mode: false,
+        default_coins: ['BTCUSDT'],
+        btc_eth_leverage: 5,
+        altcoin_leverage: 5,
+      }
+
+      const registrationEnabled =
+        (apiResponse as any).registration_enabled !== false
+
+      expect(registrationEnabled).toBe(true)
+    })
+  })
+
+  describe('multi-location consistency', () => {
+    const systemConfig = { registration_enabled: false }
+
+    it('should have consistent behavior across LoginPage', () => {
+      const registrationEnabled = systemConfig?.registration_enabled !== false
+      expect(registrationEnabled).toBe(false)
+    })
+
+    it('should have consistent behavior across RegisterPage', () => {
+      const registrationEnabled = systemConfig?.registration_enabled !== false
+      expect(registrationEnabled).toBe(false)
+    })
+
+    it('should have consistent behavior across HeaderBar', () => {
+      const registrationEnabled = systemConfig?.registration_enabled !== false
+      expect(registrationEnabled).toBe(false)
+    })
+
+    it('should have consistent behavior across LoginModal', () => {
+      const registrationEnabled = systemConfig?.registration_enabled !== false
+      expect(registrationEnabled).toBe(false)
+    })
+  })
+})
diff --git a/web/src/pages/AITradersPage.tsx b/web/src/pages/AITradersPage.tsx
new file mode 100644
index 00000000..b662d6e7
--- /dev/null
+++ b/web/src/pages/AITradersPage.tsx
@@ -0,0 +1,248 @@
+import { useEffect } from 'react'
+import { useNavigate } from 'react-router-dom'
+import useSWR from 'swr'
+import { api } from '../lib/api'
+import { useLanguage } from '../contexts/LanguageContext'
+import { useAuth } from '../contexts/AuthContext'
+import { useTradersConfigStore, useTradersModalStore } from '../stores'
+import { useTraderActions } from '../hooks/useTraderActions'
+import { TraderConfigModal } from '../components/TraderConfigModal'
+import {
+  SignalSourceModal,
+  ModelConfigModal,
+  ExchangeConfigModal,
+} from '../components/traders'
+import { PageHeader } from '../components/traders/sections/PageHeader'
+import { SignalSourceWarning } from '../components/traders/sections/SignalSourceWarning'
+import { AIModelsSection } from '../components/traders/sections/AIModelsSection'
+import { ExchangesSection } from '../components/traders/sections/ExchangesSection'
+import { TradersGrid } from '../components/traders/sections/TradersGrid'
+
+interface AITradersPageProps {
+  onTraderSelect?: (traderId: string) => void
+}
+
+export function AITradersPage({ onTraderSelect }: AITradersPageProps) {
+  const { language } = useLanguage()
+  const { user, token } = useAuth()
+  const navigate = useNavigate()
+
+  // Zustand stores
+  const {
+    allModels,
+    allExchanges,
+    supportedModels,
+    supportedExchanges,
+    configuredModels,
+    configuredExchanges,
+    userSignalSource,
+    loadConfigs,
+    setAllModels,
+    setAllExchanges,
+    setUserSignalSource,
+  } = useTradersConfigStore()
+
+  const {
+    showCreateModal,
+    showEditModal,
+    showModelModal,
+    showExchangeModal,
+    showSignalSourceModal,
+    editingModel,
+    editingExchange,
+    editingTrader,
+    setShowCreateModal,
+    setShowEditModal,
+    setShowModelModal,
+    setShowExchangeModal,
+    setShowSignalSourceModal,
+    setEditingModel,
+    setEditingExchange,
+    setEditingTrader,
+  } = useTradersModalStore()
+
+  // SWR for traders data
+  const { data: traders, mutate: mutateTraders } = useSWR(
+    user && token ? 'traders' : null,
+    api.getTraders,
+    { refreshInterval: 5000 }
+  )
+
+  // Load configurations
+  useEffect(() => {
+    loadConfigs(user, token)
+  }, [user, token, loadConfigs])
+
+  // Business logic hook
+  const {
+    isModelInUse,
+    isExchangeInUse,
+    handleCreateTrader,
+    handleEditTrader,
+    handleSaveEditTrader,
+    handleDeleteTrader,
+    handleToggleTrader,
+    handleAddModel,
+    handleAddExchange,
+    handleModelClick,
+    handleExchangeClick,
+    handleSaveModel,
+    handleDeleteModel,
+    handleSaveExchange,
+    handleDeleteExchange,
+    handleSaveSignalSource,
+  } = useTraderActions({
+    traders,
+    allModels,
+    allExchanges,
+    supportedModels,
+    supportedExchanges,
+    language,
+    mutateTraders,
+    setAllModels,
+    setAllExchanges,
+    setUserSignalSource,
+    setShowCreateModal,
+    setShowEditModal,
+    setShowModelModal,
+    setShowExchangeModal,
+    setShowSignalSourceModal,
+    setEditingModel,
+    setEditingExchange,
+    editingTrader,
+    setEditingTrader,
+  })
+
+  // 计算派生状态
+  const enabledModels = allModels?.filter((m) => m.enabled) || []
+  const enabledExchanges =
+    allExchanges?.filter((e) => {
+      if (!e.enabled) return false
+      if (e.id === 'aster') {
+        return e.asterUser?.trim() && e.asterSigner?.trim()
+      }
+      if (e.id === 'hyperliquid') {
+        return e.hyperliquidWalletAddr?.trim()
+      }
+      return true
+    }) || []
+
+  // 检查是否需要显示信号源警告
+  const showSignalWarning =
+    traders?.some((t) => t.use_coin_pool || t.use_oi_top) &&
+    !userSignalSource.coinPoolUrl &&
+    !userSignalSource.oiTopUrl
+
+  // 处理交易员查看
+  const handleTraderSelect = (traderId: string) => {
+    if (onTraderSelect) {
+      onTraderSelect(traderId)
+    } else {
+      navigate(`/dashboard?trader=${traderId}`)
+    }
+  }
+
+  return (
+    <div className="space-y-4 md:space-y-6 animate-fade-in">
+      {/* Header */}
+      <PageHeader
+        language={language}
+        tradersCount={traders?.length || 0}
+        configuredModelsCount={configuredModels.length}
+        configuredExchangesCount={configuredExchanges.length}
+        onAddModel={handleAddModel}
+        onAddExchange={handleAddExchange}
+        onConfigureSignalSource={() => setShowSignalSourceModal(true)}
+        onCreateTrader={() => setShowCreateModal(true)}
+      />
+
+      {/* Signal Source Warning */}
+      {showSignalWarning && (
+        <SignalSourceWarning
+          language={language}
+          onConfigure={() => setShowSignalSourceModal(true)}
+        />
+      )}
+
+      {/* Configuration Status */}
+      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
+        <AIModelsSection
+          language={language}
+          configuredModels={configuredModels}
+          isModelInUse={isModelInUse}
+          onModelClick={handleModelClick}
+        />
+
+        <ExchangesSection
+          language={language}
+          configuredExchanges={configuredExchanges}
+          isExchangeInUse={isExchangeInUse}
+          onExchangeClick={handleExchangeClick}
+        />
+      </div>
+
+      {/* Traders Grid */}
+      <TradersGrid
+        language={language}
+        traders={traders}
+        onTraderSelect={handleTraderSelect}
+        onEditTrader={handleEditTrader}
+        onDeleteTrader={handleDeleteTrader}
+        onToggleTrader={handleToggleTrader}
+      />
+
+      {/* Modals */}
+      <TraderConfigModal
+        isOpen={showCreateModal}
+        onClose={() => setShowCreateModal(false)}
+        isEditMode={false}
+        availableModels={enabledModels}
+        availableExchanges={enabledExchanges}
+        onSave={handleCreateTrader}
+      />
+
+      <TraderConfigModal
+        isOpen={showEditModal}
+        onClose={() => setShowEditModal(false)}
+        isEditMode={true}
+        traderData={editingTrader}
+        availableModels={enabledModels}
+        availableExchanges={enabledExchanges}
+        onSave={handleSaveEditTrader}
+      />
+
+      {showModelModal && (
+        <ModelConfigModal
+          allModels={supportedModels}
+          configuredModels={allModels}
+          editingModelId={editingModel}
+          onSave={handleSaveModel}
+          onDelete={handleDeleteModel}
+          onClose={() => setShowModelModal(false)}
+          language={language}
+        />
+      )}
+
+      {showExchangeModal && (
+        <ExchangeConfigModal
+          allExchanges={supportedExchanges}
+          editingExchangeId={editingExchange}
+          onSave={handleSaveExchange}
+          onDelete={handleDeleteExchange}
+          onClose={() => setShowExchangeModal(false)}
+          language={language}
+        />
+      )}
+
+      {showSignalSourceModal && (
+        <SignalSourceModal
+          coinPoolUrl={userSignalSource.coinPoolUrl}
+          oiTopUrl={userSignalSource.oiTopUrl}
+          onSave={handleSaveSignalSource}
+          onClose={() => setShowSignalSourceModal(false)}
+          language={language}
+        />
+      )}
+    </div>
+  )
+}
diff --git a/web/src/pages/TraderDashboard.tsx b/web/src/pages/TraderDashboard.tsx
index 9d165603..d66a141b 100644
--- a/web/src/pages/TraderDashboard.tsx
+++ b/web/src/pages/TraderDashboard.tsx
@@ -282,6 +282,8 @@ export default function TraderDashboard() {
     )
   }
 
+  const highlightColor = '#60a5fa'
+
   return (
     <div>
       {/* Trader Header */}
@@ -346,7 +348,7 @@ export default function TraderDashboard() {
               style={{
                 color: selectedTrader.ai_model.includes('qwen')
                   ? '#c084fc'
-                  : '#60a5fa',
+                  : highlightColor,
               }}
             >
               {getModelDisplayName(
@@ -355,6 +357,10 @@ export default function TraderDashboard() {
               )}
             </span>
           </span>
+          <span>•</span>
+          <span>
+            Prompt: <span className="font-semibold" style={{ color: highlightColor }}>{selectedTrader.system_prompt_template || '-'}</span>
+          </span>
           {status && (
             <>
               <span>•</span>
diff --git a/web/src/routes/index.tsx b/web/src/routes/index.tsx
index b49164cf..d0793e48 100644
--- a/web/src/routes/index.tsx
+++ b/web/src/routes/index.tsx
@@ -7,7 +7,7 @@ import { LoginPage } from '../components/LoginPage'
 import { RegisterPage } from '../components/RegisterPage'
 import { ResetPasswordPage } from '../components/ResetPasswordPage'
 import { CompetitionPage } from '../components/CompetitionPage'
-import { AITradersPage } from '../components/AITradersPage'
+import { AITradersPage } from '../pages/AITradersPage'
 import TraderDashboard from '../pages/TraderDashboard'
 
 export const router = createBrowserRouter([
diff --git a/web/src/stores/index.ts b/web/src/stores/index.ts
new file mode 100644
index 00000000..e825ae04
--- /dev/null
+++ b/web/src/stores/index.ts
@@ -0,0 +1,2 @@
+export { useTradersConfigStore } from './tradersConfigStore'
+export { useTradersModalStore } from './tradersModalStore'
diff --git a/web/src/stores/tradersConfigStore.ts b/web/src/stores/tradersConfigStore.ts
new file mode 100644
index 00000000..b58f3a20
--- /dev/null
+++ b/web/src/stores/tradersConfigStore.ts
@@ -0,0 +1,128 @@
+import { create } from 'zustand'
+import type { AIModel, Exchange } from '../types'
+import { api } from '../lib/api'
+
+interface SignalSource {
+  coinPoolUrl: string
+  oiTopUrl: string
+}
+
+interface TradersConfigState {
+  // 数据
+  allModels: AIModel[]
+  allExchanges: Exchange[]
+  supportedModels: AIModel[]
+  supportedExchanges: Exchange[]
+  userSignalSource: SignalSource
+
+  // 计算属性
+  configuredModels: AIModel[]
+  configuredExchanges: Exchange[]
+
+  // Actions
+  setAllModels: (models: AIModel[]) => void
+  setAllExchanges: (exchanges: Exchange[]) => void
+  setSupportedModels: (models: AIModel[]) => void
+  setSupportedExchanges: (exchanges: Exchange[]) => void
+  setUserSignalSource: (source: SignalSource) => void
+
+  // 异步加载
+  loadConfigs: (user: any, token: string | null) => Promise<void>
+
+  // 重置
+  reset: () => void
+}
+
+const initialState = {
+  allModels: [],
+  allExchanges: [],
+  supportedModels: [],
+  supportedExchanges: [],
+  userSignalSource: { coinPoolUrl: '', oiTopUrl: '' },
+  configuredModels: [],
+  configuredExchanges: [],
+}
+
+export const useTradersConfigStore = create<TradersConfigState>((set, get) => ({
+  ...initialState,
+
+  setAllModels: (models) => {
+    set({ allModels: models })
+    // 更新 configuredModels
+    const configuredModels = models.filter((m) => {
+      return m.enabled || (m.customApiUrl && m.customApiUrl.trim() !== '')
+    })
+    set({ configuredModels })
+  },
+
+  setAllExchanges: (exchanges) => {
+    set({ allExchanges: exchanges })
+    // 更新 configuredExchanges
+    const configuredExchanges = exchanges.filter((e) => {
+      if (e.id === 'aster') {
+        return e.asterUser && e.asterUser.trim() !== ''
+      }
+      if (e.id === 'hyperliquid') {
+        return e.hyperliquidWalletAddr && e.hyperliquidWalletAddr.trim() !== ''
+      }
+      // 修复: 添加 enabled 判断,与原始逻辑保持一致
+      return e.enabled || (e.apiKey && e.apiKey.trim() !== '')
+    })
+    set({ configuredExchanges })
+  },
+
+  setSupportedModels: (models) => set({ supportedModels: models }),
+  setSupportedExchanges: (exchanges) => set({ supportedExchanges: exchanges }),
+  setUserSignalSource: (source) => set({ userSignalSource: source }),
+
+  loadConfigs: async (user, token) => {
+    if (!user || !token) {
+      // 未登录时只加载公开的支持模型和交易所
+      try {
+        const [supportedModels, supportedExchanges] = await Promise.all([
+          api.getSupportedModels(),
+          api.getSupportedExchanges(),
+        ])
+        get().setSupportedModels(supportedModels)
+        get().setSupportedExchanges(supportedExchanges)
+      } catch (err) {
+        console.error('Failed to load supported configs:', err)
+      }
+      return
+    }
+
+    try {
+      const [
+        modelConfigs,
+        exchangeConfigs,
+        supportedModels,
+        supportedExchanges,
+      ] = await Promise.all([
+        api.getModelConfigs(),
+        api.getExchangeConfigs(),
+        api.getSupportedModels(),
+        api.getSupportedExchanges(),
+      ])
+
+      get().setAllModels(modelConfigs)
+      get().setAllExchanges(exchangeConfigs)
+      get().setSupportedModels(supportedModels)
+      get().setSupportedExchanges(supportedExchanges)
+
+      // 加载用户信号源配置
+      try {
+        const signalSource = await api.getUserSignalSource()
+        get().setUserSignalSource({
+          coinPoolUrl: signalSource.coin_pool_url || '',
+          oiTopUrl: signalSource.oi_top_url || '',
+        })
+      } catch (error) {
+        console.log('📡 用户信号源配置暂未设置')
+      }
+    } catch (error) {
+      console.error('Failed to load configs:', error)
+    }
+  },
+
+  reset: () => set(initialState),
+}))
diff --git a/web/src/stores/tradersModalStore.ts b/web/src/stores/tradersModalStore.ts
new file mode 100644
index 00000000..e70a1912
--- /dev/null
+++ b/web/src/stores/tradersModalStore.ts
@@ -0,0 +1,79 @@
+import { create } from 'zustand'
+import type { TraderConfigData } from '../types'
+
+interface TradersModalState {
+  // Modal 显示状态
+  showCreateModal: boolean
+  showEditModal: boolean
+  showModelModal: boolean
+  showExchangeModal: boolean
+  showSignalSourceModal: boolean
+
+  // 编辑状态
+  editingModel: string | null
+  editingExchange: string | null
+  editingTrader: TraderConfigData | null
+
+  // Actions
+  setShowCreateModal: (show: boolean) => void
+  setShowEditModal: (show: boolean) => void
+  setShowModelModal: (show: boolean) => void
+  setShowExchangeModal: (show: boolean) => void
+  setShowSignalSourceModal: (show: boolean) => void
+
+  setEditingModel: (modelId: string | null) => void
+  setEditingExchange: (exchangeId: string | null) => void
+  setEditingTrader: (trader: TraderConfigData | null) => void
+
+  // 便捷方法
+  openModelModal: (modelId?: string) => void
+  closeModelModal: () => void
+  openExchangeModal: (exchangeId?: string) => void
+  closeExchangeModal: () => void
+
+  // 重置
+  reset: () => void
+}
+
+const initialState = {
+  showCreateModal: false,
+  showEditModal: false,
+  showModelModal: false,
+  showExchangeModal: false,
+  showSignalSourceModal: false,
+  editingModel: null,
+  editingExchange: null,
+  editingTrader: null,
+}
+
+export const useTradersModalStore = create<TradersModalState>((set) => ({
+  ...initialState,
+
+  setShowCreateModal: (show) => set({ showCreateModal: show }),
+  setShowEditModal: (show) => set({ showEditModal: show }),
+  setShowModelModal: (show) => set({ showModelModal: show }),
+  setShowExchangeModal: (show) => set({ showExchangeModal: show }),
+  setShowSignalSourceModal: (show) => set({ showSignalSourceModal: show }),
+
+  setEditingModel: (modelId) => set({ editingModel: modelId }),
+  setEditingExchange: (exchangeId) => set({ editingExchange: exchangeId }),
+  setEditingTrader: (trader) => set({ editingTrader: trader }),
+
+  openModelModal: (modelId) => {
+    set({ editingModel: modelId || null, showModelModal: true })
+  },
+
+  closeModelModal: () => {
+    set({ showModelModal: false, editingModel: null })
+  },
+
+  openExchangeModal: (exchangeId) => {
+    set({ editingExchange: exchangeId || null, showExchangeModal: true })
+  },
+
+  closeExchangeModal: () => {
+    set({ showExchangeModal: false, editingExchange: null })
+  },
+
+  reset: () => set(initialState),
+}))
diff --git a/web/src/types.ts b/web/src/types.ts
index 60ce44ed..8bf1e6bf 100644
--- a/web/src/types.ts
+++ b/web/src/types.ts
@@ -16,11 +16,10 @@ export interface SystemStatus {
 export interface AccountInfo {
   total_equity: number
   wallet_balance: number
-  unrealized_profit: number
+  unrealized_profit: number // 未实现盈亏（交易所API官方值）
   available_balance: number
   total_pnl: number
   total_pnl_pct: number
-  total_unrealized_pnl: number
   initial_balance: number
   daily_pnl: number
   position_count: number
@@ -94,6 +93,7 @@ export interface TraderInfo {
   custom_prompt?: string
   use_coin_pool?: boolean
   use_oi_top?: boolean
+  system_prompt_template?: string
 }
 
 export interface AIModel {
@@ -126,7 +126,7 @@ export interface CreateTraderRequest {
   name: string
   ai_model_id: string
   exchange_id: string
-  initial_balance: number
+  initial_balance?: number // 可选：创建时由后端自动获取，编辑时可手动更新
   scan_interval_minutes?: number
   btc_eth_leverage?: number
   altcoin_leverage?: number
